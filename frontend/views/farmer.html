<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Farmer | F2C</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/feather-icons"></script>
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f8fafc;
        }
        
        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(16, 185, 129, 0.1);
        }
        
        .role-toggle {
            transition: all 0.3s ease;
        }
        
        .role-toggle.active {
            background-color: #10b981;
            color: white;
        }
        
        .cart-item-enter {
            opacity: 0;
            transform: translateX(-20px);
        }
        
        .cart-item-enter-active {
            opacity: 1;
            transform: translateX(0);
            transition: all 300ms;
        }
    </style>
</head>
<body class="min-h-screen">
    <!-- Header -->
    <header class="bg-white shadow-sm">
        <div class="container mx-auto px-4 py-4 flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <i data-feather="shopping-bag" class="text-green-500"></i>
                <h1 class="text-2xl font-bold text-green-600">FarmFresh Connect</h1>
            </div>
            <div class="flex items-center space-x-4">
                <div class="flex bg-gray-100 rounded-full p-1">
                    <button id="customerToggle" class="role-toggle px-4 py-2 rounded-full active">Customer</button>
                    <button id="farmerToggle" class="role-toggle px-4 py-2 rounded-full">Farmer</button>
                </div>
                <button id="cartButton" class="relative p-2 rounded-full hover:bg-gray-100">
                    <i data-feather="shopping-cart" class="text-gray-600"></i>
                    <span id="cartCount" class="absolute -top-1 -right-1 bg-green-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center hidden">0</span>
                </button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">
        <!-- Customer View -->
        <div id="customerView">
            <div class="flex justify-between items-center mb-8">
                <h2 class="text-2xl font-bold text-gray-800">Fresh From Our Farms</h2>
                <div class="relative">
                    <input type="text" placeholder="Search products..." class="pl-10 pr-4 py-2 border rounded-full focus:outline-none focus:ring-2 focus:ring-green-500">
                    <i data-feather="search" class="absolute left-3 top-2.5 text-gray-400"></i>
                </div>
            </div>
            
            <!-- Product Grid -->
            <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
                <!-- Product cards will be dynamically inserted here -->
            </div>
        </div>
        
        <!-- Farmer View (Hidden by default) -->
        <div id="farmerView" class="hidden">
            <div class="flex justify-between items-center mb-8">
                <h2 class="text-2xl font-bold text-gray-800">Your Farm Dashboard</h2>
                <button id="addProductBtn" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-full flex items-center">
                    <i data-feather="plus" class="mr-2"></i> Add Product
                </button>
            </div>
            
            <!-- Inventory Table -->
            <div class="bg-white rounded-lg shadow overflow-hidden">
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Product</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Price</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Inventory</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="inventoryTable" class="bg-white divide-y divide-gray-200">
                            <!-- Inventory items will be dynamically inserted here -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Orders Section -->
            <div class="mt-12">
                <h3 class="text-xl font-semibold text-gray-800 mb-4">Pending Orders</h3>
                <div id="ordersList" class="space-y-4">
                    <!-- Orders will be dynamically inserted here -->
                </div>
            </div>
        </div>
    </main>

    <!-- Shopping Cart Sidebar -->
    <div id="cartSidebar" class="fixed inset-y-0 right-0 w-full sm:w-96 bg-white shadow-lg transform translate-x-full transition-transform duration-300 ease-in-out z-50">
        <div class="flex justify-between items-center p-4 border-b">
            <h3 class="text-lg font-semibold">Your Cart</h3>
            <button id="closeCart" class="p-2 rounded-full hover:bg-gray-100">
                <i data-feather="x"></i>
            </button>
        </div>
        <div id="cartItems" class="p-4 overflow-y-auto h-3/4">
            <!-- Cart items will be dynamically inserted here -->
        </div>
        <div class="absolute bottom-0 left-0 right-0 p-4 border-t bg-white">
            <div class="flex justify-between mb-4">
                <span class="font-medium">Subtotal:</span>
                <span id="cartSubtotal" class="font-semibold">$0.00</span>
            </div>
            <button id="checkoutBtn" class="w-full bg-green-500 hover:bg-green-600 text-white py-3 rounded-lg font-medium">
                Proceed to Checkout
            </button>
        </div>
    </div>

    <!-- Checkout Modal -->
    <div id="checkoutModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-md p-6">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-semibold">Checkout</h3>
                <button id="closeCheckout" class="p-2 rounded-full hover:bg-gray-100">
                    <i data-feather="x"></i>
                </button>
            </div>
            <form id="checkoutForm" class="space-y-4">
                <div>
                    <label for="name" class="block text-sm font-medium text-gray-700">Full Name</label>
                    <input type="text" id="name" name="name" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-green-500 focus:border-green-500">
                </div>
                <div>
                    <label for="address" class="block text-sm font-medium text-gray-700">Delivery Address</label>
                    <textarea id="address" name="address" rows="3" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-green-500 focus:border-green-500"></textarea>
                </div>
                <div>
                    <label for="phone" class="block text-sm font-medium text-gray-700">Phone Number</label>
                    <input type="tel" id="phone" name="phone" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-green-500 focus:border-green-500">
                </div>
                <div class="flex justify-between items-center pt-4 border-t">
                    <span class="font-medium">Total:</span>
                    <span id="checkoutTotal" class="font-semibold">$0.00</span>
                </div>
                <button type="submit" class="w-full bg-green-500 hover:bg-green-600 text-white py-3 rounded-lg font-medium">
                    Place Order
                </button>
            </form>
        </div>
    </div>

    <!-- Add Product Modal -->
    <div id="addProductModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-md p-6">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-semibold">Add New Product</h3>
                <button id="closeAddProduct" class="p-2 rounded-full hover:bg-gray-100">
                    <i data-feather="x"></i>
                </button>
            </div>
            <form id="addProductForm" class="space-y-4">
                <div>
                    <label for="productName" class="block text-sm font-medium text-gray-700">Product Name</label>
                    <input type="text" id="productName" name="productName" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-green-500 focus:border-green-500">
                </div>
                <div>
                    <label for="productPrice" class="block text-sm font-medium text-gray-700">Price</label>
                    <input type="number" id="productPrice" name="productPrice" min="0" step="0.01" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-green-500 focus:border-green-500">
                </div>
                <div>
                    <label for="productInventory" class="block text-sm font-medium text-gray-700">Inventory</label>
                    <input type="number" id="productInventory" name="productInventory" min="0" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-green-500 focus:border-green-500">
                </div>
                <div>
                    <label for="productUnit" class="block text-sm font-medium text-gray-700">Unit</label>
                    <select id="productUnit" name="productUnit" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-green-500 focus:border-green-500">
                        <option value="lb">Pound (lb)</option>
                        <option value="bunch">Bunch</option>
                        <option value="dozen">Dozen</option>
                        <option value="each">Each</option>
                    </select>
                </div>
                <button type="submit" class="w-full bg-green-500 hover:bg-green-600 text-white py-3 rounded-lg font-medium">
                    Add Product
                </button>
            </form>
        </div>
    </div>

    <!-- Order Confirmation Toast -->
    <div id="orderConfirmation" class="fixed bottom-4 left-1/2 transform -translate-x-1/2 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg hidden z-50">
        <div class="flex items-center space-x-2">
            <i data-feather="check-circle"></i>
            <span>Order placed successfully!</span>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-white border-t mt-12">
        <div class="container mx-auto px-4 py-6">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="mb-4 md:mb-0">
                    <div class="flex items-center space-x-2">
                        <i data-feather="shopping-bag" class="text-green-500"></i>
                        <span class="text-lg font-semibold text-green-600">FarmFresh Connect</span>
                    </div>
                    <p class="text-gray-600 mt-2">Connecting you directly with local farmers.</p>
                </div>
                <div class="flex space-x-6">
                    <a href="#" class="text-gray-600 hover:text-green-500"><i data-feather="facebook"></i></a>
                    <a href="#" class="text-gray-600 hover:text-green-500"><i data-feather="instagram"></i></a>
                    <a href="#" class="text-gray-600 hover:text-green-500"><i data-feather="twitter"></i></a>
                </div>
            </div>
            <div class="mt-6 pt-6 border-t text-center text-gray-500 text-sm">
                &copy; 2023 FarmFresh Connect. All rights reserved.
            </div>
        </div>
    </footer>

    <script>
        // Sample data - in a real app this would come from Firestore
        let products = [
            { id: '1', name: 'Organic Carrots', price: 2.99, inventory: 25, unit: 'lb', farmer: 'Green Valley Farm', image: 'http://static.photos/food/320x240/1' },
            { id: '2', name: 'Fresh Eggs', price: 4.50, inventory: 12, unit: 'dozen', farmer: 'Sunny Side Farm', image: 'http://static.photos/food/320x240/2' },
            { id: '3', name: 'Heirloom Tomatoes', price: 3.75, inventory: 8, unit: 'lb', farmer: 'Red Barn Produce', image: 'http://static.photos/food/320x240/3' },
            { id: '4', name: 'Organic Kale', price: 2.25, inventory: 15, unit: 'bunch', farmer: 'Green Valley Farm', image: 'http://static.photos/food/320x240/4' },
            { id: '5', name: 'Free-range Chicken', price: 8.99, inventory: 6, unit: 'lb', farmer: 'Happy Hens Farm', image: 'http://static.photos/food/320x240/5' },
            { id: '6', name: 'Raw Honey', price: 7.50, inventory: 10, unit: 'jar', farmer: 'Busy Bee Apiary', image: 'http://static.photos/food/320x240/6' },
            { id: '7', name: 'Whole Wheat Bread', price: 5.25, inventory: 7, unit: 'loaf', farmer: 'Golden Grain Bakery', image: 'http://static.photos/food/320x240/7' },
            { id: '8', name: 'Organic Apples', price: 1.99, inventory: 30, unit: 'lb', farmer: 'Orchard Hill Farm', image: 'http://static.photos/food/320x240/8' }
        ];

        let farmerProducts = products.filter(p => p.farmer === 'Green Valley Farm');
        let cart = [];
        let orders = [
            { id: '101', customer: 'John Doe', items: [{product: 'Organic Carrots', quantity: 2, price: 2.99}], total: 5.98, status: 'pending', date: '2023-05-15' },
            { id: '102', customer: 'Jane Smith', items: [{product: 'Fresh Eggs', quantity: 1, price: 4.50}, {product: 'Heirloom Tomatoes', quantity: 3, price: 3.75}], total: 15.75, status: 'confirmed', date: '2023-05-14' }
        ];

        // DOM Elements
        const customerView = document.getElementById('customerView');
        const farmerView = document.getElementById('farmerView');
        const customerToggle = document.getElementById('customerToggle');
        const farmerToggle = document.getElementById('farmerToggle');
        const cartButton = document.getElementById('cartButton');
        const cartCount = document.getElementById('cartCount');
        const cartSidebar = document.getElementById('cartSidebar');
        const closeCart = document.getElementById('closeCart');
        const cartItems = document.getElementById('cartItems');
        const cartSubtotal = document.getElementById('cartSubtotal');
        const checkoutBtn = document.getElementById('checkoutBtn');
        const checkoutModal = document.getElementById('checkoutModal');
        const closeCheckout = document.getElementById('closeCheckout');
        const checkoutForm = document.getElementById('checkoutForm');
        const checkoutTotal = document.getElementById('checkoutTotal');
        const addProductBtn = document.getElementById('addProductBtn');
        const addProductModal = document.getElementById('addProductModal');
        const closeAddProduct = document.getElementById('closeAddProduct');
        const addProductForm = document.getElementById('addProductForm');
        const inventoryTable = document.getElementById('inventoryTable');
        const ordersList = document.getElementById('ordersList');
        const orderConfirmation = document.getElementById('orderConfirmation');
        const productGrid = document.querySelector('#customerView .grid');

        // Initialize
        function init() {
            renderProducts();
            renderFarmerProducts();
            renderOrders();
            feather.replace();
            
            // Event listeners
            customerToggle.addEventListener('click', () => switchView('customer'));
            farmerToggle.addEventListener('click', () => switchView('farmer'));
            cartButton.addEventListener('click', toggleCart);
            closeCart.addEventListener('click', toggleCart);
            checkoutBtn.addEventListener('click', openCheckout);
            closeCheckout.addEventListener('click', closeCheckoutModal);
            checkoutForm.addEventListener('submit', placeOrder);
            addProductBtn.addEventListener('click', openAddProductModal);
            closeAddProduct.addEventListener('click', closeAddProductModal);
            addProductForm.addEventListener('submit', addNewProduct);
        }

        // Switch between customer and farmer views
        function switchView(view) {
            if (view === 'customer') {
                customerView.classList.remove('hidden');
                farmerView.classList.add('hidden');
                customerToggle.classList.add('active');
                farmerToggle.classList.remove('active');
            } else {
                customerView.classList.add('hidden');
                farmerView.classList.remove('hidden');
                customerToggle.classList.remove('active');
                farmerToggle.classList.add('active');
            }
        }

        // Render products for customers
        function renderProducts() {
            productGrid.innerHTML = '';
            products.forEach(product => {
                const productCard = document.createElement('div');
                productCard.className = 'product-card bg-white rounded-lg shadow-md overflow-hidden transition-all duration-300 cursor-pointer';
                productCard.innerHTML = `
                    <div class="h-48 bg-gray-100 overflow-hidden">
                        <img src="${product.image}" alt="${product.name}" class="w-full h-full object-cover">
                    </div>
                    <div class="p-4">
                        <h3 class="font-semibold text-lg mb-1">${product.name}</h3>
                        <p class="text-gray-600 text-sm mb-2">${product.farmer}</p>
                        <div class="flex justify-between items-center">
                            <div>
                                <span class="font-bold text-green-600">$${product.price.toFixed(2)}</span>
                                <span class="text-gray-500 text-sm ml-1">/ ${product.unit}</span>
                            </div>
                            <button data-id="${product.id}" class="add-to-cart bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded-full text-sm flex items-center">
                                <i data-feather="plus" class="w-4 h-4 mr-1"></i> Add
                            </button>
                        </div>
                    </div>
                `;
                productGrid.appendChild(productCard);
                
                // Add event listener to the button
                productCard.querySelector('.add-to-cart').addEventListener('click', (e) => {
                    e.stopPropagation();
                    addToCart(product);
                });
            });
            feather.replace();
        }

        // Add product to cart
        function addToCart(product) {
            const existingItem = cart.find(item => item.id === product.id);
            if (existingItem) {
                existingItem.quantity++;
            } else {
                cart.push({
                    id: product.id,
                    name: product.name,
                    price: product.price,
                    unit: product.unit,
                    quantity: 1
                });
            }
            updateCart();
            
            // Show cart count animation
            cartCount.classList.remove('hidden');
            cartCount.textContent = cart.reduce((total, item) => total + item.quantity, 0);
            cartCount.classList.add('animate-bounce');
            setTimeout(() => cartCount.classList.remove('animate-bounce'), 1000);
        }

        // Update cart UI
        function updateCart() {
            cartCount.textContent = cart.reduce((total, item) => total + item.quantity, 0);
            if (cart.length === 0) {
                cartCount.classList.add('hidden');
            } else {
                cartCount.classList.remove('hidden');
            }
            
            // Update cart items
            cartItems.innerHTML = '';
            if (cart.length === 0) {
                cartItems.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <i data-feather="shopping-cart" class="w-12 h-12 mx-auto mb-4"></i>
                        <p>Your cart is empty</p>
                    </div>
                `;
                feather.replace();
                return;
            }
            
            cart.forEach(item => {
                const cartItem = document.createElement('div');
                cartItem.className = 'flex justify-between items-center py-3 border-b';
                cartItem.innerHTML = `
                    <div>
                        <h4 class="font-medium">${item.name}</h4>
                        <p class="text-gray-500 text-sm">$${item.price.toFixed(2)} / ${item.unit}</p>
                    </div>
                    <div class="flex items-center">
                        <button data-id="${item.id}" class="decrease-quantity text-gray-500 hover:text-green-500 p-1">
                            <i data-feather="minus" class="w-4 h-4"></i>
                        </button>
                        <span class="mx-2">${item.quantity}</span>
                        <button data-id="${item.id}" class="increase-quantity text-gray-500 hover:text-green-500 p-1">
                            <i data-feather="plus" class="w-4 h-4"></i>
                        </button>
                        <button data-id="${item.id}" class="remove-item text-gray-500 hover:text-red-500 p-1 ml-2">
                            <i data-feather="trash-2" class="w-4 h-4"></i>
                        </button>
                    </div>
                `;
                cartItems.appendChild(cartItem);
            });
            feather.replace();
            
            // Calculate subtotal
            const subtotal = cart.reduce((total, item) => total + (item.price * item.quantity), 0);
            cartSubtotal.textContent = `$${subtotal.toFixed(2)}`;
            checkoutTotal.textContent = `$${subtotal.toFixed(2)}`;
            
            // Add event listeners to cart item buttons
            document.querySelectorAll('.decrease-quantity').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const id = e.currentTarget.getAttribute('data-id');
                    const item = cart.find(item => item.id === id);
                    if (item.quantity > 1) {
                        item.quantity--;
                    } else {
                        cart = cart.filter(item => item.id !== id);
                    }
                    updateCart();
                });
            });
            
            document.querySelectorAll('.increase-quantity').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const id = e.currentTarget.getAttribute('data-id');
                    const item = cart.find(item => item.id === id);
                    item.quantity++;
                    updateCart();
                });
            });
            
            document.querySelectorAll('.remove-item').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const id = e.currentTarget.getAttribute('data-id');
                    cart = cart.filter(item => item.id !== id);
                    updateCart();
                });
            });
        }

        // Toggle cart sidebar
        function toggleCart() {
            cartSidebar.classList.toggle('translate-x-full');
            // Update cart items when opening
            if (!cartSidebar.classList.contains('translate-x-full')) {
                updateCart();
            }
        }

        // Open checkout modal
        function openCheckout() {
            if (cart.length === 0) {
                alert('Your cart is empty');
                return;
            }
            checkoutModal.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }

        // Close checkout modal
        function closeCheckoutModal() {
            checkoutModal.classList.add('hidden');
            document.body.style.overflow = 'auto';
        }

        // Place order
        function placeOrder(e) {
            e.preventDefault();
            const name = document.getElementById('name').value;
            const address = document.getElementById('address').value;
            const phone = document.getElementById('phone').value;
            
            // In a real app, this would be saved to Firestore
            const newOrder = {
                id: Date.now().toString(),
                customer: name,
                items: cart.map(item => ({
                    product: item.name,
                    quantity: item.quantity,
                    price: item.price
                })),
                total: cart.reduce((total, item) => total + (item.price * item.quantity), 0),
                status: 'pending',
                date: new Date().toISOString().split('T')[0],
                address: address,
                phone: phone
            };
            
            orders.push(newOrder);
            
            // Clear cart
            cart = [];
            updateCart();
            closeCheckoutModal();
            checkoutForm.reset();
            
            // Show confirmation
            orderConfirmation.classList.remove('hidden');
            setTimeout(() => orderConfirmation.classList.add('hidden'), 3000);
            
            // If in farmer view, update orders list
            if (!farmerView.classList.contains('hidden')) {
                renderOrders();
            }
        }

        // Render farmer products
        function renderFarmerProducts() {
            inventoryTable.innerHTML = '';
            farmerProducts.forEach(product => {
                const row = document.createElement('tr');
                row.className = product.inventory < 5 ? 'bg-red-50' : '';
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="flex items-center">
                            <div class="flex-shrink-0 h-10 w-10">
                                <img class="h-10 w-10 rounded-full object-cover" src="${product.image}" alt="${product.name}">
                            </div>
                            <div class="ml-4">
                                <div class="text-sm font-medium text-gray-900">${product.name}</div>
                            </div>
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm text-gray-900">$${product.price.toFixed(2)}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm text-gray-900">${product.inventory}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${product.inventory > 0 ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                            ${product.inventory > 0 ? 'Available' : 'Out of stock'}
                        </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                        <button data-id="${product.id}" class="edit-product text-green-600 hover:text-green-900 mr-3">Edit</button>
                        <button data-id="${product.id}" class="delete-product text-red-600 hover:text-red-900">Delete</button>
                    </td>
                `;
                inventoryTable.appendChild(row);
                
                // Add event listeners
                row.querySelector('.edit-product').addEventListener('click', () => editProduct(product.id));
                row.querySelector('.delete-product').addEventListener('click', () => deleteProduct(product.id));
            });
        }

        // Edit product (in a real app, this would update Firestore)
        function editProduct(id) {
            const product = farmerProducts.find(p => p.id === id);
            if (product) {
                const newPrice = prompt('Enter new price:', product.price);
                if (newPrice !== null) {
                    product.price = parseFloat(newPrice);
                    const newInventory = prompt('Enter new inventory:', product.inventory);
                    if (newInventory !== null) {
                        product.inventory = parseInt(newInventory);
                        renderFarmerProducts();
                        // Also update the main products list
                        const mainProductIndex = products.findIndex(p => p.id === id);
                        if (mainProductIndex !== -1) {
                            products[mainProductIndex] = {...product};
                            renderProducts();
                        }
                    }
                }
            }
        }

        // Delete product
        function deleteProduct(id) {
            if (confirm('Are you sure you want to delete this product?')) {
                farmerProducts = farmerProducts.filter(p => p.id !== id);
                products = products.filter(p => p.id !== id);
                renderFarmerProducts();
                renderProducts();
            }
        }

        // Open add product modal
        function openAddProductModal() {
            addProductModal.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }

        // Close add product modal
        function closeAddProductModal() {
            addProductModal.classList.add('hidden');
            document.body.style.overflow = 'auto';
            addProductForm.reset();
        }

        // Add new product
        function addNewProduct(e) {
            e.preventDefault();
            const name = document.getElementById('productName').value;
            const price = parseFloat(document.getElementById('productPrice').value);
            const inventory = parseInt(document.getElementById('productInventory').value);
            const unit = document.getElementById('productUnit').value;
            
            // Generate a random image URL
            const randomImageId = Math.floor(Math.random() * 20) + 1;
            const imageUrl = `http://static.photos/food/320x240/${randomImageId}`;
            
            const newProduct = {
                id: Date.now().toString(),
                name: name,
                price: price,
                inventory: inventory,
                unit: unit,
                farmer: 'Green Valley Farm',
                image: imageUrl
            };
            
            farmerProducts.push(newProduct);
            products.push(newProduct);
            renderFarmerProducts();
            renderProducts();
            closeAddProductModal();
        }

        // Render orders for farmer
        function renderOrders() {
            ordersList.innerHTML = '';
            if (orders.length === 0) {
                ordersList.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <i data-feather="package" class="w-12 h-12 mx-auto mb-4"></i>
                        <p>No orders yet</p>
                    </div>
                `;
                feather.replace();
                return;
            }
            
            orders.forEach(order => {
                const orderCard = document.createElement('div');
                orderCard.className = 'bg-white rounded-lg shadow overflow-hidden';
                orderCard.innerHTML = `
                    <div class="p-4 border-b">
                        <div class="flex justify-between items-start">
                            <div>
                                <h4 class="font-semibold">Order #${order.id}</h4>
                                <p class="text-sm text-gray-600">${order.date}</p>
                            </div>
                            <span class="px-2 py-1 text-xs rounded-full ${order.status === 'pending' ? 'bg-yellow-100 text-yellow-800' : order.status === 'confirmed' ? 'bg-blue-100 text-blue-800' : 'bg-green-100 text-green-800'}">
                                ${order.status.charAt(0).toUpperCase() + order.status.slice(1)}
                            </span>
                        </div>
                        <div class="mt-2">
                            <p class="text-sm"><span class="font-medium">Customer:</span> ${order.customer}</p>
                            <p class="text-sm"><span class="font-medium">Address:</span> ${order.address}</p>
                            <p class="text-sm"><span class="font-medium">Phone:</span> ${order.phone}</p>
                        </div>
                    </div>
                    <div class="p-4 border-b">
                        ${order.items.map(item => `
                            <div class="flex justify-between py-2">
                                <div>${item.quantity} x ${item.product}</div>
                                <div class="font-medium">$${(item.quantity * item.price).toFixed(2)}</div>
                            </div>
                        `).join('')}
                    </div>
                    <div class="p-4 flex justify-between items-center">
                        <div class="font-bold">Total: $${order.total.toFixed(2)}</div>
                        ${order.status === 'pending' ? `
                            <button data-id="${order.id}" class="confirm-order bg-green-500 hover:bg-green-600 text-white px-4 py-1 rounded-full text-sm">
                                Confirm Order
                            </button>
                        ` : order.status === 'confirmed' ? `
                            <button data-id="${order.id}" class="mark-delivered bg-blue-500 hover:bg-blue-600 text-white px-4 py-1 rounded-full text-sm">
                                Mark as Delivered
                            </button>
                        ` : ''}
                    </div>
                `;
                ordersList.appendChild(orderCard);
                
                // Add event listeners to buttons
                if (order.status === 'pending') {
                    orderCard.querySelector('.confirm-order').addEventListener('click', () => updateOrderStatus(order.id, 'confirmed'));
                } else if (order.status === 'confirmed') {
                    orderCard.querySelector('.mark-delivered').addEventListener('click', () => updateOrderStatus(order.id, 'delivered'));
                }
            });
            feather.replace();
        }

        // Update order status
        function updateOrderStatus(id, status) {
            const order = orders.find(o => o.id === id);
            if (order) {
                order.status = status;
                renderOrders();
            }
        }

        // Initialize the app
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>