/*! For license information please see runner.js.LICENSE.txt */
(()=>{var e,t,r,n,i={796:(e,t,r)=>{"use strict";r.d(t,{Accessor:()=>K,AnimationChannel:()=>Q,BD:()=>$,oY:()=>C,i5:()=>I,hj:()=>ye,eY:()=>re,aw:()=>_,Pp:()=>P,MathUtils:()=>B,WV:()=>he,uS:()=>b,fC:()=>ge,TextureChannel:()=>S,lO:()=>ne,qi:()=>_e,A8:()=>E});class n{constructor(){this._listeners={}}addEventListener(e,t){const r=this._listeners;return void 0===r[e]&&(r[e]=[]),-1===r[e].indexOf(t)&&r[e].push(t),this}removeEventListener(e,t){if(void 0===this._listeners)return this;const r=this._listeners[e];if(void 0!==r){const e=r.indexOf(t);-1!==e&&r.splice(e,1)}return this}dispatchEvent(e){if(void 0===this._listeners)return this;const t=this._listeners[e.type];if(void 0!==t){const r=t.slice(0);for(let t=0,n=r.length;t<n;t++)r[t].call(this,e)}return this}dispose(){for(const e in this._listeners)delete this._listeners[e]}}class i extends n{constructor(e,t,r,n={}){if(super(),this._name=void 0,this._parent=void 0,this._child=void 0,this._attributes=void 0,this._disposed=!1,this._name=e,this._parent=t,this._child=r,this._attributes=n,!t.isOnGraph(r))throw new Error("Cannot connect disconnected graphs.")}getName(){return this._name}getParent(){return this._parent}getChild(){return this._child}setChild(e){return this._child=e,this}getAttributes(){return this._attributes}dispose(){this._disposed||(this._disposed=!0,this.dispatchEvent({type:"dispose",target:this}),super.dispose())}isDisposed(){return this._disposed}}function o(){return o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},o.apply(this,arguments)}function s(e){return e instanceof i}function a(e){return Array.isArray(e)&&e[0]instanceof i}function c(e){return!!(e&&"object"==typeof e&&Object.values(e)[0]instanceof i)}const l=Symbol("attributes"),u=Symbol("immutableKeys");class h extends n{constructor(e){super(),this._disposed=!1,this.graph=void 0,this[l]=void 0,this[u]=void 0,this.graph=e,this[u]=new Set,this[l]=this._createAttributes()}getDefaults(){return{}}_createAttributes(){const e=this.getDefaults(),t={};for(const r in e){const n=e[r];if(n instanceof h){const e=this.graph.createEdge(r,this,n);e.addEventListener("dispose",(()=>n.dispose())),this[u].add(r),t[r]=e}else t[r]=n}return t}isOnGraph(e){return this.graph===e.graph}isDisposed(){return this._disposed}dispose(){this._disposed||(this.graph.listChildEdges(this).forEach((e=>e.dispose())),this.graph.disconnectParents(this),this._disposed=!0,this.dispatchEvent({type:"dispose"}))}detach(){return this.graph.disconnectParents(this),this}swap(e,t){for(const r in this[l]){const n=this[l][r];if(s(n)){const i=n;i.getChild()===e&&this.setRef(r,t,i.getAttributes())}else if(a(n)){const i=n.find((t=>t.getChild()===e));if(i){const n=i.getAttributes();this.removeRef(r,e).addRef(r,t,n)}}else if(c(n)){const i=n;for(const n in i){const o=i[n];o.getChild()===e&&this.setRefMap(r,n,t,o.getAttributes())}}}return this}get(e){return this[l][e]}set(e,t){return this[l][e]=t,this.dispatchEvent({type:"change",attribute:e})}getRef(e){const t=this[l][e];return t?t.getChild():null}setRef(e,t,r){if(this[u].has(e))throw new Error(`Cannot overwrite immutable attribute, "${e}".`);const n=this[l][e];if(n&&n.dispose(),!t)return this;const i=this.graph.createEdge(e,this,t,r);return i.addEventListener("dispose",(()=>{delete this[l][e],this.dispatchEvent({type:"change",attribute:e})})),this[l][e]=i,this.dispatchEvent({type:"change",attribute:e})}listRefs(e){return this[l][e].map((e=>e.getChild()))}addRef(e,t,r){const n=this.graph.createEdge(e,this,t,r),i=this[l][e];return i.push(n),n.addEventListener("dispose",(()=>{const t=i.filter((e=>e!==n));i.length=0;for(const e of t)i.push(e);this.dispatchEvent({type:"change",attribute:e})})),this.dispatchEvent({type:"change",attribute:e})}removeRef(e,t){return this[l][e].filter((e=>e.getChild()===t)).forEach((e=>e.dispose())),this}listRefMapKeys(e){return Object.keys(this[l][e])}listRefMapValues(e){return Object.values(this[l][e]).map((e=>e.getChild()))}getRefMap(e,t){const r=this[l][e];return r[t]?r[t].getChild():null}setRefMap(e,t,r,n){const i=this[l][e],s=i[t];if(s&&s.dispose(),!r)return this;n=Object.assign(n||{},{key:t});const a=this.graph.createEdge(e,this,r,o({},n,{key:t}));return a.addEventListener("dispose",(()=>{delete i[t],this.dispatchEvent({type:"change",attribute:e,key:t})})),i[t]=a,this.dispatchEvent({type:"change",attribute:e,key:t})}dispatchEvent(e){return super.dispatchEvent(o({},e,{target:this})),this.graph.dispatchEvent(o({},e,{target:this,type:`node:${e.type}`})),this}}var p="undefined"!=typeof Float32Array?Float32Array:Array;Math.random;Math.PI;function d(e){var t=e[0],r=e[1],n=e[2];return Math.hypot(t,r,n)}function f(e,t,r){var n=t[0],i=t[1],o=t[2],s=r[3]*n+r[7]*i+r[11]*o+r[15];return s=s||1,e[0]=(r[0]*n+r[4]*i+r[8]*o+r[12])/s,e[1]=(r[1]*n+r[5]*i+r[9]*o+r[13])/s,e[2]=(r[2]*n+r[6]*i+r[10]*o+r[14])/s,e}Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var m,g;m=new p(3),p!=Float32Array&&(m[0]=0,m[1]=0,m[2]=0),g=m;function y(e,t,r){var n=t[0],i=t[1],o=t[2],s=t[3],a=t[4],c=t[5],l=t[6],u=t[7],h=t[8],p=t[9],d=t[10],f=t[11],m=t[12],g=t[13],y=t[14],v=t[15],_=r[0],b=r[1],x=r[2],w=r[3];return e[0]=_*n+b*a+x*h+w*m,e[1]=_*i+b*c+x*p+w*g,e[2]=_*o+b*l+x*d+w*y,e[3]=_*s+b*u+x*f+w*v,_=r[4],b=r[5],x=r[6],w=r[7],e[4]=_*n+b*a+x*h+w*m,e[5]=_*i+b*c+x*p+w*g,e[6]=_*o+b*l+x*d+w*y,e[7]=_*s+b*u+x*f+w*v,_=r[8],b=r[9],x=r[10],w=r[11],e[8]=_*n+b*a+x*h+w*m,e[9]=_*i+b*c+x*p+w*g,e[10]=_*o+b*l+x*d+w*y,e[11]=_*s+b*u+x*f+w*v,_=r[12],b=r[13],x=r[14],w=r[15],e[12]=_*n+b*a+x*h+w*m,e[13]=_*i+b*c+x*p+w*g,e[14]=_*o+b*l+x*d+w*y,e[15]=_*s+b*u+x*f+w*v,e}function v(e,t){var r=new p(3);!function(e,t){var r=t[0],n=t[1],i=t[2],o=t[4],s=t[5],a=t[6],c=t[8],l=t[9],u=t[10];e[0]=Math.hypot(r,n,i),e[1]=Math.hypot(o,s,a),e[2]=Math.hypot(c,l,u)}(r,t);var n=1/r[0],i=1/r[1],o=1/r[2],s=t[0]*n,a=t[1]*i,c=t[2]*o,l=t[4]*n,u=t[5]*i,h=t[6]*o,d=t[8]*n,f=t[9]*i,m=t[10]*o,g=s+u+m,y=0;return g>0?(y=2*Math.sqrt(g+1),e[3]=.25*y,e[0]=(h-f)/y,e[1]=(d-c)/y,e[2]=(a-l)/y):s>u&&s>m?(y=2*Math.sqrt(1+s-u-m),e[3]=(h-f)/y,e[0]=.25*y,e[1]=(a+l)/y,e[2]=(d+c)/y):u>m?(y=2*Math.sqrt(1+u-s-m),e[3]=(d-c)/y,e[0]=(a+l)/y,e[1]=.25*y,e[2]=(h+f)/y):(y=2*Math.sqrt(1+m-s-u),e[3]=(a-l)/y,e[0]=(d+c)/y,e[1]=(h+f)/y,e[2]=.25*y),e}const _="@glb.bin";var b,x,w,S,M,T;function E(e){const t={min:[1/0,1/0,1/0],max:[-1/0,-1/0,-1/0]},r=e.propertyType===b.NODE?[e]:e.listChildren();for(const e of r)e.traverse((e=>{const r=e.getMesh();if(!r)return;const n=A(r,e.getWorldMatrix());R(n.min,t),R(n.max,t)}));return t}function A(e,t){const r={min:[1/0,1/0,1/0],max:[-1/0,-1/0,-1/0]};for(const n of e.listPrimitives()){const e=n.getAttribute("POSITION");if(!e)continue;let i=[0,0,0],o=[0,0,0];for(let n=0;n<e.getCount();n++)i=e.getElement(n,i),o=f(o,i,t),R(o,r)}return r}function R(e,t){for(let r=0;r<3;r++)t.min[r]=Math.min(e[r],t.min[r]),t.max[r]=Math.max(e[r],t.max[r])}!function(e){e.ACCESSOR="Accessor",e.ANIMATION="Animation",e.ANIMATION_CHANNEL="AnimationChannel",e.ANIMATION_SAMPLER="AnimationSampler",e.BUFFER="Buffer",e.CAMERA="Camera",e.MATERIAL="Material",e.MESH="Mesh",e.PRIMITIVE="Primitive",e.PRIMITIVE_TARGET="PrimitiveTarget",e.NODE="Node",e.ROOT="Root",e.SCENE="Scene",e.SKIN="Skin",e.TEXTURE="Texture",e.TEXTURE_INFO="TextureInfo"}(b||(b={})),function(e){e.INTERLEAVED="interleaved",e.SEPARATE="separate"}(x||(x={})),function(e){e.ARRAY_BUFFER="ARRAY_BUFFER",e.ELEMENT_ARRAY_BUFFER="ELEMENT_ARRAY_BUFFER",e.INVERSE_BIND_MATRICES="INVERSE_BIND_MATRICES",e.OTHER="OTHER"}(w||(w={})),function(e){e[e.R=4096]="R",e[e.G=256]="G",e[e.B=16]="B",e[e.A=1]="A"}(S||(S={})),function(e){e.GLTF="GLTF",e.GLB="GLB"}(M||(M={}));class C{static createBufferFromDataURI(e){if("undefined"==typeof Buffer){const t=atob(e.split(",")[1]),r=new Uint8Array(t.length);for(let e=0;e<t.length;e++)r[e]=t.charCodeAt(e);return r}{const t=e.split(",")[1],r=e.indexOf("base64")>=0;return Buffer.from(t,r?"base64":"utf8")}}static encodeText(e){return"undefined"!=typeof TextEncoder?(new TextEncoder).encode(e):Buffer.from(e)}static decodeText(e){return"undefined"!=typeof TextDecoder?(new TextDecoder).decode(e):Buffer.from(e).toString("utf8")}static concat(e){let t=0;for(const r of e)t+=r.byteLength;const r=new Uint8Array(t);let n=0;for(const t of e)r.set(t,n),n+=t.byteLength;return r}static pad(e,t=0){const r=this.padNumber(e.byteLength);if(r===e.byteLength)return e;const n=new Uint8Array(r);if(n.set(e),0!==t)for(let i=e.byteLength;i<r;i++)n[i]=t;return n}static padNumber(e){return 4*Math.ceil(e/4)}static equals(e,t){if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;let r=e.byteLength;for(;r--;)if(e[r]!==t[r])return!1;return!0}static toView(e,t=0,r=1/0){return new Uint8Array(e.buffer,e.byteOffset+t,Math.min(e.byteLength,r))}static assertView(e){if(e&&!ArrayBuffer.isView(e))throw new Error(`Method requires Uint8Array parameter; received "${typeof e}".`);return e}}class I{static hexToFactor(e,t){e=Math.floor(e);const r=t;return r[0]=(e>>16&255)/255,r[1]=(e>>8&255)/255,r[2]=(255&e)/255,this.convertSRGBToLinear(t,t)}static factorToHex(e){const t=[...e],[r,n,i]=this.convertLinearToSRGB(e,t);return 255*r<<16^255*n<<8^255*i<<0}static convertSRGBToLinear(e,t){const r=e,n=t;for(let e=0;e<3;e++)n[e]=r[e]<.04045?.0773993808*r[e]:Math.pow(.9478672986*r[e]+.0521327014,2.4);return t}static convertLinearToSRGB(e,t){const r=e,n=t;for(let e=0;e<3;e++)n[e]=r[e]<.0031308?12.92*r[e]:1.055*Math.pow(r[e],.41666)-.055;return t}}class O{match(e){return e.length>=8&&137===e[0]&&80===e[1]&&78===e[2]&&71===e[3]&&13===e[4]&&10===e[5]&&26===e[6]&&10===e[7]}getSize(e){const t=new DataView(e.buffer,e.byteOffset);return C.decodeText(e.slice(12,16))===O.PNG_FRIED_CHUNK_NAME?[t.getUint32(32,!1),t.getUint32(36,!1)]:[t.getUint32(16,!1),t.getUint32(20,!1)]}getChannels(e){return 4}}O.PNG_FRIED_CHUNK_NAME="CgBI";class P{static registerFormat(e,t){this.impls[e]=t}static getMimeType(e){for(const t in this.impls)if(this.impls[t].match(e))return t;return null}static getSize(e,t){return this.impls[t]?this.impls[t].getSize(e):null}static getChannels(e,t){return this.impls[t]?this.impls[t].getChannels(e):null}static getMemSize(e,t){if(!this.impls[t])return null;if(this.impls[t].getGPUByteLength)return this.impls[t].getGPUByteLength(e);let r=0;const n=this.getSize(e,t);if(!n)return null;for(;n[0]>1||n[1]>1;)r+=n[0]*n[1]*4,n[0]=Math.max(Math.floor(n[0]/2),1),n[1]=Math.max(Math.floor(n[1]/2),1);return r+=4,r}static mimeTypeToExtension(e){return"image/jpeg"===e?"jpg":e.split("/").pop()}static extensionToMimeType(e){return"jpg"===e?"image/jpeg":`image/${e}`}}function N(e,t){if(t>e.byteLength)throw new TypeError("Corrupt JPG, exceeded buffer limits");if(255!==e.getUint8(t))throw new TypeError("Invalid JPG, marker table corrupted");return e}P.impls={"image/jpeg":new class{match(e){return e.length>=3&&255===e[0]&&216===e[1]&&255===e[2]}getSize(e){let t,r,n=new DataView(e.buffer,e.byteOffset+4);for(;n.byteLength;){if(t=n.getUint16(0,!1),N(n,t),r=n.getUint8(t+1),192===r||193===r||194===r)return[n.getUint16(t+7,!1),n.getUint16(t+5,!1)];n=new DataView(e.buffer,n.byteOffset+t+2)}throw new TypeError("Invalid JPG, no size found")}getChannels(e){return 3}},"image/png":new O};class L{static basename(e){const t=e.split(/[\\/]/).pop();return t.substring(0,t.lastIndexOf("."))}static extension(e){if(e.startsWith("data:image/")){const t=e.match(/data:(image\/\w+)/)[1];return P.mimeTypeToExtension(t)}return e.startsWith("data:model/gltf+json")?"gltf":e.startsWith("data:model/gltf-binary")?"glb":e.startsWith("data:application/")?"bin":e.split(/[\\/]/).pop().split(/[.]/).pop()}}function U(e){return"[object Object]"===Object.prototype.toString.call(e)}function D(e){if(!1===U(e))return!1;const t=e.constructor;if(void 0===t)return!0;const r=t.prototype;return!1!==U(r)&&!1!==Object.prototype.hasOwnProperty.call(r,"isPrototypeOf")}!function(e){e[e.SILENT=4]="SILENT",e[e.ERROR=3]="ERROR",e[e.WARN=2]="WARN",e[e.INFO=1]="INFO",e[e.DEBUG=0]="DEBUG"}(T||(T={}));class F{constructor(e){this.verbosity=void 0,this.verbosity=e}debug(e){this.verbosity<=F.Verbosity.DEBUG&&console.debug(e)}info(e){this.verbosity<=F.Verbosity.INFO&&console.info(e)}warn(e){this.verbosity<=F.Verbosity.WARN&&console.warn(e)}error(e){this.verbosity<=F.Verbosity.ERROR&&console.error(e)}}F.Verbosity=T,F.DEFAULT_INSTANCE=new F(F.Verbosity.INFO);class B{static identity(e){return e}static eq(e,t,r=1e-5){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(Math.abs(e[n]-t[n])>r)return!1;return!0}static denormalize(e,t){switch(t){case 5126:return e;case 5123:return e/65535;case 5121:return e/255;case 5122:return Math.max(e/32767,-1);case 5120:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}static normalize(e,t){switch(t){case 5126:return e;case 5123:return Math.round(65535*e);case 5121:return Math.round(255*e);case 5122:return Math.round(32767*e);case 5120:return Math.round(127*e);default:throw new Error("Invalid component type.")}}static decompose(e,t,r,n){let i=d([e[0],e[1],e[2]]);const o=d([e[4],e[5],e[6]]),s=d([e[8],e[9],e[10]]);(function(e){var t=e[0],r=e[1],n=e[2],i=e[3],o=e[4],s=e[5],a=e[6],c=e[7],l=e[8],u=e[9],h=e[10],p=e[11],d=e[12],f=e[13],m=e[14],g=e[15];return(t*s-r*o)*(h*g-p*m)-(t*a-n*o)*(u*g-p*f)+(t*c-i*o)*(u*m-h*f)+(r*a-n*s)*(l*g-p*d)-(r*c-i*s)*(l*m-h*d)+(n*c-i*a)*(l*f-u*d)})(e)<0&&(i=-i),t[0]=e[12],t[1]=e[13],t[2]=e[14];const a=e.slice(),c=1/i,l=1/o,u=1/s;a[0]*=c,a[1]*=c,a[2]*=c,a[4]*=l,a[5]*=l,a[6]*=l,a[8]*=u,a[9]*=u,a[10]*=u,v(r,a),n[0]=i,n[1]=o,n[2]=s}static compose(e,t,r,n){const i=n,o=t[0],s=t[1],a=t[2],c=t[3],l=o+o,u=s+s,h=a+a,p=o*l,d=o*u,f=o*h,m=s*u,g=s*h,y=a*h,v=c*l,_=c*u,b=c*h,x=r[0],w=r[1],S=r[2];return i[0]=(1-(m+y))*x,i[1]=(d+b)*x,i[2]=(f-_)*x,i[3]=0,i[4]=(d-b)*w,i[5]=(1-(p+y))*w,i[6]=(g+v)*w,i[7]=0,i[8]=(f+_)*S,i[9]=(g-v)*S,i[10]=(1-(p+m))*S,i[11]=0,i[12]=e[0],i[13]=e[1],i[14]=e[2],i[15]=1,i}}function k(e,t){if(!!e!=!!t)return!1;const r=e.getChild(),n=t.getChild();return r===n||r.equals(n)}function j(e,t){if(!!e!=!!t)return!1;if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++){const n=e[r],i=t[r];if(n.getChild()!==i.getChild()&&!n.getChild().equals(i.getChild()))return!1}return!0}function G(e,t){if(!!e!=!!t)return!1;const r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;for(const r in e){const n=e[r],i=t[r];if(!!n!=!!i)return!1;const o=n.getChild(),s=i.getChild();if(o!==s&&!o.equals(s))return!1}return!0}function z(e,t){if(e===t)return!0;if(!!e!=!!t||!e||!t)return!1;if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}function V(e,t){if(e===t)return!0;if(!!e!=!!t)return!1;if(!D(e)||!D(t))return e===t;const r=e,n=t;let i,o=0,s=0;for(i in r)o++;for(i in n)s++;if(o!==s)return!1;for(i in r){const e=r[i],t=n[i];if(H(e)&&H(t)){if(!z(e,t))return!1}else if(D(e)&&D(t)){if(!V(e,t))return!1}else if(e!==t)return!1}return!0}function H(e){return Array.isArray(e)||ArrayBuffer.isView(e)}new Set;class W{static dirname(e){const t=e.lastIndexOf("/");return-1===t?"./":e.substring(0,t+1)}static basename(e){return L.basename(new URL(e,"https://null.example").pathname)}static extension(e){return L.extension(new URL(e,"https://null.example").pathname)}static resolve(e,t){if(!this.isRelativePath(t))return t;const r=e.split("/"),n=t.split("/");r.pop();for(let e=0;e<n.length;e++)"."!==n[e]&&(".."===n[e]?r.pop():r.push(n[e]));return r.join("/")}static isAbsoluteURL(e){return this.PROTOCOL_REGEXP.test(e)}static isRelativePath(e){return!/^(?:[a-zA-Z]+:)?\//.test(e)}}W.DEFAULT_INIT={},W.PROTOCOL_REGEXP=/^[a-zA-Z]+:\/\//;const X=e=>e,Y=new Set;class q extends h{constructor(e,t=""){super(e),this[l].name=t,this.init(),this.dispatchEvent({type:"create"})}getDefaults(){return Object.assign(super.getDefaults(),{name:"",extras:{}})}getName(){return this.get("name")}setName(e){return this.set("name",e)}getExtras(){return this.get("extras")}setExtras(e){return this.set("extras",e)}clone(){return new(0,this.constructor)(this.graph).copy(this,X)}copy(e,t=X){for(const e in this[l]){const t=this[l][e];if(t instanceof i)this[u].has(e)||t.dispose();else if(a(t))for(const e of t)e.dispose();else if(c(t))for(const e in t)t[e].dispose()}for(const r in e[l]){const n=this[l][r],o=e[l][r];if(o instanceof i)this[u].has(r)?n.getChild().copy(t(o.getChild()),t):this.setRef(r,t(o.getChild()),o.getAttributes());else if(a(o))for(const e of o)this.addRef(r,t(e.getChild()),e.getAttributes());else if(c(o))for(const e in o){const n=o[e];this.setRefMap(r,e,t(n.getChild()),n.getAttributes())}else this[l][r]=D(o)?JSON.parse(JSON.stringify(o)):Array.isArray(o)||o instanceof ArrayBuffer||ArrayBuffer.isView(o)?o.slice():o}return this}equals(e,t=Y){if(this===e)return!0;if(this.propertyType!==e.propertyType)return!1;for(const r in this[l]){if(t.has(r))continue;const n=this[l][r],i=e[l][r];if(s(n)||s(i)){if(!k(n,i))return!1}else if(a(n)||a(i)){if(!j(n,i))return!1}else if(c(n)||c(i)){if(!G(n,i))return!1}else if(D(n)||D(i)){if(!V(n,i))return!1}else if(H(n)||H(i)){if(!z(n,i))return!1}else if(n!==i)return!1}return!0}detach(){return this.graph.disconnectParents(this,(e=>"Root"!==e.propertyType)),this}listParents(){return this.graph.listParents(this)}}class J extends q{getDefaults(){return Object.assign(super.getDefaults(),{extensions:{}})}getExtension(e){return this.getRefMap("extensions",e)}setExtension(e,t){return t&&t.t(this),this.setRefMap("extensions",e,t)}listExtensions(){return this.listRefMapValues("extensions")}}class K extends J{constructor(...e){super(...e),this.i=B.identity,this.o=B.identity}init(){this.propertyType=b.ACCESSOR}getDefaults(){return Object.assign(super.getDefaults(),{array:null,type:K.Type.SCALAR,componentType:K.ComponentType.FLOAT,normalized:!1,buffer:null})}copy(e,t=X){return super.copy(e,t),this.i=e.i,this.o=e.o,this}static getElementSize(e){switch(e){case K.Type.SCALAR:return 1;case K.Type.VEC2:return 2;case K.Type.VEC3:return 3;case K.Type.VEC4:case K.Type.MAT2:return 4;case K.Type.MAT3:return 9;case K.Type.MAT4:return 16;default:throw new Error("Unexpected type: "+e)}}static getComponentSize(e){switch(e){case K.ComponentType.BYTE:case K.ComponentType.UNSIGNED_BYTE:return 1;case K.ComponentType.SHORT:case K.ComponentType.UNSIGNED_SHORT:return 2;case K.ComponentType.UNSIGNED_INT:case K.ComponentType.FLOAT:return 4;default:throw new Error("Unexpected component type: "+e)}}getMinNormalized(e){const t=this.getElementSize();this.getMin(e);for(let r=0;r<t;r++)e[r]=this.o(e[r]);return e}getMin(e){const t=this.get("array"),r=this.getCount(),n=this.getElementSize();for(let t=0;t<n;t++)e[t]=1/0;for(let i=0;i<r*n;i+=n)for(let r=0;r<n;r++){const n=t[i+r];Number.isFinite(n)&&(e[r]=Math.min(e[r],n))}return e}getMaxNormalized(e){const t=this.getElementSize();this.getMax(e);for(let r=0;r<t;r++)e[r]=this.o(e[r]);return e}getMax(e){const t=this.get("array"),r=this.getCount(),n=this.getElementSize();for(let t=0;t<n;t++)e[t]=-1/0;for(let i=0;i<r*n;i+=n)for(let r=0;r<n;r++){const n=t[i+r];Number.isFinite(n)&&(e[r]=Math.max(e[r],n))}return e}getCount(){const e=this.get("array");return e?e.length/this.getElementSize():0}getType(){return this.get("type")}setType(e){return this.set("type",e)}getElementSize(){return K.getElementSize(this.get("type"))}getComponentSize(){return this.get("array").BYTES_PER_ELEMENT}getComponentType(){return this.get("componentType")}getNormalized(){return this.get("normalized")}setNormalized(e){return this.set("normalized",e),e?(this.o=e=>B.denormalize(e,this.get("componentType")),this.i=e=>B.normalize(e,this.get("componentType"))):(this.o=B.identity,this.i=B.identity),this}getScalar(e){const t=this.getElementSize();return this.o(this.get("array")[e*t])}setScalar(e,t){return this.get("array")[e*this.getElementSize()]=this.i(t),this}getElement(e,t){const r=this.getElementSize(),n=this.get("array");for(let i=0;i<r;i++)t[i]=this.o(n[e*r+i]);return t}setElement(e,t){const r=this.getElementSize(),n=this.get("array");for(let i=0;i<r;i++)n[e*r+i]=this.i(t[i]);return this}getBuffer(){return this.getRef("buffer")}setBuffer(e){return this.setRef("buffer",e)}getArray(){return this.get("array")}setArray(e){return this.set("componentType",e?function(e){switch(e.constructor){case Float32Array:return K.ComponentType.FLOAT;case Uint32Array:return K.ComponentType.UNSIGNED_INT;case Uint16Array:return K.ComponentType.UNSIGNED_SHORT;case Uint8Array:return K.ComponentType.UNSIGNED_BYTE;case Int16Array:return K.ComponentType.SHORT;case Int8Array:return K.ComponentType.BYTE;default:throw new Error("Unknown accessor componentType.")}}(e):K.ComponentType.FLOAT),this.set("array",e),this}getByteLength(){const e=this.get("array");return e?e.byteLength:0}}K.Type={SCALAR:"SCALAR",VEC2:"VEC2",VEC3:"VEC3",VEC4:"VEC4",MAT2:"MAT2",MAT3:"MAT3",MAT4:"MAT4"},K.ComponentType={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,UNSIGNED_INT:5125,FLOAT:5126};class Z extends J{init(){this.propertyType=b.ANIMATION}getDefaults(){return Object.assign(super.getDefaults(),{channels:[],samplers:[]})}addChannel(e){return this.addRef("channels",e)}removeChannel(e){return this.removeRef("channels",e)}listChannels(){return this.listRefs("channels")}addSampler(e){return this.addRef("samplers",e)}removeSampler(e){return this.removeRef("samplers",e)}listSamplers(){return this.listRefs("samplers")}}class Q extends J{init(){this.propertyType=b.ANIMATION_CHANNEL}getDefaults(){return Object.assign(super.getDefaults(),{targetPath:null,targetNode:null,sampler:null})}getTargetPath(){return this.get("targetPath")}setTargetPath(e){return this.set("targetPath",e)}getTargetNode(){return this.getRef("targetNode")}setTargetNode(e){return this.setRef("targetNode",e)}getSampler(){return this.getRef("sampler")}setSampler(e){return this.setRef("sampler",e)}}Q.TargetPath={TRANSLATION:"translation",ROTATION:"rotation",SCALE:"scale",WEIGHTS:"weights"};class $ extends J{init(){this.propertyType=b.ANIMATION_SAMPLER}getDefaultAttributes(){return Object.assign(super.getDefaults(),{interpolation:$.Interpolation.LINEAR,input:null,output:null})}getInterpolation(){return this.get("interpolation")}setInterpolation(e){return this.set("interpolation",e)}getInput(){return this.getRef("input")}setInput(e){return this.setRef("input",e,{usage:w.OTHER})}getOutput(){return this.getRef("output")}setOutput(e){return this.setRef("output",e,{usage:w.OTHER})}}$.Interpolation={LINEAR:"LINEAR",STEP:"STEP",CUBICSPLINE:"CUBICSPLINE"};class ee extends J{init(){this.propertyType=b.BUFFER}getDefaults(){return Object.assign(super.getDefaults(),{uri:""})}getURI(){return this.get("uri")}setURI(e){return this.set("uri",e)}}class te extends J{init(){this.propertyType=b.CAMERA}getDefaults(){return Object.assign(super.getDefaults(),{type:te.Type.PERSPECTIVE,znear:.1,zfar:100,aspectRatio:null,yfov:2*Math.PI*50/360,xmag:1,ymag:1})}getType(){return this.get("type")}setType(e){return this.set("type",e)}getZNear(){return this.get("znear")}setZNear(e){return this.set("znear",e)}getZFar(){return this.get("zfar")}setZFar(e){return this.set("zfar",e)}getAspectRatio(){return this.get("aspectRatio")}setAspectRatio(e){return this.set("aspectRatio",e)}getYFov(){return this.get("yfov")}setYFov(e){return this.set("yfov",e)}getXMag(){return this.get("xmag")}setXMag(e){return this.set("xmag",e)}getYMag(){return this.get("ymag")}setYMag(e){return this.set("ymag",e)}}te.Type={PERSPECTIVE:"perspective",ORTHOGRAPHIC:"orthographic"};class re extends q{t(e){if(!this.parentTypes.includes(e.propertyType))throw new Error(`Parent "${e.propertyType}" invalid for child "${this.propertyType}".`)}}re.EXTENSION_NAME=void 0;class ne extends J{init(){this.propertyType=b.TEXTURE_INFO}getDefaults(){return Object.assign(super.getDefaults(),{texCoord:0,magFilter:null,minFilter:null,wrapS:ne.WrapMode.REPEAT,wrapT:ne.WrapMode.REPEAT})}getTexCoord(){return this.get("texCoord")}setTexCoord(e){return this.set("texCoord",e)}getMagFilter(){return this.get("magFilter")}setMagFilter(e){return this.set("magFilter",e)}getMinFilter(){return this.get("minFilter")}setMinFilter(e){return this.set("minFilter",e)}getWrapS(){return this.get("wrapS")}setWrapS(e){return this.set("wrapS",e)}getWrapT(){return this.get("wrapT")}setWrapT(e){return this.set("wrapT",e)}}ne.WrapMode={CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497},ne.MagFilter={NEAREST:9728,LINEAR:9729},ne.MinFilter={NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987};const{R:ie,G:oe,B:se,A:ae}=S;class ce extends J{init(){this.propertyType=b.MATERIAL}getDefaults(){return Object.assign(super.getDefaults(),{alphaMode:ce.AlphaMode.OPAQUE,alphaCutoff:.5,doubleSided:!1,baseColorFactor:[1,1,1,1],baseColorTexture:null,baseColorTextureInfo:new ne(this.graph,"baseColorTextureInfo"),emissiveFactor:[0,0,0],emissiveTexture:null,emissiveTextureInfo:new ne(this.graph,"emissiveTextureInfo"),normalScale:1,normalTexture:null,normalTextureInfo:new ne(this.graph,"normalTextureInfo"),occlusionStrength:1,occlusionTexture:null,occlusionTextureInfo:new ne(this.graph,"occlusionTextureInfo"),roughnessFactor:1,metallicFactor:1,metallicRoughnessTexture:null,metallicRoughnessTextureInfo:new ne(this.graph,"metallicRoughnessTextureInfo")})}getDoubleSided(){return this.get("doubleSided")}setDoubleSided(e){return this.set("doubleSided",e)}getAlpha(){return this.get("baseColorFactor")[3]}setAlpha(e){const t=this.get("baseColorFactor").slice();return t[3]=e,this.set("baseColorFactor",t)}getAlphaMode(){return this.get("alphaMode")}setAlphaMode(e){return this.set("alphaMode",e)}getAlphaCutoff(){return this.get("alphaCutoff")}setAlphaCutoff(e){return this.set("alphaCutoff",e)}getBaseColorFactor(){return this.get("baseColorFactor")}setBaseColorFactor(e){return this.set("baseColorFactor",e)}getBaseColorHex(){return I.factorToHex(this.get("baseColorFactor"))}setBaseColorHex(e){const t=this.get("baseColorFactor").slice();return this.set("baseColorFactor",I.hexToFactor(e,t))}getBaseColorTexture(){return this.getRef("baseColorTexture")}getBaseColorTextureInfo(){return this.getRef("baseColorTexture")?this.getRef("baseColorTextureInfo"):null}setBaseColorTexture(e){return this.setRef("baseColorTexture",e,{channels:ie|oe|se|ae})}getEmissiveFactor(){return this.get("emissiveFactor")}setEmissiveFactor(e){return this.set("emissiveFactor",e)}getEmissiveHex(){return I.factorToHex(this.get("emissiveFactor"))}setEmissiveHex(e){const t=this.get("emissiveFactor").slice();return this.set("emissiveFactor",I.hexToFactor(e,t))}getEmissiveTexture(){return this.getRef("emissiveTexture")}getEmissiveTextureInfo(){return this.getRef("emissiveTexture")?this.getRef("emissiveTextureInfo"):null}setEmissiveTexture(e){return this.setRef("emissiveTexture",e,{channels:ie|oe|se})}getNormalScale(){return this.get("normalScale")}setNormalScale(e){return this.set("normalScale",e)}getNormalTexture(){return this.getRef("normalTexture")}getNormalTextureInfo(){return this.getRef("normalTexture")?this.getRef("normalTextureInfo"):null}setNormalTexture(e){return this.setRef("normalTexture",e,{channels:ie|oe|se})}getOcclusionStrength(){return this.get("occlusionStrength")}setOcclusionStrength(e){return this.set("occlusionStrength",e)}getOcclusionTexture(){return this.getRef("occlusionTexture")}getOcclusionTextureInfo(){return this.getRef("occlusionTexture")?this.getRef("occlusionTextureInfo"):null}setOcclusionTexture(e){return this.setRef("occlusionTexture",e,{channels:ie})}getRoughnessFactor(){return this.get("roughnessFactor")}setRoughnessFactor(e){return this.set("roughnessFactor",e)}getMetallicFactor(){return this.get("metallicFactor")}setMetallicFactor(e){return this.set("metallicFactor",e)}getMetallicRoughnessTexture(){return this.getRef("metallicRoughnessTexture")}getMetallicRoughnessTextureInfo(){return this.getRef("metallicRoughnessTexture")?this.getRef("metallicRoughnessTextureInfo"):null}setMetallicRoughnessTexture(e){return this.setRef("metallicRoughnessTexture",e,{channels:oe|se})}}ce.AlphaMode={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};class le extends J{init(){this.propertyType=b.MESH}getDefaults(){return Object.assign(super.getDefaults(),{weights:[],primitives:[]})}addPrimitive(e){return this.addRef("primitives",e)}removePrimitive(e){return this.removeRef("primitives",e)}listPrimitives(){return this.listRefs("primitives")}getWeights(){return this.get("weights")}setWeights(e){return this.set("weights",e)}}class ue extends J{constructor(...e){super(...e),this.u=null}init(){this.propertyType=b.NODE}getDefaults(){return Object.assign(super.getDefaults(),{translation:[0,0,0],rotation:[0,0,0,1],scale:[1,1,1],weights:[],camera:null,mesh:null,skin:null,children:[]})}copy(e,t=X){if(t===X)throw new Error("Node cannot be copied.");return super.copy(e,t)}getTranslation(){return this.get("translation")}getRotation(){return this.get("rotation")}getScale(){return this.get("scale")}setTranslation(e){return this.set("translation",e)}setRotation(e){return this.set("rotation",e)}setScale(e){return this.set("scale",e)}getMatrix(){return B.compose(this.get("translation"),this.get("rotation"),this.get("scale"),[])}setMatrix(e){const t=this.get("translation").slice(),r=this.get("rotation").slice(),n=this.get("scale").slice();return B.decompose(e,t,r,n),this.set("translation",t).set("rotation",r).set("scale",n)}getWorldTranslation(){const e=[0,0,0];return B.decompose(this.getWorldMatrix(),e,[0,0,0,1],[1,1,1]),e}getWorldRotation(){const e=[0,0,0,1];return B.decompose(this.getWorldMatrix(),[0,0,0],e,[1,1,1]),e}getWorldScale(){const e=[1,1,1];return B.decompose(this.getWorldMatrix(),[0,0,0],[0,0,0,1],e),e}getWorldMatrix(){const e=[];for(let t=this;t instanceof ue;t=t.u)e.push(t);let t;const r=e.pop().getMatrix();for(;t=e.pop();)y(r,r,t.getMatrix());return r}addChild(e){e.u&&e.u.removeChild(e),this.addRef("children",e),e.u=this;const t=this[l].children;return t[t.length-1].addEventListener("dispose",(()=>e.u=null)),this}removeChild(e){return this.removeRef("children",e)}listChildren(){return this.listRefs("children")}getParent(){return this.u}getMesh(){return this.getRef("mesh")}setMesh(e){return this.setRef("mesh",e)}getCamera(){return this.getRef("camera")}setCamera(e){return this.setRef("camera",e)}getSkin(){return this.getRef("skin")}setSkin(e){return this.setRef("skin",e)}getWeights(){return this.get("weights")}setWeights(e){return this.set("weights",e)}traverse(e){e(this);for(const t of this.listChildren())t.traverse(e);return this}}class he extends J{init(){this.propertyType=b.PRIMITIVE}getDefaults(){return Object.assign(super.getDefaults(),{mode:he.Mode.TRIANGLES,material:null,indices:null,attributes:{},targets:[]})}getIndices(){return this.getRef("indices")}setIndices(e){return this.setRef("indices",e,{usage:w.ELEMENT_ARRAY_BUFFER})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,t){return this.setRefMap("attributes",e,t,{usage:w.ARRAY_BUFFER})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}getMaterial(){return this.getRef("material")}setMaterial(e){return this.setRef("material",e)}getMode(){return this.get("mode")}setMode(e){return this.set("mode",e)}listTargets(){return this.listRefs("targets")}addTarget(e){return this.addRef("targets",e)}removeTarget(e){return this.removeRef("targets",e)}}he.Mode={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};function pe(){return(pe=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}class de extends J{init(){this.propertyType=b.SCENE}getDefaults(){return Object.assign(super.getDefaults(),{children:[]})}copy(e,t=X){if(t===X)throw new Error("Scene cannot be copied.");return super.copy(e,t)}addChild(e){e.u&&e.u.removeChild(e),this.addRef("children",e),e.u=this;const t=this[l].children;return t[t.length-1].addEventListener("dispose",(()=>e.u=null)),this}removeChild(e){return this.removeRef("children",e)}listChildren(){return this.listRefs("children")}traverse(e){for(const t of this.listChildren())t.traverse(e);return this}}class fe extends J{init(){this.propertyType=b.SKIN}getDefaults(){return Object.assign(super.getDefaults(),{skeleton:null,inverseBindMatrices:null,joints:[]})}getSkeleton(){return this.getRef("skeleton")}setSkeleton(e){return this.setRef("skeleton",e)}getInverseBindMatrices(){return this.getRef("inverseBindMatrices")}setInverseBindMatrices(e){return this.setRef("inverseBindMatrices",e,{usage:w.INVERSE_BIND_MATRICES})}addJoint(e){return this.addRef("joints",e)}removeJoint(e){return this.removeRef("joints",e)}listJoints(){return this.listRefs("joints")}}class me extends J{init(){this.propertyType=b.TEXTURE}getDefaults(){return Object.assign(super.getDefaults(),{image:null,mimeType:"",uri:""})}getMimeType(){return this.get("mimeType")||P.extensionToMimeType(L.extension(this.get("uri")))}setMimeType(e){return this.set("mimeType",e)}getURI(){return this.get("uri")}setURI(e){return this.set("uri",e),this.set("mimeType",P.extensionToMimeType(L.extension(e))),this}getImage(){return this.get("image")}setImage(e){return this.set("image",C.assertView(e))}getSize(){const e=this.get("image");return e?P.getSize(e,this.getMimeType()):null}}class ge extends J{init(){this.propertyType=b.ROOT}getDefaults(){return Object.assign(super.getDefaults(),{asset:{generator:"glTF-Transform v2.5.1",version:"2.0"},defaultScene:null,accessors:[],animations:[],buffers:[],cameras:[],materials:[],meshes:[],nodes:[],scenes:[],skins:[],textures:[]})}constructor(e){super(e),this.h=new Set,e.addEventListener("node:create",(e=>{this.l(e.target)}))}clone(){throw new Error("Root cannot be cloned.")}copy(e,t=X){if(t===X)throw new Error("Root cannot be copied.");this.set("asset",pe({},e.get("asset"))),this.setName(e.getName()),this.setExtras(pe({},e.getExtras())),this.setDefaultScene(e.getDefaultScene()?t(e.getDefaultScene()):null);for(const r of e.listRefMapKeys("extensions")){const n=e.getExtension(r);this.setExtension(r,t(n))}return this}l(e){return e instanceof de?this.addRef("scenes",e):e instanceof ue?this.addRef("nodes",e):e instanceof te?this.addRef("cameras",e):e instanceof fe?this.addRef("skins",e):e instanceof le?this.addRef("meshes",e):e instanceof ce?this.addRef("materials",e):e instanceof me?this.addRef("textures",e):e instanceof Z?this.addRef("animations",e):e instanceof K?this.addRef("accessors",e):e instanceof ee&&this.addRef("buffers",e),this}getAsset(){return this.get("asset")}listExtensionsUsed(){return Array.from(this.h)}listExtensionsRequired(){return this.listExtensionsUsed().filter((e=>e.isRequired()))}g(e){return this.h.add(e),this}p(e){return this.h.delete(e),this}listScenes(){return this.listRefs("scenes")}setDefaultScene(e){return this.setRef("defaultScene",e)}getDefaultScene(){return this.getRef("defaultScene")}listNodes(){return this.listRefs("nodes")}listCameras(){return this.listRefs("cameras")}listSkins(){return this.listRefs("skins")}listMeshes(){return this.listRefs("meshes")}listMaterials(){return this.listRefs("materials")}listTextures(){return this.listRefs("textures")}listAnimations(){return this.listRefs("animations")}listAccessors(){return this.listRefs("accessors")}listBuffers(){return this.listRefs("buffers")}}class ye{constructor(e){this.extensionName="",this.prereadTypes=[],this.prewriteTypes=[],this.readDependencies=[],this.writeDependencies=[],this.document=void 0,this.required=!1,this.properties=new Set,this.S=void 0,this.document=e,e.getRoot().g(this),this.S=e=>{const t=e,r=t.target;r instanceof re&&r.extensionName===this.extensionName&&("node:create"===t.type&&this.M(r),"node:dispose"===t.type&&this.I(r))};const t=e.getGraph();t.addEventListener("node:create",this.S),t.addEventListener("node:dispose",this.S)}dispose(){this.document.getRoot().p(this);const e=this.document.getGraph();e.removeEventListener("node:create",this.S),e.removeEventListener("node:dispose",this.S);for(const e of this.properties)e.dispose()}static register(){}isRequired(){return this.required}setRequired(e){return this.required=e,this}listProperties(){return Array.from(this.properties)}M(e){return this.properties.add(e),this}I(e){return this.properties.delete(e),this}install(e,t){return this}preread(e,t){return this}prewrite(e,t){return this}}ye.EXTENSION_NAME=void 0;Int8Array,Uint8Array,Int16Array,Uint16Array,Uint32Array,Float32Array,F.DEFAULT_INSTANCE;var ve;!function(e){e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"}(ve||(ve={}));class _e{constructor(e,t,r){this.N=void 0,this.jsonDoc=void 0,this.options=void 0,this.accessorIndexMap=new Map,this.animationIndexMap=new Map,this.bufferIndexMap=new Map,this.cameraIndexMap=new Map,this.skinIndexMap=new Map,this.materialIndexMap=new Map,this.meshIndexMap=new Map,this.nodeIndexMap=new Map,this.imageIndexMap=new Map,this.textureDefIndexMap=new Map,this.textureInfoDefMap=new Map,this.samplerDefIndexMap=new Map,this.sceneIndexMap=new Map,this.imageBufferViews=[],this.otherBufferViews=new Map,this.otherBufferViewsIndexMap=new Map,this.extensionData={},this.bufferURIGenerator=void 0,this.imageURIGenerator=void 0,this.logger=void 0,this.O=new Map,this.accessorUsageGroupedByParent=new Set(["ARRAY_BUFFER"]),this.accessorParents=new Map,this.N=e,this.jsonDoc=t,this.options=r;const n=e.getRoot(),i=n.listBuffers().length,o=n.listTextures().length;this.bufferURIGenerator=new be(i>1,(()=>r.basename||"buffer")),this.imageURIGenerator=new be(o>1,(t=>function(e,t){const r=e.getGraph().listParentEdges(t).find((t=>t.getParent()!==e.getRoot()));return r?r.getName().replace(/texture$/i,""):""}(e,t)||r.basename||"texture")),this.logger=e.getLogger()}createTextureInfoDef(e,t){const r={magFilter:t.getMagFilter()||void 0,minFilter:t.getMinFilter()||void 0,wrapS:t.getWrapS(),wrapT:t.getWrapT()},n=JSON.stringify(r);this.samplerDefIndexMap.has(n)||(this.samplerDefIndexMap.set(n,this.jsonDoc.json.samplers.length),this.jsonDoc.json.samplers.push(r));const i={source:this.imageIndexMap.get(e),sampler:this.samplerDefIndexMap.get(n)},o=JSON.stringify(i);this.textureDefIndexMap.has(o)||(this.textureDefIndexMap.set(o,this.jsonDoc.json.textures.length),this.jsonDoc.json.textures.push(i));const s={index:this.textureDefIndexMap.get(o)};return 0!==t.getTexCoord()&&(s.texCoord=t.getTexCoord()),Object.keys(t.getExtras()).length>0&&(s.extras=t.getExtras()),this.textureInfoDefMap.set(t,s),s}createPropertyDef(e){const t={};return e.getName()&&(t.name=e.getName()),Object.keys(e.getExtras()).length>0&&(t.extras=e.getExtras()),t}createAccessorDef(e){const t=this.createPropertyDef(e);return t.type=e.getType(),t.componentType=e.getComponentType(),t.count=e.getCount(),this.N.getGraph().listParentEdges(e).some((e=>"attributes"===e.getName()&&"POSITION"===e.getAttributes().key||"input"===e.getName()))&&(t.max=e.getMax([]).map(Math.fround),t.min=e.getMin([]).map(Math.fround)),e.getNormalized()&&(t.normalized=e.getNormalized()),t}createImageData(e,t,r){if(this.options.format===M.GLB)this.imageBufferViews.push(t),e.bufferView=this.jsonDoc.json.bufferViews.length,this.jsonDoc.json.bufferViews.push({buffer:0,byteOffset:-1,byteLength:t.byteLength});else{const n=P.mimeTypeToExtension(r.getMimeType());e.uri=this.imageURIGenerator.createURI(r,n),this.jsonDoc.resources[e.uri]=t}}getAccessorUsage(e){const t=this.O.get(e);if(t)return t;for(const t of this.N.getGraph().listParentEdges(e)){const{usage:e}=t.getAttributes();if(e)return e;t.getParent().propertyType!==b.ROOT&&this.N.getLogger().warn(`Missing attribute ".usage" on edge, "${t.getName()}".`)}return _e.BufferViewUsage.OTHER}addAccessorToUsageGroup(e,t){const r=this.O.get(e);if(r&&r!==t)throw new Error(`Accessor with usage "${r}" cannot be reused as "${t}".`);return this.O.set(e,t),this}listAccessorUsageGroups(){const e={};for(const[t,r]of Array.from(this.O.entries()))e[r]=e[r]||[],e[r].push(t);return e}}_e.BufferViewTarget=ve,_e.BufferViewUsage=w,_e.USAGE_TO_TARGET={[w.ARRAY_BUFFER]:ve.ARRAY_BUFFER,[w.ELEMENT_ARRAY_BUFFER]:ve.ELEMENT_ARRAY_BUFFER};class be{constructor(e,t){this.multiple=void 0,this.basename=void 0,this.counter={},this.multiple=e,this.basename=t}createURI(e,t){if(e.getURI())return e.getURI();if(this.multiple){const r=this.basename(e);return this.counter[r]=this.counter[r]||1,`${r}_${this.counter[r]++}.${t}`}return`${this.basename(e)}.${t}`}}const{BufferViewUsage:xe}=_e;var we;!function(e){e[e.JSON=1313821514]="JSON",e[e.BIN=5130562]="BIN"}(we||(we={}))},638:(e,t,r)=>{"use strict";r.d(t,{UG:()=>q,gQ:()=>pt,Ev:()=>ue,bI:()=>we,Nf:()=>De});var n=r(796);class i{constructor(){this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=0,this.levels=[],this.dataFormatDescriptor=[{vendorId:0,descriptorType:0,descriptorBlockSize:0,versionNumber:2,colorModel:0,colorPrimaries:1,transferFunction:2,flags:0,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}}class o{constructor(e,t,r,n){this._dataView=void 0,this._littleEndian=void 0,this._offset=void 0,this._dataView=new DataView(e.buffer,e.byteOffset+t,r),this._littleEndian=n,this._offset=0}_nextUint8(){const e=this._dataView.getUint8(this._offset);return this._offset+=1,e}_nextUint16(){const e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e}_nextUint32(){const e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint64(){const e=this._dataView.getUint32(this._offset,this._littleEndian)+2**32*this._dataView.getUint32(this._offset+4,this._littleEndian);return this._offset+=8,e}_nextInt32(){const e=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,e}_skip(e){return this._offset+=e,this}_scan(e,t=0){const r=this._offset;let n=0;for(;this._dataView.getUint8(this._offset)!==t&&n<e;)n++,this._offset++;return n<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+r,n)}}new Uint8Array([0]);const s=[171,75,84,88,32,50,48,187,13,10,26,10];function a(e){return"undefined"!=typeof TextDecoder?(new TextDecoder).decode(e):Buffer.from(e).toString("utf8")}function c(e){const t=new Uint8Array(e.buffer,e.byteOffset,s.length);if(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||t[3]!==s[3]||t[4]!==s[4]||t[5]!==s[5]||t[6]!==s[6]||t[7]!==s[7]||t[8]!==s[8]||t[9]!==s[9]||t[10]!==s[10]||t[11]!==s[11])throw new Error("Missing KTX 2.0 identifier.");const r=new i,n=17*Uint32Array.BYTES_PER_ELEMENT,c=new o(e,s.length,n,!0);r.vkFormat=c._nextUint32(),r.typeSize=c._nextUint32(),r.pixelWidth=c._nextUint32(),r.pixelHeight=c._nextUint32(),r.pixelDepth=c._nextUint32(),r.layerCount=c._nextUint32(),r.faceCount=c._nextUint32();const l=c._nextUint32();r.supercompressionScheme=c._nextUint32();const u=c._nextUint32(),h=c._nextUint32(),p=c._nextUint32(),d=c._nextUint32(),f=c._nextUint64(),m=c._nextUint64(),g=new o(e,s.length+n,3*l*8,!0);for(let t=0;t<l;t++)r.levels.push({levelData:new Uint8Array(e.buffer,e.byteOffset+g._nextUint64(),g._nextUint64()),uncompressedByteLength:g._nextUint64()});const y=new o(e,u,h,!0),v={vendorId:y._skip(4)._nextUint16(),descriptorType:y._nextUint16(),versionNumber:y._nextUint16(),descriptorBlockSize:y._nextUint16(),colorModel:y._nextUint8(),colorPrimaries:y._nextUint8(),transferFunction:y._nextUint8(),flags:y._nextUint8(),texelBlockDimension:[y._nextUint8(),y._nextUint8(),y._nextUint8(),y._nextUint8()],bytesPlane:[y._nextUint8(),y._nextUint8(),y._nextUint8(),y._nextUint8(),y._nextUint8(),y._nextUint8(),y._nextUint8(),y._nextUint8()],samples:[]},_=(v.descriptorBlockSize/4-6)/4;for(let e=0;e<_;e++){const t={bitOffset:y._nextUint16(),bitLength:y._nextUint8(),channelType:y._nextUint8(),samplePosition:[y._nextUint8(),y._nextUint8(),y._nextUint8(),y._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};64&t.channelType?(t.sampleLower=y._nextInt32(),t.sampleUpper=y._nextInt32()):(t.sampleLower=y._nextUint32(),t.sampleUpper=y._nextUint32()),v.samples[e]=t}r.dataFormatDescriptor.length=0,r.dataFormatDescriptor.push(v);const b=new o(e,p,d,!0);for(;b._offset<d;){const e=b._nextUint32(),t=b._scan(e),n=a(t),i=b._scan(e-t.byteLength);r.keyValue[n]=n.match(/^ktx/i)?a(i):i,b._offset%4&&b._skip(4-b._offset%4)}if(m<=0)return r;const x=new o(e,f,m,!0),w=x._nextUint16(),S=x._nextUint16(),M=x._nextUint32(),T=x._nextUint32(),E=x._nextUint32(),A=x._nextUint32(),R=[];for(let e=0;e<l;e++)R.push({imageFlags:x._nextUint32(),rgbSliceByteOffset:x._nextUint32(),rgbSliceByteLength:x._nextUint32(),alphaSliceByteOffset:x._nextUint32(),alphaSliceByteLength:x._nextUint32()});const C=f+x._offset,I=C+M,O=I+T,P=O+E,N=new Uint8Array(e.buffer,e.byteOffset+C,M),L=new Uint8Array(e.buffer,e.byteOffset+I,T),U=new Uint8Array(e.buffer,e.byteOffset+O,E),D=new Uint8Array(e.buffer,e.byteOffset+P,A);return r.globalData={endpointCount:w,selectorCount:S,imageDescs:R,endpointsData:N,selectorsData:L,tablesData:U,extendedData:D},r}class l extends n.eY{init(){this.extensionName="EXT_mesh_gpu_instancing",this.propertyType="InstancedMesh",this.parentTypes=[n.uS.NODE]}getDefaults(){return Object.assign(super.getDefaults(),{attributes:{}})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,t){return this.setRefMap("attributes",e,t,{usage:"INSTANCE_ATTRIBUTE"})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}}l.EXTENSION_NAME="EXT_mesh_gpu_instancing";const u="EXT_mesh_gpu_instancing";class h extends n.hj{constructor(...e){super(...e),this.extensionName=u,this.provideTypes=[n.uS.NODE],this.prewriteTypes=[n.uS.ACCESSOR]}createInstancedMesh(){return new l(this.document.getGraph())}read(e){return(e.jsonDoc.json.nodes||[]).forEach(((t,r)=>{if(!t.extensions||!t.extensions[u])return;const n=t.extensions[u],i=this.createInstancedMesh();for(const t in n.attributes)i.setAttribute(t,e.accessors[n.attributes[t]]);e.nodes[r].setExtension(u,i)})),this}prewrite(e){e.accessorUsageGroupedByParent.add("INSTANCE_ATTRIBUTE");for(const t of this.properties)for(const r of t.listAttributes())e.addAccessorToUsageGroup(r,"INSTANCE_ATTRIBUTE");return this}write(e){const t=e.jsonDoc;return this.document.getRoot().listNodes().forEach((r=>{const n=r.getExtension(u);if(n){const i=e.nodeIndexMap.get(r),o=t.json.nodes[i],s={attributes:{}};n.listSemantics().forEach((t=>{const r=n.getAttribute(t);s.attributes[t]=e.accessorIndexMap.get(r)})),o.extensions=o.extensions||{},o.extensions[u]=s}})),this}}function p(){return(p=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}var d,f,m;h.EXTENSION_NAME=u,function(e){e.QUANTIZE="quantize",e.FILTER="filter"}(d||(d={})),function(e){e.ATTRIBUTES="ATTRIBUTES",e.TRIANGLES="TRIANGLES",e.INDICES="INDICES"}(f||(f={})),function(e){e.NONE="NONE",e.OCTAHEDRAL="OCTAHEDRAL",e.QUATERNION="QUATERNION",e.EXPONENTIAL="EXPONENTIAL"}(m||(m={}));const{BYTE:g,SHORT:y,FLOAT:v}=n.Accessor.ComponentType,{normalize:_,denormalize:b}=n.MathUtils;function x(e,t,r,i){const{filter:o,bits:s}=i,a={array:e.getArray(),byteStride:e.getElementSize()*e.getComponentSize(),componentType:e.getComponentType(),normalized:e.getNormalized()};if(r!==f.ATTRIBUTES)return a;if(o!==m.NONE){let r=e.getNormalized()?function(e){const t=e.getComponentType(),r=e.getArray(),n=new Float32Array(r.length);for(let e=0;e<r.length;e++)n[e]=b(r[e],t);return n}(e):new Float32Array(a.array);switch(o){case m.EXPONENTIAL:a.byteStride=4*e.getElementSize(),a.componentType=v,a.normalized=!1,a.array=t.encodeFilterExp(r,e.getCount(),a.byteStride,s);break;case m.OCTAHEDRAL:a.byteStride=s>8?8:4,a.componentType=s>8?y:g,a.normalized=!0,r=3===e.getElementSize()?function(e){const t=new Float32Array(4*e.length/3);for(let r=0,n=e.length/3;r<n;r++)t[4*r]=e[3*r],t[4*r+1]=e[3*r+1],t[4*r+2]=e[3*r+2];return t}(r):r,a.array=t.encodeFilterOct(r,e.getCount(),a.byteStride,s);break;case m.QUATERNION:a.byteStride=8,a.componentType=y,a.normalized=!0,a.array=t.encodeFilterQuat(r,e.getCount(),a.byteStride,s);break;default:throw new Error("Invalid filter.")}a.min=e.getMin([]),a.max=e.getMax([]),e.getNormalized()&&(a.min=a.min.map((t=>b(t,e.getComponentType()))),a.max=a.max.map((t=>b(t,e.getComponentType())))),a.normalized&&(a.min=a.min.map((e=>_(e,a.componentType))),a.max=a.max.map((e=>_(e,a.componentType))))}else a.byteStride%4&&(a.array=function(e,t){const r=n.oY.padNumber(e.BYTES_PER_ELEMENT*t)/e.BYTES_PER_ELEMENT,i=new e.constructor(e.length/t*r);for(let n=0;n*t<e.length;n++)for(let o=0;o<t;o++)i[n*r+o]=e[n*t+o];return i}(a.array,e.getElementSize()),a.byteStride=a.array.byteLength/e.getCount());return a}function w(e,t){return t===n.qi.BufferViewUsage.ELEMENT_ARRAY_BUFFER?e.listParents().some((e=>e instanceof n.WV&&e.getMode()===n.WV.Mode.TRIANGLES))?f.TRIANGLES:f.INDICES:f.ATTRIBUTES}function S(e,t){const r=t.getGraph().listParentEdges(e).filter((e=>!(e.getParent()instanceof n.fC)));for(const t of r){const r=t.getName(),n=t.getAttributes().key||"";if("indices"===r)return{filter:m.NONE};if("attributes"===r){if("POSITION"===n)return{filter:m.NONE};if("TEXCOORD_0"===n)return{filter:m.NONE};if("NORMAL"===n)return{filter:m.OCTAHEDRAL,bits:8};if("TANGENT"===n)return{filter:m.OCTAHEDRAL,bits:8};if(n.startsWith("JOINTS_"))return{filter:m.NONE};if(n.startsWith("WEIGHTS_"))return{filter:m.NONE}}if("output"===r){const t=M(e);return"rotation"===t?{filter:m.QUATERNION,bits:16}:"translation"===t||"scale"===t?{filter:m.EXPONENTIAL,bits:12}:{filter:m.NONE}}if("input"===r)return{filter:m.NONE};if("inverseBindMatrices"===r)return{filter:m.NONE}}return{filter:m.NONE}}function M(e){for(const t of e.listParents())if(t instanceof n.BD)for(const e of t.listParents())if(e instanceof n.AnimationChannel)return e.getTargetPath();return null}const T="EXT_meshopt_compression",E={method:d.QUANTIZE};class A extends n.hj{constructor(...e){super(...e),this.extensionName=T,this.prereadTypes=[n.uS.BUFFER,n.uS.PRIMITIVE],this.prewriteTypes=[n.uS.BUFFER,n.uS.ACCESSOR],this.readDependencies=["meshopt.decoder"],this.writeDependencies=["meshopt.encoder"],this._decoder=null,this._decoderFallbackBufferMap=new Map,this._encoder=null,this._encoderOptions=E,this._encoderFallbackBuffer=null,this._encoderBufferViews={},this._encoderBufferViewData={},this._encoderBufferViewAccessors={}}install(e,t){return"meshopt.decoder"===e&&(this._decoder=t),"meshopt.encoder"===e&&(this._encoder=t),this}setEncoderOptions(e){return this._encoderOptions=p({},E,e),this}preread(e,t){if(!this._decoder){if(!this.isRequired())return this;throw new Error(`[${T}] Please install extension dependency, "meshopt.decoder".`)}if(!this._decoder.supported){if(!this.isRequired())return this;throw new Error(`[${T}]: Missing WASM support.`)}return t===n.uS.BUFFER?this._prereadBuffers(e):t===n.uS.PRIMITIVE&&this._prereadPrimitives(e),this}_prereadBuffers(e){const t=e.jsonDoc;(t.json.bufferViews||[]).forEach(((r,i)=>{if(!r.extensions||!r.extensions[T])return;const o=r.extensions[T],s=o.byteOffset||0,a=o.byteLength||0,c=o.count,l=o.byteStride,u=new Uint8Array(c*l),h=t.json.buffers[o.buffer],p=n.oY.toView(h.uri?t.resources[h.uri]:t.resources[n.aw],s,a);this._decoder.decodeGltfBuffer(u,c,l,p,o.mode,o.filter),e.bufferViews[i]=u}))}_prereadPrimitives(e){const t=e.jsonDoc;(t.json.bufferViews||[]).forEach((r=>{var n;r.extensions&&r.extensions[T]&&(n=t.json.buffers[r.buffer]).extensions&&n.extensions.EXT_meshopt_compression&&n.extensions.EXT_meshopt_compression.fallback&&this._decoderFallbackBufferMap.set(e.buffers[r.buffer],e.buffers[r.extensions[T].buffer])}))}read(e){if(!this.isRequired())return this;for(const[e,t]of this._decoderFallbackBufferMap){for(const r of e.listParents())r instanceof n.Accessor&&r.swap(e,t);e.dispose()}return this}prewrite(e,t){return t===n.uS.ACCESSOR?this._prewriteAccessors(e):t===n.uS.BUFFER&&this._prewriteBuffers(e),this}_prewriteAccessors(e){const t=e.jsonDoc.json,r=this._encoder,i=this._encoderOptions,o=this.document.createBuffer(),s=this.document.getRoot().listBuffers().indexOf(o);this._encoderFallbackBuffer=o,this._encoderBufferViews={},this._encoderBufferViewData={},this._encoderBufferViewAccessors={};for(const o of this.document.getRoot().listAccessors()){if("weights"===M(o))continue;const a=e.getAccessorUsage(o),c=w(o,a),l=i.method===d.FILTER?S(o,this.document):{filter:m.NONE},u=x(o,r,c,l),{array:h,byteStride:p}=u,f=o.getBuffer();if(!f)throw new Error(`${T}: Missing buffer for accessor.`);const g=this.document.getRoot().listBuffers().indexOf(f),y=[a,c,l.filter,p,g].join(":");let v=this._encoderBufferViews[y],_=this._encoderBufferViewData[y],b=this._encoderBufferViewAccessors[y];v&&_||(b=this._encoderBufferViewAccessors[y]=[],_=this._encoderBufferViewData[y]=[],v=this._encoderBufferViews[y]={buffer:s,target:n.qi.USAGE_TO_TARGET[a],byteOffset:0,byteLength:0,byteStride:a===n.qi.BufferViewUsage.ARRAY_BUFFER?p:void 0,extensions:{[T]:{buffer:g,byteOffset:0,byteLength:0,mode:c,filter:l.filter!==m.NONE?l.filter:void 0,byteStride:p,count:0}}});const E=e.createAccessorDef(o);E.componentType=u.componentType,E.normalized=u.normalized,E.byteOffset=v.byteLength,E.min&&u.min&&(E.min=u.min),E.max&&u.max&&(E.max=u.max),e.accessorIndexMap.set(o,t.accessors.length),t.accessors.push(E),b.push(E),_.push(new Uint8Array(h.buffer,h.byteOffset,h.byteLength)),v.byteLength+=h.byteLength,v.extensions.EXT_meshopt_compression.count+=o.getCount()}}_prewriteBuffers(e){const t=this._encoder;for(const r in this._encoderBufferViews){const i=this._encoderBufferViews[r],o=this._encoderBufferViewData[r],s=this.document.getRoot().listBuffers()[i.extensions[T].buffer],a=e.otherBufferViews.get(s)||[],{count:c,byteStride:l,mode:u}=i.extensions[T],h=n.oY.concat(o),p=t.encodeGltfBuffer(h,c,l,u),d=n.oY.pad(p);i.extensions[T].byteLength=p.byteLength,o.length=0,o.push(d),a.push(d),e.otherBufferViews.set(s,a)}}write(e){let t=0;for(const r in this._encoderBufferViews){const i=this._encoderBufferViews[r],o=e.otherBufferViewsIndexMap.get(this._encoderBufferViewData[r][0]),s=this._encoderBufferViewAccessors[r];for(const e of s)e.bufferView=o;const a=e.jsonDoc.json.bufferViews[o],c=a.byteOffset||0;Object.assign(a,i),a.byteOffset=t,a.extensions[T].byteOffset=c,t+=n.oY.padNumber(i.byteLength)}const r=this._encoderFallbackBuffer,i=e.bufferIndexMap.get(r),o=e.jsonDoc.json.buffers[i];return o.byteLength=t,o.extensions={[T]:{fallback:!0}},r.dispose(),this}}A.EXTENSION_NAME=T,A.EncoderMethod=d;const R="EXT_texture_webp";class C{match(e){return e.length>=12&&87===e[8]&&69===e[9]&&66===e[10]&&80===e[11]}getSize(e){const t=n.oY.decodeText(e.slice(0,4)),r=n.oY.decodeText(e.slice(8,12));if("RIFF"!==t||"WEBP"!==r)return null;const i=new DataView(e.buffer,e.byteOffset);let o=12;for(;o<i.byteLength;){const e=n.oY.decodeText(new Uint8Array([i.getUint8(o),i.getUint8(o+1),i.getUint8(o+2),i.getUint8(o+3)])),t=i.getUint32(o+4,!0);if("VP8 "===e)return[16383&i.getInt16(o+14,!0),16383&i.getInt16(o+16,!0)];if("VP8L"===e){const e=i.getUint8(o+9),t=i.getUint8(o+10),r=i.getUint8(o+11);return[1+((63&t)<<8|e),1+((15&i.getUint8(o+12))<<10|r<<2|(192&t)>>6)]}o+=8+t+t%2}return null}getChannels(e){return 4}}class I extends n.hj{constructor(...e){super(...e),this.extensionName=R,this.prereadTypes=[n.uS.TEXTURE]}static register(){n.Pp.registerFormat("image/webp",new C)}preread(e){return(e.jsonDoc.json.textures||[]).forEach((e=>{e.extensions&&e.extensions[R]&&(e.source=e.extensions[R].source)})),this}read(e){return this}write(e){const t=e.jsonDoc;return this.document.getRoot().listTextures().forEach((r=>{if("image/webp"===r.getMimeType()){const n=e.imageIndexMap.get(r);(t.json.textures||[]).forEach((e=>{e.source===n&&(e.extensions=e.extensions||{},e.extensions[R]={source:e.source},delete e.source)}))}})),this}}I.EXTENSION_NAME=R;const O="KHR_draco_mesh_compression";let P,N,L,U;function D(e,t){const r=new P.DecoderBuffer;try{if(r.Init(t,t.length),e.GetEncodedGeometryType(r)!==P.TRIANGULAR_MESH)throw new Error(`[${O}] Unknown geometry type.`);const n=new P.Mesh;if(!e.DecodeBufferToMesh(r,n).ok()||0===n.ptr)throw new Error(`[${O}] Decoding failure.`);return n}finally{P.destroy(r)}}function F(e,t){const r=3*t.num_faces();let n,i;if(t.num_points()<=65534){const o=r*Uint16Array.BYTES_PER_ELEMENT;n=P._malloc(o),e.GetTrianglesUInt16Array(t,o,n),i=new Uint16Array(P.HEAPU16.buffer,n,r).slice()}else{const o=r*Uint32Array.BYTES_PER_ELEMENT;n=P._malloc(o),e.GetTrianglesUInt32Array(t,o,n),i=new Uint32Array(P.HEAPU32.buffer,n,r).slice()}return P._free(n),i}function B(e,t,r,n){const i=L[n.componentType],o=N[n.componentType],s=r.num_components(),a=t.num_points()*s,c=a*o.BYTES_PER_ELEMENT,l=P._malloc(c);e.GetAttributeDataArrayForAllPoints(t,r,i,c,l);const u=new o(P.HEAPF32.buffer,l,a).slice();return P._free(l),u}var k,j;!function(e){e[e.EDGEBREAKER=1]="EDGEBREAKER",e[e.SEQUENTIAL=0]="SEQUENTIAL"}(k||(k={})),function(e){e.POSITION="POSITION",e.NORMAL="NORMAL",e.COLOR="COLOR",e.TEX_COORD="TEX_COORD",e.GENERIC="GENERIC"}(j||(j={}));const G={[j.POSITION]:14,[j.NORMAL]:10,[j.COLOR]:8,[j.TEX_COORD]:12,[j.GENERIC]:12},z={decodeSpeed:5,encodeSpeed:5,method:k.EDGEBREAKER,quantizationBits:G,quantizationVolume:"mesh"};function V(e,t=z){const r=p({},z,t);r.quantizationBits=p({},G,t.quantizationBits);const n=new U.Encoder,i=new U.MeshBuilder,o=new U.Mesh,s={},a=new U.DracoInt8Array;for(const t of e.listSemantics()){const a=e.getAttribute(t),c=H(t),l=W(i,a.getComponentType(),o,U[c],a.getCount(),a.getElementSize(),a.getArray());if(-1===l)throw new Error(`Error compressing "${t}" attribute.`);if(s[t]=l,"mesh"===r.quantizationVolume||"POSITION"!==t)n.SetAttributeQuantization(U[c],r.quantizationBits[c]);else{if("object"!=typeof r.quantizationVolume)throw new Error("Invalid quantization volume state.");{const{quantizationVolume:e}=r,t=Math.max(e.max[0]-e.min[0],e.max[1]-e.min[1],e.max[2]-e.min[2]);n.SetAttributeExplicitQuantization(U[c],r.quantizationBits[c],a.getElementSize(),e.min,t)}}}const c=e.getIndices();if(!c)throw new X("Primitive must have indices.");i.AddFacesToMesh(o,c.getCount()/3,c.getArray()),n.SetSpeedOptions(r.encodeSpeed,r.decodeSpeed),n.SetTrackEncodedProperties(!0),r.method===k.SEQUENTIAL||e.listTargets().length>0?n.SetEncodingMethod(U.MESH_SEQUENTIAL_ENCODING):n.SetEncodingMethod(U.MESH_EDGEBREAKER_ENCODING);const l=n.EncodeMeshToDracoBuffer(o,a);if(l<=0)throw new X("Error applying Draco compression.");const u=new Uint8Array(l);for(let e=0;e<l;++e)u[e]=a.GetValue(e);const h=e.getAttribute("POSITION").getCount(),d=n.GetNumberOfEncodedPoints(),f=3*n.GetNumberOfEncodedFaces();if(e.listTargets().length>0&&d!==h)throw new X('Compression reduced vertex count unexpectedly, corrupting morph targets. Applying the "weld" function before compression may resolve the issue.');return U.destroy(a),U.destroy(o),U.destroy(i),U.destroy(n),{numVertices:d,numIndices:f,data:u,attributeIDs:s}}function H(e){return"POSITION"===e?j.POSITION:"NORMAL"===e?j.NORMAL:e.startsWith("COLOR_")?j.COLOR:e.startsWith("TEXCOORD_")?j.TEX_COORD:j.GENERIC}function W(e,t,r,i,o,s,a){switch(t){case n.Accessor.ComponentType.UNSIGNED_BYTE:return e.AddUInt8Attribute(r,i,o,s,a);case n.Accessor.ComponentType.BYTE:return e.AddInt8Attribute(r,i,o,s,a);case n.Accessor.ComponentType.UNSIGNED_SHORT:return e.AddUInt16Attribute(r,i,o,s,a);case n.Accessor.ComponentType.SHORT:return e.AddInt16Attribute(r,i,o,s,a);case n.Accessor.ComponentType.UNSIGNED_INT:return e.AddUInt32Attribute(r,i,o,s,a);case n.Accessor.ComponentType.FLOAT:return e.AddFloatAttribute(r,i,o,s,a);default:throw new Error(`Unexpected component type, "${t}".`)}}class X extends Error{}const Y="KHR_draco_mesh_compression";class q extends n.hj{constructor(...e){super(...e),this.extensionName=Y,this.prereadTypes=[n.uS.PRIMITIVE],this.prewriteTypes=[n.uS.ACCESSOR],this.readDependencies=["draco3d.decoder"],this.writeDependencies=["draco3d.encoder"],this._decoderModule=null,this._encoderModule=null,this._encoderOptions={}}install(e,t){return"draco3d.decoder"===e&&(this._decoderModule=t,P=this._decoderModule,N={[n.Accessor.ComponentType.FLOAT]:Float32Array,[n.Accessor.ComponentType.UNSIGNED_INT]:Uint32Array,[n.Accessor.ComponentType.UNSIGNED_SHORT]:Uint16Array,[n.Accessor.ComponentType.UNSIGNED_BYTE]:Uint8Array,[n.Accessor.ComponentType.SHORT]:Int16Array,[n.Accessor.ComponentType.BYTE]:Int8Array},L={[n.Accessor.ComponentType.FLOAT]:P.DT_FLOAT32,[n.Accessor.ComponentType.UNSIGNED_INT]:P.DT_UINT32,[n.Accessor.ComponentType.UNSIGNED_SHORT]:P.DT_UINT16,[n.Accessor.ComponentType.UNSIGNED_BYTE]:P.DT_UINT8,[n.Accessor.ComponentType.SHORT]:P.DT_INT16,[n.Accessor.ComponentType.BYTE]:P.DT_INT8}),"draco3d.encoder"===e&&(this._encoderModule=t,U=this._encoderModule),this}setEncoderOptions(e){return this._encoderOptions=e,this}preread(e){if(!this._decoderModule)throw new Error(`[${Y}] Please install extension dependency, "draco3d.decoder".`);const t=this.document.getLogger(),r=e.jsonDoc,i=new Map;try{const o=r.json.meshes||[];for(const s of o)for(const o of s.primitives){if(!o.extensions||!o.extensions[Y])continue;const s=o.extensions[Y];let[a,c]=i.get(s.bufferView)||[];if(!c||!a){const e=r.json.bufferViews[s.bufferView],o=r.json.buffers[e.buffer],l=n.oY.toView(o.uri?r.resources[o.uri]:r.resources[n.aw],e.byteOffset||0,e.byteLength);a=new this._decoderModule.Decoder,c=D(a,l),i.set(s.bufferView,[a,c]),t.debug(`[${Y}] Decompressed ${l.byteLength} bytes.`)}for(const t in o.attributes){const r=e.jsonDoc.json.accessors[o.attributes[t]],n=a.GetAttributeByUniqueId(c,s.attributes[t]),i=B(a,c,n,r);e.accessors[o.attributes[t]].setArray(i)}void 0!==o.indices&&e.accessors[o.indices].setArray(F(a,c))}}finally{for(const[e,t]of Array.from(i.values()))this._decoderModule.destroy(e),this._decoderModule.destroy(t)}return this}read(e){return this}prewrite(e,t){if(!this._encoderModule)throw new Error(`[${Y}] Please install extension dependency, "draco3d.encoder".`);const r=this.document.getLogger();r.debug(`[${Y}] Compression options: ${JSON.stringify(this._encoderOptions)}`);const i=function(e){const t=e.getLogger(),r=new Set,i=new Set;for(const o of e.getRoot().listMeshes())for(const e of o.listPrimitives())e.getIndices()?e.getMode()!==n.WV.Mode.TRIANGLES?(i.add(e),t.warn(`[${Y}] Skipping Draco compression on non-TRIANGLES primitive.`)):r.add(e):(i.add(e),t.warn(`[${Y}] Skipping Draco compression on non-indexed primitive.`));const o=e.getRoot().listAccessors(),s=new Map;for(let e=0;e<o.length;e++)s.set(o[e],e);const a=new Map,c=new Set,l=new Map;for(const t of Array.from(r)){let r=J(t,s);if(c.has(r))l.set(t,r);else{if(a.has(t.getIndices())){const r=t.getIndices(),n=r.clone();s.set(n,e.getRoot().listAccessors().length-1),t.swap(r,n)}for(const r of t.listAttributes())if(a.has(r)){const n=r.clone();s.set(n,e.getRoot().listAccessors().length-1),t.swap(r,n)}r=J(t,s),c.add(r),l.set(t,r),a.set(t.getIndices(),r);for(const e of t.listAttributes())a.set(e,r)}}for(const e of Array.from(a.keys())){const t=new Set(e.listParents().map((e=>e.propertyType)));if(2!==t.size||!t.has(n.uS.PRIMITIVE)||!t.has(n.uS.ROOT))throw new Error(`[${Y}] Compressed accessors must only be used as indices or vertex attributes.`)}for(const e of Array.from(r)){const t=l.get(e),r=e.getIndices();if(a.get(r)!==t||e.listAttributes().some((e=>a.get(e)!==t)))throw new Error(`[${Y}] Draco primitives must share all, or no, accessors.`)}for(const e of Array.from(i)){const t=e.getIndices();if(a.has(t)||e.listAttributes().some((e=>a.has(e))))throw new Error(`[${Y}] Accessor cannot be shared by compressed and uncompressed primitives.`)}return l}(this.document),o=new Map;let s="mesh";"scene"===this._encoderOptions.quantizationVolume&&(1!==this.document.getRoot().listScenes().length?r.warn(`[${Y}]: quantizationVolume=scene requires exactly 1 scene.`):s=(0,n.A8)(this.document.getRoot().listScenes().pop()));for(const t of Array.from(i.keys())){const n=i.get(t);if(!n)throw new Error("Unexpected primitive.");if(o.has(n)){o.set(n,o.get(n));continue}const a=t.getIndices(),c=e.jsonDoc.json.accessors;let l;try{l=V(t,p({},this._encoderOptions,{quantizationVolume:s}))}catch(e){if(e instanceof X){r.warn(`[${Y}]: ${e.message} Skipping primitive compression.`);continue}throw e}o.set(n,l);const u=e.createAccessorDef(a);u.count=l.numIndices,e.accessorIndexMap.set(a,c.length),c.push(u);for(const r of t.listSemantics()){const n=t.getAttribute(r),i=e.createAccessorDef(n);i.count=l.numVertices,e.accessorIndexMap.set(n,c.length),c.push(i)}const h=t.getAttribute("POSITION").getBuffer()||this.document.getRoot().listBuffers()[0];e.otherBufferViews.has(h)||e.otherBufferViews.set(h,[]),e.otherBufferViews.get(h).push(l.data)}return r.debug(`[${Y}] Compressed ${i.size} primitives.`),e.extensionData[Y]={primitiveHashMap:i,primitiveEncodingMap:o},this}write(e){const t=e.extensionData[Y];for(const r of this.document.getRoot().listMeshes()){const n=e.jsonDoc.json.meshes[e.meshIndexMap.get(r)];for(let i=0;i<r.listPrimitives().length;i++){const o=r.listPrimitives()[i],s=n.primitives[i],a=t.primitiveHashMap.get(o);if(!a)continue;const c=t.primitiveEncodingMap.get(a);c&&(s.extensions=s.extensions||{},s.extensions[Y]={bufferView:e.otherBufferViewsIndexMap.get(c.data),attributes:c.attributeIDs})}}if(!t.primitiveHashMap.size){const t=e.jsonDoc.json;t.extensionsUsed=(t.extensionsUsed||[]).filter((e=>e!==Y)),t.extensionsRequired=(t.extensionsRequired||[]).filter((e=>e!==Y))}return this}}function J(e,t){const r=[],n=e.getIndices();r.push(t.get(n));for(const n of e.listAttributes())r.push(t.get(n));return r.sort().join("|")}q.EXTENSION_NAME=Y,q.EncoderMethod=k;class K extends n.eY{init(){this.extensionName="KHR_lights_punctual",this.propertyType="Light",this.parentTypes=[n.uS.NODE]}getDefaults(){return Object.assign(super.getDefaults(),{color:[1,1,1],intensity:1,type:K.Type.POINT,range:null,innerConeAngle:0,outerConeAngle:Math.PI/4})}getColor(){return this.get("color")}setColor(e){return this.set("color",e)}getColorHex(){return n.i5.factorToHex(this.getColor())}setColorHex(e){const t=this.getColor().slice();return n.i5.hexToFactor(e,t),this.setColor(t)}getIntensity(){return this.get("intensity")}setIntensity(e){return this.set("intensity",e)}getType(){return this.get("type")}setType(e){return this.set("type",e)}getRange(){return this.get("range")}setRange(e){return this.set("range",e)}getInnerConeAngle(){return this.get("innerConeAngle")}setInnerConeAngle(e){return this.set("innerConeAngle",e)}getOuterConeAngle(){return this.get("outerConeAngle")}setOuterConeAngle(e){return this.set("outerConeAngle",e)}}K.EXTENSION_NAME="KHR_lights_punctual",K.Type={POINT:"point",SPOT:"spot",DIRECTIONAL:"directional"};const Z="KHR_lights_punctual";class Q extends n.hj{constructor(...e){super(...e),this.extensionName=Z}createLight(e=""){return new K(this.document.getGraph(),e)}read(e){const t=e.jsonDoc;if(!t.json.extensions||!t.json.extensions[Z])return this;const r=(t.json.extensions[Z].lights||[]).map((e=>{var t,r;const n=this.createLight().setName(e.name||"").setType(e.type);return void 0!==e.color&&n.setColor(e.color),void 0!==e.intensity&&n.setIntensity(e.intensity),void 0!==e.range&&n.setRange(e.range),void 0!==(null==(t=e.spot)?void 0:t.innerConeAngle)&&n.setInnerConeAngle(e.spot.innerConeAngle),void 0!==(null==(r=e.spot)?void 0:r.outerConeAngle)&&n.setOuterConeAngle(e.spot.outerConeAngle),n}));return t.json.nodes.forEach(((t,n)=>{t.extensions&&t.extensions[Z]&&e.nodes[n].setExtension(Z,r[t.extensions[Z].light])})),this}write(e){const t=e.jsonDoc;if(0===this.properties.size)return this;const r=[],i=new Map;for(const e of this.properties){const t=e,o={type:t.getType()};n.MathUtils.eq(t.getColor(),[1,1,1])||(o.color=t.getColor()),1!==t.getIntensity()&&(o.intensity=t.getIntensity()),null!=t.getRange()&&(o.range=t.getRange()),t.getName()&&(o.name=t.getName()),t.getType()===K.Type.SPOT&&(o.spot={innerConeAngle:t.getInnerConeAngle(),outerConeAngle:t.getOuterConeAngle()}),r.push(o),i.set(t,r.length-1)}return this.document.getRoot().listNodes().forEach((r=>{const n=r.getExtension(Z);if(n){const o=e.nodeIndexMap.get(r),s=t.json.nodes[o];s.extensions=s.extensions||{},s.extensions[Z]={light:i.get(n)}}})),t.json.extensions=t.json.extensions||{},t.json.extensions[Z]={lights:r},this}}Q.EXTENSION_NAME=Z;const{R:$,G:ee,B:te}=n.TextureChannel;class re extends n.eY{init(){this.extensionName="KHR_materials_clearcoat",this.propertyType="Clearcoat",this.parentTypes=[n.uS.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{clearcoatFactor:0,clearcoatTexture:null,clearcoatTextureInfo:new n.lO(this.graph,"clearcoatTextureInfo"),clearcoatRoughnessFactor:0,clearcoatRoughnessTexture:null,clearcoatRoughnessTextureInfo:new n.lO(this.graph,"clearcoatRoughnessTextureInfo"),clearcoatNormalScale:1,clearcoatNormalTexture:null,clearcoatNormalTextureInfo:new n.lO(this.graph,"clearcoatNormalTextureInfo")})}getClearcoatFactor(){return this.get("clearcoatFactor")}setClearcoatFactor(e){return this.set("clearcoatFactor",e)}getClearcoatTexture(){return this.getRef("clearcoatTexture")}getClearcoatTextureInfo(){return this.getRef("clearcoatTexture")?this.getRef("clearcoatTextureInfo"):null}setClearcoatTexture(e){return this.setRef("clearcoatTexture",e,{channels:$})}getClearcoatRoughnessFactor(){return this.get("clearcoatRoughnessFactor")}setClearcoatRoughnessFactor(e){return this.set("clearcoatRoughnessFactor",e)}getClearcoatRoughnessTexture(){return this.getRef("clearcoatRoughnessTexture")}getClearcoatRoughnessTextureInfo(){return this.getRef("clearcoatRoughnessTexture")?this.getRef("clearcoatRoughnessTextureInfo"):null}setClearcoatRoughnessTexture(e){return this.setRef("clearcoatRoughnessTexture",e,{channels:ee})}getClearcoatNormalScale(){return this.get("clearcoatNormalScale")}setClearcoatNormalScale(e){return this.set("clearcoatNormalScale",e)}getClearcoatNormalTexture(){return this.getRef("clearcoatNormalTexture")}getClearcoatNormalTextureInfo(){return this.getRef("clearcoatNormalTexture")?this.getRef("clearcoatNormalTextureInfo"):null}setClearcoatNormalTexture(e){return this.setRef("clearcoatNormalTexture",e,{channels:$|ee|te})}}re.EXTENSION_NAME="KHR_materials_clearcoat";const ne="KHR_materials_clearcoat";class ie extends n.hj{constructor(...e){super(...e),this.extensionName=ne}createClearcoat(){return new re(this.document.getGraph())}read(e){const t=e.jsonDoc,r=t.json.textures||[];return(t.json.materials||[]).forEach(((t,n)=>{if(t.extensions&&t.extensions[ne]){const i=this.createClearcoat();e.materials[n].setExtension(ne,i);const o=t.extensions[ne];if(void 0!==o.clearcoatFactor&&i.setClearcoatFactor(o.clearcoatFactor),void 0!==o.clearcoatRoughnessFactor&&i.setClearcoatRoughnessFactor(o.clearcoatRoughnessFactor),void 0!==o.clearcoatTexture){const t=o.clearcoatTexture;i.setClearcoatTexture(e.textures[r[t.index].source]),e.setTextureInfo(i.getClearcoatTextureInfo(),t)}if(void 0!==o.clearcoatRoughnessTexture){const t=o.clearcoatRoughnessTexture;i.setClearcoatRoughnessTexture(e.textures[r[t.index].source]),e.setTextureInfo(i.getClearcoatRoughnessTextureInfo(),t)}if(void 0!==o.clearcoatNormalTexture){const t=o.clearcoatNormalTexture;i.setClearcoatNormalTexture(e.textures[r[t.index].source]),e.setTextureInfo(i.getClearcoatNormalTextureInfo(),t),void 0!==t.scale&&i.setClearcoatNormalScale(t.scale)}}})),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach((r=>{const n=r.getExtension(ne);if(n){const i=e.materialIndexMap.get(r),o=t.json.materials[i];o.extensions=o.extensions||{};const s=o.extensions[ne]={clearcoatFactor:n.getClearcoatFactor(),clearcoatRoughnessFactor:n.getClearcoatRoughnessFactor()};if(n.getClearcoatTexture()){const t=n.getClearcoatTexture(),r=n.getClearcoatTextureInfo();s.clearcoatTexture=e.createTextureInfoDef(t,r)}if(n.getClearcoatRoughnessTexture()){const t=n.getClearcoatRoughnessTexture(),r=n.getClearcoatRoughnessTextureInfo();s.clearcoatRoughnessTexture=e.createTextureInfoDef(t,r)}if(n.getClearcoatNormalTexture()){const t=n.getClearcoatNormalTexture(),r=n.getClearcoatNormalTextureInfo();s.clearcoatNormalTexture=e.createTextureInfoDef(t,r),1!==n.getClearcoatNormalScale()&&(s.clearcoatNormalTexture.scale=n.getClearcoatNormalScale())}}})),this}}ie.EXTENSION_NAME=ne;class oe extends n.eY{init(){this.extensionName="KHR_materials_emissive_strength",this.propertyType="EmissiveStrength",this.parentTypes=[n.uS.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{emissiveStrength:1})}getEmissiveStrength(){return this.get("emissiveStrength")}setEmissiveStrength(e){return this.set("emissiveStrength",e)}}oe.EXTENSION_NAME="KHR_materials_emissive_strength";const se="KHR_materials_emissive_strength";class ae extends n.hj{constructor(...e){super(...e),this.extensionName=se}createEmissiveStrength(){return new oe(this.document.getGraph())}read(e){return(e.jsonDoc.json.materials||[]).forEach(((t,r)=>{if(t.extensions&&t.extensions[se]){const n=this.createEmissiveStrength();e.materials[r].setExtension(se,n);const i=t.extensions[se];void 0!==i.emissiveStrength&&n.setEmissiveStrength(i.emissiveStrength)}})),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach((r=>{const n=r.getExtension(se);if(n){const i=e.materialIndexMap.get(r),o=t.json.materials[i];o.extensions=o.extensions||{},o.extensions[se]={emissiveStrength:n.getEmissiveStrength()}}})),this}}ae.EXTENSION_NAME=se;class ce extends n.eY{init(){this.extensionName="KHR_materials_ior",this.propertyType="IOR",this.parentTypes=[n.uS.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{ior:0})}getIOR(){return this.get("ior")}setIOR(e){return this.set("ior",e)}}ce.EXTENSION_NAME="KHR_materials_ior";const le="KHR_materials_ior";class ue extends n.hj{constructor(...e){super(...e),this.extensionName=le}createIOR(){return new ce(this.document.getGraph())}read(e){return(e.jsonDoc.json.materials||[]).forEach(((t,r)=>{if(t.extensions&&t.extensions[le]){const n=this.createIOR();e.materials[r].setExtension(le,n);const i=t.extensions[le];void 0!==i.ior&&n.setIOR(i.ior)}})),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach((r=>{const n=r.getExtension(le);if(n){const i=e.materialIndexMap.get(r),o=t.json.materials[i];o.extensions=o.extensions||{},o.extensions[le]={ior:n.getIOR()}}})),this}}ue.EXTENSION_NAME=le;const{R:he,G:pe}=n.TextureChannel;class de extends n.eY{init(){this.extensionName="KHR_materials_iridescence",this.propertyType="Iridescence",this.parentTypes=[n.uS.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{iridescenceFactor:0,iridescenceTexture:null,iridescenceTextureInfo:new n.lO(this.graph,"iridescenceTextureInfo"),iridescenceIOR:1.3,iridescenceThicknessMinimum:100,iridescenceThicknessMaximum:400,iridescenceThicknessTexture:null,iridescenceThicknessTextureInfo:new n.lO(this.graph,"iridescenceThicknessTextureInfo")})}getIridescenceFactor(){return this.get("iridescenceFactor")}setIridescenceFactor(e){return this.set("iridescenceFactor",e)}getIridescenceTexture(){return this.getRef("iridescenceTexture")}getIridescenceTextureInfo(){return this.getRef("iridescenceTexture")?this.getRef("iridescenceTextureInfo"):null}setIridescenceTexture(e){return this.setRef("iridescenceTexture",e,{channels:he})}getIridescenceIOR(){return this.get("iridescenceIOR")}setIridescenceIOR(e){return this.set("iridescenceIOR",e)}getIridescenceThicknessMinimum(){return this.get("iridescenceThicknessMinimum")}setIridescenceThicknessMinimum(e){return this.set("iridescenceThicknessMinimum",e)}getIridescenceThicknessMaximum(){return this.get("iridescenceThicknessMaximum")}setIridescenceThicknessMaximum(e){return this.set("iridescenceThicknessMaximum",e)}getIridescenceThicknessTexture(){return this.getRef("iridescenceThicknessTexture")}getIridescenceThicknessTextureInfo(){return this.getRef("iridescenceThicknessTexture")?this.getRef("iridescenceThicknessTextureInfo"):null}setIridescenceThicknessTexture(e){return this.setRef("iridescenceThicknessTexture",e,{channels:pe})}}de.EXTENSION_NAME="KHR_materials_iridescence";const fe="KHR_materials_iridescence";class me extends n.hj{constructor(...e){super(...e),this.extensionName=fe}createIridescence(){return new de(this.document.getGraph())}read(e){const t=e.jsonDoc,r=t.json.textures||[];return(t.json.materials||[]).forEach(((t,n)=>{if(t.extensions&&t.extensions[fe]){const i=this.createIridescence();e.materials[n].setExtension(fe,i);const o=t.extensions[fe];if(void 0!==o.iridescenceFactor&&i.setIridescenceFactor(o.iridescenceFactor),void 0!==o.iridescenceIor&&i.setIridescenceIOR(o.iridescenceIor),void 0!==o.iridescenceThicknessMinimum&&i.setIridescenceThicknessMinimum(o.iridescenceThicknessMinimum),void 0!==o.iridescenceThicknessMaximum&&i.setIridescenceThicknessMaximum(o.iridescenceThicknessMaximum),void 0!==o.iridescenceTexture){const t=o.iridescenceTexture;i.setIridescenceTexture(e.textures[r[t.index].source]),e.setTextureInfo(i.getIridescenceTextureInfo(),t)}if(void 0!==o.iridescenceThicknessTexture){const t=o.iridescenceThicknessTexture;i.setIridescenceThicknessTexture(e.textures[r[t.index].source]),e.setTextureInfo(i.getIridescenceThicknessTextureInfo(),t)}}})),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach((r=>{const n=r.getExtension(fe);if(n){const i=e.materialIndexMap.get(r),o=t.json.materials[i];o.extensions=o.extensions||{};const s=o.extensions[fe]={};if(n.getIridescenceFactor()>0&&(s.iridescenceFactor=n.getIridescenceFactor()),1.3!==n.getIridescenceIOR()&&(s.iridescenceIor=n.getIridescenceIOR()),100!==n.getIridescenceThicknessMinimum()&&(s.iridescenceThicknessMinimum=n.getIridescenceThicknessMinimum()),400!==n.getIridescenceThicknessMaximum()&&(s.iridescenceThicknessMaximum=n.getIridescenceThicknessMaximum()),n.getIridescenceTexture()){const t=n.getIridescenceTexture(),r=n.getIridescenceTextureInfo();s.iridescenceTexture=e.createTextureInfoDef(t,r)}if(n.getIridescenceThicknessTexture()){const t=n.getIridescenceThicknessTexture(),r=n.getIridescenceThicknessTextureInfo();s.iridescenceThicknessTexture=e.createTextureInfoDef(t,r)}}})),this}}me.EXTENSION_NAME=fe;const{R:ge,G:ye,B:ve,A:_e}=n.TextureChannel;class be extends n.eY{init(){this.extensionName="KHR_materials_pbrSpecularGlossiness",this.propertyType="PBRSpecularGlossiness",this.parentTypes=[n.uS.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{diffuseFactor:[1,1,1,1],diffuseTexture:null,diffuseTextureInfo:new n.lO(this.graph,"diffuseTextureInfo"),specularFactor:[1,1,1],glossinessFactor:1,specularGlossinessTexture:null,specularGlossinessTextureInfo:new n.lO(this.graph,"specularGlossinessTextureInfo")})}getDiffuseFactor(){return this.get("diffuseFactor")}setDiffuseFactor(e){return this.set("diffuseFactor",e)}getDiffuseHex(){return n.i5.factorToHex(this.getDiffuseFactor())}setDiffuseHex(e){const t=this.getDiffuseFactor().slice();return this.setDiffuseFactor(n.i5.hexToFactor(e,t))}getDiffuseTexture(){return this.getRef("diffuseTexture")}getDiffuseTextureInfo(){return this.getRef("diffuseTexture")?this.getRef("diffuseTextureInfo"):null}setDiffuseTexture(e){return this.setRef("diffuseTexture",e,{channels:ge|ye|ve|_e})}getSpecularFactor(){return this.get("specularFactor")}setSpecularFactor(e){return this.set("specularFactor",e)}getGlossinessFactor(){return this.get("glossinessFactor")}setGlossinessFactor(e){return this.set("glossinessFactor",e)}getSpecularGlossinessTexture(){return this.getRef("specularGlossinessTexture")}getSpecularGlossinessTextureInfo(){return this.getRef("specularGlossinessTexture")?this.getRef("specularGlossinessTextureInfo"):null}setSpecularGlossinessTexture(e){return this.setRef("specularGlossinessTexture",e,{channels:ge|ye|ve|_e})}}be.EXTENSION_NAME="KHR_materials_pbrSpecularGlossiness";const xe="KHR_materials_pbrSpecularGlossiness";class we extends n.hj{constructor(...e){super(...e),this.extensionName=xe}createPBRSpecularGlossiness(){return new be(this.document.getGraph())}read(e){const t=e.jsonDoc,r=t.json.textures||[];return(t.json.materials||[]).forEach(((t,n)=>{if(t.extensions&&t.extensions[xe]){const i=this.createPBRSpecularGlossiness();e.materials[n].setExtension(xe,i);const o=t.extensions[xe];if(void 0!==o.diffuseFactor&&i.setDiffuseFactor(o.diffuseFactor),void 0!==o.specularFactor&&i.setSpecularFactor(o.specularFactor),void 0!==o.glossinessFactor&&i.setGlossinessFactor(o.glossinessFactor),void 0!==o.diffuseTexture){const t=o.diffuseTexture;i.setDiffuseTexture(e.textures[r[t.index].source]),e.setTextureInfo(i.getDiffuseTextureInfo(),t)}if(void 0!==o.specularGlossinessTexture){const t=o.specularGlossinessTexture;i.setSpecularGlossinessTexture(e.textures[r[t.index].source]),e.setTextureInfo(i.getSpecularGlossinessTextureInfo(),t)}}})),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach((r=>{const n=r.getExtension(xe);if(n){const i=e.materialIndexMap.get(r),o=t.json.materials[i];o.extensions=o.extensions||{};const s=o.extensions[xe]={diffuseFactor:n.getDiffuseFactor(),specularFactor:n.getSpecularFactor(),glossinessFactor:n.getGlossinessFactor()};if(n.getDiffuseTexture()){const t=n.getDiffuseTexture(),r=n.getDiffuseTextureInfo();s.diffuseTexture=e.createTextureInfoDef(t,r)}if(n.getSpecularGlossinessTexture()){const t=n.getSpecularGlossinessTexture(),r=n.getSpecularGlossinessTextureInfo();s.specularGlossinessTexture=e.createTextureInfoDef(t,r)}}})),this}}we.EXTENSION_NAME=xe;const{R:Se,G:Me,B:Te,A:Ee}=n.TextureChannel;class Ae extends n.eY{init(){this.extensionName="KHR_materials_sheen",this.propertyType="Sheen",this.parentTypes=[n.uS.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{sheenColorFactor:[0,0,0],sheenColorTexture:null,sheenColorTextureInfo:new n.lO(this.graph,"sheenColorTextureInfo"),sheenRoughnessFactor:0,sheenRoughnessTexture:null,sheenRoughnessTextureInfo:new n.lO(this.graph,"sheenRoughnessTextureInfo")})}getSheenColorFactor(){return this.get("sheenColorFactor")}getSheenColorHex(){return n.i5.factorToHex(this.getSheenColorFactor())}setSheenColorFactor(e){return this.set("sheenColorFactor",e)}setSheenColorHex(e){const t=this.getSheenColorFactor().slice();return this.set("sheenColorFactor",n.i5.hexToFactor(e,t))}getSheenColorTexture(){return this.getRef("sheenColorTexture")}getSheenColorTextureInfo(){return this.getRef("sheenColorTexture")?this.getRef("sheenColorTextureInfo"):null}setSheenColorTexture(e){return this.setRef("sheenColorTexture",e,{channels:Se|Me|Te})}getSheenRoughnessFactor(){return this.get("sheenRoughnessFactor")}setSheenRoughnessFactor(e){return this.set("sheenRoughnessFactor",e)}getSheenRoughnessTexture(){return this.getRef("sheenRoughnessTexture")}getSheenRoughnessTextureInfo(){return this.getRef("sheenRoughnessTexture")?this.getRef("sheenRoughnessTextureInfo"):null}setSheenRoughnessTexture(e){return this.setRef("sheenRoughnessTexture",e,{channels:Ee})}}Ae.EXTENSION_NAME="KHR_materials_sheen";const Re="KHR_materials_sheen";class Ce extends n.hj{constructor(...e){super(...e),this.extensionName=Re}createSheen(){return new Ae(this.document.getGraph())}read(e){const t=e.jsonDoc,r=t.json.textures||[];return(t.json.materials||[]).forEach(((t,n)=>{if(t.extensions&&t.extensions[Re]){const i=this.createSheen();e.materials[n].setExtension(Re,i);const o=t.extensions[Re];if(void 0!==o.sheenColorFactor&&i.setSheenColorFactor(o.sheenColorFactor),void 0!==o.sheenRoughnessFactor&&i.setSheenRoughnessFactor(o.sheenRoughnessFactor),void 0!==o.sheenColorTexture){const t=o.sheenColorTexture;i.setSheenColorTexture(e.textures[r[t.index].source]),e.setTextureInfo(i.getSheenColorTextureInfo(),t)}if(void 0!==o.sheenRoughnessTexture){const t=o.sheenRoughnessTexture;i.setSheenRoughnessTexture(e.textures[r[t.index].source]),e.setTextureInfo(i.getSheenRoughnessTextureInfo(),t)}}})),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach((r=>{const n=r.getExtension(Re);if(n){const i=e.materialIndexMap.get(r),o=t.json.materials[i];o.extensions=o.extensions||{};const s=o.extensions[Re]={sheenColorFactor:n.getSheenColorFactor(),sheenRoughnessFactor:n.getSheenRoughnessFactor()};if(n.getSheenColorTexture()){const t=n.getSheenColorTexture(),r=n.getSheenColorTextureInfo();s.sheenColorTexture=e.createTextureInfoDef(t,r)}if(n.getSheenRoughnessTexture()){const t=n.getSheenRoughnessTexture(),r=n.getSheenRoughnessTextureInfo();s.sheenRoughnessTexture=e.createTextureInfoDef(t,r)}}})),this}}Ce.EXTENSION_NAME=Re;const{R:Ie,G:Oe,B:Pe,A:Ne}=n.TextureChannel;class Le extends n.eY{init(){this.extensionName="KHR_materials_specular",this.propertyType="Specular",this.parentTypes=[n.uS.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{specularFactor:1,specularTexture:null,specularTextureInfo:new n.lO(this.graph,"specularTextureInfo"),specularColorFactor:[1,1,1],specularColorTexture:null,specularColorTextureInfo:new n.lO(this.graph,"specularColorTextureInfo")})}getSpecularFactor(){return this.get("specularFactor")}setSpecularFactor(e){return this.set("specularFactor",e)}getSpecularColorFactor(){return this.get("specularColorFactor")}setSpecularColorFactor(e){return this.set("specularColorFactor",e)}getSpecularColorHex(){return n.i5.factorToHex(this.getSpecularColorFactor())}setSpecularColorHex(e){const t=this.getSpecularColorFactor().slice();return this.set("specularColorFactor",n.i5.hexToFactor(e,t))}getSpecularTexture(){return this.getRef("specularTexture")}getSpecularTextureInfo(){return this.getRef("specularTexture")?this.getRef("specularTextureInfo"):null}setSpecularTexture(e){return this.setRef("specularTexture",e,{channels:Ne})}getSpecularColorTexture(){return this.getRef("specularColorTexture")}getSpecularColorTextureInfo(){return this.getRef("specularColorTexture")?this.getRef("specularColorTextureInfo"):null}setSpecularColorTexture(e){return this.setRef("specularColorTexture",e,{channels:Ie|Oe|Pe})}}Le.EXTENSION_NAME="KHR_materials_specular";const Ue="KHR_materials_specular";class De extends n.hj{constructor(...e){super(...e),this.extensionName=Ue}createSpecular(){return new Le(this.document.getGraph())}read(e){const t=e.jsonDoc,r=t.json.textures||[];return(t.json.materials||[]).forEach(((t,n)=>{if(t.extensions&&t.extensions[Ue]){const i=this.createSpecular();e.materials[n].setExtension(Ue,i);const o=t.extensions[Ue];if(void 0!==o.specularFactor&&i.setSpecularFactor(o.specularFactor),void 0!==o.specularColorFactor&&i.setSpecularColorFactor(o.specularColorFactor),void 0!==o.specularTexture){const t=o.specularTexture;i.setSpecularTexture(e.textures[r[t.index].source]),e.setTextureInfo(i.getSpecularTextureInfo(),t)}if(void 0!==o.specularColorTexture){const t=o.specularColorTexture;i.setSpecularColorTexture(e.textures[r[t.index].source]),e.setTextureInfo(i.getSpecularColorTextureInfo(),t)}}})),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach((r=>{const i=r.getExtension(Ue);if(i){const o=e.materialIndexMap.get(r),s=t.json.materials[o];s.extensions=s.extensions||{};const a=s.extensions[Ue]={};if(1!==i.getSpecularFactor()&&(a.specularFactor=i.getSpecularFactor()),n.MathUtils.eq(i.getSpecularColorFactor(),[1,1,1])||(a.specularColorFactor=i.getSpecularColorFactor()),i.getSpecularTexture()){const t=i.getSpecularTexture(),r=i.getSpecularTextureInfo();a.specularTexture=e.createTextureInfoDef(t,r)}if(i.getSpecularColorTexture()){const t=i.getSpecularColorTexture(),r=i.getSpecularColorTextureInfo();a.specularColorTexture=e.createTextureInfoDef(t,r)}}})),this}}De.EXTENSION_NAME=Ue;const{R:Fe}=n.TextureChannel;class Be extends n.eY{init(){this.extensionName="KHR_materials_transmission",this.propertyType="Transmission",this.parentTypes=[n.uS.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{transmissionFactor:0,transmissionTexture:null,transmissionTextureInfo:new n.lO(this.graph,"transmissionTextureInfo")})}getTransmissionFactor(){return this.get("transmissionFactor")}setTransmissionFactor(e){return this.set("transmissionFactor",e)}getTransmissionTexture(){return this.getRef("transmissionTexture")}getTransmissionTextureInfo(){return this.getRef("transmissionTexture")?this.getRef("transmissionTextureInfo"):null}setTransmissionTexture(e){return this.setRef("transmissionTexture",e,{channels:Fe})}}Be.EXTENSION_NAME="KHR_materials_transmission";const ke="KHR_materials_transmission";class je extends n.hj{constructor(...e){super(...e),this.extensionName=ke}createTransmission(){return new Be(this.document.getGraph())}read(e){const t=e.jsonDoc,r=t.json.textures||[];return(t.json.materials||[]).forEach(((t,n)=>{if(t.extensions&&t.extensions[ke]){const i=this.createTransmission();e.materials[n].setExtension(ke,i);const o=t.extensions[ke];if(void 0!==o.transmissionFactor&&i.setTransmissionFactor(o.transmissionFactor),void 0!==o.transmissionTexture){const t=o.transmissionTexture;i.setTransmissionTexture(e.textures[r[t.index].source]),e.setTextureInfo(i.getTransmissionTextureInfo(),t)}}})),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach((r=>{const n=r.getExtension(ke);if(n){const i=e.materialIndexMap.get(r),o=t.json.materials[i];o.extensions=o.extensions||{};const s=o.extensions[ke]={transmissionFactor:n.getTransmissionFactor()};if(n.getTransmissionTexture()){const t=n.getTransmissionTexture(),r=n.getTransmissionTextureInfo();s.transmissionTexture=e.createTextureInfoDef(t,r)}}})),this}}je.EXTENSION_NAME=ke;class Ge extends n.eY{init(){this.extensionName="KHR_materials_unlit",this.propertyType="Unlit",this.parentTypes=[n.uS.MATERIAL]}}Ge.EXTENSION_NAME="KHR_materials_unlit";const ze="KHR_materials_unlit";class Ve extends n.hj{constructor(...e){super(...e),this.extensionName=ze}createUnlit(){return new Ge(this.document.getGraph())}read(e){return(e.jsonDoc.json.materials||[]).forEach(((t,r)=>{t.extensions&&t.extensions[ze]&&e.materials[r].setExtension(ze,this.createUnlit())})),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach((r=>{if(r.getExtension(ze)){const n=e.materialIndexMap.get(r),i=t.json.materials[n];i.extensions=i.extensions||{},i.extensions[ze]={}}})),this}}Ve.EXTENSION_NAME=ze;class He extends n.eY{init(){this.extensionName="KHR_materials_variants",this.propertyType="Mapping",this.parentTypes=["MappingList"]}getDefaults(){return Object.assign(super.getDefaults(),{material:null,variants:[]})}getMaterial(){return this.getRef("material")}setMaterial(e){return this.setRef("material",e)}addVariant(e){return this.addRef("variants",e)}removeVariant(e){return this.removeRef("variants",e)}listVariants(){return this.listRefs("variants")}}He.EXTENSION_NAME="KHR_materials_variants";class We extends n.eY{init(){this.extensionName="KHR_materials_variants",this.propertyType="MappingList",this.parentTypes=[n.uS.PRIMITIVE]}getDefaults(){return Object.assign(super.getDefaults(),{mappings:[]})}addMapping(e){return this.addRef("mappings",e)}removeMapping(e){return this.removeRef("mappings",e)}listMappings(){return this.listRefs("mappings")}}We.EXTENSION_NAME="KHR_materials_variants";class Xe extends n.eY{init(){this.extensionName="KHR_materials_variants",this.propertyType="Variant",this.parentTypes=["MappingList"]}}Xe.EXTENSION_NAME="KHR_materials_variants";const Ye="KHR_materials_variants";class qe extends n.hj{constructor(...e){super(...e),this.extensionName=Ye}createMappingList(){return new We(this.document.getGraph())}createVariant(e=""){return new Xe(this.document.getGraph(),e)}createMapping(){return new He(this.document.getGraph())}listVariants(){return Array.from(this.properties).filter((e=>e instanceof Xe))}read(e){const t=e.jsonDoc;if(!t.json.extensions||!t.json.extensions[Ye])return this;const r=(t.json.extensions[Ye].variants||[]).map((e=>this.createVariant().setName(e.name||"")));return(t.json.meshes||[]).forEach(((t,n)=>{const i=e.meshes[n];(t.primitives||[]).forEach(((t,n)=>{if(!t.extensions||!t.extensions[Ye])return;const o=this.createMappingList(),s=t.extensions[Ye];for(const t of s.mappings){const n=this.createMapping();void 0!==t.material&&n.setMaterial(e.materials[t.material]);for(const e of t.variants||[])n.addVariant(r[e]);o.addMapping(n)}i.listPrimitives()[n].setExtension(Ye,o)}))})),this}write(e){const t=e.jsonDoc,r=this.listVariants();if(!r.length)return this;const n=[],i=new Map;for(const t of r)i.set(t,n.length),n.push(e.createPropertyDef(t));for(const t of this.document.getRoot().listMeshes()){const r=e.meshIndexMap.get(t);t.listPrimitives().forEach(((t,n)=>{const o=t.getExtension(Ye);if(!o)return;const s=e.jsonDoc.json.meshes[r].primitives[n],a=o.listMappings().map((t=>{const r=e.createPropertyDef(t),n=t.getMaterial();return n&&(r.material=e.materialIndexMap.get(n)),r.variants=t.listVariants().map((e=>i.get(e))),r}));s.extensions=s.extensions||{},s.extensions[Ye]={mappings:a}}))}return t.json.extensions=t.json.extensions||{},t.json.extensions[Ye]={variants:n},this}}qe.EXTENSION_NAME=Ye;const{G:Je}=n.TextureChannel;class Ke extends n.eY{init(){this.extensionName="KHR_materials_volume",this.propertyType="Volume",this.parentTypes=[n.uS.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{thicknessFactor:0,thicknessTexture:null,thicknessTextureInfo:new n.lO(this.graph,"thicknessTexture"),attenuationDistance:1/0,attenuationColor:[1,1,1]})}getThicknessFactor(){return this.get("thicknessFactor")}setThicknessFactor(e){return this.set("thicknessFactor",e)}getThicknessTexture(){return this.getRef("thicknessTexture")}getThicknessTextureInfo(){return this.getRef("thicknessTexture")?this.getRef("thicknessTextureInfo"):null}setThicknessTexture(e){return this.setRef("thicknessTexture",e,{channels:Je})}getAttenuationDistance(){return this.get("attenuationDistance")}setAttenuationDistance(e){return this.set("attenuationDistance",e)}getAttenuationColor(){return this.get("attenuationColor")}setAttenuationColor(e){return this.set("attenuationColor",e)}getAttenuationColorHex(){return n.i5.factorToHex(this.getAttenuationColor())}setAttenuationColorHex(e){const t=this.getAttenuationColor().slice();return this.set("attenuationColor",n.i5.hexToFactor(e,t))}}Ke.EXTENSION_NAME="KHR_materials_volume";const Ze="KHR_materials_volume";class Qe extends n.hj{constructor(...e){super(...e),this.extensionName=Ze}createVolume(){return new Ke(this.document.getGraph())}read(e){const t=e.jsonDoc,r=t.json.textures||[];return(t.json.materials||[]).forEach(((t,n)=>{if(t.extensions&&t.extensions[Ze]){const i=this.createVolume();e.materials[n].setExtension(Ze,i);const o=t.extensions[Ze];if(void 0!==o.thicknessFactor&&i.setThicknessFactor(o.thicknessFactor),void 0!==o.attenuationDistance&&i.setAttenuationDistance(o.attenuationDistance),void 0!==o.attenuationColor&&i.setAttenuationColor(o.attenuationColor),void 0!==o.thicknessTexture){const t=o.thicknessTexture;i.setThicknessTexture(e.textures[r[t.index].source]),e.setTextureInfo(i.getThicknessTextureInfo(),t)}}})),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach((r=>{const i=r.getExtension(Ze);if(i){const o=e.materialIndexMap.get(r),s=t.json.materials[o];s.extensions=s.extensions||{};const a=s.extensions[Ze]={};if(i.getThicknessFactor()>0&&(a.thicknessFactor=i.getThicknessFactor()),Number.isFinite(i.getAttenuationDistance())&&(a.attenuationDistance=i.getAttenuationDistance()),n.MathUtils.eq(i.getAttenuationColor(),[1,1,1])||(a.attenuationColor=i.getAttenuationColor()),i.getThicknessTexture()){const t=i.getThicknessTexture(),r=i.getThicknessTextureInfo();a.thicknessTexture=e.createTextureInfoDef(t,r)}}})),this}}Qe.EXTENSION_NAME=Ze;const $e="KHR_mesh_quantization";class et extends n.hj{constructor(...e){super(...e),this.extensionName=$e}read(e){return this}write(e){return this}}et.EXTENSION_NAME=$e;const tt="KHR_texture_basisu";class rt{match(e){return 171===e[0]&&75===e[1]&&84===e[2]&&88===e[3]&&32===e[4]&&50===e[5]&&48===e[6]&&187===e[7]&&13===e[8]&&10===e[9]&&26===e[10]&&10===e[11]}getSize(e){const t=c(e);return[t.pixelWidth,t.pixelHeight]}getChannels(e){const t=c(e).dataFormatDescriptor[0];if(163===t.colorModel)return 2===t.samples.length&&15==(15&t.samples[1].channelType)?4:3;if(166===t.colorModel)return 3==(15&t.samples[0].channelType)?4:3;throw new Error(`Unexpected KTX2 colorModel, "${t.colorModel}".`)}getGPUByteLength(e){const t=c(e),r=this.getChannels(e)>3;let n=0;for(let e=0;e<t.levels.length;e++){const i=t.levels[e];n+=i.uncompressedByteLength?i.uncompressedByteLength:Math.max(1,Math.floor(t.pixelWidth/Math.pow(2,e)))/4*(Math.max(1,Math.floor(t.pixelHeight/Math.pow(2,e)))/4)*(r?16:8)}return n}}class nt extends n.hj{constructor(...e){super(...e),this.extensionName=tt,this.prereadTypes=[n.uS.TEXTURE]}static register(){n.Pp.registerFormat("image/ktx2",new rt)}preread(e){return e.jsonDoc.json.textures.forEach((e=>{e.extensions&&e.extensions[tt]&&(e.source=e.extensions[tt].source)})),this}read(e){return this}write(e){const t=e.jsonDoc;return this.document.getRoot().listTextures().forEach((r=>{if("image/ktx2"===r.getMimeType()){const n=e.imageIndexMap.get(r);t.json.textures.forEach((e=>{e.source===n&&(e.extensions=e.extensions||{},e.extensions[tt]={source:e.source},delete e.source)}))}})),this}}nt.EXTENSION_NAME=tt;class it extends n.eY{init(){this.extensionName="KHR_texture_transform",this.propertyType="Transform",this.parentTypes=[n.uS.TEXTURE_INFO]}getDefaults(){return Object.assign(super.getDefaults(),{offset:[0,0],rotation:0,scale:[1,1],texCoord:null})}getOffset(){return this.get("offset")}setOffset(e){return this.set("offset",e)}getRotation(){return this.get("rotation")}setRotation(e){return this.set("rotation",e)}getScale(){return this.get("scale")}setScale(e){return this.set("scale",e)}getTexCoord(){return this.get("texCoord")}setTexCoord(e){return this.set("texCoord",e)}}it.EXTENSION_NAME="KHR_texture_transform";const ot="KHR_texture_transform";class st extends n.hj{constructor(...e){super(...e),this.extensionName=ot}createTransform(){return new it(this.document.getGraph())}read(e){for(const[t,r]of Array.from(e.textureInfos.entries())){if(!r.extensions||!r.extensions[ot])continue;const e=this.createTransform(),n=r.extensions[ot];void 0!==n.offset&&e.setOffset(n.offset),void 0!==n.rotation&&e.setRotation(n.rotation),void 0!==n.scale&&e.setScale(n.scale),void 0!==n.texCoord&&e.setTexCoord(n.texCoord),t.setExtension(ot,e)}return this}write(e){const t=Array.from(e.textureInfoDefMap.entries());for(const[e,r]of t){const t=e.getExtension(ot);if(!t)continue;r.extensions=r.extensions||{};const i={},o=n.MathUtils.eq;o(t.getOffset(),[0,0])||(i.offset=t.getOffset()),0!==t.getRotation()&&(i.rotation=t.getRotation()),o(t.getScale(),[1,1])||(i.scale=t.getScale()),null!=t.getTexCoord()&&(i.texCoord=t.getTexCoord()),r.extensions[ot]=i}return this}}st.EXTENSION_NAME=ot;const at=[n.uS.ROOT,n.uS.SCENE,n.uS.NODE,n.uS.MESH,n.uS.MATERIAL,n.uS.TEXTURE,n.uS.ANIMATION];class ct extends n.eY{init(){this.extensionName="KHR_xmp_json_ld",this.propertyType="Packet",this.parentTypes=at}getDefaults(){return Object.assign(super.getDefaults(),{context:{},properties:{}})}getContext(){return this.get("context")}setContext(e){return this.set("context",p({},e))}listProperties(){return Object.keys(this.get("properties"))}getProperty(e){const t=this.get("properties");return e in t?t[e]:null}setProperty(e,t){this._assertContext(e);const r=p({},this.get("properties"));return t?r[e]=t:delete r[e],this.set("properties",r)}toJSONLD(){return p({"@context":lt(this.get("context"))},lt(this.get("properties")))}fromJSONLD(e){const t=(e=lt(e))["@context"];return t&&this.set("context",t),delete e["@context"],this.set("properties",e)}_assertContext(e){if(!(e.split(":")[0]in this.get("context")))throw new Error(`KHR_xmp_json_ld: Missing context for term, "${e}".`)}}function lt(e){return JSON.parse(JSON.stringify(e))}ct.EXTENSION_NAME="KHR_xmp_json_ld";const ut="KHR_xmp_json_ld";class ht extends n.hj{constructor(...e){super(...e),this.extensionName=ut}createPacket(){return new ct(this.document.getGraph())}listPackets(){return Array.from(this.properties)}read(e){var t;const r=null==(t=e.jsonDoc.json.extensions)?void 0:t[ut];if(!r||!r.packets)return this;const n=e.jsonDoc.json,i=this.document.getRoot(),o=r.packets.map((e=>this.createPacket().fromJSONLD(e))),s=[[n.asset],n.scenes,n.nodes,n.meshes,n.materials,n.images,n.animations],a=[[i],i.listScenes(),i.listNodes(),i.listMeshes(),i.listMaterials(),i.listTextures(),i.listAnimations()];for(let e=0;e<s.length;e++){const t=s[e]||[];for(let r=0;r<t.length;r++){const n=t[r];n.extensions&&n.extensions[ut]&&a[e][r].setExtension(ut,o[n.extensions[ut].packet])}}return this}write(e){const{json:t}=e.jsonDoc,r=[];for(const i of this.properties){r.push(i.toJSONLD());for(const o of i.listParents()){let i;switch(o.propertyType){case n.uS.ROOT:i=t.asset;break;case n.uS.SCENE:i=t.scenes[e.sceneIndexMap.get(o)];break;case n.uS.NODE:i=t.nodes[e.nodeIndexMap.get(o)];break;case n.uS.MESH:i=t.meshes[e.meshIndexMap.get(o)];break;case n.uS.MATERIAL:i=t.materials[e.materialIndexMap.get(o)];break;case n.uS.TEXTURE:i=t.images[e.imageIndexMap.get(o)];break;case n.uS.ANIMATION:i=t.animations[e.animationIndexMap.get(o)];break;default:i=null,this.document.getLogger().warn(`[${ut}]: Unsupported parent property, "${o.propertyType}"`)}i&&(i.extensions=i.extensions||{},i.extensions[ut]={packet:r.length-1})}}return r.length>0&&(t.extensions=t.extensions||{},t.extensions[ut]={packets:r}),this}}ht.EXTENSION_NAME=ut;const pt=[q,Q,ie,ae,ue,me,we,De,Ce,je,Ve,qe,Qe,et,nt,st,ht]},826:(e,t,r)=>{"use strict";r.d(t,{VJ:()=>y,QR:()=>S});var n=r(796),i=r(788),o=r.n(i),s=r(39),a=r.n(s);function c(e,t,r={}){const n=document.createElement("canvas");n.width=e.shape[0],n.height=e.shape[1];const i=n.getContext("2d"),o=i.getImageData(0,0,n.width,n.height);try{u(e,o.data)}catch(e){return h.from(Promise.reject(e))}i.putImageData(o,0,0);const s=r.quality?r.quality/100:void 0;switch(t){case"canvas":return n;case"jpg":case"jpeg":return l(n,"image/jpeg",s);case"png":return l(n,"image/png");default:throw new Error("[ndarray-pixels] Unsupported file type: "+t)}}function l(e,t,r){const n=new Promise(((n,i)=>{e.toBlob((async e=>{e?n(new Uint8Array(await e.arrayBuffer())):i(new Error("[ndarray-pixels] Failed to canvas.toBlob()."))}),t,r)}));return h.from(n)}function u(e,t,r=-1){if(4===e.shape.length)return u(e.pick(r),t,0);if(3===e.shape.length)if(3===e.shape[2])a().assign(o()(t,[e.shape[0],e.shape[1],3],[4,4*e.shape[0],1]),e),a().assigns(o()(t,[e.shape[0]*e.shape[1]],[4],3),255);else if(4===e.shape[2])a().assign(o()(t,[e.shape[0],e.shape[1],4],[4,4*e.shape[0],1]),e);else{if(1!==e.shape[2])throw new Error("[ndarray-pixels] Incompatible array shape.");a().assign(o()(t,[e.shape[0],e.shape[1],3],[4,4*e.shape[0],1]),o()(e.data,[e.shape[0],e.shape[1],3],[e.stride[0],e.stride[1],0],e.offset)),a().assigns(o()(t,[e.shape[0]*e.shape[1]],[4],3),255)}else{if(2!==e.shape.length)throw new Error("[ndarray-pixels] Incompatible array shape.");a().assign(o()(t,[e.shape[0],e.shape[1],3],[4,4*e.shape[0],1]),o()(e.data,[e.shape[0],e.shape[1],3],[e.stride[0],e.stride[1],0],e.offset)),a().assigns(o()(t,[e.shape[0]*e.shape[1]],[4],3),255)}return t}class h{constructor(e){this._promise=void 0,this._promise=e}on(e,t){return"data"===e?this._promise.then(t):"error"===e?this._promise.catch(t):"end"===e&&this._promise.finally(t),this}static from(e){return new h(e)}}var p=r(638);function d(){return(d=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function f(e,t){return Object.defineProperty(t,"name",{value:e}),t}async function m(e,t,r){if(!e)return null;const n=e.getImage();if(!n)return null;const i=await async function(e,t){return e instanceof Uint8Array&&"undefined"!=typeof Buffer&&(e=Buffer.from(e)),new Promise(((r,n)=>{!function(e,t,r){if(r=r||t,e instanceof Uint8Array){if("string"!=typeof t)throw new Error("[ndarray-pixels] Type must be given for Uint8Array image data");const r=new Blob([e],{type:t});e=URL.createObjectURL(r)}const n=new Image;n.crossOrigin="anonymous",n.onload=function(){URL.revokeObjectURL(e);const t=document.createElement("canvas");t.width=n.width,t.height=n.height;const i=t.getContext("2d");i.drawImage(n,0,0);const s=i.getImageData(0,0,n.width,n.height);r(null,o()(new Uint8Array(s.data),[n.width,n.height,4],[4,4*n.width,1],0))},n.onerror=t=>{URL.revokeObjectURL(e),r(t)},n.src=e}(e,t,((e,t)=>{t&&!e?r(t):n(e)}))}))}(n,e.getMimeType());for(let e=0;e<i.shape[0];++e)for(let t=0;t<i.shape[1];++t)r(i,e,t);const s=await async function(e,t){return new Promise(((r,n)=>{const i=[],o=t.replace("image/","");c(e,o).on("data",(e=>i.push(e))).on("end",(()=>r(function(e){let t=0;for(const r of e)t+=r.byteLength;const r=new Uint8Array(t);let n=0;for(const t of e)r.set(t,n),n+=t.byteLength;return r}(i)))).on("error",(e=>n(e)))}))}(i,"image/png");return t.setImage(s).setMimeType("image/png")}n.uS.ACCESSOR,n.uS.MESH,n.uS.TEXTURE,n.uS.MATERIAL;const g={method:"edgebreaker",encodeSpeed:5,decodeSpeed:5,quantizePosition:14,quantizeNormal:10,quantizeColor:8,quantizeTexcoord:12,quantizeGeneric:12,quantizationVolume:"mesh"},y=e=>{const t=d({},g,e);return e=>{e.createExtension(p.UG).setRequired(!0).setEncoderOptions({method:"edgebreaker"===t.method?p.UG.EncoderMethod.EDGEBREAKER:p.UG.EncoderMethod.SEQUENTIAL,encodeSpeed:t.encodeSpeed,decodeSpeed:t.decodeSpeed,quantizationBits:{POSITION:t.quantizePosition,NORMAL:t.quantizeNormal,COLOR:t.quantizeColor,TEX_COORD:t.quantizeTexcoord,GENERIC:t.quantizeGeneric},quantizationVolume:t.quantizationVolume})}};n.uS.NODE,n.uS.SKIN,n.uS.MESH,n.uS.CAMERA,n.uS.PRIMITIVE,n.uS.PRIMITIVE_TARGET,n.uS.ANIMATION,n.uS.MATERIAL,n.uS.TEXTURE,n.uS.ACCESSOR,n.uS.BUFFER;Int8Array,Int16Array,Int32Array;const{TRANSLATION:v,ROTATION:_,SCALE:b,WEIGHTS:x}=n.AnimationChannel.TargetPath;const w={};function S(e=w){return d({},w,e),f("metalRough",(async e=>{const t=e.getLogger();if(!e.getRoot().listExtensionsUsed().map((e=>e.extensionName)).includes("KHR_materials_pbrSpecularGlossiness"))return void t.warn("metalRough: KHR_materials_pbrSpecularGlossiness not found on document.");const r=e.createExtension(p.Ev),n=e.createExtension(p.Nf),i=e.createExtension(p.bI),o=new Set;for(const t of e.getRoot().listMaterials()){const i=t.getExtension("KHR_materials_pbrSpecularGlossiness");if(!i)continue;const s=n.createSpecular().setSpecularFactor(1).setSpecularColorFactor(i.getSpecularFactor());o.add(i.getSpecularGlossinessTexture()),o.add(t.getBaseColorTexture()),o.add(t.getMetallicRoughnessTexture()),t.setBaseColorFactor(i.getDiffuseFactor()).setMetallicFactor(0).setRoughnessFactor(1).setExtension("KHR_materials_ior",r.createIOR().setIOR(1e3)).setExtension("KHR_materials_specular",s);const a=i.getDiffuseTexture();a&&(t.setBaseColorTexture(a),t.getBaseColorTextureInfo().copy(i.getDiffuseTextureInfo()));const c=i.getSpecularGlossinessTexture();if(c){const r=i.getSpecularGlossinessTextureInfo(),n=e.createTexture();await m(c,n,((e,t,r)=>{e.set(t,r,3,255)})),s.setSpecularTexture(n),s.setSpecularColorTexture(n),s.getSpecularTextureInfo().copy(r),s.getSpecularColorTextureInfo().copy(r);const o=i.getGlossinessFactor(),a=e.createTexture();await m(c,a,((e,t,r)=>{const n=255-Math.round(e.get(t,r,3)*o);e.set(t,r,0,0),e.set(t,r,1,n),e.set(t,r,2,0),e.set(t,r,3,255)})),t.setMetallicRoughnessTexture(a),t.getMetallicRoughnessTextureInfo().copy(r)}else s.setSpecularColorFactor(i.getSpecularFactor()),t.setRoughnessFactor(1-i.getGlossinessFactor());t.setExtension("KHR_materials_pbrSpecularGlossiness",null)}i.dispose();for(const e of o)e&&1===e.listParents().length&&e.dispose();t.debug("metalRough: Complete.")}))}var M;!function(e){e.OXIPNG="oxipng",e.MOZJPEG="mozjpeg",e.WEBP="webp"}(M||(M={}));M.OXIPNG,M.MOZJPEG,M.WEBP;const T={jobs:4,formats:/.*/,slots:/.*/,auto:!1};d({},T,{codec:M.WEBP}),d({},T,{codec:M.MOZJPEG,formats:/^image\/jpeg$/}),d({},T,{codec:M.OXIPNG,formats:/^image\/png$/});var E;!function(e){e.LANCZOS3="lanczos3",e.LANCZOS2="lanczos2"}(E||(E={}));E.LANCZOS3},162:(e,t,r)=>{"use strict";r.d(t,{R:()=>f});var n=r(327),i=r(638),o=r(826),s=r(328),a=r.n(s);function c(e){return c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c(e)}function l(){l=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,i=Object.defineProperty||function(e,t,r){e[t]=r.value},o="function"==typeof Symbol?Symbol:{},s=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",u=o.toStringTag||"@@toStringTag";function h(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{h({},"")}catch(e){h=function(e,t,r){return e[t]=r}}function p(e,t,r,n){var o=t&&t.prototype instanceof _?t:_,s=Object.create(o.prototype),a=new P(n||[]);return i(s,"_invoke",{value:R(e,r,a)}),s}function d(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=p;var f="suspendedStart",m="suspendedYield",g="executing",y="completed",v={};function _(){}function b(){}function x(){}var w={};h(w,s,(function(){return this}));var S=Object.getPrototypeOf,M=S&&S(S(N([])));M&&M!==r&&n.call(M,s)&&(w=M);var T=x.prototype=_.prototype=Object.create(w);function E(e){["next","throw","return"].forEach((function(t){h(e,t,(function(e){return this._invoke(t,e)}))}))}function A(e,t){function r(i,o,s,a){var l=d(e[i],e,o);if("throw"!==l.type){var u=l.arg,h=u.value;return h&&"object"==c(h)&&n.call(h,"__await")?t.resolve(h.__await).then((function(e){r("next",e,s,a)}),(function(e){r("throw",e,s,a)})):t.resolve(h).then((function(e){u.value=e,s(u)}),(function(e){return r("throw",e,s,a)}))}a(l.arg)}var o;i(this,"_invoke",{value:function(e,n){function i(){return new t((function(t,i){r(e,n,t,i)}))}return o=o?o.then(i,i):i()}})}function R(t,r,n){var i=f;return function(o,s){if(i===g)throw new Error("Generator is already running");if(i===y){if("throw"===o)throw s;return{value:e,done:!0}}for(n.method=o,n.arg=s;;){var a=n.delegate;if(a){var c=C(a,n);if(c){if(c===v)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===f)throw i=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=g;var l=d(t,r,n);if("normal"===l.type){if(i=n.done?y:m,l.arg===v)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(i=y,n.method="throw",n.arg=l.arg)}}}function C(t,r){var n=r.method,i=t.iterator[n];if(i===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,C(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var o=d(i,t.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,v;var s=o.arg;return s?s.done?(r[t.resultName]=s.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,v):s:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function I(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function O(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function P(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(I,this),this.reset(!0)}function N(t){if(t||""===t){var r=t[s];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,o=function r(){for(;++i<t.length;)if(n.call(t,i))return r.value=t[i],r.done=!1,r;return r.value=e,r.done=!0,r};return o.next=o}}throw new TypeError(c(t)+" is not iterable")}return b.prototype=x,i(T,"constructor",{value:x,configurable:!0}),i(x,"constructor",{value:b,configurable:!0}),b.displayName=h(x,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===b||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,x):(e.__proto__=x,h(e,u,"GeneratorFunction")),e.prototype=Object.create(T),e},t.awrap=function(e){return{__await:e}},E(A.prototype),h(A.prototype,a,(function(){return this})),t.AsyncIterator=A,t.async=function(e,r,n,i,o){void 0===o&&(o=Promise);var s=new A(p(e,r,n,i),o);return t.isGeneratorFunction(r)?s:s.next().then((function(e){return e.done?e.value:s.next()}))},E(T),h(T,u,"Generator"),h(T,s,(function(){return this})),h(T,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=N,P.prototype={constructor:P,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(O),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function i(n,i){return a.type="throw",a.arg=t,r.next=n,i&&(r.method="next",r.arg=e),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var s=this.tryEntries[o],a=s.completion;if("root"===s.tryLoc)return i("end");if(s.tryLoc<=this.prev){var c=n.call(s,"catchLoc"),l=n.call(s,"finallyLoc");if(c&&l){if(this.prev<s.catchLoc)return i(s.catchLoc,!0);if(this.prev<s.finallyLoc)return i(s.finallyLoc)}else if(c){if(this.prev<s.catchLoc)return i(s.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return i(s.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var s=o?o.completion:{};return s.type=e,s.arg=t,o?(this.method="next",this.next=o.finallyLoc,v):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),v},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),O(r),v}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;O(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:N(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),v}},t}function u(e){return function(e){if(Array.isArray(e))return h(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return h(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return h(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function p(e,t,r,n,i,o,s){try{var a=e[o](s),c=a.value}catch(e){return void r(e)}a.done?t(c):Promise.resolve(c).then(n,i)}function d(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function s(e){p(o,n,i,s,a,"next",e)}function a(e){p(o,n,i,s,a,"throw",e)}s(void 0)}))}}function f(e,t){return m.apply(this,arguments)}function m(){return(m=d(l().mark((function e(t,r){var s,c,h,p,d;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=null!=r?r:{},c={textures:{}},e.t0=new n.WC({credentials:"include"}).registerExtensions([i.UG].concat(u(i.gQ))),e.next=5,a().createDecoderModule();case 5:return e.t1=e.sent,e.next=8,a().createEncoderModule();case 8:return e.t2=e.sent,e.t3={"draco3d.decoder":e.t1,"draco3d.encoder":e.t2},h=e.t0.registerDependencies.call(e.t0,e.t3),e.next=13,h.readBinary(t);case 13:return p=e.sent,e.next=16,p.transform((0,o.QR)(),(0,o.VJ)());case 16:return p.getRoot().listTextures().forEach((function(e,t){var r=e.getMimeType(),i=n.Pp.mimeTypeToExtension(r),o="image_"+e.getUuid()+"."+i;e.setName(o),e.setURI(o),e.setIsSeparated(!0),s[o]||(c.textures[o]=Array.from(e.getImage()))})),e.next=20,h.writeBinary(p);case 20:return d=e.sent,c.buffer=Array.from(d),e.abrupt("return",c);case 23:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},614:function(e,t,r){var n;!function(i){function o(e,t,r,n,i){this._listener=t,this._isOnce=r,this.context=n,this._signal=e,this._priority=i||0}function s(e,t){if("function"!=typeof e)throw Error("listener is a required param of {fn}() and should be a Function.".replace("{fn}",t))}function a(){this._bindings=[],this._prevParams=null;var e=this;this.dispatch=function(){a.prototype.dispatch.apply(e,arguments)}}o.prototype={active:!0,params:null,execute:function(e){var t;return this.active&&this._listener&&(e=this.params?this.params.concat(e):e,t=this._listener.apply(this.context,e),this._isOnce&&this.detach()),t},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal,delete this._listener,delete this.context},toString:function(){return"[SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}},a.prototype={VERSION:"1.0.0",memorize:!1,_shouldPropagate:!0,active:!0,_registerListener:function(e,t,r,n){var i=this._indexOfListener(e,r);if(-1!==i){if((e=this._bindings[i]).isOnce()!==t)throw Error("You cannot add"+(t?"":"Once")+"() then add"+(t?"Once":"")+"() the same listener without removing the relationship first.")}else e=new o(this,e,t,r,n),this._addBinding(e);return this.memorize&&this._prevParams&&e.execute(this._prevParams),e},_addBinding:function(e){var t=this._bindings.length;do{--t}while(this._bindings[t]&&e._priority<=this._bindings[t]._priority);this._bindings.splice(t+1,0,e)},_indexOfListener:function(e,t){for(var r,n=this._bindings.length;n--;)if((r=this._bindings[n])._listener===e&&r.context===t)return n;return-1},has:function(e,t){return-1!==this._indexOfListener(e,t)},add:function(e,t,r){return s(e,"add"),this._registerListener(e,!1,t,r)},addOnce:function(e,t,r){return s(e,"addOnce"),this._registerListener(e,!0,t,r)},remove:function(e,t){s(e,"remove");var r=this._indexOfListener(e,t);return-1!==r&&(this._bindings[r]._destroy(),this._bindings.splice(r,1)),e},removeAll:function(){for(var e=this._bindings.length;e--;)this._bindings[e]._destroy();this._bindings.length=0},getNumListeners:function(){return this._bindings.length},halt:function(){this._shouldPropagate=!1},dispatch:function(e){if(this.active){var t,r=Array.prototype.slice.call(arguments),n=this._bindings.length;if(this.memorize&&(this._prevParams=r),n){t=this._bindings.slice(),this._shouldPropagate=!0;do{n--}while(t[n]&&this._shouldPropagate&&!1!==t[n].execute(r))}}},forget:function(){this._prevParams=null},dispose:function(){this.removeAll(),delete this._bindings,delete this._prevParams},toString:function(){return"[Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}};var c=a;c.Signal=a,void 0===(n=function(){return c}.call(t,r,t,e))||(e.exports=n)}()},928:(e,t,r)=>{"use strict";var n=r(3);function i(){this.argTypes=[],this.shimArgs=[],this.arrayArgs=[],this.arrayBlockIndices=[],this.scalarArgs=[],this.offsetArgs=[],this.offsetArgIndex=[],this.indexArgs=[],this.shapeArgs=[],this.funcName="",this.pre=null,this.body=null,this.post=null,this.debug=!1}e.exports=function(e){var t=new i;t.pre=e.pre,t.body=e.body,t.post=e.post;var r=e.args.slice(0);t.argTypes=r;for(var o=0;o<r.length;++o){var s=r[o];if("array"===s||"object"==typeof s&&s.blockIndices){if(t.argTypes[o]="array",t.arrayArgs.push(o),t.arrayBlockIndices.push(s.blockIndices?s.blockIndices:0),t.shimArgs.push("array"+o),o<t.pre.args.length&&t.pre.args[o].count>0)throw new Error("cwise: pre() block may not reference array args");if(o<t.post.args.length&&t.post.args[o].count>0)throw new Error("cwise: post() block may not reference array args")}else if("scalar"===s)t.scalarArgs.push(o),t.shimArgs.push("scalar"+o);else if("index"===s){if(t.indexArgs.push(o),o<t.pre.args.length&&t.pre.args[o].count>0)throw new Error("cwise: pre() block may not reference array index");if(o<t.body.args.length&&t.body.args[o].lvalue)throw new Error("cwise: body() block may not write to array index");if(o<t.post.args.length&&t.post.args[o].count>0)throw new Error("cwise: post() block may not reference array index")}else if("shape"===s){if(t.shapeArgs.push(o),o<t.pre.args.length&&t.pre.args[o].lvalue)throw new Error("cwise: pre() block may not write to array shape");if(o<t.body.args.length&&t.body.args[o].lvalue)throw new Error("cwise: body() block may not write to array shape");if(o<t.post.args.length&&t.post.args[o].lvalue)throw new Error("cwise: post() block may not write to array shape")}else{if("object"!=typeof s||!s.offset)throw new Error("cwise: Unknown argument type "+r[o]);t.argTypes[o]="offset",t.offsetArgs.push({array:s.array,offset:s.offset}),t.offsetArgIndex.push(o)}}if(t.arrayArgs.length<=0)throw new Error("cwise: No array arguments specified");if(t.pre.args.length>r.length)throw new Error("cwise: Too many arguments in pre() block");if(t.body.args.length>r.length)throw new Error("cwise: Too many arguments in body() block");if(t.post.args.length>r.length)throw new Error("cwise: Too many arguments in post() block");return t.debug=!!e.printCode||!!e.debug,t.funcName=e.funcName||"cwise",t.blockSize=e.blockSize||64,n(t)}},798:(e,t,r)=>{"use strict";var n=r(731);function i(e,t,r){var n,i,o=e.length,s=t.arrayArgs.length,a=t.indexArgs.length>0,c=[],l=[],u=0,h=0;for(n=0;n<o;++n)l.push(["i",n,"=0"].join(""));for(i=0;i<s;++i)for(n=0;n<o;++n)h=u,u=e[n],0===n?l.push(["d",i,"s",n,"=t",i,"p",u].join("")):l.push(["d",i,"s",n,"=(t",i,"p",u,"-s",h,"*t",i,"p",h,")"].join(""));for(l.length>0&&c.push("var "+l.join(",")),n=o-1;n>=0;--n)u=e[n],c.push(["for(i",n,"=0;i",n,"<s",u,";++i",n,"){"].join(""));for(c.push(r),n=0;n<o;++n){for(h=u,u=e[n],i=0;i<s;++i)c.push(["p",i,"+=d",i,"s",n].join(""));a&&(n>0&&c.push(["index[",h,"]-=s",h].join("")),c.push(["++index[",u,"]"].join(""))),c.push("}")}return c.join("\n")}function o(e,t,r){for(var n=e.body,i=[],o=[],s=0;s<e.args.length;++s){var a=e.args[s];if(!(a.count<=0)){var c=new RegExp(a.name,"g"),l="",u=t.arrayArgs.indexOf(s);switch(t.argTypes[s]){case"offset":var h=t.offsetArgIndex.indexOf(s);u=t.offsetArgs[h].array,l="+q"+h;case"array":l="p"+u+l;var p="l"+s,d="a"+u;if(0===t.arrayBlockIndices[u])1===a.count?"generic"===r[u]?a.lvalue?(i.push(["var ",p,"=",d,".get(",l,")"].join("")),n=n.replace(c,p),o.push([d,".set(",l,",",p,")"].join(""))):n=n.replace(c,[d,".get(",l,")"].join("")):n=n.replace(c,[d,"[",l,"]"].join("")):"generic"===r[u]?(i.push(["var ",p,"=",d,".get(",l,")"].join("")),n=n.replace(c,p),a.lvalue&&o.push([d,".set(",l,",",p,")"].join(""))):(i.push(["var ",p,"=",d,"[",l,"]"].join("")),n=n.replace(c,p),a.lvalue&&o.push([d,"[",l,"]=",p].join("")));else{for(var f=[a.name],m=[l],g=0;g<Math.abs(t.arrayBlockIndices[u]);g++)f.push("\\s*\\[([^\\]]+)\\]"),m.push("$"+(g+1)+"*t"+u+"b"+g);if(c=new RegExp(f.join(""),"g"),l=m.join("+"),"generic"===r[u])throw new Error("cwise: Generic arrays not supported in combination with blocks!");n=n.replace(c,[d,"[",l,"]"].join(""))}break;case"scalar":n=n.replace(c,"Y"+t.scalarArgs.indexOf(s));break;case"index":n=n.replace(c,"index");break;case"shape":n=n.replace(c,"shape")}}}return[i.join("\n"),n,o.join("\n")].join("\n").trim()}function s(e){for(var t=new Array(e.length),r=!0,n=0;n<e.length;++n){var i=e[n],o=i.match(/\d+/);o=o?o[0]:"",0===i.charAt(0)?t[n]="u"+i.charAt(1)+o:t[n]=i.charAt(0)+o,n>0&&(r=r&&t[n]===t[n-1])}return r?t[0]:t.join("")}e.exports=function(e,t){for(var r=t[1].length-Math.abs(e.arrayBlockIndices[0])|0,a=new Array(e.arrayArgs.length),c=new Array(e.arrayArgs.length),l=0;l<e.arrayArgs.length;++l)c[l]=t[2*l],a[l]=t[2*l+1];var u=[],h=[],p=[],d=[],f=[];for(l=0;l<e.arrayArgs.length;++l){e.arrayBlockIndices[l]<0?(p.push(0),d.push(r),u.push(r),h.push(r+e.arrayBlockIndices[l])):(p.push(e.arrayBlockIndices[l]),d.push(e.arrayBlockIndices[l]+r),u.push(0),h.push(e.arrayBlockIndices[l]));for(var m=[],g=0;g<a[l].length;g++)p[l]<=a[l][g]&&a[l][g]<d[l]&&m.push(a[l][g]-p[l]);f.push(m)}var y=["SS"],v=["'use strict'"],_=[];for(g=0;g<r;++g)_.push(["s",g,"=SS[",g,"]"].join(""));for(l=0;l<e.arrayArgs.length;++l){y.push("a"+l),y.push("t"+l),y.push("p"+l);for(g=0;g<r;++g)_.push(["t",l,"p",g,"=t",l,"[",p[l]+g,"]"].join(""));for(g=0;g<Math.abs(e.arrayBlockIndices[l]);++g)_.push(["t",l,"b",g,"=t",l,"[",u[l]+g,"]"].join(""))}for(l=0;l<e.scalarArgs.length;++l)y.push("Y"+l);if(e.shapeArgs.length>0&&_.push("shape=SS.slice(0)"),e.indexArgs.length>0){var b=new Array(r);for(l=0;l<r;++l)b[l]="0";_.push(["index=[",b.join(","),"]"].join(""))}for(l=0;l<e.offsetArgs.length;++l){var x=e.offsetArgs[l],w=[];for(g=0;g<x.offset.length;++g)0!==x.offset[g]&&(1===x.offset[g]?w.push(["t",x.array,"p",g].join("")):w.push([x.offset[g],"*t",x.array,"p",g].join("")));0===w.length?_.push("q"+l+"=0"):_.push(["q",l,"=",w.join("+")].join(""))}var S=n([].concat(e.pre.thisVars).concat(e.body.thisVars).concat(e.post.thisVars));for((_=_.concat(S)).length>0&&v.push("var "+_.join(",")),l=0;l<e.arrayArgs.length;++l)v.push("p"+l+"|=0");e.pre.body.length>3&&v.push(o(e.pre,e,c));var M=o(e.body,e,c),T=function(e){for(var t=0,r=e[0].length;t<r;){for(var n=1;n<e.length;++n)if(e[n][t]!==e[0][t])return t;++t}return t}(f);T<r?v.push(function(e,t,r,n){for(var o=t.length,s=r.arrayArgs.length,a=r.blockSize,c=r.indexArgs.length>0,l=[],u=0;u<s;++u)l.push(["var offset",u,"=p",u].join(""));for(u=e;u<o;++u)l.push(["for(var j"+u+"=SS[",t[u],"]|0;j",u,">0;){"].join("")),l.push(["if(j",u,"<",a,"){"].join("")),l.push(["s",t[u],"=j",u].join("")),l.push(["j",u,"=0"].join("")),l.push(["}else{s",t[u],"=",a].join("")),l.push(["j",u,"-=",a,"}"].join("")),c&&l.push(["index[",t[u],"]=j",u].join(""));for(u=0;u<s;++u){for(var h=["offset"+u],p=e;p<o;++p)h.push(["j",p,"*t",u,"p",t[p]].join(""));l.push(["p",u,"=(",h.join("+"),")"].join(""))}for(l.push(i(t,r,n)),u=e;u<o;++u)l.push("}");return l.join("\n")}(T,f[0],e,M)):v.push(i(f[0],e,M)),e.post.body.length>3&&v.push(o(e.post,e,c)),e.debug&&console.log("-----Generated cwise routine for ",t,":\n"+v.join("\n")+"\n----------");var E=[e.funcName||"unnamed","_cwise_loop_",a[0].join("s"),"m",T,s(c)].join("");return new Function(["function ",E,"(",y.join(","),"){",v.join("\n"),"} return ",E].join(""))()}},3:(e,t,r)=>{"use strict";var n=r(798);e.exports=function(e){var t=["'use strict'","var CACHED={}"],r=[],i=e.funcName+"_cwise_thunk";t.push(["return function ",i,"(",e.shimArgs.join(","),"){"].join(""));for(var o=[],s=[],a=[["array",e.arrayArgs[0],".shape.slice(",Math.max(0,e.arrayBlockIndices[0]),e.arrayBlockIndices[0]<0?","+e.arrayBlockIndices[0]+")":")"].join("")],c=[],l=[],u=0;u<e.arrayArgs.length;++u){var h=e.arrayArgs[u];r.push(["t",h,"=array",h,".dtype,","r",h,"=array",h,".order"].join("")),o.push("t"+h),o.push("r"+h),s.push("t"+h),s.push("r"+h+".join()"),a.push("array"+h+".data"),a.push("array"+h+".stride"),a.push("array"+h+".offset|0"),u>0&&(c.push("array"+e.arrayArgs[0]+".shape.length===array"+h+".shape.length+"+(Math.abs(e.arrayBlockIndices[0])-Math.abs(e.arrayBlockIndices[u]))),l.push("array"+e.arrayArgs[0]+".shape[shapeIndex+"+Math.max(0,e.arrayBlockIndices[0])+"]===array"+h+".shape[shapeIndex+"+Math.max(0,e.arrayBlockIndices[u])+"]"))}for(e.arrayArgs.length>1&&(t.push("if (!("+c.join(" && ")+")) throw new Error('cwise: Arrays do not all have the same dimensionality!')"),t.push("for(var shapeIndex=array"+e.arrayArgs[0]+".shape.length-"+Math.abs(e.arrayBlockIndices[0])+"; shapeIndex--\x3e0;) {"),t.push("if (!("+l.join(" && ")+")) throw new Error('cwise: Arrays do not all have the same shape!')"),t.push("}")),u=0;u<e.scalarArgs.length;++u)a.push("scalar"+e.scalarArgs[u]);return r.push(["type=[",s.join(","),"].join()"].join("")),r.push("proc=CACHED[type]"),t.push("var "+r.join(",")),t.push(["if(!proc){","CACHED[type]=proc=compile([",o.join(","),"])}","return proc(",a.join(","),")}"].join("")),e.debug&&console.log("-----Generated thunk:\n"+t.join("\n")+"\n----------"),new Function("compile",t.join("\n"))(n.bind(void 0,e))}},328:(e,t,r)=>{var n=r(599),i=r(128);e.exports={createEncoderModule:n,createDecoderModule:i}},128:function(e,t,r){var n=n||{};n.scope={},n.arrayIteratorImpl=function(e){var t=0;return function(){return t<e.length?{done:!1,value:e[t++]}:{done:!0}}},n.arrayIterator=function(e){return{next:n.arrayIteratorImpl(e)}},n.makeIterator=function(e){var t="undefined"!=typeof Symbol&&Symbol.iterator&&e[Symbol.iterator];return t?t.call(e):n.arrayIterator(e)},n.ASSUME_ES5=!1,n.ASSUME_NO_NATIVE_MAP=!1,n.ASSUME_NO_NATIVE_SET=!1,n.SIMPLE_FROUND_POLYFILL=!1,n.ISOLATE_POLYFILLS=!1,n.FORCE_POLYFILL_PROMISE=!1,n.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1,n.getGlobal=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof r.g&&r.g];for(var t=0;t<e.length;++t){var n=e[t];if(n&&n.Math==Math)return n}throw Error("Cannot find global object")},n.global=n.getGlobal(this),n.defineProperty=n.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,r){return e==Array.prototype||e==Object.prototype||(e[t]=r.value),e},n.IS_SYMBOL_NATIVE="function"==typeof Symbol&&"symbol"==typeof Symbol("x"),n.TRUST_ES6_POLYFILLS=!n.ISOLATE_POLYFILLS||n.IS_SYMBOL_NATIVE,n.polyfills={},n.propertyToPolyfillSymbol={},n.POLYFILL_PREFIX="$jscp$";n.polyfill=function(e,t,r,i){t&&(n.ISOLATE_POLYFILLS?n.polyfillIsolated(e,t,r,i):n.polyfillUnisolated(e,t,r,i))},n.polyfillUnisolated=function(e,t,r,i){for(r=n.global,e=e.split("."),i=0;i<e.length-1;i++){var o=e[i];if(!(o in r))return;r=r[o]}(t=t(i=r[e=e[e.length-1]]))!=i&&null!=t&&n.defineProperty(r,e,{configurable:!0,writable:!0,value:t})},n.polyfillIsolated=function(e,t,r,i){var o=e.split(".");e=1===o.length,i=o[0],i=!e&&i in n.polyfills?n.polyfills:n.global;for(var s=0;s<o.length-1;s++){var a=o[s];if(!(a in i))return;i=i[a]}o=o[o.length-1],null!=(t=t(r=n.IS_SYMBOL_NATIVE&&"es6"===r?i[o]:null))&&(e?n.defineProperty(n.polyfills,o,{configurable:!0,writable:!0,value:t}):t!==r&&(void 0===n.propertyToPolyfillSymbol[o]&&(r=1e9*Math.random()>>>0,n.propertyToPolyfillSymbol[o]=n.IS_SYMBOL_NATIVE?n.global.Symbol(o):n.POLYFILL_PREFIX+r+"$"+o),n.defineProperty(i,n.propertyToPolyfillSymbol[o],{configurable:!0,writable:!0,value:t})))},n.polyfill("Promise",(function(e){function t(){this.batch_=null}function r(e){return e instanceof o?e:new o((function(t,r){t(e)}))}if(e&&(!(n.FORCE_POLYFILL_PROMISE||n.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION&&void 0===n.global.PromiseRejectionEvent)||!n.global.Promise||-1===n.global.Promise.toString().indexOf("[native code]")))return e;t.prototype.asyncExecute=function(e){if(null==this.batch_){this.batch_=[];var t=this;this.asyncExecuteFunction((function(){t.executeBatch_()}))}this.batch_.push(e)};var i=n.global.setTimeout;t.prototype.asyncExecuteFunction=function(e){i(e,0)},t.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var e=this.batch_;this.batch_=[];for(var t=0;t<e.length;++t){var r=e[t];e[t]=null;try{r()}catch(e){this.asyncThrow_(e)}}}this.batch_=null},t.prototype.asyncThrow_=function(e){this.asyncExecuteFunction((function(){throw e}))};var o=function(e){this.state_=0,this.result_=void 0,this.onSettledCallbacks_=[],this.isRejectionHandled_=!1;var t=this.createResolveAndReject_();try{e(t.resolve,t.reject)}catch(e){t.reject(e)}};o.prototype.createResolveAndReject_=function(){function e(e){return function(n){r||(r=!0,e.call(t,n))}}var t=this,r=!1;return{resolve:e(this.resolveTo_),reject:e(this.reject_)}},o.prototype.resolveTo_=function(e){if(e===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(e instanceof o)this.settleSameAsPromise_(e);else{e:switch(typeof e){case"object":var t=null!=e;break e;case"function":t=!0;break e;default:t=!1}t?this.resolveToNonPromiseObj_(e):this.fulfill_(e)}},o.prototype.resolveToNonPromiseObj_=function(e){var t=void 0;try{t=e.then}catch(e){return void this.reject_(e)}"function"==typeof t?this.settleSameAsThenable_(t,e):this.fulfill_(e)},o.prototype.reject_=function(e){this.settle_(2,e)},o.prototype.fulfill_=function(e){this.settle_(1,e)},o.prototype.settle_=function(e,t){if(0!=this.state_)throw Error("Cannot settle("+e+", "+t+"): Promise already settled in state"+this.state_);this.state_=e,this.result_=t,2===this.state_&&this.scheduleUnhandledRejectionCheck_(),this.executeOnSettledCallbacks_()},o.prototype.scheduleUnhandledRejectionCheck_=function(){var e=this;i((function(){if(e.notifyUnhandledRejection_()){var t=n.global.console;void 0!==t&&t.error(e.result_)}}),1)},o.prototype.notifyUnhandledRejection_=function(){if(this.isRejectionHandled_)return!1;var e=n.global.CustomEvent,t=n.global.Event,r=n.global.dispatchEvent;return void 0===r||("function"==typeof e?e=new e("unhandledrejection",{cancelable:!0}):"function"==typeof t?e=new t("unhandledrejection",{cancelable:!0}):(e=n.global.document.createEvent("CustomEvent")).initCustomEvent("unhandledrejection",!1,!0,e),e.promise=this,e.reason=this.result_,r(e))},o.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var e=0;e<this.onSettledCallbacks_.length;++e)s.asyncExecute(this.onSettledCallbacks_[e]);this.onSettledCallbacks_=null}};var s=new t;return o.prototype.settleSameAsPromise_=function(e){var t=this.createResolveAndReject_();e.callWhenSettled_(t.resolve,t.reject)},o.prototype.settleSameAsThenable_=function(e,t){var r=this.createResolveAndReject_();try{e.call(t,r.resolve,r.reject)}catch(e){r.reject(e)}},o.prototype.then=function(e,t){function r(e,t){return"function"==typeof e?function(t){try{n(e(t))}catch(e){i(e)}}:t}var n,i,s=new o((function(e,t){n=e,i=t}));return this.callWhenSettled_(r(e,n),r(t,i)),s},o.prototype.catch=function(e){return this.then(void 0,e)},o.prototype.callWhenSettled_=function(e,t){function r(){switch(n.state_){case 1:e(n.result_);break;case 2:t(n.result_);break;default:throw Error("Unexpected state: "+n.state_)}}var n=this;null==this.onSettledCallbacks_?s.asyncExecute(r):this.onSettledCallbacks_.push(r),this.isRejectionHandled_=!0},o.resolve=r,o.reject=function(e){return new o((function(t,r){r(e)}))},o.race=function(e){return new o((function(t,i){for(var o=n.makeIterator(e),s=o.next();!s.done;s=o.next())r(s.value).callWhenSettled_(t,i)}))},o.all=function(e){var t=n.makeIterator(e),i=t.next();return i.done?r([]):new o((function(e,n){function o(t){return function(r){s[t]=r,0==--a&&e(s)}}var s=[],a=0;do{s.push(void 0),a++,r(i.value).callWhenSettled_(o(s.length-1),n),i=t.next()}while(!i.done)}))},o}),"es6","es3"),n.owns=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.assign=n.TRUST_ES6_POLYFILLS&&"function"==typeof Object.assign?Object.assign:function(e,t){for(var r=1;r<arguments.length;r++){var i=arguments[r];if(i)for(var o in i)n.owns(i,o)&&(e[o]=i[o])}return e},n.polyfill("Object.assign",(function(e){return e||n.assign}),"es6","es3"),n.checkStringArgs=function(e,t,r){if(null==e)throw new TypeError("The 'this' value for String.prototype."+r+" must not be null or undefined");if(t instanceof RegExp)throw new TypeError("First argument to String.prototype."+r+" must not be a regular expression");return e+""},n.polyfill("String.prototype.startsWith",(function(e){return e||function(e,t){var r=n.checkStringArgs(this,e,"startsWith");e+="";var i=r.length,o=e.length;t=Math.max(0,Math.min(0|t,r.length));for(var s=0;s<o&&t<i;)if(r[t++]!=e[s++])return!1;return s>=o}}),"es6","es3"),n.polyfill("Array.prototype.copyWithin",(function(e){function t(e){return 1/0===(e=Number(e))||-1/0===e?e:0|e}return e||function(e,r,n){var i=this.length;if(e=t(e),r=t(r),n=void 0===n?i:t(n),e=0>e?Math.max(i+e,0):Math.min(e,i),r=0>r?Math.max(i+r,0):Math.min(r,i),n=0>n?Math.max(i+n,0):Math.min(n,i),e<r)for(;r<n;)r in this?this[e++]=this[r++]:(delete this[e++],r++);else for(e+=(n=Math.min(n,i+r-e))-r;n>r;)--n in this?this[--e]=this[n]:delete this[--e];return this}}),"es6","es3"),n.typedArrayCopyWithin=function(e){return e||Array.prototype.copyWithin},n.polyfill("Int8Array.prototype.copyWithin",n.typedArrayCopyWithin,"es6","es5"),n.polyfill("Uint8Array.prototype.copyWithin",n.typedArrayCopyWithin,"es6","es5"),n.polyfill("Uint8ClampedArray.prototype.copyWithin",n.typedArrayCopyWithin,"es6","es5"),n.polyfill("Int16Array.prototype.copyWithin",n.typedArrayCopyWithin,"es6","es5"),n.polyfill("Uint16Array.prototype.copyWithin",n.typedArrayCopyWithin,"es6","es5"),n.polyfill("Int32Array.prototype.copyWithin",n.typedArrayCopyWithin,"es6","es5"),n.polyfill("Uint32Array.prototype.copyWithin",n.typedArrayCopyWithin,"es6","es5"),n.polyfill("Float32Array.prototype.copyWithin",n.typedArrayCopyWithin,"es6","es5"),n.polyfill("Float64Array.prototype.copyWithin",n.typedArrayCopyWithin,"es6","es5");var i=function(){var e="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0;return e=e||"/index.js",function(t){function n(e,t){if(e){var r=ee,n=e+t;for(t=e;r[t]&&!(t>=n);)++t;if(16<t-e&&r.buffer&&ie)r=ie.decode(r.subarray(e,t));else{for(n="";e<t;){var i=r[e++];if(128&i){var o=63&r[e++];if(192==(224&i))n+=String.fromCharCode((31&i)<<6|o);else{var s=63&r[e++];65536>(i=224==(240&i)?(15&i)<<12|o<<6|s:(7&i)<<18|o<<12|s<<6|63&r[e++])?n+=String.fromCharCode(i):(i-=65536,n+=String.fromCharCode(55296|i>>10,56320|1023&i))}}else n+=String.fromCharCode(i)}r=n}}else r="";return r}function i(){var e=Q.buffer;F.HEAP8=$=new Int8Array(e),F.HEAP16=new Int16Array(e),F.HEAP32=te=new Int32Array(e),F.HEAPU8=ee=new Uint8Array(e),F.HEAPU16=new Uint16Array(e),F.HEAPU32=re=new Uint32Array(e),F.HEAPF32=new Float32Array(e),F.HEAPF64=new Float64Array(e)}function o(e){throw F.onAbort&&F.onAbort(e),Z(e="Aborted("+e+")"),ne=!0,e=new WebAssembly.RuntimeError(e+". Build with -sASSERTIONS for more info."),D(e),e}function s(e){try{if(e==pe&&K)return new Uint8Array(K);if(q)return q(e);throw"both async and sync fetching of the wasm failed"}catch(e){o(e)}}function a(e){for(;0<e.length;)e.shift()(F)}function c(e){this.excPtr=e,this.ptr=e-24,this.set_type=function(e){re[this.ptr+4>>2]=e},this.get_type=function(){return re[this.ptr+4>>2]},this.set_destructor=function(e){re[this.ptr+8>>2]=e},this.get_destructor=function(){return re[this.ptr+8>>2]},this.set_refcount=function(e){te[this.ptr>>2]=e},this.set_caught=function(e){$[this.ptr+12>>0]=e?1:0},this.get_caught=function(){return 0!=$[this.ptr+12>>0]},this.set_rethrown=function(e){$[this.ptr+13>>0]=e?1:0},this.get_rethrown=function(){return 0!=$[this.ptr+13>>0]},this.init=function(e,t){this.set_adjusted_ptr(0),this.set_type(e),this.set_destructor(t),this.set_refcount(0),this.set_caught(!1),this.set_rethrown(!1)},this.add_ref=function(){te[this.ptr>>2]+=1},this.release_ref=function(){var e=te[this.ptr>>2];return te[this.ptr>>2]=e-1,1===e},this.set_adjusted_ptr=function(e){re[this.ptr+16>>2]=e},this.get_adjusted_ptr=function(){return re[this.ptr+16>>2]},this.get_exception_ptr=function(){if(Kr(this.get_type()))return re[this.excPtr>>2];var e=this.get_adjusted_ptr();return 0!==e?e:this.excPtr}}function l(){function e(){if(!Jr&&(Jr=!0,F.calledRun=!0,!ne)){if(ce=!0,a(se),U(F),F.onRuntimeInitialized&&F.onRuntimeInitialized(),F.postRun)for("function"==typeof F.postRun&&(F.postRun=[F.postRun]);F.postRun.length;)ae.unshift(F.postRun.shift());a(ae)}}if(!(0<le)){if(F.preRun)for("function"==typeof F.preRun&&(F.preRun=[F.preRun]);F.preRun.length;)oe.unshift(F.preRun.shift());a(oe),0<le||(F.setStatus?(F.setStatus("Running..."),setTimeout((function(){setTimeout((function(){F.setStatus("")}),1),e()}),1)):e())}}function u(){}function h(e){return(e||u).__cache__}function p(e,t){var r=h(t),n=r[e];return n||((n=Object.create((t||u).prototype)).ptr=e,r[e]=n)}function d(e){if("string"==typeof e){for(var t=0,r=0;r<e.length;++r){var n=e.charCodeAt(r);127>=n?t++:2047>=n?t+=2:55296<=n&&57343>=n?(t+=4,++r):t+=3}if(r=0,0<(n=(t=Array(t+1)).length)){n=r+n-1;for(var i=0;i<e.length;++i){var o=e.charCodeAt(i);if(55296<=o&&57343>=o)o=65536+((1023&o)<<10)|1023&e.charCodeAt(++i);if(127>=o){if(r>=n)break;t[r++]=o}else{if(2047>=o){if(r+1>=n)break;t[r++]=192|o>>6}else{if(65535>=o){if(r+2>=n)break;t[r++]=224|o>>12}else{if(r+3>=n)break;t[r++]=240|o>>18,t[r++]=128|o>>12&63}t[r++]=128|o>>6&63}t[r++]=128|63&o}}t[r]=0}return e=Zr.alloc(t,$),Zr.copy(t,$,e),e}return e}function f(e){if("object"==typeof e){var t=Zr.alloc(e,$);return Zr.copy(e,$,t),t}return e}function m(){throw"cannot construct a VoidPtr, no constructor in IDL"}function g(){this.ptr=me(),h(g)[this.ptr]=this}function y(){this.ptr=ve(),h(y)[this.ptr]=this}function v(){this.ptr=xe(),h(v)[this.ptr]=this}function _(){this.ptr=Se(),h(_)[this.ptr]=this}function b(){this.ptr=Le(),h(b)[this.ptr]=this}function x(){this.ptr=je(),h(x)[this.ptr]=this}function w(){this.ptr=He(),h(w)[this.ptr]=this}function S(){this.ptr=qe(),h(S)[this.ptr]=this}function M(){this.ptr=$e(),h(M)[this.ptr]=this}function T(){throw"cannot construct a Status, no constructor in IDL"}function E(){this.ptr=ot(),h(E)[this.ptr]=this}function A(){this.ptr=lt(),h(A)[this.ptr]=this}function R(){this.ptr=dt(),h(R)[this.ptr]=this}function C(){this.ptr=yt(),h(C)[this.ptr]=this}function I(){this.ptr=xt(),h(I)[this.ptr]=this}function O(){this.ptr=Tt(),h(O)[this.ptr]=this}function P(){this.ptr=Ct(),h(P)[this.ptr]=this}function N(){this.ptr=Nt(),h(N)[this.ptr]=this}function L(){this.ptr=zt(),h(L)[this.ptr]=this}var U,D,F=void 0!==(t=void 0===t?{}:t)?t:{};F.ready=new Promise((function(e,t){U=e,D=t}));var B=!1,k=!1;F.onRuntimeInitialized=function(){B=!0,k&&"function"==typeof F.onModuleLoaded&&F.onModuleLoaded(F)},F.onModuleParsed=function(){k=!0,B&&"function"==typeof F.onModuleLoaded&&F.onModuleLoaded(F)},F.isVersionSupported=function(e){return"string"==typeof e&&(!(2>(e=e.split(".")).length||3<e.length)&&(1==e[0]&&0<=e[1]&&5>=e[1]||!(0!=e[0]||10<e[1])))};var j=Object.assign({},F),G="object"==typeof window,z="function"==typeof importScripts,V="object"==typeof process&&"object"==typeof process.versions&&"string"==typeof process.versions.node,H="";if(V){var W=r(Object(function(){var e=new Error("Cannot find module 'fs'");throw e.code="MODULE_NOT_FOUND",e}())),X=r(594);H=z?X.dirname(H)+"/":"//";var Y=function(e,t){return e=e.startsWith("file://")?new URL(e):X.normalize(e),W.readFileSync(e,t?void 0:"utf8")},q=function(e){return(e=Y(e,!0)).buffer||(e=new Uint8Array(e)),e},J=function(e,t,r){e=e.startsWith("file://")?new URL(e):X.normalize(e),W.readFile(e,(function(e,n){e?r(e):t(n.buffer)}))};1<process.argv.length&&process.argv[1].replace(/\\/g,"/"),process.argv.slice(2),F.inspect=function(){return"[Emscripten Module object]"}}else(G||z)&&(z?H=self.location.href:"undefined"!=typeof document&&document.currentScript&&(H=document.currentScript.src),e&&(H=e),H=0!==H.indexOf("blob:")?H.substr(0,H.replace(/[?#].*/,"").lastIndexOf("/")+1):"",Y=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(null),t.responseText},z&&(q=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}),J=function(e,t,r){var n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="arraybuffer",n.onload=function(){200==n.status||0==n.status&&n.response?t(n.response):r()},n.onerror=r,n.send(null)});F.print||console.log.bind(console);var K,Z=F.printErr||console.warn.bind(console);Object.assign(F,j),j=null,F.wasmBinary&&(K=F.wasmBinary),"object"!=typeof WebAssembly&&o("no native wasm support detected");var Q,$,ee,te,re,ne=!1,ie="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0,oe=[],se=[],ae=[],ce=!1,le=0,ue=null,he=null,pe="draco_decoder_gltf.wasm";pe.startsWith("data:application/octet-stream;base64,")||(pe=function(e){return F.locateFile?F.locateFile(e,H):H+e}(pe));var de={b:function(e,t,r){throw new c(e).init(t,r),e},a:function(){o("")},d:function(e,t,r){ee.copyWithin(e,t,t+r)},c:function(e){var t=ee.length;if(2147483648<(e>>>=0))return!1;for(var r=1;4>=r;r*=2){var n=t*(1+.2/r);n=Math.min(n,e+100663296);var o=Math;n=Math.max(e,n),o=o.min.call(o,2147483648,n+(65536-n%65536)%65536);e:{n=Q.buffer;try{Q.grow(o-n.byteLength+65535>>>16),i();var s=1;break e}catch(e){}s=void 0}if(s)return!0}return!1}};!function(){function e(e,t){F.asm=e.exports,Q=F.asm.e,i(),se.unshift(F.asm.f),le--,F.monitorRunDependencies&&F.monitorRunDependencies(le),0==le&&(null!==ue&&(clearInterval(ue),ue=null),he&&(e=he,he=null,e()))}function t(t){e(t.instance)}function r(e){return function(){if(!K&&(G||z)){if("function"==typeof fetch&&!pe.startsWith("file://"))return fetch(pe,{credentials:"same-origin"}).then((function(e){if(!e.ok)throw"failed to load wasm binary file at '"+pe+"'";return e.arrayBuffer()})).catch((function(){return s(pe)}));if(J)return new Promise((function(e,t){J(pe,(function(t){e(new Uint8Array(t))}),t)}))}return Promise.resolve().then((function(){return s(pe)}))}().then((function(e){return WebAssembly.instantiate(e,n)})).then((function(e){return e})).then(e,(function(e){Z("failed to asynchronously prepare wasm: "+e),o(e)}))}var n={a:de};if(le++,F.monitorRunDependencies&&F.monitorRunDependencies(le),F.instantiateWasm)try{return F.instantiateWasm(n,e)}catch(e){Z("Module.instantiateWasm callback failed with error: "+e),D(e)}(K||"function"!=typeof WebAssembly.instantiateStreaming||pe.startsWith("data:application/octet-stream;base64,")||pe.startsWith("file://")||V||"function"!=typeof fetch?r(t):fetch(pe,{credentials:"same-origin"}).then((function(e){return WebAssembly.instantiateStreaming(e,n).then(t,(function(e){return Z("wasm streaming compile failed: "+e),Z("falling back to ArrayBuffer instantiation"),r(t)}))}))).catch(D)}();var fe=F._emscripten_bind_VoidPtr___destroy___0=function(){return(fe=F._emscripten_bind_VoidPtr___destroy___0=F.asm.h).apply(null,arguments)},me=F._emscripten_bind_DecoderBuffer_DecoderBuffer_0=function(){return(me=F._emscripten_bind_DecoderBuffer_DecoderBuffer_0=F.asm.i).apply(null,arguments)},ge=F._emscripten_bind_DecoderBuffer_Init_2=function(){return(ge=F._emscripten_bind_DecoderBuffer_Init_2=F.asm.j).apply(null,arguments)},ye=F._emscripten_bind_DecoderBuffer___destroy___0=function(){return(ye=F._emscripten_bind_DecoderBuffer___destroy___0=F.asm.k).apply(null,arguments)},ve=F._emscripten_bind_AttributeTransformData_AttributeTransformData_0=function(){return(ve=F._emscripten_bind_AttributeTransformData_AttributeTransformData_0=F.asm.l).apply(null,arguments)},_e=F._emscripten_bind_AttributeTransformData_transform_type_0=function(){return(_e=F._emscripten_bind_AttributeTransformData_transform_type_0=F.asm.m).apply(null,arguments)},be=F._emscripten_bind_AttributeTransformData___destroy___0=function(){return(be=F._emscripten_bind_AttributeTransformData___destroy___0=F.asm.n).apply(null,arguments)},xe=F._emscripten_bind_GeometryAttribute_GeometryAttribute_0=function(){return(xe=F._emscripten_bind_GeometryAttribute_GeometryAttribute_0=F.asm.o).apply(null,arguments)},we=F._emscripten_bind_GeometryAttribute___destroy___0=function(){return(we=F._emscripten_bind_GeometryAttribute___destroy___0=F.asm.p).apply(null,arguments)},Se=F._emscripten_bind_PointAttribute_PointAttribute_0=function(){return(Se=F._emscripten_bind_PointAttribute_PointAttribute_0=F.asm.q).apply(null,arguments)},Me=F._emscripten_bind_PointAttribute_size_0=function(){return(Me=F._emscripten_bind_PointAttribute_size_0=F.asm.r).apply(null,arguments)},Te=F._emscripten_bind_PointAttribute_GetAttributeTransformData_0=function(){return(Te=F._emscripten_bind_PointAttribute_GetAttributeTransformData_0=F.asm.s).apply(null,arguments)},Ee=F._emscripten_bind_PointAttribute_attribute_type_0=function(){return(Ee=F._emscripten_bind_PointAttribute_attribute_type_0=F.asm.t).apply(null,arguments)},Ae=F._emscripten_bind_PointAttribute_data_type_0=function(){return(Ae=F._emscripten_bind_PointAttribute_data_type_0=F.asm.u).apply(null,arguments)},Re=F._emscripten_bind_PointAttribute_num_components_0=function(){return(Re=F._emscripten_bind_PointAttribute_num_components_0=F.asm.v).apply(null,arguments)},Ce=F._emscripten_bind_PointAttribute_normalized_0=function(){return(Ce=F._emscripten_bind_PointAttribute_normalized_0=F.asm.w).apply(null,arguments)},Ie=F._emscripten_bind_PointAttribute_byte_stride_0=function(){return(Ie=F._emscripten_bind_PointAttribute_byte_stride_0=F.asm.x).apply(null,arguments)},Oe=F._emscripten_bind_PointAttribute_byte_offset_0=function(){return(Oe=F._emscripten_bind_PointAttribute_byte_offset_0=F.asm.y).apply(null,arguments)},Pe=F._emscripten_bind_PointAttribute_unique_id_0=function(){return(Pe=F._emscripten_bind_PointAttribute_unique_id_0=F.asm.z).apply(null,arguments)},Ne=F._emscripten_bind_PointAttribute___destroy___0=function(){return(Ne=F._emscripten_bind_PointAttribute___destroy___0=F.asm.A).apply(null,arguments)},Le=F._emscripten_bind_AttributeQuantizationTransform_AttributeQuantizationTransform_0=function(){return(Le=F._emscripten_bind_AttributeQuantizationTransform_AttributeQuantizationTransform_0=F.asm.B).apply(null,arguments)},Ue=F._emscripten_bind_AttributeQuantizationTransform_InitFromAttribute_1=function(){return(Ue=F._emscripten_bind_AttributeQuantizationTransform_InitFromAttribute_1=F.asm.C).apply(null,arguments)},De=F._emscripten_bind_AttributeQuantizationTransform_quantization_bits_0=function(){return(De=F._emscripten_bind_AttributeQuantizationTransform_quantization_bits_0=F.asm.D).apply(null,arguments)},Fe=F._emscripten_bind_AttributeQuantizationTransform_min_value_1=function(){return(Fe=F._emscripten_bind_AttributeQuantizationTransform_min_value_1=F.asm.E).apply(null,arguments)},Be=F._emscripten_bind_AttributeQuantizationTransform_range_0=function(){return(Be=F._emscripten_bind_AttributeQuantizationTransform_range_0=F.asm.F).apply(null,arguments)},ke=F._emscripten_bind_AttributeQuantizationTransform___destroy___0=function(){return(ke=F._emscripten_bind_AttributeQuantizationTransform___destroy___0=F.asm.G).apply(null,arguments)},je=F._emscripten_bind_AttributeOctahedronTransform_AttributeOctahedronTransform_0=function(){return(je=F._emscripten_bind_AttributeOctahedronTransform_AttributeOctahedronTransform_0=F.asm.H).apply(null,arguments)},Ge=F._emscripten_bind_AttributeOctahedronTransform_InitFromAttribute_1=function(){return(Ge=F._emscripten_bind_AttributeOctahedronTransform_InitFromAttribute_1=F.asm.I).apply(null,arguments)},ze=F._emscripten_bind_AttributeOctahedronTransform_quantization_bits_0=function(){return(ze=F._emscripten_bind_AttributeOctahedronTransform_quantization_bits_0=F.asm.J).apply(null,arguments)},Ve=F._emscripten_bind_AttributeOctahedronTransform___destroy___0=function(){return(Ve=F._emscripten_bind_AttributeOctahedronTransform___destroy___0=F.asm.K).apply(null,arguments)},He=F._emscripten_bind_PointCloud_PointCloud_0=function(){return(He=F._emscripten_bind_PointCloud_PointCloud_0=F.asm.L).apply(null,arguments)},We=F._emscripten_bind_PointCloud_num_attributes_0=function(){return(We=F._emscripten_bind_PointCloud_num_attributes_0=F.asm.M).apply(null,arguments)},Xe=F._emscripten_bind_PointCloud_num_points_0=function(){return(Xe=F._emscripten_bind_PointCloud_num_points_0=F.asm.N).apply(null,arguments)},Ye=F._emscripten_bind_PointCloud___destroy___0=function(){return(Ye=F._emscripten_bind_PointCloud___destroy___0=F.asm.O).apply(null,arguments)},qe=F._emscripten_bind_Mesh_Mesh_0=function(){return(qe=F._emscripten_bind_Mesh_Mesh_0=F.asm.P).apply(null,arguments)},Je=F._emscripten_bind_Mesh_num_faces_0=function(){return(Je=F._emscripten_bind_Mesh_num_faces_0=F.asm.Q).apply(null,arguments)},Ke=F._emscripten_bind_Mesh_num_attributes_0=function(){return(Ke=F._emscripten_bind_Mesh_num_attributes_0=F.asm.R).apply(null,arguments)},Ze=F._emscripten_bind_Mesh_num_points_0=function(){return(Ze=F._emscripten_bind_Mesh_num_points_0=F.asm.S).apply(null,arguments)},Qe=F._emscripten_bind_Mesh___destroy___0=function(){return(Qe=F._emscripten_bind_Mesh___destroy___0=F.asm.T).apply(null,arguments)},$e=F._emscripten_bind_Metadata_Metadata_0=function(){return($e=F._emscripten_bind_Metadata_Metadata_0=F.asm.U).apply(null,arguments)},et=F._emscripten_bind_Metadata___destroy___0=function(){return(et=F._emscripten_bind_Metadata___destroy___0=F.asm.V).apply(null,arguments)},tt=F._emscripten_bind_Status_code_0=function(){return(tt=F._emscripten_bind_Status_code_0=F.asm.W).apply(null,arguments)},rt=F._emscripten_bind_Status_ok_0=function(){return(rt=F._emscripten_bind_Status_ok_0=F.asm.X).apply(null,arguments)},nt=F._emscripten_bind_Status_error_msg_0=function(){return(nt=F._emscripten_bind_Status_error_msg_0=F.asm.Y).apply(null,arguments)},it=F._emscripten_bind_Status___destroy___0=function(){return(it=F._emscripten_bind_Status___destroy___0=F.asm.Z).apply(null,arguments)},ot=F._emscripten_bind_DracoFloat32Array_DracoFloat32Array_0=function(){return(ot=F._emscripten_bind_DracoFloat32Array_DracoFloat32Array_0=F.asm._).apply(null,arguments)},st=F._emscripten_bind_DracoFloat32Array_GetValue_1=function(){return(st=F._emscripten_bind_DracoFloat32Array_GetValue_1=F.asm.$).apply(null,arguments)},at=F._emscripten_bind_DracoFloat32Array_size_0=function(){return(at=F._emscripten_bind_DracoFloat32Array_size_0=F.asm.aa).apply(null,arguments)},ct=F._emscripten_bind_DracoFloat32Array___destroy___0=function(){return(ct=F._emscripten_bind_DracoFloat32Array___destroy___0=F.asm.ba).apply(null,arguments)},lt=F._emscripten_bind_DracoInt8Array_DracoInt8Array_0=function(){return(lt=F._emscripten_bind_DracoInt8Array_DracoInt8Array_0=F.asm.ca).apply(null,arguments)},ut=F._emscripten_bind_DracoInt8Array_GetValue_1=function(){return(ut=F._emscripten_bind_DracoInt8Array_GetValue_1=F.asm.da).apply(null,arguments)},ht=F._emscripten_bind_DracoInt8Array_size_0=function(){return(ht=F._emscripten_bind_DracoInt8Array_size_0=F.asm.ea).apply(null,arguments)},pt=F._emscripten_bind_DracoInt8Array___destroy___0=function(){return(pt=F._emscripten_bind_DracoInt8Array___destroy___0=F.asm.fa).apply(null,arguments)},dt=F._emscripten_bind_DracoUInt8Array_DracoUInt8Array_0=function(){return(dt=F._emscripten_bind_DracoUInt8Array_DracoUInt8Array_0=F.asm.ga).apply(null,arguments)},ft=F._emscripten_bind_DracoUInt8Array_GetValue_1=function(){return(ft=F._emscripten_bind_DracoUInt8Array_GetValue_1=F.asm.ha).apply(null,arguments)},mt=F._emscripten_bind_DracoUInt8Array_size_0=function(){return(mt=F._emscripten_bind_DracoUInt8Array_size_0=F.asm.ia).apply(null,arguments)},gt=F._emscripten_bind_DracoUInt8Array___destroy___0=function(){return(gt=F._emscripten_bind_DracoUInt8Array___destroy___0=F.asm.ja).apply(null,arguments)},yt=F._emscripten_bind_DracoInt16Array_DracoInt16Array_0=function(){return(yt=F._emscripten_bind_DracoInt16Array_DracoInt16Array_0=F.asm.ka).apply(null,arguments)},vt=F._emscripten_bind_DracoInt16Array_GetValue_1=function(){return(vt=F._emscripten_bind_DracoInt16Array_GetValue_1=F.asm.la).apply(null,arguments)},_t=F._emscripten_bind_DracoInt16Array_size_0=function(){return(_t=F._emscripten_bind_DracoInt16Array_size_0=F.asm.ma).apply(null,arguments)},bt=F._emscripten_bind_DracoInt16Array___destroy___0=function(){return(bt=F._emscripten_bind_DracoInt16Array___destroy___0=F.asm.na).apply(null,arguments)},xt=F._emscripten_bind_DracoUInt16Array_DracoUInt16Array_0=function(){return(xt=F._emscripten_bind_DracoUInt16Array_DracoUInt16Array_0=F.asm.oa).apply(null,arguments)},wt=F._emscripten_bind_DracoUInt16Array_GetValue_1=function(){return(wt=F._emscripten_bind_DracoUInt16Array_GetValue_1=F.asm.pa).apply(null,arguments)},St=F._emscripten_bind_DracoUInt16Array_size_0=function(){return(St=F._emscripten_bind_DracoUInt16Array_size_0=F.asm.qa).apply(null,arguments)},Mt=F._emscripten_bind_DracoUInt16Array___destroy___0=function(){return(Mt=F._emscripten_bind_DracoUInt16Array___destroy___0=F.asm.ra).apply(null,arguments)},Tt=F._emscripten_bind_DracoInt32Array_DracoInt32Array_0=function(){return(Tt=F._emscripten_bind_DracoInt32Array_DracoInt32Array_0=F.asm.sa).apply(null,arguments)},Et=F._emscripten_bind_DracoInt32Array_GetValue_1=function(){return(Et=F._emscripten_bind_DracoInt32Array_GetValue_1=F.asm.ta).apply(null,arguments)},At=F._emscripten_bind_DracoInt32Array_size_0=function(){return(At=F._emscripten_bind_DracoInt32Array_size_0=F.asm.ua).apply(null,arguments)},Rt=F._emscripten_bind_DracoInt32Array___destroy___0=function(){return(Rt=F._emscripten_bind_DracoInt32Array___destroy___0=F.asm.va).apply(null,arguments)},Ct=F._emscripten_bind_DracoUInt32Array_DracoUInt32Array_0=function(){return(Ct=F._emscripten_bind_DracoUInt32Array_DracoUInt32Array_0=F.asm.wa).apply(null,arguments)},It=F._emscripten_bind_DracoUInt32Array_GetValue_1=function(){return(It=F._emscripten_bind_DracoUInt32Array_GetValue_1=F.asm.xa).apply(null,arguments)},Ot=F._emscripten_bind_DracoUInt32Array_size_0=function(){return(Ot=F._emscripten_bind_DracoUInt32Array_size_0=F.asm.ya).apply(null,arguments)},Pt=F._emscripten_bind_DracoUInt32Array___destroy___0=function(){return(Pt=F._emscripten_bind_DracoUInt32Array___destroy___0=F.asm.za).apply(null,arguments)},Nt=F._emscripten_bind_MetadataQuerier_MetadataQuerier_0=function(){return(Nt=F._emscripten_bind_MetadataQuerier_MetadataQuerier_0=F.asm.Aa).apply(null,arguments)},Lt=F._emscripten_bind_MetadataQuerier_HasEntry_2=function(){return(Lt=F._emscripten_bind_MetadataQuerier_HasEntry_2=F.asm.Ba).apply(null,arguments)},Ut=F._emscripten_bind_MetadataQuerier_GetIntEntry_2=function(){return(Ut=F._emscripten_bind_MetadataQuerier_GetIntEntry_2=F.asm.Ca).apply(null,arguments)},Dt=F._emscripten_bind_MetadataQuerier_GetIntEntryArray_3=function(){return(Dt=F._emscripten_bind_MetadataQuerier_GetIntEntryArray_3=F.asm.Da).apply(null,arguments)},Ft=F._emscripten_bind_MetadataQuerier_GetDoubleEntry_2=function(){return(Ft=F._emscripten_bind_MetadataQuerier_GetDoubleEntry_2=F.asm.Ea).apply(null,arguments)},Bt=F._emscripten_bind_MetadataQuerier_GetStringEntry_2=function(){return(Bt=F._emscripten_bind_MetadataQuerier_GetStringEntry_2=F.asm.Fa).apply(null,arguments)},kt=F._emscripten_bind_MetadataQuerier_NumEntries_1=function(){return(kt=F._emscripten_bind_MetadataQuerier_NumEntries_1=F.asm.Ga).apply(null,arguments)},jt=F._emscripten_bind_MetadataQuerier_GetEntryName_2=function(){return(jt=F._emscripten_bind_MetadataQuerier_GetEntryName_2=F.asm.Ha).apply(null,arguments)},Gt=F._emscripten_bind_MetadataQuerier___destroy___0=function(){return(Gt=F._emscripten_bind_MetadataQuerier___destroy___0=F.asm.Ia).apply(null,arguments)},zt=F._emscripten_bind_Decoder_Decoder_0=function(){return(zt=F._emscripten_bind_Decoder_Decoder_0=F.asm.Ja).apply(null,arguments)},Vt=F._emscripten_bind_Decoder_DecodeArrayToPointCloud_3=function(){return(Vt=F._emscripten_bind_Decoder_DecodeArrayToPointCloud_3=F.asm.Ka).apply(null,arguments)},Ht=F._emscripten_bind_Decoder_DecodeArrayToMesh_3=function(){return(Ht=F._emscripten_bind_Decoder_DecodeArrayToMesh_3=F.asm.La).apply(null,arguments)},Wt=F._emscripten_bind_Decoder_GetAttributeId_2=function(){return(Wt=F._emscripten_bind_Decoder_GetAttributeId_2=F.asm.Ma).apply(null,arguments)},Xt=F._emscripten_bind_Decoder_GetAttributeIdByName_2=function(){return(Xt=F._emscripten_bind_Decoder_GetAttributeIdByName_2=F.asm.Na).apply(null,arguments)},Yt=F._emscripten_bind_Decoder_GetAttributeIdByMetadataEntry_3=function(){return(Yt=F._emscripten_bind_Decoder_GetAttributeIdByMetadataEntry_3=F.asm.Oa).apply(null,arguments)},qt=F._emscripten_bind_Decoder_GetAttribute_2=function(){return(qt=F._emscripten_bind_Decoder_GetAttribute_2=F.asm.Pa).apply(null,arguments)},Jt=F._emscripten_bind_Decoder_GetAttributeByUniqueId_2=function(){return(Jt=F._emscripten_bind_Decoder_GetAttributeByUniqueId_2=F.asm.Qa).apply(null,arguments)},Kt=F._emscripten_bind_Decoder_GetMetadata_1=function(){return(Kt=F._emscripten_bind_Decoder_GetMetadata_1=F.asm.Ra).apply(null,arguments)},Zt=F._emscripten_bind_Decoder_GetAttributeMetadata_2=function(){return(Zt=F._emscripten_bind_Decoder_GetAttributeMetadata_2=F.asm.Sa).apply(null,arguments)},Qt=F._emscripten_bind_Decoder_GetFaceFromMesh_3=function(){return(Qt=F._emscripten_bind_Decoder_GetFaceFromMesh_3=F.asm.Ta).apply(null,arguments)},$t=F._emscripten_bind_Decoder_GetTriangleStripsFromMesh_2=function(){return($t=F._emscripten_bind_Decoder_GetTriangleStripsFromMesh_2=F.asm.Ua).apply(null,arguments)},er=F._emscripten_bind_Decoder_GetTrianglesUInt16Array_3=function(){return(er=F._emscripten_bind_Decoder_GetTrianglesUInt16Array_3=F.asm.Va).apply(null,arguments)},tr=F._emscripten_bind_Decoder_GetTrianglesUInt32Array_3=function(){return(tr=F._emscripten_bind_Decoder_GetTrianglesUInt32Array_3=F.asm.Wa).apply(null,arguments)},rr=F._emscripten_bind_Decoder_GetAttributeFloat_3=function(){return(rr=F._emscripten_bind_Decoder_GetAttributeFloat_3=F.asm.Xa).apply(null,arguments)},nr=F._emscripten_bind_Decoder_GetAttributeFloatForAllPoints_3=function(){return(nr=F._emscripten_bind_Decoder_GetAttributeFloatForAllPoints_3=F.asm.Ya).apply(null,arguments)},ir=F._emscripten_bind_Decoder_GetAttributeIntForAllPoints_3=function(){return(ir=F._emscripten_bind_Decoder_GetAttributeIntForAllPoints_3=F.asm.Za).apply(null,arguments)},or=F._emscripten_bind_Decoder_GetAttributeInt8ForAllPoints_3=function(){return(or=F._emscripten_bind_Decoder_GetAttributeInt8ForAllPoints_3=F.asm._a).apply(null,arguments)},sr=F._emscripten_bind_Decoder_GetAttributeUInt8ForAllPoints_3=function(){return(sr=F._emscripten_bind_Decoder_GetAttributeUInt8ForAllPoints_3=F.asm.$a).apply(null,arguments)},ar=F._emscripten_bind_Decoder_GetAttributeInt16ForAllPoints_3=function(){return(ar=F._emscripten_bind_Decoder_GetAttributeInt16ForAllPoints_3=F.asm.ab).apply(null,arguments)},cr=F._emscripten_bind_Decoder_GetAttributeUInt16ForAllPoints_3=function(){return(cr=F._emscripten_bind_Decoder_GetAttributeUInt16ForAllPoints_3=F.asm.bb).apply(null,arguments)},lr=F._emscripten_bind_Decoder_GetAttributeInt32ForAllPoints_3=function(){return(lr=F._emscripten_bind_Decoder_GetAttributeInt32ForAllPoints_3=F.asm.cb).apply(null,arguments)},ur=F._emscripten_bind_Decoder_GetAttributeUInt32ForAllPoints_3=function(){return(ur=F._emscripten_bind_Decoder_GetAttributeUInt32ForAllPoints_3=F.asm.db).apply(null,arguments)},hr=F._emscripten_bind_Decoder_GetAttributeDataArrayForAllPoints_5=function(){return(hr=F._emscripten_bind_Decoder_GetAttributeDataArrayForAllPoints_5=F.asm.eb).apply(null,arguments)},pr=F._emscripten_bind_Decoder_SkipAttributeTransform_1=function(){return(pr=F._emscripten_bind_Decoder_SkipAttributeTransform_1=F.asm.fb).apply(null,arguments)},dr=F._emscripten_bind_Decoder_GetEncodedGeometryType_Deprecated_1=function(){return(dr=F._emscripten_bind_Decoder_GetEncodedGeometryType_Deprecated_1=F.asm.gb).apply(null,arguments)},fr=F._emscripten_bind_Decoder_DecodeBufferToPointCloud_2=function(){return(fr=F._emscripten_bind_Decoder_DecodeBufferToPointCloud_2=F.asm.hb).apply(null,arguments)},mr=F._emscripten_bind_Decoder_DecodeBufferToMesh_2=function(){return(mr=F._emscripten_bind_Decoder_DecodeBufferToMesh_2=F.asm.ib).apply(null,arguments)},gr=F._emscripten_bind_Decoder___destroy___0=function(){return(gr=F._emscripten_bind_Decoder___destroy___0=F.asm.jb).apply(null,arguments)},yr=F._emscripten_enum_draco_AttributeTransformType_ATTRIBUTE_INVALID_TRANSFORM=function(){return(yr=F._emscripten_enum_draco_AttributeTransformType_ATTRIBUTE_INVALID_TRANSFORM=F.asm.kb).apply(null,arguments)},vr=F._emscripten_enum_draco_AttributeTransformType_ATTRIBUTE_NO_TRANSFORM=function(){return(vr=F._emscripten_enum_draco_AttributeTransformType_ATTRIBUTE_NO_TRANSFORM=F.asm.lb).apply(null,arguments)},_r=F._emscripten_enum_draco_AttributeTransformType_ATTRIBUTE_QUANTIZATION_TRANSFORM=function(){return(_r=F._emscripten_enum_draco_AttributeTransformType_ATTRIBUTE_QUANTIZATION_TRANSFORM=F.asm.mb).apply(null,arguments)},br=F._emscripten_enum_draco_AttributeTransformType_ATTRIBUTE_OCTAHEDRON_TRANSFORM=function(){return(br=F._emscripten_enum_draco_AttributeTransformType_ATTRIBUTE_OCTAHEDRON_TRANSFORM=F.asm.nb).apply(null,arguments)},xr=F._emscripten_enum_draco_GeometryAttribute_Type_INVALID=function(){return(xr=F._emscripten_enum_draco_GeometryAttribute_Type_INVALID=F.asm.ob).apply(null,arguments)},wr=F._emscripten_enum_draco_GeometryAttribute_Type_POSITION=function(){return(wr=F._emscripten_enum_draco_GeometryAttribute_Type_POSITION=F.asm.pb).apply(null,arguments)},Sr=F._emscripten_enum_draco_GeometryAttribute_Type_NORMAL=function(){return(Sr=F._emscripten_enum_draco_GeometryAttribute_Type_NORMAL=F.asm.qb).apply(null,arguments)},Mr=F._emscripten_enum_draco_GeometryAttribute_Type_COLOR=function(){return(Mr=F._emscripten_enum_draco_GeometryAttribute_Type_COLOR=F.asm.rb).apply(null,arguments)},Tr=F._emscripten_enum_draco_GeometryAttribute_Type_TEX_COORD=function(){return(Tr=F._emscripten_enum_draco_GeometryAttribute_Type_TEX_COORD=F.asm.sb).apply(null,arguments)},Er=F._emscripten_enum_draco_GeometryAttribute_Type_GENERIC=function(){return(Er=F._emscripten_enum_draco_GeometryAttribute_Type_GENERIC=F.asm.tb).apply(null,arguments)},Ar=F._emscripten_enum_draco_EncodedGeometryType_INVALID_GEOMETRY_TYPE=function(){return(Ar=F._emscripten_enum_draco_EncodedGeometryType_INVALID_GEOMETRY_TYPE=F.asm.ub).apply(null,arguments)},Rr=F._emscripten_enum_draco_EncodedGeometryType_POINT_CLOUD=function(){return(Rr=F._emscripten_enum_draco_EncodedGeometryType_POINT_CLOUD=F.asm.vb).apply(null,arguments)},Cr=F._emscripten_enum_draco_EncodedGeometryType_TRIANGULAR_MESH=function(){return(Cr=F._emscripten_enum_draco_EncodedGeometryType_TRIANGULAR_MESH=F.asm.wb).apply(null,arguments)},Ir=F._emscripten_enum_draco_DataType_DT_INVALID=function(){return(Ir=F._emscripten_enum_draco_DataType_DT_INVALID=F.asm.xb).apply(null,arguments)},Or=F._emscripten_enum_draco_DataType_DT_INT8=function(){return(Or=F._emscripten_enum_draco_DataType_DT_INT8=F.asm.yb).apply(null,arguments)},Pr=F._emscripten_enum_draco_DataType_DT_UINT8=function(){return(Pr=F._emscripten_enum_draco_DataType_DT_UINT8=F.asm.zb).apply(null,arguments)},Nr=F._emscripten_enum_draco_DataType_DT_INT16=function(){return(Nr=F._emscripten_enum_draco_DataType_DT_INT16=F.asm.Ab).apply(null,arguments)},Lr=F._emscripten_enum_draco_DataType_DT_UINT16=function(){return(Lr=F._emscripten_enum_draco_DataType_DT_UINT16=F.asm.Bb).apply(null,arguments)},Ur=F._emscripten_enum_draco_DataType_DT_INT32=function(){return(Ur=F._emscripten_enum_draco_DataType_DT_INT32=F.asm.Cb).apply(null,arguments)},Dr=F._emscripten_enum_draco_DataType_DT_UINT32=function(){return(Dr=F._emscripten_enum_draco_DataType_DT_UINT32=F.asm.Db).apply(null,arguments)},Fr=F._emscripten_enum_draco_DataType_DT_INT64=function(){return(Fr=F._emscripten_enum_draco_DataType_DT_INT64=F.asm.Eb).apply(null,arguments)},Br=F._emscripten_enum_draco_DataType_DT_UINT64=function(){return(Br=F._emscripten_enum_draco_DataType_DT_UINT64=F.asm.Fb).apply(null,arguments)},kr=F._emscripten_enum_draco_DataType_DT_FLOAT32=function(){return(kr=F._emscripten_enum_draco_DataType_DT_FLOAT32=F.asm.Gb).apply(null,arguments)},jr=F._emscripten_enum_draco_DataType_DT_FLOAT64=function(){return(jr=F._emscripten_enum_draco_DataType_DT_FLOAT64=F.asm.Hb).apply(null,arguments)},Gr=F._emscripten_enum_draco_DataType_DT_BOOL=function(){return(Gr=F._emscripten_enum_draco_DataType_DT_BOOL=F.asm.Ib).apply(null,arguments)},zr=F._emscripten_enum_draco_DataType_DT_TYPES_COUNT=function(){return(zr=F._emscripten_enum_draco_DataType_DT_TYPES_COUNT=F.asm.Jb).apply(null,arguments)},Vr=F._emscripten_enum_draco_StatusCode_OK=function(){return(Vr=F._emscripten_enum_draco_StatusCode_OK=F.asm.Kb).apply(null,arguments)},Hr=F._emscripten_enum_draco_StatusCode_DRACO_ERROR=function(){return(Hr=F._emscripten_enum_draco_StatusCode_DRACO_ERROR=F.asm.Lb).apply(null,arguments)},Wr=F._emscripten_enum_draco_StatusCode_IO_ERROR=function(){return(Wr=F._emscripten_enum_draco_StatusCode_IO_ERROR=F.asm.Mb).apply(null,arguments)},Xr=F._emscripten_enum_draco_StatusCode_INVALID_PARAMETER=function(){return(Xr=F._emscripten_enum_draco_StatusCode_INVALID_PARAMETER=F.asm.Nb).apply(null,arguments)},Yr=F._emscripten_enum_draco_StatusCode_UNSUPPORTED_VERSION=function(){return(Yr=F._emscripten_enum_draco_StatusCode_UNSUPPORTED_VERSION=F.asm.Ob).apply(null,arguments)},qr=F._emscripten_enum_draco_StatusCode_UNKNOWN_VERSION=function(){return(qr=F._emscripten_enum_draco_StatusCode_UNKNOWN_VERSION=F.asm.Pb).apply(null,arguments)};F._malloc=function(){return(F._malloc=F.asm.Qb).apply(null,arguments)},F._free=function(){return(F._free=F.asm.Rb).apply(null,arguments)};var Jr,Kr=function(){return(Kr=F.asm.Sb).apply(null,arguments)};if(F.___start_em_js=11660,F.___stop_em_js=11758,he=function e(){Jr||l(),Jr||(he=e)},F.preInit)for("function"==typeof F.preInit&&(F.preInit=[F.preInit]);0<F.preInit.length;)F.preInit.pop()();l(),u.prototype=Object.create(u.prototype),u.prototype.constructor=u,u.prototype.__class__=u,u.__cache__={},F.WrapperObject=u,F.getCache=h,F.wrapPointer=p,F.castObject=function(e,t){return p(e.ptr,t)},F.NULL=p(0),F.destroy=function(e){if(!e.__destroy__)throw"Error: Cannot destroy object. (Did you create it yourself?)";e.__destroy__(),delete h(e.__class__)[e.ptr]},F.compare=function(e,t){return e.ptr===t.ptr},F.getPointer=function(e){return e.ptr},F.getClass=function(e){return e.__class__};var Zr={buffer:0,size:0,pos:0,temps:[],needed:0,prepare:function(){if(Zr.needed){for(var e=0;e<Zr.temps.length;e++)F._free(Zr.temps[e]);Zr.temps.length=0,F._free(Zr.buffer),Zr.buffer=0,Zr.size+=Zr.needed,Zr.needed=0}Zr.buffer||(Zr.size+=128,Zr.buffer=F._malloc(Zr.size),Zr.buffer||o(void 0)),Zr.pos=0},alloc:function(e,t){return Zr.buffer||o(void 0),e=(e=e.length*t.BYTES_PER_ELEMENT)+7&-8,Zr.pos+e>=Zr.size?(0<e||o(void 0),Zr.needed+=e,t=F._malloc(e),Zr.temps.push(t)):(t=Zr.buffer+Zr.pos,Zr.pos+=e),t},copy:function(e,t,r){switch(r>>>=0,t.BYTES_PER_ELEMENT){case 2:r>>>=1;break;case 4:r>>>=2;break;case 8:r>>>=3}for(var n=0;n<e.length;n++)t[r+n]=e[n]}};return m.prototype=Object.create(u.prototype),m.prototype.constructor=m,m.prototype.__class__=m,m.__cache__={},F.VoidPtr=m,m.prototype.__destroy__=m.prototype.__destroy__=function(){fe(this.ptr)},g.prototype=Object.create(u.prototype),g.prototype.constructor=g,g.prototype.__class__=g,g.__cache__={},F.DecoderBuffer=g,g.prototype.Init=g.prototype.Init=function(e,t){var r=this.ptr;Zr.prepare(),"object"==typeof e&&(e=f(e)),t&&"object"==typeof t&&(t=t.ptr),ge(r,e,t)},g.prototype.__destroy__=g.prototype.__destroy__=function(){ye(this.ptr)},y.prototype=Object.create(u.prototype),y.prototype.constructor=y,y.prototype.__class__=y,y.__cache__={},F.AttributeTransformData=y,y.prototype.transform_type=y.prototype.transform_type=function(){return _e(this.ptr)},y.prototype.__destroy__=y.prototype.__destroy__=function(){be(this.ptr)},v.prototype=Object.create(u.prototype),v.prototype.constructor=v,v.prototype.__class__=v,v.__cache__={},F.GeometryAttribute=v,v.prototype.__destroy__=v.prototype.__destroy__=function(){we(this.ptr)},_.prototype=Object.create(u.prototype),_.prototype.constructor=_,_.prototype.__class__=_,_.__cache__={},F.PointAttribute=_,_.prototype.size=_.prototype.size=function(){return Me(this.ptr)},_.prototype.GetAttributeTransformData=_.prototype.GetAttributeTransformData=function(){return p(Te(this.ptr),y)},_.prototype.attribute_type=_.prototype.attribute_type=function(){return Ee(this.ptr)},_.prototype.data_type=_.prototype.data_type=function(){return Ae(this.ptr)},_.prototype.num_components=_.prototype.num_components=function(){return Re(this.ptr)},_.prototype.normalized=_.prototype.normalized=function(){return!!Ce(this.ptr)},_.prototype.byte_stride=_.prototype.byte_stride=function(){return Ie(this.ptr)},_.prototype.byte_offset=_.prototype.byte_offset=function(){return Oe(this.ptr)},_.prototype.unique_id=_.prototype.unique_id=function(){return Pe(this.ptr)},_.prototype.__destroy__=_.prototype.__destroy__=function(){Ne(this.ptr)},b.prototype=Object.create(u.prototype),b.prototype.constructor=b,b.prototype.__class__=b,b.__cache__={},F.AttributeQuantizationTransform=b,b.prototype.InitFromAttribute=b.prototype.InitFromAttribute=function(e){var t=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),!!Ue(t,e)},b.prototype.quantization_bits=b.prototype.quantization_bits=function(){return De(this.ptr)},b.prototype.min_value=b.prototype.min_value=function(e){var t=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),Fe(t,e)},b.prototype.range=b.prototype.range=function(){return Be(this.ptr)},b.prototype.__destroy__=b.prototype.__destroy__=function(){ke(this.ptr)},x.prototype=Object.create(u.prototype),x.prototype.constructor=x,x.prototype.__class__=x,x.__cache__={},F.AttributeOctahedronTransform=x,x.prototype.InitFromAttribute=x.prototype.InitFromAttribute=function(e){var t=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),!!Ge(t,e)},x.prototype.quantization_bits=x.prototype.quantization_bits=function(){return ze(this.ptr)},x.prototype.__destroy__=x.prototype.__destroy__=function(){Ve(this.ptr)},w.prototype=Object.create(u.prototype),w.prototype.constructor=w,w.prototype.__class__=w,w.__cache__={},F.PointCloud=w,w.prototype.num_attributes=w.prototype.num_attributes=function(){return We(this.ptr)},w.prototype.num_points=w.prototype.num_points=function(){return Xe(this.ptr)},w.prototype.__destroy__=w.prototype.__destroy__=function(){Ye(this.ptr)},S.prototype=Object.create(u.prototype),S.prototype.constructor=S,S.prototype.__class__=S,S.__cache__={},F.Mesh=S,S.prototype.num_faces=S.prototype.num_faces=function(){return Je(this.ptr)},S.prototype.num_attributes=S.prototype.num_attributes=function(){return Ke(this.ptr)},S.prototype.num_points=S.prototype.num_points=function(){return Ze(this.ptr)},S.prototype.__destroy__=S.prototype.__destroy__=function(){Qe(this.ptr)},M.prototype=Object.create(u.prototype),M.prototype.constructor=M,M.prototype.__class__=M,M.__cache__={},F.Metadata=M,M.prototype.__destroy__=M.prototype.__destroy__=function(){et(this.ptr)},T.prototype=Object.create(u.prototype),T.prototype.constructor=T,T.prototype.__class__=T,T.__cache__={},F.Status=T,T.prototype.code=T.prototype.code=function(){return tt(this.ptr)},T.prototype.ok=T.prototype.ok=function(){return!!rt(this.ptr)},T.prototype.error_msg=T.prototype.error_msg=function(){return n(nt(this.ptr))},T.prototype.__destroy__=T.prototype.__destroy__=function(){it(this.ptr)},E.prototype=Object.create(u.prototype),E.prototype.constructor=E,E.prototype.__class__=E,E.__cache__={},F.DracoFloat32Array=E,E.prototype.GetValue=E.prototype.GetValue=function(e){var t=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),st(t,e)},E.prototype.size=E.prototype.size=function(){return at(this.ptr)},E.prototype.__destroy__=E.prototype.__destroy__=function(){ct(this.ptr)},A.prototype=Object.create(u.prototype),A.prototype.constructor=A,A.prototype.__class__=A,A.__cache__={},F.DracoInt8Array=A,A.prototype.GetValue=A.prototype.GetValue=function(e){var t=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),ut(t,e)},A.prototype.size=A.prototype.size=function(){return ht(this.ptr)},A.prototype.__destroy__=A.prototype.__destroy__=function(){pt(this.ptr)},R.prototype=Object.create(u.prototype),R.prototype.constructor=R,R.prototype.__class__=R,R.__cache__={},F.DracoUInt8Array=R,R.prototype.GetValue=R.prototype.GetValue=function(e){var t=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),ft(t,e)},R.prototype.size=R.prototype.size=function(){return mt(this.ptr)},R.prototype.__destroy__=R.prototype.__destroy__=function(){gt(this.ptr)},C.prototype=Object.create(u.prototype),C.prototype.constructor=C,C.prototype.__class__=C,C.__cache__={},F.DracoInt16Array=C,C.prototype.GetValue=C.prototype.GetValue=function(e){var t=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),vt(t,e)},C.prototype.size=C.prototype.size=function(){return _t(this.ptr)},C.prototype.__destroy__=C.prototype.__destroy__=function(){bt(this.ptr)},I.prototype=Object.create(u.prototype),I.prototype.constructor=I,I.prototype.__class__=I,I.__cache__={},F.DracoUInt16Array=I,I.prototype.GetValue=I.prototype.GetValue=function(e){var t=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),wt(t,e)},I.prototype.size=I.prototype.size=function(){return St(this.ptr)},I.prototype.__destroy__=I.prototype.__destroy__=function(){Mt(this.ptr)},O.prototype=Object.create(u.prototype),O.prototype.constructor=O,O.prototype.__class__=O,O.__cache__={},F.DracoInt32Array=O,O.prototype.GetValue=O.prototype.GetValue=function(e){var t=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),Et(t,e)},O.prototype.size=O.prototype.size=function(){return At(this.ptr)},O.prototype.__destroy__=O.prototype.__destroy__=function(){Rt(this.ptr)},P.prototype=Object.create(u.prototype),P.prototype.constructor=P,P.prototype.__class__=P,P.__cache__={},F.DracoUInt32Array=P,P.prototype.GetValue=P.prototype.GetValue=function(e){var t=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),It(t,e)},P.prototype.size=P.prototype.size=function(){return Ot(this.ptr)},P.prototype.__destroy__=P.prototype.__destroy__=function(){Pt(this.ptr)},N.prototype=Object.create(u.prototype),N.prototype.constructor=N,N.prototype.__class__=N,N.__cache__={},F.MetadataQuerier=N,N.prototype.HasEntry=N.prototype.HasEntry=function(e,t){var r=this.ptr;return Zr.prepare(),e&&"object"==typeof e&&(e=e.ptr),t=t&&"object"==typeof t?t.ptr:d(t),!!Lt(r,e,t)},N.prototype.GetIntEntry=N.prototype.GetIntEntry=function(e,t){var r=this.ptr;return Zr.prepare(),e&&"object"==typeof e&&(e=e.ptr),t=t&&"object"==typeof t?t.ptr:d(t),Ut(r,e,t)},N.prototype.GetIntEntryArray=N.prototype.GetIntEntryArray=function(e,t,r){var n=this.ptr;Zr.prepare(),e&&"object"==typeof e&&(e=e.ptr),t=t&&"object"==typeof t?t.ptr:d(t),r&&"object"==typeof r&&(r=r.ptr),Dt(n,e,t,r)},N.prototype.GetDoubleEntry=N.prototype.GetDoubleEntry=function(e,t){var r=this.ptr;return Zr.prepare(),e&&"object"==typeof e&&(e=e.ptr),t=t&&"object"==typeof t?t.ptr:d(t),Ft(r,e,t)},N.prototype.GetStringEntry=N.prototype.GetStringEntry=function(e,t){var r=this.ptr;return Zr.prepare(),e&&"object"==typeof e&&(e=e.ptr),t=t&&"object"==typeof t?t.ptr:d(t),n(Bt(r,e,t))},N.prototype.NumEntries=N.prototype.NumEntries=function(e){var t=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),kt(t,e)},N.prototype.GetEntryName=N.prototype.GetEntryName=function(e,t){var r=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),n(jt(r,e,t))},N.prototype.__destroy__=N.prototype.__destroy__=function(){Gt(this.ptr)},L.prototype=Object.create(u.prototype),L.prototype.constructor=L,L.prototype.__class__=L,L.__cache__={},F.Decoder=L,L.prototype.DecodeArrayToPointCloud=L.prototype.DecodeArrayToPointCloud=function(e,t,r){var n=this.ptr;return Zr.prepare(),"object"==typeof e&&(e=f(e)),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),p(Vt(n,e,t,r),T)},L.prototype.DecodeArrayToMesh=L.prototype.DecodeArrayToMesh=function(e,t,r){var n=this.ptr;return Zr.prepare(),"object"==typeof e&&(e=f(e)),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),p(Ht(n,e,t,r),T)},L.prototype.GetAttributeId=L.prototype.GetAttributeId=function(e,t){var r=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),Wt(r,e,t)},L.prototype.GetAttributeIdByName=L.prototype.GetAttributeIdByName=function(e,t){var r=this.ptr;return Zr.prepare(),e&&"object"==typeof e&&(e=e.ptr),t=t&&"object"==typeof t?t.ptr:d(t),Xt(r,e,t)},L.prototype.GetAttributeIdByMetadataEntry=L.prototype.GetAttributeIdByMetadataEntry=function(e,t,r){var n=this.ptr;return Zr.prepare(),e&&"object"==typeof e&&(e=e.ptr),t=t&&"object"==typeof t?t.ptr:d(t),r=r&&"object"==typeof r?r.ptr:d(r),Yt(n,e,t,r)},L.prototype.GetAttribute=L.prototype.GetAttribute=function(e,t){var r=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),p(qt(r,e,t),_)},L.prototype.GetAttributeByUniqueId=L.prototype.GetAttributeByUniqueId=function(e,t){var r=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),p(Jt(r,e,t),_)},L.prototype.GetMetadata=L.prototype.GetMetadata=function(e){var t=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),p(Kt(t,e),M)},L.prototype.GetAttributeMetadata=L.prototype.GetAttributeMetadata=function(e,t){var r=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),p(Zt(r,e,t),M)},L.prototype.GetFaceFromMesh=L.prototype.GetFaceFromMesh=function(e,t,r){var n=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),!!Qt(n,e,t,r)},L.prototype.GetTriangleStripsFromMesh=L.prototype.GetTriangleStripsFromMesh=function(e,t){var r=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),$t(r,e,t)},L.prototype.GetTrianglesUInt16Array=L.prototype.GetTrianglesUInt16Array=function(e,t,r){var n=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),!!er(n,e,t,r)},L.prototype.GetTrianglesUInt32Array=L.prototype.GetTrianglesUInt32Array=function(e,t,r){var n=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),!!tr(n,e,t,r)},L.prototype.GetAttributeFloat=L.prototype.GetAttributeFloat=function(e,t,r){var n=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),!!rr(n,e,t,r)},L.prototype.GetAttributeFloatForAllPoints=L.prototype.GetAttributeFloatForAllPoints=function(e,t,r){var n=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),!!nr(n,e,t,r)},L.prototype.GetAttributeIntForAllPoints=L.prototype.GetAttributeIntForAllPoints=function(e,t,r){var n=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),!!ir(n,e,t,r)},L.prototype.GetAttributeInt8ForAllPoints=L.prototype.GetAttributeInt8ForAllPoints=function(e,t,r){var n=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),!!or(n,e,t,r)},L.prototype.GetAttributeUInt8ForAllPoints=L.prototype.GetAttributeUInt8ForAllPoints=function(e,t,r){var n=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),!!sr(n,e,t,r)},L.prototype.GetAttributeInt16ForAllPoints=L.prototype.GetAttributeInt16ForAllPoints=function(e,t,r){var n=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),!!ar(n,e,t,r)},L.prototype.GetAttributeUInt16ForAllPoints=L.prototype.GetAttributeUInt16ForAllPoints=function(e,t,r){var n=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),!!cr(n,e,t,r)},L.prototype.GetAttributeInt32ForAllPoints=L.prototype.GetAttributeInt32ForAllPoints=function(e,t,r){var n=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),!!lr(n,e,t,r)},L.prototype.GetAttributeUInt32ForAllPoints=L.prototype.GetAttributeUInt32ForAllPoints=function(e,t,r){var n=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),!!ur(n,e,t,r)},L.prototype.GetAttributeDataArrayForAllPoints=L.prototype.GetAttributeDataArrayForAllPoints=function(e,t,r,n,i){var o=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),n&&"object"==typeof n&&(n=n.ptr),i&&"object"==typeof i&&(i=i.ptr),!!hr(o,e,t,r,n,i)},L.prototype.SkipAttributeTransform=L.prototype.SkipAttributeTransform=function(e){var t=this.ptr;e&&"object"==typeof e&&(e=e.ptr),pr(t,e)},L.prototype.GetEncodedGeometryType_Deprecated=L.prototype.GetEncodedGeometryType_Deprecated=function(e){var t=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),dr(t,e)},L.prototype.DecodeBufferToPointCloud=L.prototype.DecodeBufferToPointCloud=function(e,t){var r=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),p(fr(r,e,t),T)},L.prototype.DecodeBufferToMesh=L.prototype.DecodeBufferToMesh=function(e,t){var r=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),p(mr(r,e,t),T)},L.prototype.__destroy__=L.prototype.__destroy__=function(){gr(this.ptr)},function(){function e(){F.ATTRIBUTE_INVALID_TRANSFORM=yr(),F.ATTRIBUTE_NO_TRANSFORM=vr(),F.ATTRIBUTE_QUANTIZATION_TRANSFORM=_r(),F.ATTRIBUTE_OCTAHEDRON_TRANSFORM=br(),F.INVALID=xr(),F.POSITION=wr(),F.NORMAL=Sr(),F.COLOR=Mr(),F.TEX_COORD=Tr(),F.GENERIC=Er(),F.INVALID_GEOMETRY_TYPE=Ar(),F.POINT_CLOUD=Rr(),F.TRIANGULAR_MESH=Cr(),F.DT_INVALID=Ir(),F.DT_INT8=Or(),F.DT_UINT8=Pr(),F.DT_INT16=Nr(),F.DT_UINT16=Lr(),F.DT_INT32=Ur(),F.DT_UINT32=Dr(),F.DT_INT64=Fr(),F.DT_UINT64=Br(),F.DT_FLOAT32=kr(),F.DT_FLOAT64=jr(),F.DT_BOOL=Gr(),F.DT_TYPES_COUNT=zr(),F.OK=Vr(),F.DRACO_ERROR=Hr(),F.IO_ERROR=Wr(),F.INVALID_PARAMETER=Xr(),F.UNSUPPORTED_VERSION=Yr(),F.UNKNOWN_VERSION=qr()}ce?e():se.unshift(e)}(),"function"==typeof F.onModuleParsed&&F.onModuleParsed(),F.Decoder.prototype.GetEncodedGeometryType=function(e){if(e.__class__&&e.__class__===F.DecoderBuffer)return F.Decoder.prototype.GetEncodedGeometryType_Deprecated(e);if(8>e.byteLength)return F.INVALID_GEOMETRY_TYPE;switch(e[7]){case 0:return F.POINT_CLOUD;case 1:return F.TRIANGULAR_MESH;default:return F.INVALID_GEOMETRY_TYPE}},t.ready}}();e.exports=i},599:function(e,t,r){var n=n||{};n.scope={},n.arrayIteratorImpl=function(e){var t=0;return function(){return t<e.length?{done:!1,value:e[t++]}:{done:!0}}},n.arrayIterator=function(e){return{next:n.arrayIteratorImpl(e)}},n.makeIterator=function(e){var t="undefined"!=typeof Symbol&&Symbol.iterator&&e[Symbol.iterator];return t?t.call(e):n.arrayIterator(e)},n.ASSUME_ES5=!1,n.ASSUME_NO_NATIVE_MAP=!1,n.ASSUME_NO_NATIVE_SET=!1,n.SIMPLE_FROUND_POLYFILL=!1,n.ISOLATE_POLYFILLS=!1,n.FORCE_POLYFILL_PROMISE=!1,n.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1,n.getGlobal=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof r.g&&r.g];for(var t=0;t<e.length;++t){var n=e[t];if(n&&n.Math==Math)return n}throw Error("Cannot find global object")},n.global=n.getGlobal(this),n.defineProperty=n.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,r){return e==Array.prototype||e==Object.prototype||(e[t]=r.value),e},n.IS_SYMBOL_NATIVE="function"==typeof Symbol&&"symbol"==typeof Symbol("x"),n.TRUST_ES6_POLYFILLS=!n.ISOLATE_POLYFILLS||n.IS_SYMBOL_NATIVE,n.polyfills={},n.propertyToPolyfillSymbol={},n.POLYFILL_PREFIX="$jscp$";n.polyfill=function(e,t,r,i){t&&(n.ISOLATE_POLYFILLS?n.polyfillIsolated(e,t,r,i):n.polyfillUnisolated(e,t,r,i))},n.polyfillUnisolated=function(e,t,r,i){for(r=n.global,e=e.split("."),i=0;i<e.length-1;i++){var o=e[i];if(!(o in r))return;r=r[o]}(t=t(i=r[e=e[e.length-1]]))!=i&&null!=t&&n.defineProperty(r,e,{configurable:!0,writable:!0,value:t})},n.polyfillIsolated=function(e,t,r,i){var o=e.split(".");e=1===o.length,i=o[0],i=!e&&i in n.polyfills?n.polyfills:n.global;for(var s=0;s<o.length-1;s++){var a=o[s];if(!(a in i))return;i=i[a]}o=o[o.length-1],null!=(t=t(r=n.IS_SYMBOL_NATIVE&&"es6"===r?i[o]:null))&&(e?n.defineProperty(n.polyfills,o,{configurable:!0,writable:!0,value:t}):t!==r&&(void 0===n.propertyToPolyfillSymbol[o]&&(r=1e9*Math.random()>>>0,n.propertyToPolyfillSymbol[o]=n.IS_SYMBOL_NATIVE?n.global.Symbol(o):n.POLYFILL_PREFIX+r+"$"+o),n.defineProperty(i,n.propertyToPolyfillSymbol[o],{configurable:!0,writable:!0,value:t})))},n.polyfill("Promise",(function(e){function t(){this.batch_=null}function r(e){return e instanceof o?e:new o((function(t,r){t(e)}))}if(e&&(!(n.FORCE_POLYFILL_PROMISE||n.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION&&void 0===n.global.PromiseRejectionEvent)||!n.global.Promise||-1===n.global.Promise.toString().indexOf("[native code]")))return e;t.prototype.asyncExecute=function(e){if(null==this.batch_){this.batch_=[];var t=this;this.asyncExecuteFunction((function(){t.executeBatch_()}))}this.batch_.push(e)};var i=n.global.setTimeout;t.prototype.asyncExecuteFunction=function(e){i(e,0)},t.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var e=this.batch_;this.batch_=[];for(var t=0;t<e.length;++t){var r=e[t];e[t]=null;try{r()}catch(e){this.asyncThrow_(e)}}}this.batch_=null},t.prototype.asyncThrow_=function(e){this.asyncExecuteFunction((function(){throw e}))};var o=function(e){this.state_=0,this.result_=void 0,this.onSettledCallbacks_=[],this.isRejectionHandled_=!1;var t=this.createResolveAndReject_();try{e(t.resolve,t.reject)}catch(e){t.reject(e)}};o.prototype.createResolveAndReject_=function(){function e(e){return function(n){r||(r=!0,e.call(t,n))}}var t=this,r=!1;return{resolve:e(this.resolveTo_),reject:e(this.reject_)}},o.prototype.resolveTo_=function(e){if(e===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(e instanceof o)this.settleSameAsPromise_(e);else{e:switch(typeof e){case"object":var t=null!=e;break e;case"function":t=!0;break e;default:t=!1}t?this.resolveToNonPromiseObj_(e):this.fulfill_(e)}},o.prototype.resolveToNonPromiseObj_=function(e){var t=void 0;try{t=e.then}catch(e){return void this.reject_(e)}"function"==typeof t?this.settleSameAsThenable_(t,e):this.fulfill_(e)},o.prototype.reject_=function(e){this.settle_(2,e)},o.prototype.fulfill_=function(e){this.settle_(1,e)},o.prototype.settle_=function(e,t){if(0!=this.state_)throw Error("Cannot settle("+e+", "+t+"): Promise already settled in state"+this.state_);this.state_=e,this.result_=t,2===this.state_&&this.scheduleUnhandledRejectionCheck_(),this.executeOnSettledCallbacks_()},o.prototype.scheduleUnhandledRejectionCheck_=function(){var e=this;i((function(){if(e.notifyUnhandledRejection_()){var t=n.global.console;void 0!==t&&t.error(e.result_)}}),1)},o.prototype.notifyUnhandledRejection_=function(){if(this.isRejectionHandled_)return!1;var e=n.global.CustomEvent,t=n.global.Event,r=n.global.dispatchEvent;return void 0===r||("function"==typeof e?e=new e("unhandledrejection",{cancelable:!0}):"function"==typeof t?e=new t("unhandledrejection",{cancelable:!0}):(e=n.global.document.createEvent("CustomEvent")).initCustomEvent("unhandledrejection",!1,!0,e),e.promise=this,e.reason=this.result_,r(e))},o.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var e=0;e<this.onSettledCallbacks_.length;++e)s.asyncExecute(this.onSettledCallbacks_[e]);this.onSettledCallbacks_=null}};var s=new t;return o.prototype.settleSameAsPromise_=function(e){var t=this.createResolveAndReject_();e.callWhenSettled_(t.resolve,t.reject)},o.prototype.settleSameAsThenable_=function(e,t){var r=this.createResolveAndReject_();try{e.call(t,r.resolve,r.reject)}catch(e){r.reject(e)}},o.prototype.then=function(e,t){function r(e,t){return"function"==typeof e?function(t){try{n(e(t))}catch(e){i(e)}}:t}var n,i,s=new o((function(e,t){n=e,i=t}));return this.callWhenSettled_(r(e,n),r(t,i)),s},o.prototype.catch=function(e){return this.then(void 0,e)},o.prototype.callWhenSettled_=function(e,t){function r(){switch(n.state_){case 1:e(n.result_);break;case 2:t(n.result_);break;default:throw Error("Unexpected state: "+n.state_)}}var n=this;null==this.onSettledCallbacks_?s.asyncExecute(r):this.onSettledCallbacks_.push(r),this.isRejectionHandled_=!0},o.resolve=r,o.reject=function(e){return new o((function(t,r){r(e)}))},o.race=function(e){return new o((function(t,i){for(var o=n.makeIterator(e),s=o.next();!s.done;s=o.next())r(s.value).callWhenSettled_(t,i)}))},o.all=function(e){var t=n.makeIterator(e),i=t.next();return i.done?r([]):new o((function(e,n){function o(t){return function(r){s[t]=r,0==--a&&e(s)}}var s=[],a=0;do{s.push(void 0),a++,r(i.value).callWhenSettled_(o(s.length-1),n),i=t.next()}while(!i.done)}))},o}),"es6","es3"),n.owns=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.assign=n.TRUST_ES6_POLYFILLS&&"function"==typeof Object.assign?Object.assign:function(e,t){for(var r=1;r<arguments.length;r++){var i=arguments[r];if(i)for(var o in i)n.owns(i,o)&&(e[o]=i[o])}return e},n.polyfill("Object.assign",(function(e){return e||n.assign}),"es6","es3"),n.checkStringArgs=function(e,t,r){if(null==e)throw new TypeError("The 'this' value for String.prototype."+r+" must not be null or undefined");if(t instanceof RegExp)throw new TypeError("First argument to String.prototype."+r+" must not be a regular expression");return e+""},n.polyfill("String.prototype.startsWith",(function(e){return e||function(e,t){var r=n.checkStringArgs(this,e,"startsWith");e+="";var i=r.length,o=e.length;t=Math.max(0,Math.min(0|t,r.length));for(var s=0;s<o&&t<i;)if(r[t++]!=e[s++])return!1;return s>=o}}),"es6","es3"),n.polyfill("Array.prototype.copyWithin",(function(e){function t(e){return 1/0===(e=Number(e))||-1/0===e?e:0|e}return e||function(e,r,n){var i=this.length;if(e=t(e),r=t(r),n=void 0===n?i:t(n),e=0>e?Math.max(i+e,0):Math.min(e,i),r=0>r?Math.max(i+r,0):Math.min(r,i),n=0>n?Math.max(i+n,0):Math.min(n,i),e<r)for(;r<n;)r in this?this[e++]=this[r++]:(delete this[e++],r++);else for(e+=(n=Math.min(n,i+r-e))-r;n>r;)--n in this?this[--e]=this[n]:delete this[--e];return this}}),"es6","es3"),n.typedArrayCopyWithin=function(e){return e||Array.prototype.copyWithin},n.polyfill("Int8Array.prototype.copyWithin",n.typedArrayCopyWithin,"es6","es5"),n.polyfill("Uint8Array.prototype.copyWithin",n.typedArrayCopyWithin,"es6","es5"),n.polyfill("Uint8ClampedArray.prototype.copyWithin",n.typedArrayCopyWithin,"es6","es5"),n.polyfill("Int16Array.prototype.copyWithin",n.typedArrayCopyWithin,"es6","es5"),n.polyfill("Uint16Array.prototype.copyWithin",n.typedArrayCopyWithin,"es6","es5"),n.polyfill("Int32Array.prototype.copyWithin",n.typedArrayCopyWithin,"es6","es5"),n.polyfill("Uint32Array.prototype.copyWithin",n.typedArrayCopyWithin,"es6","es5"),n.polyfill("Float32Array.prototype.copyWithin",n.typedArrayCopyWithin,"es6","es5"),n.polyfill("Float64Array.prototype.copyWithin",n.typedArrayCopyWithin,"es6","es5");var i=function(){var e="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0;return e=e||"/index.js",function(t){function n(){var e=X.buffer;O.HEAP8=Y=new Int8Array(e),O.HEAP16=J=new Int16Array(e),O.HEAP32=K=new Int32Array(e),O.HEAPU8=q=new Uint8Array(e),O.HEAPU16=new Uint16Array(e),O.HEAPU32=Z=new Uint32Array(e),O.HEAPF32=Q=new Float32Array(e),O.HEAPF64=new Float64Array(e)}function i(e){throw O.onAbort&&O.onAbort(e),W(e="Aborted("+e+")"),$=!0,e=new WebAssembly.RuntimeError(e+". Build with -sASSERTIONS for more info."),I(e),e}function o(e){try{if(e==ae&&H)return new Uint8Array(H);if(z)return z(e);throw"both async and sync fetching of the wasm failed"}catch(e){i(e)}}function s(e){for(;0<e.length;)e.shift()(O)}function a(e){this.excPtr=e,this.ptr=e-24,this.set_type=function(e){Z[this.ptr+4>>2]=e},this.get_type=function(){return Z[this.ptr+4>>2]},this.set_destructor=function(e){Z[this.ptr+8>>2]=e},this.get_destructor=function(){return Z[this.ptr+8>>2]},this.set_refcount=function(e){K[this.ptr>>2]=e},this.set_caught=function(e){Y[this.ptr+12>>0]=e?1:0},this.get_caught=function(){return 0!=Y[this.ptr+12>>0]},this.set_rethrown=function(e){Y[this.ptr+13>>0]=e?1:0},this.get_rethrown=function(){return 0!=Y[this.ptr+13>>0]},this.init=function(e,t){this.set_adjusted_ptr(0),this.set_type(e),this.set_destructor(t),this.set_refcount(0),this.set_caught(!1),this.set_rethrown(!1)},this.add_ref=function(){K[this.ptr>>2]+=1},this.release_ref=function(){var e=K[this.ptr>>2];return K[this.ptr>>2]=e-1,1===e},this.set_adjusted_ptr=function(e){Z[this.ptr+16>>2]=e},this.get_adjusted_ptr=function(){return Z[this.ptr+16>>2]},this.get_exception_ptr=function(){if(Jt(this.get_type()))return Z[this.excPtr>>2];var e=this.get_adjusted_ptr();return 0!==e?e:this.excPtr}}function c(){function e(){if(!qt&&(qt=!0,O.calledRun=!0,!$)){if(ne=!0,s(te),C(O),O.onRuntimeInitialized&&O.onRuntimeInitialized(),O.postRun)for("function"==typeof O.postRun&&(O.postRun=[O.postRun]);O.postRun.length;)re.unshift(O.postRun.shift());s(re)}}if(!(0<ie)){if(O.preRun)for("function"==typeof O.preRun&&(O.preRun=[O.preRun]);O.preRun.length;)ee.unshift(O.preRun.shift());s(ee),0<ie||(O.setStatus?(O.setStatus("Running..."),setTimeout((function(){setTimeout((function(){O.setStatus("")}),1),e()}),1)):e())}}function l(){}function u(e){return(e||l).__cache__}function h(e,t){var r=u(t),n=r[e];return n||((n=Object.create((t||l).prototype)).ptr=e,r[e]=n)}function p(e){if("string"==typeof e){for(var t=0,r=0;r<e.length;++r){var n=e.charCodeAt(r);127>=n?t++:2047>=n?t+=2:55296<=n&&57343>=n?(t+=4,++r):t+=3}if(r=0,0<(n=(t=Array(t+1)).length)){n=r+n-1;for(var i=0;i<e.length;++i){var o=e.charCodeAt(i);if(55296<=o&&57343>=o)o=65536+((1023&o)<<10)|1023&e.charCodeAt(++i);if(127>=o){if(r>=n)break;t[r++]=o}else{if(2047>=o){if(r+1>=n)break;t[r++]=192|o>>6}else{if(65535>=o){if(r+2>=n)break;t[r++]=224|o>>12}else{if(r+3>=n)break;t[r++]=240|o>>18,t[r++]=128|o>>12&63}t[r++]=128|o>>6&63}t[r++]=128|63&o}}t[r]=0}return e=Kt.alloc(t,Y),Kt.copy(t,Y,e),e}return e}function d(e){if("object"==typeof e){var t=Kt.alloc(e,Y);return Kt.copy(e,Y,t),t}return e}function f(e){if("object"==typeof e){var t=Kt.alloc(e,J);return Kt.copy(e,J,t),t}return e}function m(e){if("object"==typeof e){var t=Kt.alloc(e,K);return Kt.copy(e,K,t),t}return e}function g(e){if("object"==typeof e){var t=Kt.alloc(e,Q);return Kt.copy(e,Q,t),t}return e}function y(){throw"cannot construct a VoidPtr, no constructor in IDL"}function v(){this.ptr=ue(),u(v)[this.ptr]=this}function _(){this.ptr=pe(),u(_)[this.ptr]=this}function b(){this.ptr=we(),u(b)[this.ptr]=this}function x(){this.ptr=Ee(),u(x)[this.ptr]=this}function w(){this.ptr=Pe(),u(w)[this.ptr]=this}function S(){this.ptr=Le(),u(S)[this.ptr]=this}function M(){this.ptr=Be(),u(M)[this.ptr]=this}function T(){this.ptr=He(),u(T)[this.ptr]=this}function E(){this.ptr=tt(),u(E)[this.ptr]=this}function A(){this.ptr=gt(),u(A)[this.ptr]=this}function R(e){e&&"object"==typeof e&&(e=e.ptr),this.ptr=At(e),u(R)[this.ptr]=this}var C,I,O=void 0!==(t=void 0===t?{}:t)?t:{};O.ready=new Promise((function(e,t){C=e,I=t}));var P=!1,N=!1;O.onRuntimeInitialized=function(){P=!0,N&&"function"==typeof O.onModuleLoaded&&O.onModuleLoaded(O)},O.onModuleParsed=function(){N=!0,P&&"function"==typeof O.onModuleLoaded&&O.onModuleLoaded(O)},O.isVersionSupported=function(e){return"string"==typeof e&&(!(2>(e=e.split(".")).length||3<e.length)&&(1==e[0]&&0<=e[1]&&5>=e[1]||!(0!=e[0]||10<e[1])))};var L=Object.assign({},O),U="object"==typeof window,D="function"==typeof importScripts,F="object"==typeof process&&"object"==typeof process.versions&&"string"==typeof process.versions.node,B="";if(F){var k=r(Object(function(){var e=new Error("Cannot find module 'fs'");throw e.code="MODULE_NOT_FOUND",e}())),j=r(594);B=D?j.dirname(B)+"/":"//";var G=function(e,t){return e=e.startsWith("file://")?new URL(e):j.normalize(e),k.readFileSync(e,t?void 0:"utf8")},z=function(e){return(e=G(e,!0)).buffer||(e=new Uint8Array(e)),e},V=function(e,t,r){e=e.startsWith("file://")?new URL(e):j.normalize(e),k.readFile(e,(function(e,n){e?r(e):t(n.buffer)}))};1<process.argv.length&&process.argv[1].replace(/\\/g,"/"),process.argv.slice(2),O.inspect=function(){return"[Emscripten Module object]"}}else(U||D)&&(D?B=self.location.href:"undefined"!=typeof document&&document.currentScript&&(B=document.currentScript.src),e&&(B=e),B=0!==B.indexOf("blob:")?B.substr(0,B.replace(/[?#].*/,"").lastIndexOf("/")+1):"",G=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(null),t.responseText},D&&(z=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}),V=function(e,t,r){var n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="arraybuffer",n.onload=function(){200==n.status||0==n.status&&n.response?t(n.response):r()},n.onerror=r,n.send(null)});O.print||console.log.bind(console);var H,W=O.printErr||console.warn.bind(console);Object.assign(O,L),L=null,O.wasmBinary&&(H=O.wasmBinary),"object"!=typeof WebAssembly&&i("no native wasm support detected");var X,Y,q,J,K,Z,Q,$=!1,ee=[],te=[],re=[],ne=!1,ie=0,oe=null,se=null,ae="draco_encoder.wasm";ae.startsWith("data:application/octet-stream;base64,")||(ae=function(e){return O.locateFile?O.locateFile(e,B):B+e}(ae));var ce={b:function(e,t,r){throw new a(e).init(t,r),e},a:function(){i("")},d:function(e,t,r){q.copyWithin(e,t,t+r)},c:function(e){var t=q.length;if(2147483648<(e>>>=0))return!1;for(var r=1;4>=r;r*=2){var i=t*(1+.2/r);i=Math.min(i,e+100663296);var o=Math;i=Math.max(e,i),o=o.min.call(o,2147483648,i+(65536-i%65536)%65536);e:{i=X.buffer;try{X.grow(o-i.byteLength+65535>>>16),n();var s=1;break e}catch(e){}s=void 0}if(s)return!0}return!1}};!function(){function e(e,t){O.asm=e.exports,X=O.asm.e,n(),te.unshift(O.asm.f),ie--,O.monitorRunDependencies&&O.monitorRunDependencies(ie),0==ie&&(null!==oe&&(clearInterval(oe),oe=null),se&&(e=se,se=null,e()))}function t(t){e(t.instance)}function r(e){return function(){if(!H&&(U||D)){if("function"==typeof fetch&&!ae.startsWith("file://"))return fetch(ae,{credentials:"same-origin"}).then((function(e){if(!e.ok)throw"failed to load wasm binary file at '"+ae+"'";return e.arrayBuffer()})).catch((function(){return o(ae)}));if(V)return new Promise((function(e,t){V(ae,(function(t){e(new Uint8Array(t))}),t)}))}return Promise.resolve().then((function(){return o(ae)}))}().then((function(e){return WebAssembly.instantiate(e,s)})).then((function(e){return e})).then(e,(function(e){W("failed to asynchronously prepare wasm: "+e),i(e)}))}var s={a:ce};if(ie++,O.monitorRunDependencies&&O.monitorRunDependencies(ie),O.instantiateWasm)try{return O.instantiateWasm(s,e)}catch(e){W("Module.instantiateWasm callback failed with error: "+e),I(e)}(H||"function"!=typeof WebAssembly.instantiateStreaming||ae.startsWith("data:application/octet-stream;base64,")||ae.startsWith("file://")||F||"function"!=typeof fetch?r(t):fetch(ae,{credentials:"same-origin"}).then((function(e){return WebAssembly.instantiateStreaming(e,s).then(t,(function(e){return W("wasm streaming compile failed: "+e),W("falling back to ArrayBuffer instantiation"),r(t)}))}))).catch(I)}();var le=O._emscripten_bind_VoidPtr___destroy___0=function(){return(le=O._emscripten_bind_VoidPtr___destroy___0=O.asm.h).apply(null,arguments)},ue=O._emscripten_bind_GeometryAttribute_GeometryAttribute_0=function(){return(ue=O._emscripten_bind_GeometryAttribute_GeometryAttribute_0=O.asm.i).apply(null,arguments)},he=O._emscripten_bind_GeometryAttribute___destroy___0=function(){return(he=O._emscripten_bind_GeometryAttribute___destroy___0=O.asm.j).apply(null,arguments)},pe=O._emscripten_bind_PointAttribute_PointAttribute_0=function(){return(pe=O._emscripten_bind_PointAttribute_PointAttribute_0=O.asm.k).apply(null,arguments)},de=O._emscripten_bind_PointAttribute_size_0=function(){return(de=O._emscripten_bind_PointAttribute_size_0=O.asm.l).apply(null,arguments)},fe=O._emscripten_bind_PointAttribute_attribute_type_0=function(){return(fe=O._emscripten_bind_PointAttribute_attribute_type_0=O.asm.m).apply(null,arguments)},me=O._emscripten_bind_PointAttribute_data_type_0=function(){return(me=O._emscripten_bind_PointAttribute_data_type_0=O.asm.n).apply(null,arguments)},ge=O._emscripten_bind_PointAttribute_num_components_0=function(){return(ge=O._emscripten_bind_PointAttribute_num_components_0=O.asm.o).apply(null,arguments)},ye=O._emscripten_bind_PointAttribute_normalized_0=function(){return(ye=O._emscripten_bind_PointAttribute_normalized_0=O.asm.p).apply(null,arguments)},ve=O._emscripten_bind_PointAttribute_byte_stride_0=function(){return(ve=O._emscripten_bind_PointAttribute_byte_stride_0=O.asm.q).apply(null,arguments)},_e=O._emscripten_bind_PointAttribute_byte_offset_0=function(){return(_e=O._emscripten_bind_PointAttribute_byte_offset_0=O.asm.r).apply(null,arguments)},be=O._emscripten_bind_PointAttribute_unique_id_0=function(){return(be=O._emscripten_bind_PointAttribute_unique_id_0=O.asm.s).apply(null,arguments)},xe=O._emscripten_bind_PointAttribute___destroy___0=function(){return(xe=O._emscripten_bind_PointAttribute___destroy___0=O.asm.t).apply(null,arguments)},we=O._emscripten_bind_PointCloud_PointCloud_0=function(){return(we=O._emscripten_bind_PointCloud_PointCloud_0=O.asm.u).apply(null,arguments)},Se=O._emscripten_bind_PointCloud_num_attributes_0=function(){return(Se=O._emscripten_bind_PointCloud_num_attributes_0=O.asm.v).apply(null,arguments)},Me=O._emscripten_bind_PointCloud_num_points_0=function(){return(Me=O._emscripten_bind_PointCloud_num_points_0=O.asm.w).apply(null,arguments)},Te=O._emscripten_bind_PointCloud___destroy___0=function(){return(Te=O._emscripten_bind_PointCloud___destroy___0=O.asm.x).apply(null,arguments)},Ee=O._emscripten_bind_Mesh_Mesh_0=function(){return(Ee=O._emscripten_bind_Mesh_Mesh_0=O.asm.y).apply(null,arguments)},Ae=O._emscripten_bind_Mesh_num_faces_0=function(){return(Ae=O._emscripten_bind_Mesh_num_faces_0=O.asm.z).apply(null,arguments)},Re=O._emscripten_bind_Mesh_num_attributes_0=function(){return(Re=O._emscripten_bind_Mesh_num_attributes_0=O.asm.A).apply(null,arguments)},Ce=O._emscripten_bind_Mesh_num_points_0=function(){return(Ce=O._emscripten_bind_Mesh_num_points_0=O.asm.B).apply(null,arguments)},Ie=O._emscripten_bind_Mesh_set_num_points_1=function(){return(Ie=O._emscripten_bind_Mesh_set_num_points_1=O.asm.C).apply(null,arguments)},Oe=O._emscripten_bind_Mesh___destroy___0=function(){return(Oe=O._emscripten_bind_Mesh___destroy___0=O.asm.D).apply(null,arguments)},Pe=O._emscripten_bind_Metadata_Metadata_0=function(){return(Pe=O._emscripten_bind_Metadata_Metadata_0=O.asm.E).apply(null,arguments)},Ne=O._emscripten_bind_Metadata___destroy___0=function(){return(Ne=O._emscripten_bind_Metadata___destroy___0=O.asm.F).apply(null,arguments)},Le=O._emscripten_bind_DracoInt8Array_DracoInt8Array_0=function(){return(Le=O._emscripten_bind_DracoInt8Array_DracoInt8Array_0=O.asm.G).apply(null,arguments)},Ue=O._emscripten_bind_DracoInt8Array_GetValue_1=function(){return(Ue=O._emscripten_bind_DracoInt8Array_GetValue_1=O.asm.H).apply(null,arguments)},De=O._emscripten_bind_DracoInt8Array_size_0=function(){return(De=O._emscripten_bind_DracoInt8Array_size_0=O.asm.I).apply(null,arguments)},Fe=O._emscripten_bind_DracoInt8Array___destroy___0=function(){return(Fe=O._emscripten_bind_DracoInt8Array___destroy___0=O.asm.J).apply(null,arguments)},Be=O._emscripten_bind_MetadataBuilder_MetadataBuilder_0=function(){return(Be=O._emscripten_bind_MetadataBuilder_MetadataBuilder_0=O.asm.K).apply(null,arguments)},ke=O._emscripten_bind_MetadataBuilder_AddStringEntry_3=function(){return(ke=O._emscripten_bind_MetadataBuilder_AddStringEntry_3=O.asm.L).apply(null,arguments)},je=O._emscripten_bind_MetadataBuilder_AddIntEntry_3=function(){return(je=O._emscripten_bind_MetadataBuilder_AddIntEntry_3=O.asm.M).apply(null,arguments)},Ge=O._emscripten_bind_MetadataBuilder_AddIntEntryArray_4=function(){return(Ge=O._emscripten_bind_MetadataBuilder_AddIntEntryArray_4=O.asm.N).apply(null,arguments)},ze=O._emscripten_bind_MetadataBuilder_AddDoubleEntry_3=function(){return(ze=O._emscripten_bind_MetadataBuilder_AddDoubleEntry_3=O.asm.O).apply(null,arguments)},Ve=O._emscripten_bind_MetadataBuilder___destroy___0=function(){return(Ve=O._emscripten_bind_MetadataBuilder___destroy___0=O.asm.P).apply(null,arguments)},He=O._emscripten_bind_PointCloudBuilder_PointCloudBuilder_0=function(){return(He=O._emscripten_bind_PointCloudBuilder_PointCloudBuilder_0=O.asm.Q).apply(null,arguments)},We=O._emscripten_bind_PointCloudBuilder_AddFloatAttribute_5=function(){return(We=O._emscripten_bind_PointCloudBuilder_AddFloatAttribute_5=O.asm.R).apply(null,arguments)},Xe=O._emscripten_bind_PointCloudBuilder_AddInt8Attribute_5=function(){return(Xe=O._emscripten_bind_PointCloudBuilder_AddInt8Attribute_5=O.asm.S).apply(null,arguments)},Ye=O._emscripten_bind_PointCloudBuilder_AddUInt8Attribute_5=function(){return(Ye=O._emscripten_bind_PointCloudBuilder_AddUInt8Attribute_5=O.asm.T).apply(null,arguments)},qe=O._emscripten_bind_PointCloudBuilder_AddInt16Attribute_5=function(){return(qe=O._emscripten_bind_PointCloudBuilder_AddInt16Attribute_5=O.asm.U).apply(null,arguments)},Je=O._emscripten_bind_PointCloudBuilder_AddUInt16Attribute_5=function(){return(Je=O._emscripten_bind_PointCloudBuilder_AddUInt16Attribute_5=O.asm.V).apply(null,arguments)},Ke=O._emscripten_bind_PointCloudBuilder_AddInt32Attribute_5=function(){return(Ke=O._emscripten_bind_PointCloudBuilder_AddInt32Attribute_5=O.asm.W).apply(null,arguments)},Ze=O._emscripten_bind_PointCloudBuilder_AddUInt32Attribute_5=function(){return(Ze=O._emscripten_bind_PointCloudBuilder_AddUInt32Attribute_5=O.asm.X).apply(null,arguments)},Qe=O._emscripten_bind_PointCloudBuilder_AddMetadata_2=function(){return(Qe=O._emscripten_bind_PointCloudBuilder_AddMetadata_2=O.asm.Y).apply(null,arguments)},$e=O._emscripten_bind_PointCloudBuilder_SetMetadataForAttribute_3=function(){return($e=O._emscripten_bind_PointCloudBuilder_SetMetadataForAttribute_3=O.asm.Z).apply(null,arguments)},et=O._emscripten_bind_PointCloudBuilder___destroy___0=function(){return(et=O._emscripten_bind_PointCloudBuilder___destroy___0=O.asm._).apply(null,arguments)},tt=O._emscripten_bind_MeshBuilder_MeshBuilder_0=function(){return(tt=O._emscripten_bind_MeshBuilder_MeshBuilder_0=O.asm.$).apply(null,arguments)},rt=O._emscripten_bind_MeshBuilder_AddFacesToMesh_3=function(){return(rt=O._emscripten_bind_MeshBuilder_AddFacesToMesh_3=O.asm.aa).apply(null,arguments)},nt=O._emscripten_bind_MeshBuilder_AddFloatAttributeToMesh_5=function(){return(nt=O._emscripten_bind_MeshBuilder_AddFloatAttributeToMesh_5=O.asm.ba).apply(null,arguments)},it=O._emscripten_bind_MeshBuilder_AddInt32AttributeToMesh_5=function(){return(it=O._emscripten_bind_MeshBuilder_AddInt32AttributeToMesh_5=O.asm.ca).apply(null,arguments)},ot=O._emscripten_bind_MeshBuilder_AddMetadataToMesh_2=function(){return(ot=O._emscripten_bind_MeshBuilder_AddMetadataToMesh_2=O.asm.da).apply(null,arguments)},st=O._emscripten_bind_MeshBuilder_AddFloatAttribute_5=function(){return(st=O._emscripten_bind_MeshBuilder_AddFloatAttribute_5=O.asm.ea).apply(null,arguments)},at=O._emscripten_bind_MeshBuilder_AddInt8Attribute_5=function(){return(at=O._emscripten_bind_MeshBuilder_AddInt8Attribute_5=O.asm.fa).apply(null,arguments)},ct=O._emscripten_bind_MeshBuilder_AddUInt8Attribute_5=function(){return(ct=O._emscripten_bind_MeshBuilder_AddUInt8Attribute_5=O.asm.ga).apply(null,arguments)},lt=O._emscripten_bind_MeshBuilder_AddInt16Attribute_5=function(){return(lt=O._emscripten_bind_MeshBuilder_AddInt16Attribute_5=O.asm.ha).apply(null,arguments)},ut=O._emscripten_bind_MeshBuilder_AddUInt16Attribute_5=function(){return(ut=O._emscripten_bind_MeshBuilder_AddUInt16Attribute_5=O.asm.ia).apply(null,arguments)},ht=O._emscripten_bind_MeshBuilder_AddInt32Attribute_5=function(){return(ht=O._emscripten_bind_MeshBuilder_AddInt32Attribute_5=O.asm.ja).apply(null,arguments)},pt=O._emscripten_bind_MeshBuilder_AddUInt32Attribute_5=function(){return(pt=O._emscripten_bind_MeshBuilder_AddUInt32Attribute_5=O.asm.ka).apply(null,arguments)},dt=O._emscripten_bind_MeshBuilder_AddMetadata_2=function(){return(dt=O._emscripten_bind_MeshBuilder_AddMetadata_2=O.asm.la).apply(null,arguments)},ft=O._emscripten_bind_MeshBuilder_SetMetadataForAttribute_3=function(){return(ft=O._emscripten_bind_MeshBuilder_SetMetadataForAttribute_3=O.asm.ma).apply(null,arguments)},mt=O._emscripten_bind_MeshBuilder___destroy___0=function(){return(mt=O._emscripten_bind_MeshBuilder___destroy___0=O.asm.na).apply(null,arguments)},gt=O._emscripten_bind_Encoder_Encoder_0=function(){return(gt=O._emscripten_bind_Encoder_Encoder_0=O.asm.oa).apply(null,arguments)},yt=O._emscripten_bind_Encoder_SetEncodingMethod_1=function(){return(yt=O._emscripten_bind_Encoder_SetEncodingMethod_1=O.asm.pa).apply(null,arguments)},vt=O._emscripten_bind_Encoder_SetAttributeQuantization_2=function(){return(vt=O._emscripten_bind_Encoder_SetAttributeQuantization_2=O.asm.qa).apply(null,arguments)},_t=O._emscripten_bind_Encoder_SetAttributeExplicitQuantization_5=function(){return(_t=O._emscripten_bind_Encoder_SetAttributeExplicitQuantization_5=O.asm.ra).apply(null,arguments)},bt=O._emscripten_bind_Encoder_SetSpeedOptions_2=function(){return(bt=O._emscripten_bind_Encoder_SetSpeedOptions_2=O.asm.sa).apply(null,arguments)},xt=O._emscripten_bind_Encoder_SetTrackEncodedProperties_1=function(){return(xt=O._emscripten_bind_Encoder_SetTrackEncodedProperties_1=O.asm.ta).apply(null,arguments)},wt=O._emscripten_bind_Encoder_EncodeMeshToDracoBuffer_2=function(){return(wt=O._emscripten_bind_Encoder_EncodeMeshToDracoBuffer_2=O.asm.ua).apply(null,arguments)},St=O._emscripten_bind_Encoder_EncodePointCloudToDracoBuffer_3=function(){return(St=O._emscripten_bind_Encoder_EncodePointCloudToDracoBuffer_3=O.asm.va).apply(null,arguments)},Mt=O._emscripten_bind_Encoder_GetNumberOfEncodedPoints_0=function(){return(Mt=O._emscripten_bind_Encoder_GetNumberOfEncodedPoints_0=O.asm.wa).apply(null,arguments)},Tt=O._emscripten_bind_Encoder_GetNumberOfEncodedFaces_0=function(){return(Tt=O._emscripten_bind_Encoder_GetNumberOfEncodedFaces_0=O.asm.xa).apply(null,arguments)},Et=O._emscripten_bind_Encoder___destroy___0=function(){return(Et=O._emscripten_bind_Encoder___destroy___0=O.asm.ya).apply(null,arguments)},At=O._emscripten_bind_ExpertEncoder_ExpertEncoder_1=function(){return(At=O._emscripten_bind_ExpertEncoder_ExpertEncoder_1=O.asm.za).apply(null,arguments)},Rt=O._emscripten_bind_ExpertEncoder_SetEncodingMethod_1=function(){return(Rt=O._emscripten_bind_ExpertEncoder_SetEncodingMethod_1=O.asm.Aa).apply(null,arguments)},Ct=O._emscripten_bind_ExpertEncoder_SetAttributeQuantization_2=function(){return(Ct=O._emscripten_bind_ExpertEncoder_SetAttributeQuantization_2=O.asm.Ba).apply(null,arguments)},It=O._emscripten_bind_ExpertEncoder_SetAttributeExplicitQuantization_5=function(){return(It=O._emscripten_bind_ExpertEncoder_SetAttributeExplicitQuantization_5=O.asm.Ca).apply(null,arguments)},Ot=O._emscripten_bind_ExpertEncoder_SetSpeedOptions_2=function(){return(Ot=O._emscripten_bind_ExpertEncoder_SetSpeedOptions_2=O.asm.Da).apply(null,arguments)},Pt=O._emscripten_bind_ExpertEncoder_SetTrackEncodedProperties_1=function(){return(Pt=O._emscripten_bind_ExpertEncoder_SetTrackEncodedProperties_1=O.asm.Ea).apply(null,arguments)},Nt=O._emscripten_bind_ExpertEncoder_EncodeToDracoBuffer_2=function(){return(Nt=O._emscripten_bind_ExpertEncoder_EncodeToDracoBuffer_2=O.asm.Fa).apply(null,arguments)},Lt=O._emscripten_bind_ExpertEncoder_GetNumberOfEncodedPoints_0=function(){return(Lt=O._emscripten_bind_ExpertEncoder_GetNumberOfEncodedPoints_0=O.asm.Ga).apply(null,arguments)},Ut=O._emscripten_bind_ExpertEncoder_GetNumberOfEncodedFaces_0=function(){return(Ut=O._emscripten_bind_ExpertEncoder_GetNumberOfEncodedFaces_0=O.asm.Ha).apply(null,arguments)},Dt=O._emscripten_bind_ExpertEncoder___destroy___0=function(){return(Dt=O._emscripten_bind_ExpertEncoder___destroy___0=O.asm.Ia).apply(null,arguments)},Ft=O._emscripten_enum_draco_GeometryAttribute_Type_INVALID=function(){return(Ft=O._emscripten_enum_draco_GeometryAttribute_Type_INVALID=O.asm.Ja).apply(null,arguments)},Bt=O._emscripten_enum_draco_GeometryAttribute_Type_POSITION=function(){return(Bt=O._emscripten_enum_draco_GeometryAttribute_Type_POSITION=O.asm.Ka).apply(null,arguments)},kt=O._emscripten_enum_draco_GeometryAttribute_Type_NORMAL=function(){return(kt=O._emscripten_enum_draco_GeometryAttribute_Type_NORMAL=O.asm.La).apply(null,arguments)},jt=O._emscripten_enum_draco_GeometryAttribute_Type_COLOR=function(){return(jt=O._emscripten_enum_draco_GeometryAttribute_Type_COLOR=O.asm.Ma).apply(null,arguments)},Gt=O._emscripten_enum_draco_GeometryAttribute_Type_TEX_COORD=function(){return(Gt=O._emscripten_enum_draco_GeometryAttribute_Type_TEX_COORD=O.asm.Na).apply(null,arguments)},zt=O._emscripten_enum_draco_GeometryAttribute_Type_GENERIC=function(){return(zt=O._emscripten_enum_draco_GeometryAttribute_Type_GENERIC=O.asm.Oa).apply(null,arguments)},Vt=O._emscripten_enum_draco_EncodedGeometryType_INVALID_GEOMETRY_TYPE=function(){return(Vt=O._emscripten_enum_draco_EncodedGeometryType_INVALID_GEOMETRY_TYPE=O.asm.Pa).apply(null,arguments)},Ht=O._emscripten_enum_draco_EncodedGeometryType_POINT_CLOUD=function(){return(Ht=O._emscripten_enum_draco_EncodedGeometryType_POINT_CLOUD=O.asm.Qa).apply(null,arguments)},Wt=O._emscripten_enum_draco_EncodedGeometryType_TRIANGULAR_MESH=function(){return(Wt=O._emscripten_enum_draco_EncodedGeometryType_TRIANGULAR_MESH=O.asm.Ra).apply(null,arguments)},Xt=O._emscripten_enum_draco_MeshEncoderMethod_MESH_SEQUENTIAL_ENCODING=function(){return(Xt=O._emscripten_enum_draco_MeshEncoderMethod_MESH_SEQUENTIAL_ENCODING=O.asm.Sa).apply(null,arguments)},Yt=O._emscripten_enum_draco_MeshEncoderMethod_MESH_EDGEBREAKER_ENCODING=function(){return(Yt=O._emscripten_enum_draco_MeshEncoderMethod_MESH_EDGEBREAKER_ENCODING=O.asm.Ta).apply(null,arguments)};O._malloc=function(){return(O._malloc=O.asm.Ua).apply(null,arguments)},O._free=function(){return(O._free=O.asm.Va).apply(null,arguments)};var qt,Jt=function(){return(Jt=O.asm.Wa).apply(null,arguments)};if(O.___start_em_js=19116,O.___stop_em_js=19214,se=function e(){qt||c(),qt||(se=e)},O.preInit)for("function"==typeof O.preInit&&(O.preInit=[O.preInit]);0<O.preInit.length;)O.preInit.pop()();c(),l.prototype=Object.create(l.prototype),l.prototype.constructor=l,l.prototype.__class__=l,l.__cache__={},O.WrapperObject=l,O.getCache=u,O.wrapPointer=h,O.castObject=function(e,t){return h(e.ptr,t)},O.NULL=h(0),O.destroy=function(e){if(!e.__destroy__)throw"Error: Cannot destroy object. (Did you create it yourself?)";e.__destroy__(),delete u(e.__class__)[e.ptr]},O.compare=function(e,t){return e.ptr===t.ptr},O.getPointer=function(e){return e.ptr},O.getClass=function(e){return e.__class__};var Kt={buffer:0,size:0,pos:0,temps:[],needed:0,prepare:function(){if(Kt.needed){for(var e=0;e<Kt.temps.length;e++)O._free(Kt.temps[e]);Kt.temps.length=0,O._free(Kt.buffer),Kt.buffer=0,Kt.size+=Kt.needed,Kt.needed=0}Kt.buffer||(Kt.size+=128,Kt.buffer=O._malloc(Kt.size),Kt.buffer||i(void 0)),Kt.pos=0},alloc:function(e,t){return Kt.buffer||i(void 0),e=(e=e.length*t.BYTES_PER_ELEMENT)+7&-8,Kt.pos+e>=Kt.size?(0<e||i(void 0),Kt.needed+=e,t=O._malloc(e),Kt.temps.push(t)):(t=Kt.buffer+Kt.pos,Kt.pos+=e),t},copy:function(e,t,r){switch(r>>>=0,t.BYTES_PER_ELEMENT){case 2:r>>>=1;break;case 4:r>>>=2;break;case 8:r>>>=3}for(var n=0;n<e.length;n++)t[r+n]=e[n]}};return y.prototype=Object.create(l.prototype),y.prototype.constructor=y,y.prototype.__class__=y,y.__cache__={},O.VoidPtr=y,y.prototype.__destroy__=y.prototype.__destroy__=function(){le(this.ptr)},v.prototype=Object.create(l.prototype),v.prototype.constructor=v,v.prototype.__class__=v,v.__cache__={},O.GeometryAttribute=v,v.prototype.__destroy__=v.prototype.__destroy__=function(){he(this.ptr)},_.prototype=Object.create(l.prototype),_.prototype.constructor=_,_.prototype.__class__=_,_.__cache__={},O.PointAttribute=_,_.prototype.size=_.prototype.size=function(){return de(this.ptr)},_.prototype.attribute_type=_.prototype.attribute_type=function(){return fe(this.ptr)},_.prototype.data_type=_.prototype.data_type=function(){return me(this.ptr)},_.prototype.num_components=_.prototype.num_components=function(){return ge(this.ptr)},_.prototype.normalized=_.prototype.normalized=function(){return!!ye(this.ptr)},_.prototype.byte_stride=_.prototype.byte_stride=function(){return ve(this.ptr)},_.prototype.byte_offset=_.prototype.byte_offset=function(){return _e(this.ptr)},_.prototype.unique_id=_.prototype.unique_id=function(){return be(this.ptr)},_.prototype.__destroy__=_.prototype.__destroy__=function(){xe(this.ptr)},b.prototype=Object.create(l.prototype),b.prototype.constructor=b,b.prototype.__class__=b,b.__cache__={},O.PointCloud=b,b.prototype.num_attributes=b.prototype.num_attributes=function(){return Se(this.ptr)},b.prototype.num_points=b.prototype.num_points=function(){return Me(this.ptr)},b.prototype.__destroy__=b.prototype.__destroy__=function(){Te(this.ptr)},x.prototype=Object.create(l.prototype),x.prototype.constructor=x,x.prototype.__class__=x,x.__cache__={},O.Mesh=x,x.prototype.num_faces=x.prototype.num_faces=function(){return Ae(this.ptr)},x.prototype.num_attributes=x.prototype.num_attributes=function(){return Re(this.ptr)},x.prototype.num_points=x.prototype.num_points=function(){return Ce(this.ptr)},x.prototype.set_num_points=x.prototype.set_num_points=function(e){var t=this.ptr;e&&"object"==typeof e&&(e=e.ptr),Ie(t,e)},x.prototype.__destroy__=x.prototype.__destroy__=function(){Oe(this.ptr)},w.prototype=Object.create(l.prototype),w.prototype.constructor=w,w.prototype.__class__=w,w.__cache__={},O.Metadata=w,w.prototype.__destroy__=w.prototype.__destroy__=function(){Ne(this.ptr)},S.prototype=Object.create(l.prototype),S.prototype.constructor=S,S.prototype.__class__=S,S.__cache__={},O.DracoInt8Array=S,S.prototype.GetValue=S.prototype.GetValue=function(e){var t=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),Ue(t,e)},S.prototype.size=S.prototype.size=function(){return De(this.ptr)},S.prototype.__destroy__=S.prototype.__destroy__=function(){Fe(this.ptr)},M.prototype=Object.create(l.prototype),M.prototype.constructor=M,M.prototype.__class__=M,M.__cache__={},O.MetadataBuilder=M,M.prototype.AddStringEntry=M.prototype.AddStringEntry=function(e,t,r){var n=this.ptr;return Kt.prepare(),e&&"object"==typeof e&&(e=e.ptr),t=t&&"object"==typeof t?t.ptr:p(t),r=r&&"object"==typeof r?r.ptr:p(r),!!ke(n,e,t,r)},M.prototype.AddIntEntry=M.prototype.AddIntEntry=function(e,t,r){var n=this.ptr;return Kt.prepare(),e&&"object"==typeof e&&(e=e.ptr),t=t&&"object"==typeof t?t.ptr:p(t),r&&"object"==typeof r&&(r=r.ptr),!!je(n,e,t,r)},M.prototype.AddIntEntryArray=M.prototype.AddIntEntryArray=function(e,t,r,n){var i=this.ptr;return Kt.prepare(),e&&"object"==typeof e&&(e=e.ptr),t=t&&"object"==typeof t?t.ptr:p(t),"object"==typeof r&&(r=m(r)),n&&"object"==typeof n&&(n=n.ptr),!!Ge(i,e,t,r,n)},M.prototype.AddDoubleEntry=M.prototype.AddDoubleEntry=function(e,t,r){var n=this.ptr;return Kt.prepare(),e&&"object"==typeof e&&(e=e.ptr),t=t&&"object"==typeof t?t.ptr:p(t),r&&"object"==typeof r&&(r=r.ptr),!!ze(n,e,t,r)},M.prototype.__destroy__=M.prototype.__destroy__=function(){Ve(this.ptr)},T.prototype=Object.create(l.prototype),T.prototype.constructor=T,T.prototype.__class__=T,T.__cache__={},O.PointCloudBuilder=T,T.prototype.AddFloatAttribute=T.prototype.AddFloatAttribute=function(e,t,r,n,i){var o=this.ptr;return Kt.prepare(),e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),n&&"object"==typeof n&&(n=n.ptr),"object"==typeof i&&(i=g(i)),We(o,e,t,r,n,i)},T.prototype.AddInt8Attribute=T.prototype.AddInt8Attribute=function(e,t,r,n,i){var o=this.ptr;return Kt.prepare(),e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),n&&"object"==typeof n&&(n=n.ptr),"object"==typeof i&&(i=d(i)),Xe(o,e,t,r,n,i)},T.prototype.AddUInt8Attribute=T.prototype.AddUInt8Attribute=function(e,t,r,n,i){var o=this.ptr;return Kt.prepare(),e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),n&&"object"==typeof n&&(n=n.ptr),"object"==typeof i&&(i=d(i)),Ye(o,e,t,r,n,i)},T.prototype.AddInt16Attribute=T.prototype.AddInt16Attribute=function(e,t,r,n,i){var o=this.ptr;return Kt.prepare(),e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),n&&"object"==typeof n&&(n=n.ptr),"object"==typeof i&&(i=f(i)),qe(o,e,t,r,n,i)},T.prototype.AddUInt16Attribute=T.prototype.AddUInt16Attribute=function(e,t,r,n,i){var o=this.ptr;return Kt.prepare(),e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),n&&"object"==typeof n&&(n=n.ptr),"object"==typeof i&&(i=f(i)),Je(o,e,t,r,n,i)},T.prototype.AddInt32Attribute=T.prototype.AddInt32Attribute=function(e,t,r,n,i){var o=this.ptr;return Kt.prepare(),e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),n&&"object"==typeof n&&(n=n.ptr),"object"==typeof i&&(i=m(i)),Ke(o,e,t,r,n,i)},T.prototype.AddUInt32Attribute=T.prototype.AddUInt32Attribute=function(e,t,r,n,i){var o=this.ptr;return Kt.prepare(),e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),n&&"object"==typeof n&&(n=n.ptr),"object"==typeof i&&(i=m(i)),Ze(o,e,t,r,n,i)},T.prototype.AddMetadata=T.prototype.AddMetadata=function(e,t){var r=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),!!Qe(r,e,t)},T.prototype.SetMetadataForAttribute=T.prototype.SetMetadataForAttribute=function(e,t,r){var n=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),!!$e(n,e,t,r)},T.prototype.__destroy__=T.prototype.__destroy__=function(){et(this.ptr)},E.prototype=Object.create(l.prototype),E.prototype.constructor=E,E.prototype.__class__=E,E.__cache__={},O.MeshBuilder=E,E.prototype.AddFacesToMesh=E.prototype.AddFacesToMesh=function(e,t,r){var n=this.ptr;return Kt.prepare(),e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),"object"==typeof r&&(r=m(r)),!!rt(n,e,t,r)},E.prototype.AddFloatAttributeToMesh=E.prototype.AddFloatAttributeToMesh=function(e,t,r,n,i){var o=this.ptr;return Kt.prepare(),e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),n&&"object"==typeof n&&(n=n.ptr),"object"==typeof i&&(i=g(i)),nt(o,e,t,r,n,i)},E.prototype.AddInt32AttributeToMesh=E.prototype.AddInt32AttributeToMesh=function(e,t,r,n,i){var o=this.ptr;return Kt.prepare(),e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),n&&"object"==typeof n&&(n=n.ptr),"object"==typeof i&&(i=m(i)),it(o,e,t,r,n,i)},E.prototype.AddMetadataToMesh=E.prototype.AddMetadataToMesh=function(e,t){var r=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),!!ot(r,e,t)},E.prototype.AddFloatAttribute=E.prototype.AddFloatAttribute=function(e,t,r,n,i){var o=this.ptr;return Kt.prepare(),e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),n&&"object"==typeof n&&(n=n.ptr),"object"==typeof i&&(i=g(i)),st(o,e,t,r,n,i)},E.prototype.AddInt8Attribute=E.prototype.AddInt8Attribute=function(e,t,r,n,i){var o=this.ptr;return Kt.prepare(),e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),n&&"object"==typeof n&&(n=n.ptr),"object"==typeof i&&(i=d(i)),at(o,e,t,r,n,i)},E.prototype.AddUInt8Attribute=E.prototype.AddUInt8Attribute=function(e,t,r,n,i){var o=this.ptr;return Kt.prepare(),e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),n&&"object"==typeof n&&(n=n.ptr),"object"==typeof i&&(i=d(i)),ct(o,e,t,r,n,i)},E.prototype.AddInt16Attribute=E.prototype.AddInt16Attribute=function(e,t,r,n,i){var o=this.ptr;return Kt.prepare(),e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),n&&"object"==typeof n&&(n=n.ptr),"object"==typeof i&&(i=f(i)),lt(o,e,t,r,n,i)},E.prototype.AddUInt16Attribute=E.prototype.AddUInt16Attribute=function(e,t,r,n,i){var o=this.ptr;return Kt.prepare(),e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),n&&"object"==typeof n&&(n=n.ptr),"object"==typeof i&&(i=f(i)),ut(o,e,t,r,n,i)},E.prototype.AddInt32Attribute=E.prototype.AddInt32Attribute=function(e,t,r,n,i){var o=this.ptr;return Kt.prepare(),e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),n&&"object"==typeof n&&(n=n.ptr),"object"==typeof i&&(i=m(i)),ht(o,e,t,r,n,i)},E.prototype.AddUInt32Attribute=E.prototype.AddUInt32Attribute=function(e,t,r,n,i){var o=this.ptr;return Kt.prepare(),e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),n&&"object"==typeof n&&(n=n.ptr),"object"==typeof i&&(i=m(i)),pt(o,e,t,r,n,i)},E.prototype.AddMetadata=E.prototype.AddMetadata=function(e,t){var r=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),!!dt(r,e,t)},E.prototype.SetMetadataForAttribute=E.prototype.SetMetadataForAttribute=function(e,t,r){var n=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),!!ft(n,e,t,r)},E.prototype.__destroy__=E.prototype.__destroy__=function(){mt(this.ptr)},A.prototype=Object.create(l.prototype),A.prototype.constructor=A,A.prototype.__class__=A,A.__cache__={},O.Encoder=A,A.prototype.SetEncodingMethod=A.prototype.SetEncodingMethod=function(e){var t=this.ptr;e&&"object"==typeof e&&(e=e.ptr),yt(t,e)},A.prototype.SetAttributeQuantization=A.prototype.SetAttributeQuantization=function(e,t){var r=this.ptr;e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),vt(r,e,t)},A.prototype.SetAttributeExplicitQuantization=A.prototype.SetAttributeExplicitQuantization=function(e,t,r,n,i){var o=this.ptr;Kt.prepare(),e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),"object"==typeof n&&(n=g(n)),i&&"object"==typeof i&&(i=i.ptr),_t(o,e,t,r,n,i)},A.prototype.SetSpeedOptions=A.prototype.SetSpeedOptions=function(e,t){var r=this.ptr;e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),bt(r,e,t)},A.prototype.SetTrackEncodedProperties=A.prototype.SetTrackEncodedProperties=function(e){var t=this.ptr;e&&"object"==typeof e&&(e=e.ptr),xt(t,e)},A.prototype.EncodeMeshToDracoBuffer=A.prototype.EncodeMeshToDracoBuffer=function(e,t){var r=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),wt(r,e,t)},A.prototype.EncodePointCloudToDracoBuffer=A.prototype.EncodePointCloudToDracoBuffer=function(e,t,r){var n=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),St(n,e,t,r)},A.prototype.GetNumberOfEncodedPoints=A.prototype.GetNumberOfEncodedPoints=function(){return Mt(this.ptr)},A.prototype.GetNumberOfEncodedFaces=A.prototype.GetNumberOfEncodedFaces=function(){return Tt(this.ptr)},A.prototype.__destroy__=A.prototype.__destroy__=function(){Et(this.ptr)},R.prototype=Object.create(l.prototype),R.prototype.constructor=R,R.prototype.__class__=R,R.__cache__={},O.ExpertEncoder=R,R.prototype.SetEncodingMethod=R.prototype.SetEncodingMethod=function(e){var t=this.ptr;e&&"object"==typeof e&&(e=e.ptr),Rt(t,e)},R.prototype.SetAttributeQuantization=R.prototype.SetAttributeQuantization=function(e,t){var r=this.ptr;e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),Ct(r,e,t)},R.prototype.SetAttributeExplicitQuantization=R.prototype.SetAttributeExplicitQuantization=function(e,t,r,n,i){var o=this.ptr;Kt.prepare(),e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),"object"==typeof n&&(n=g(n)),i&&"object"==typeof i&&(i=i.ptr),It(o,e,t,r,n,i)},R.prototype.SetSpeedOptions=R.prototype.SetSpeedOptions=function(e,t){var r=this.ptr;e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),Ot(r,e,t)},R.prototype.SetTrackEncodedProperties=R.prototype.SetTrackEncodedProperties=function(e){var t=this.ptr;e&&"object"==typeof e&&(e=e.ptr),Pt(t,e)},R.prototype.EncodeToDracoBuffer=R.prototype.EncodeToDracoBuffer=function(e,t){var r=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),Nt(r,e,t)},R.prototype.GetNumberOfEncodedPoints=R.prototype.GetNumberOfEncodedPoints=function(){return Lt(this.ptr)},R.prototype.GetNumberOfEncodedFaces=R.prototype.GetNumberOfEncodedFaces=function(){return Ut(this.ptr)},R.prototype.__destroy__=R.prototype.__destroy__=function(){Dt(this.ptr)},function(){function e(){O.INVALID=Ft(),O.POSITION=Bt(),O.NORMAL=kt(),O.COLOR=jt(),O.TEX_COORD=Gt(),O.GENERIC=zt(),O.INVALID_GEOMETRY_TYPE=Vt(),O.POINT_CLOUD=Ht(),O.TRIANGULAR_MESH=Wt(),O.MESH_SEQUENTIAL_ENCODING=Xt(),O.MESH_EDGEBREAKER_ENCODING=Yt()}ne?e():te.unshift(e)}(),"function"==typeof O.onModuleParsed&&O.onModuleParsed(),t.ready}}();e.exports=i},296:e=>{"use strict";e.exports=function(e){for(var t=new Array(e),r=0;r<e;++r)t[r]=r;return t}},149:e=>{function t(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}e.exports=function(e){return null!=e&&(t(e)||function(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&t(e.slice(0,0))}(e)||!!e._isBuffer)}},39:(e,t,r)=>{"use strict";var n=r(928),i={body:"",args:[],thisVars:[],localVars:[]};function o(e){if(!e)return i;for(var t=0;t<e.args.length;++t){var r=e.args[t];e.args[t]=0===t?{name:r,lvalue:!0,rvalue:!!e.rvalue,count:e.count||1}:{name:r,lvalue:!1,rvalue:!0,count:1}}return e.thisVars||(e.thisVars=[]),e.localVars||(e.localVars=[]),e}function s(e){for(var t=[],r=0;r<e.args.length;++r)t.push("a"+r);return new Function("P",["return function ",e.funcName,"_ndarrayops(",t.join(","),") {P(",t.join(","),");return a0}"].join(""))(function(e){return n({args:e.args,pre:o(e.pre),body:o(e.body),post:o(e.proc),funcName:e.funcName})}(e))}var a={add:"+",sub:"-",mul:"*",div:"/",mod:"%",band:"&",bor:"|",bxor:"^",lshift:"<<",rshift:">>",rrshift:">>>"};!function(){for(var e in a){var r=a[e];t[e]=s({args:["array","array","array"],body:{args:["a","b","c"],body:"a=b"+r+"c"},funcName:e}),t[e+"eq"]=s({args:["array","array"],body:{args:["a","b"],body:"a"+r+"=b"},rvalue:!0,funcName:e+"eq"}),t[e+"s"]=s({args:["array","array","scalar"],body:{args:["a","b","s"],body:"a=b"+r+"s"},funcName:e+"s"}),t[e+"seq"]=s({args:["array","scalar"],body:{args:["a","s"],body:"a"+r+"=s"},rvalue:!0,funcName:e+"seq"})}}();var c={not:"!",bnot:"~",neg:"-",recip:"1.0/"};!function(){for(var e in c){var r=c[e];t[e]=s({args:["array","array"],body:{args:["a","b"],body:"a="+r+"b"},funcName:e}),t[e+"eq"]=s({args:["array"],body:{args:["a"],body:"a="+r+"a"},rvalue:!0,count:2,funcName:e+"eq"})}}();var l={and:"&&",or:"||",eq:"===",neq:"!==",lt:"<",gt:">",leq:"<=",geq:">="};!function(){for(var e in l){var r=l[e];t[e]=s({args:["array","array","array"],body:{args:["a","b","c"],body:"a=b"+r+"c"},funcName:e}),t[e+"s"]=s({args:["array","array","scalar"],body:{args:["a","b","s"],body:"a=b"+r+"s"},funcName:e+"s"}),t[e+"eq"]=s({args:["array","array"],body:{args:["a","b"],body:"a=a"+r+"b"},rvalue:!0,count:2,funcName:e+"eq"}),t[e+"seq"]=s({args:["array","scalar"],body:{args:["a","s"],body:"a=a"+r+"s"},rvalue:!0,count:2,funcName:e+"seq"})}}();var u=["abs","acos","asin","atan","ceil","cos","exp","floor","log","round","sin","sqrt","tan"];!function(){for(var e=0;e<u.length;++e){var r=u[e];t[r]=s({args:["array","array"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b)",thisVars:["this_f"]},funcName:r}),t[r+"eq"]=s({args:["array"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a"],body:"a=this_f(a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:r+"eq"})}}();var h=["max","min","atan2","pow"];!function(){for(var e=0;e<h.length;++e){var r=h[e];t[r]=s({args:["array","array","array"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(b,c)",thisVars:["this_f"]},funcName:r}),t[r+"s"]=s({args:["array","array","scalar"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(b,c)",thisVars:["this_f"]},funcName:r+"s"}),t[r+"eq"]=s({args:["array","array"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(a,b)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:r+"eq"}),t[r+"seq"]=s({args:["array","scalar"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(a,b)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:r+"seq"})}}();var p=["atan2","pow"];!function(){for(var e=0;e<p.length;++e){var r=p[e];t[r+"op"]=s({args:["array","array","array"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(c,b)",thisVars:["this_f"]},funcName:r+"op"}),t[r+"ops"]=s({args:["array","array","scalar"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(c,b)",thisVars:["this_f"]},funcName:r+"ops"}),t[r+"opeq"]=s({args:["array","array"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b,a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:r+"opeq"}),t[r+"opseq"]=s({args:["array","scalar"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b,a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:r+"opseq"})}}(),t.any=n({args:["array"],pre:i,body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"if(a){return true}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return false"},funcName:"any"}),t.all=n({args:["array"],pre:i,body:{args:[{name:"x",lvalue:!1,rvalue:!0,count:1}],body:"if(!x){return false}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return true"},funcName:"all"}),t.sum=n({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"this_s+=a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"sum"}),t.prod=n({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=1"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"this_s*=a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"prod"}),t.norm2squared=n({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:2}],body:"this_s+=a*a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norm2squared"}),t.norm2=n({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:2}],body:"this_s+=a*a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return Math.sqrt(this_s)"},funcName:"norm2"}),t.norminf=n({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:4}],body:"if(-a>this_s){this_s=-a}else if(a>this_s){this_s=a}",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norminf"}),t.norm1=n({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:3}],body:"this_s+=a<0?-a:a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norm1"}),t.sup=n({args:["array"],pre:{body:"this_h=-Infinity",args:[],thisVars:["this_h"],localVars:[]},body:{body:"if(_inline_1_arg0_>this_h)this_h=_inline_1_arg0_",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_h"],localVars:[]},post:{body:"return this_h",args:[],thisVars:["this_h"],localVars:[]}}),t.inf=n({args:["array"],pre:{body:"this_h=Infinity",args:[],thisVars:["this_h"],localVars:[]},body:{body:"if(_inline_1_arg0_<this_h)this_h=_inline_1_arg0_",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_h"],localVars:[]},post:{body:"return this_h",args:[],thisVars:["this_h"],localVars:[]}}),t.argmin=n({args:["index","array","shape"],pre:{body:"{this_v=Infinity;this_i=_inline_0_arg2_.slice(0)}",args:[{name:"_inline_0_arg0_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg1_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg2_",lvalue:!1,rvalue:!0,count:1}],thisVars:["this_i","this_v"],localVars:[]},body:{body:"{if(_inline_1_arg1_<this_v){this_v=_inline_1_arg1_;for(var _inline_1_k=0;_inline_1_k<_inline_1_arg0_.length;++_inline_1_k){this_i[_inline_1_k]=_inline_1_arg0_[_inline_1_k]}}}",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2},{name:"_inline_1_arg1_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_i","this_v"],localVars:["_inline_1_k"]},post:{body:"{return this_i}",args:[],thisVars:["this_i"],localVars:[]}}),t.argmax=n({args:["index","array","shape"],pre:{body:"{this_v=-Infinity;this_i=_inline_0_arg2_.slice(0)}",args:[{name:"_inline_0_arg0_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg1_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg2_",lvalue:!1,rvalue:!0,count:1}],thisVars:["this_i","this_v"],localVars:[]},body:{body:"{if(_inline_1_arg1_>this_v){this_v=_inline_1_arg1_;for(var _inline_1_k=0;_inline_1_k<_inline_1_arg0_.length;++_inline_1_k){this_i[_inline_1_k]=_inline_1_arg0_[_inline_1_k]}}}",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2},{name:"_inline_1_arg1_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_i","this_v"],localVars:["_inline_1_k"]},post:{body:"{return this_i}",args:[],thisVars:["this_i"],localVars:[]}}),t.random=s({args:["array"],pre:{args:[],body:"this_f=Math.random",thisVars:["this_f"]},body:{args:["a"],body:"a=this_f()",thisVars:["this_f"]},funcName:"random"}),t.assign=s({args:["array","array"],body:{args:["a","b"],body:"a=b"},funcName:"assign"}),t.assigns=s({args:["array","scalar"],body:{args:["a","b"],body:"a=b"},funcName:"assigns"}),t.equals=n({args:["array","array"],pre:i,body:{args:[{name:"x",lvalue:!1,rvalue:!0,count:1},{name:"y",lvalue:!1,rvalue:!0,count:1}],body:"if(x!==y){return false}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return true"},funcName:"equals"})},788:(e,t,r)=>{var n=r(296),i=r(149),o="undefined"!=typeof Float64Array;function s(e,t){return e[0]-t[0]}function a(){var e,t=this.stride,r=new Array(t.length);for(e=0;e<r.length;++e)r[e]=[Math.abs(t[e]),e];r.sort(s);var n=new Array(r.length);for(e=0;e<n.length;++e)n[e]=r[e][1];return n}function c(e,t){var r=["View",t,"d",e].join("");t<0&&(r="View_Nil"+e);var i="generic"===e;if(-1===t){var o="function "+r+"(a){this.data=a;};var proto="+r+".prototype;proto.dtype='"+e+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+r+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+r+"(a){return new "+r+"(a);}";return new Function(o)()}if(0===t){o="function "+r+"(a,d) {this.data = a;this.offset = d};var proto="+r+".prototype;proto.dtype='"+e+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+r+"_copy() {return new "+r+"(this.data,this.offset)};proto.pick=function "+r+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+r+"_get(){return "+(i?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+r+"_set(v){return "+(i?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+r+"(a,b,c,d){return new "+r+"(a,d)}";return new Function("TrivialArray",o)(l[e][0])}o=["'use strict'"];var s=n(t),c=s.map((function(e){return"i"+e})),u="this.offset+"+s.map((function(e){return"this.stride["+e+"]*i"+e})).join("+"),h=s.map((function(e){return"b"+e})).join(","),p=s.map((function(e){return"c"+e})).join(",");o.push("function "+r+"(a,"+h+","+p+",d){this.data=a","this.shape=["+h+"]","this.stride=["+p+"]","this.offset=d|0}","var proto="+r+".prototype","proto.dtype='"+e+"'","proto.dimension="+t),o.push("Object.defineProperty(proto,'size',{get:function "+r+"_size(){return "+s.map((function(e){return"this.shape["+e+"]"})).join("*"),"}})"),1===t?o.push("proto.order=[0]"):(o.push("Object.defineProperty(proto,'order',{get:"),t<4?(o.push("function "+r+"_order(){"),2===t?o.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===t&&o.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):o.push("ORDER})")),o.push("proto.set=function "+r+"_set("+c.join(",")+",v){"),i?o.push("return this.data.set("+u+",v)}"):o.push("return this.data["+u+"]=v}"),o.push("proto.get=function "+r+"_get("+c.join(",")+"){"),i?o.push("return this.data.get("+u+")}"):o.push("return this.data["+u+"]}"),o.push("proto.index=function "+r+"_index(",c.join(),"){return "+u+"}"),o.push("proto.hi=function "+r+"_hi("+c.join(",")+"){return new "+r+"(this.data,"+s.map((function(e){return["(typeof i",e,"!=='number'||i",e,"<0)?this.shape[",e,"]:i",e,"|0"].join("")})).join(",")+","+s.map((function(e){return"this.stride["+e+"]"})).join(",")+",this.offset)}");var d=s.map((function(e){return"a"+e+"=this.shape["+e+"]"})),f=s.map((function(e){return"c"+e+"=this.stride["+e+"]"}));o.push("proto.lo=function "+r+"_lo("+c.join(",")+"){var b=this.offset,d=0,"+d.join(",")+","+f.join(","));for(var m=0;m<t;++m)o.push("if(typeof i"+m+"==='number'&&i"+m+">=0){d=i"+m+"|0;b+=c"+m+"*d;a"+m+"-=d}");o.push("return new "+r+"(this.data,"+s.map((function(e){return"a"+e})).join(",")+","+s.map((function(e){return"c"+e})).join(",")+",b)}"),o.push("proto.step=function "+r+"_step("+c.join(",")+"){var "+s.map((function(e){return"a"+e+"=this.shape["+e+"]"})).join(",")+","+s.map((function(e){return"b"+e+"=this.stride["+e+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(m=0;m<t;++m)o.push("if(typeof i"+m+"==='number'){d=i"+m+"|0;if(d<0){c+=b"+m+"*(a"+m+"-1);a"+m+"=ceil(-a"+m+"/d)}else{a"+m+"=ceil(a"+m+"/d)}b"+m+"*=d}");o.push("return new "+r+"(this.data,"+s.map((function(e){return"a"+e})).join(",")+","+s.map((function(e){return"b"+e})).join(",")+",c)}");var g=new Array(t),y=new Array(t);for(m=0;m<t;++m)g[m]="a[i"+m+"]",y[m]="b[i"+m+"]";o.push("proto.transpose=function "+r+"_transpose("+c+"){"+c.map((function(e,t){return e+"=("+e+"===undefined?"+t+":"+e+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+r+"(this.data,"+g.join(",")+","+y.join(",")+",this.offset)}"),o.push("proto.pick=function "+r+"_pick("+c+"){var a=[],b=[],c=this.offset");for(m=0;m<t;++m)o.push("if(typeof i"+m+"==='number'&&i"+m+">=0){c=(c+this.stride["+m+"]*i"+m+")|0}else{a.push(this.shape["+m+"]);b.push(this.stride["+m+"])}");return o.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),o.push("return function construct_"+r+"(data,shape,stride,offset){return new "+r+"(data,"+s.map((function(e){return"shape["+e+"]"})).join(",")+","+s.map((function(e){return"stride["+e+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",o.join("\n"))(l[e],a)}var l={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};e.exports=function(e,t,r,n){if(void 0===e)return(0,l.array[0])([]);"number"==typeof e&&(e=[e]),void 0===t&&(t=[e.length]);var s=t.length;if(void 0===r){r=new Array(s);for(var a=s-1,u=1;a>=0;--a)r[a]=u,u*=t[a]}if(void 0===n){n=0;for(a=0;a<s;++a)r[a]<0&&(n-=(t[a]-1)*r[a])}for(var h=function(e){if(i(e))return"buffer";if(o)switch(Object.prototype.toString.call(e)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(e)?"array":"generic"}(e),p=l[h];p.length<=s+1;)p.push(c(h,p.length-1));return(0,p[s+1])(e,t,r,n)}},731:e=>{"use strict";e.exports=function(e,t,r){return 0===e.length?e:t?(r||e.sort(t),function(e,t){for(var r=1,n=e.length,i=e[0],o=e[0],s=1;s<n;++s)if(o=i,t(i=e[s],o)){if(s===r){r++;continue}e[r++]=i}return e.length=r,e}(e,t)):(r||e.sort(),function(e){for(var t=1,r=e.length,n=e[0],i=e[0],o=1;o<r;++o,i=n)if(i=n,(n=e[o])!==i){if(o===t){t++;continue}e[t++]=n}return e.length=t,e}(e))}},869:()=>{},594:()=>{},24:(e,t,r)=>{"use strict";r.r(t),r.d(t,{ACESFilmicToneMapping:()=>ie,AddEquation:()=>S,AddOperation:()=>$,AdditiveAnimationBlendMode:()=>Gt,AdditiveBlending:()=>_,AgXToneMapping:()=>se,AlphaFormat:()=>Ge,AlwaysCompare:()=>Ar,AlwaysDepth:()=>H,AlwaysStencilFunc:()=>_r,AmbientLight:()=>vd,AnimationAction:()=>cf,AnimationClip:()=>zp,AnimationLoader:()=>Zp,AnimationMixer:()=>uf,AnimationObjectGroup:()=>af,AnimationUtils:()=>Cp,ArcCurve:()=>Yu,ArrayCamera:()=>Xc,ArrowHelper:()=>rm,AttachedBindMode:()=>ce,Audio:()=>Wd,AudioAnalyser:()=>Zd,AudioContext:()=>Pd,AudioListener:()=>Hd,AudioLoader:()=>Nd,AxesHelper:()=>nm,BackSide:()=>m,BasicDepthPacking:()=>Wt,BasicShadowMap:()=>u,BatchedMesh:()=>yu,Bone:()=>Bl,BooleanKeyframeTrack:()=>Up,Box2:()=>Sf,Box3:()=>Un,Box3Helper:()=>Zf,BoxGeometry:()=>Yo,BoxHelper:()=>Kf,BufferAttribute:()=>lo,BufferGeometry:()=>Ao,BufferGeometryLoader:()=>Td,ByteType:()=>Ie,Cache:()=>Hp,Camera:()=>$o,CameraHelper:()=>Yf,CanvasTexture:()=>Hu,CapsuleGeometry:()=>fh,CatmullRomCurve3:()=>$u,CineonToneMapping:()=>ne,CircleGeometry:()=>mh,ClampToEdgeWrapping:()=>ye,Clock:()=>Bd,Color:()=>Zi,ColorKeyframeTrack:()=>Dp,ColorManagement:()=>fn,CompressedArrayTexture:()=>zu,CompressedCubeTexture:()=>Vu,CompressedTexture:()=>Gu,CompressedTextureLoader:()=>Qp,ConeGeometry:()=>yh,ConstantAlphaFactor:()=>G,ConstantColorFactor:()=>k,CubeCamera:()=>os,CubeReflectionMapping:()=>he,CubeRefractionMapping:()=>pe,CubeTexture:()=>ss,CubeTextureLoader:()=>ed,CubeUVReflectionMapping:()=>me,CubicBezierCurve:()=>nh,CubicBezierCurve3:()=>ih,CubicInterpolant:()=>Op,CullFaceBack:()=>a,CullFaceFront:()=>c,CullFaceFrontBack:()=>l,CullFaceNone:()=>s,Curve:()=>Wu,CurvePath:()=>hh,CustomBlending:()=>w,CustomToneMapping:()=>oe,CylinderGeometry:()=>gh,Cylindrical:()=>xf,Data3DTexture:()=>Cn,DataArrayTexture:()=>An,DataTexture:()=>kl,DataTextureLoader:()=>td,DataUtils:()=>so,DecrementStencilOp:()=>cr,DecrementWrapStencilOp:()=>ur,DefaultLoadingManager:()=>Xp,DepthFormat:()=>Xe,DepthStencilFormat:()=>Ye,DepthTexture:()=>ta,DetachedBindMode:()=>le,DirectionalLight:()=>yd,DirectionalLightHelper:()=>Hf,DiscreteInterpolant:()=>Np,DisplayP3ColorSpace:()=>Qt,DodecahedronGeometry:()=>_h,DoubleSide:()=>g,DstAlphaFactor:()=>L,DstColorFactor:()=>D,DynamicCopyUsage:()=>Ur,DynamicDrawUsage:()=>Cr,DynamicReadUsage:()=>Pr,EdgesGeometry:()=>Mh,EllipseCurve:()=>Xu,EqualCompare:()=>wr,EqualDepth:()=>Y,EqualStencilFunc:()=>fr,EquirectangularReflectionMapping:()=>de,EquirectangularRefractionMapping:()=>fe,Euler:()=>vi,EventDispatcher:()=>Gr,ExtrudeGeometry:()=>ep,FileLoader:()=>Kp,Float16BufferAttribute:()=>vo,Float32BufferAttribute:()=>_o,FloatType:()=>Ue,Fog:()=>il,FogExp2:()=>nl,FramebufferTexture:()=>ju,FrontSide:()=>f,Frustum:()=>fs,GLBufferAttribute:()=>mf,GLSL1:()=>Fr,GLSL3:()=>Br,GreaterCompare:()=>Mr,GreaterDepth:()=>J,GreaterEqualCompare:()=>Er,GreaterEqualDepth:()=>q,GreaterEqualStencilFunc:()=>vr,GreaterStencilFunc:()=>gr,GridHelper:()=>kf,Group:()=>Yc,HalfFloatType:()=>De,HemisphereLight:()=>id,HemisphereLightHelper:()=>Bf,IcosahedronGeometry:()=>rp,ImageBitmapLoader:()=>Id,ImageLoader:()=>$p,ImageUtils:()=>vn,IncrementStencilOp:()=>ar,IncrementWrapStencilOp:()=>lr,InstancedBufferAttribute:()=>Vl,InstancedBufferGeometry:()=>Md,InstancedInterleavedBuffer:()=>ff,InstancedMesh:()=>Zl,Int16BufferAttribute:()=>fo,Int32BufferAttribute:()=>go,Int8BufferAttribute:()=>uo,IntType:()=>Ne,InterleavedBuffer:()=>sl,InterleavedBufferAttribute:()=>cl,Interpolant:()=>Ip,InterpolateDiscrete:()=>Lt,InterpolateLinear:()=>Ut,InterpolateSmooth:()=>Dt,InvertStencilOp:()=>hr,KeepStencilOp:()=>or,KeyframeTrack:()=>Lp,LOD:()=>Al,LatheGeometry:()=>dh,Layers:()=>_i,LessCompare:()=>xr,LessDepth:()=>W,LessEqualCompare:()=>Sr,LessEqualDepth:()=>X,LessEqualStencilFunc:()=>mr,LessStencilFunc:()=>dr,Light:()=>nd,LightProbe:()=>xd,Line:()=>Eu,Line3:()=>Ef,LineBasicMaterial:()=>vu,LineCurve:()=>oh,LineCurve3:()=>sh,LineDashedMaterial:()=>Sp,LineLoop:()=>Ou,LineSegments:()=>Iu,LinearDisplayP3ColorSpace:()=>$t,LinearFilter:()=>Me,LinearInterpolant:()=>Pp,LinearMipMapLinearFilter:()=>Re,LinearMipMapNearestFilter:()=>Ee,LinearMipmapLinearFilter:()=>Ae,LinearMipmapNearestFilter:()=>Te,LinearSRGBColorSpace:()=>Zt,LinearToneMapping:()=>te,LinearTransfer:()=>er,Loader:()=>Yp,LoaderUtils:()=>Sd,LoadingManager:()=>Wp,LoopOnce:()=>Ot,LoopPingPong:()=>Nt,LoopRepeat:()=>Pt,LuminanceAlphaFormat:()=>We,LuminanceFormat:()=>He,MOUSE:()=>i,Material:()=>eo,MaterialLoader:()=>wd,MathUtils:()=>Qr,Matrix3:()=>en,Matrix4:()=>ci,MaxEquation:()=>A,Mesh:()=>Wo,MeshBasicMaterial:()=>to,MeshDepthMaterial:()=>jc,MeshDistanceMaterial:()=>Gc,MeshLambertMaterial:()=>xp,MeshMatcapMaterial:()=>wp,MeshNormalMaterial:()=>bp,MeshPhongMaterial:()=>vp,MeshPhysicalMaterial:()=>yp,MeshStandardMaterial:()=>gp,MeshToonMaterial:()=>_p,MinEquation:()=>E,MirroredRepeatWrapping:()=>ve,MixOperation:()=>Q,MultiplyBlending:()=>x,MultiplyOperation:()=>Z,NearestFilter:()=>_e,NearestMipMapLinearFilter:()=>Se,NearestMipMapNearestFilter:()=>xe,NearestMipmapLinearFilter:()=>we,NearestMipmapNearestFilter:()=>be,NeutralToneMapping:()=>ae,NeverCompare:()=>br,NeverDepth:()=>V,NeverStencilFunc:()=>pr,NoBlending:()=>y,NoColorSpace:()=>Jt,NoToneMapping:()=>ee,NormalAnimationBlendMode:()=>jt,NormalBlending:()=>v,NotEqualCompare:()=>Tr,NotEqualDepth:()=>K,NotEqualStencilFunc:()=>yr,NumberKeyframeTrack:()=>Fp,Object3D:()=>Ui,ObjectLoader:()=>Ed,ObjectSpaceNormalMap:()=>qt,OctahedronGeometry:()=>np,OneFactor:()=>C,OneMinusConstantAlphaFactor:()=>z,OneMinusConstantColorFactor:()=>j,OneMinusDstAlphaFactor:()=>U,OneMinusDstColorFactor:()=>F,OneMinusSrcAlphaFactor:()=>N,OneMinusSrcColorFactor:()=>O,OrthographicCamera:()=>Is,P3Primaries:()=>nr,PCFShadowMap:()=>h,PCFSoftShadowMap:()=>p,PMREMGenerator:()=>zs,Path:()=>ph,PerspectiveCamera:()=>ns,Plane:()=>hs,PlaneGeometry:()=>ys,PlaneHelper:()=>Qf,PointLight:()=>md,PointLightHelper:()=>Lf,Points:()=>Fu,PointsMaterial:()=>Pu,PolarGridHelper:()=>jf,PolyhedronGeometry:()=>vh,PositionalAudio:()=>Kd,PropertyBinding:()=>sf,PropertyMixer:()=>Qd,QuadraticBezierCurve:()=>ah,QuadraticBezierCurve3:()=>ch,Quaternion:()=>On,QuaternionKeyframeTrack:()=>kp,QuaternionLinearInterpolant:()=>Bp,RED_GREEN_RGTC2_Format:()=>Ct,RED_RGTC1_Format:()=>At,REVISION:()=>n,RGBADepthPacking:()=>Xt,RGBAFormat:()=>Ve,RGBAIntegerFormat:()=>Qe,RGBA_ASTC_10x10_Format:()=>xt,RGBA_ASTC_10x5_Format:()=>vt,RGBA_ASTC_10x6_Format:()=>_t,RGBA_ASTC_10x8_Format:()=>bt,RGBA_ASTC_12x10_Format:()=>wt,RGBA_ASTC_12x12_Format:()=>St,RGBA_ASTC_4x4_Format:()=>ut,RGBA_ASTC_5x4_Format:()=>ht,RGBA_ASTC_5x5_Format:()=>pt,RGBA_ASTC_6x5_Format:()=>dt,RGBA_ASTC_6x6_Format:()=>ft,RGBA_ASTC_8x5_Format:()=>mt,RGBA_ASTC_8x6_Format:()=>gt,RGBA_ASTC_8x8_Format:()=>yt,RGBA_BPTC_Format:()=>Mt,RGBA_ETC2_EAC_Format:()=>lt,RGBA_PVRTC_2BPPV1_Format:()=>st,RGBA_PVRTC_4BPPV1_Format:()=>ot,RGBA_S3TC_DXT1_Format:()=>et,RGBA_S3TC_DXT3_Format:()=>tt,RGBA_S3TC_DXT5_Format:()=>rt,RGBFormat:()=>ze,RGB_BPTC_SIGNED_Format:()=>Tt,RGB_BPTC_UNSIGNED_Format:()=>Et,RGB_ETC1_Format:()=>at,RGB_ETC2_Format:()=>ct,RGB_PVRTC_2BPPV1_Format:()=>it,RGB_PVRTC_4BPPV1_Format:()=>nt,RGB_S3TC_DXT1_Format:()=>$e,RGFormat:()=>Ke,RGIntegerFormat:()=>Ze,RawShaderMaterial:()=>mp,Ray:()=>ai,Raycaster:()=>yf,Rec709Primaries:()=>rr,RectAreaLight:()=>_d,RedFormat:()=>qe,RedIntegerFormat:()=>Je,ReinhardToneMapping:()=>re,RenderTarget:()=>Tn,RepeatWrapping:()=>ge,ReplaceStencilOp:()=>sr,ReverseSubtractEquation:()=>T,RingGeometry:()=>ip,SIGNED_RED_GREEN_RGTC2_Format:()=>It,SIGNED_RED_RGTC1_Format:()=>Rt,SRGBColorSpace:()=>Kt,SRGBTransfer:()=>tr,Scene:()=>ol,ShaderChunk:()=>vs,ShaderLib:()=>bs,ShaderMaterial:()=>Qo,ShadowMaterial:()=>fp,Shape:()=>Th,ShapeGeometry:()=>op,ShapePath:()=>im,ShapeUtils:()=>Zh,ShortType:()=>Oe,Skeleton:()=>zl,SkeletonHelper:()=>Pf,SkinnedMesh:()=>Fl,Source:()=>bn,Sphere:()=>$n,SphereGeometry:()=>sp,Spherical:()=>bf,SphericalHarmonics3:()=>bd,SplineCurve:()=>lh,SpotLight:()=>ud,SpotLightHelper:()=>Rf,Sprite:()=>Sl,SpriteMaterial:()=>ll,SrcAlphaFactor:()=>P,SrcAlphaSaturateFactor:()=>B,SrcColorFactor:()=>I,StaticCopyUsage:()=>Lr,StaticDrawUsage:()=>Rr,StaticReadUsage:()=>Or,StereoCamera:()=>Fd,StreamCopyUsage:()=>Dr,StreamDrawUsage:()=>Ir,StreamReadUsage:()=>Nr,StringKeyframeTrack:()=>jp,SubtractEquation:()=>M,SubtractiveBlending:()=>b,TOUCH:()=>o,TangentSpaceNormalMap:()=>Yt,TetrahedronGeometry:()=>ap,Texture:()=>Sn,TextureLoader:()=>rd,TorusGeometry:()=>cp,TorusKnotGeometry:()=>lp,Triangle:()=>Xi,TriangleFanDrawMode:()=>Ht,TriangleStripDrawMode:()=>Vt,TrianglesDrawMode:()=>zt,TubeGeometry:()=>up,UVMapping:()=>ue,Uint16BufferAttribute:()=>mo,Uint32BufferAttribute:()=>yo,Uint8BufferAttribute:()=>ho,Uint8ClampedBufferAttribute:()=>po,Uniform:()=>hf,UniformsGroup:()=>df,UniformsLib:()=>_s,UniformsUtils:()=>Zo,UnsignedByteType:()=>Ce,UnsignedInt248Type:()=>ke,UnsignedInt5999Type:()=>je,UnsignedIntType:()=>Le,UnsignedShort4444Type:()=>Fe,UnsignedShort5551Type:()=>Be,UnsignedShortType:()=>Pe,VSMShadowMap:()=>d,Vector2:()=>$r,Vector3:()=>Pn,Vector4:()=>Mn,VectorKeyframeTrack:()=>Gp,VideoTexture:()=>ku,WebGL3DRenderTarget:()=>In,WebGLArrayRenderTarget:()=>Rn,WebGLCoordinateSystem:()=>kr,WebGLCubeRenderTarget:()=>as,WebGLMultipleRenderTargets:()=>om,WebGLRenderTarget:()=>En,WebGLRenderer:()=>rl,WebGLUtils:()=>Wc,WebGPUCoordinateSystem:()=>jr,WireframeGeometry:()=>hp,WrapAroundEnding:()=>kt,ZeroCurvatureEnding:()=>Ft,ZeroFactor:()=>R,ZeroSlopeEnding:()=>Bt,ZeroStencilOp:()=>ir,createCanvasElement:()=>an});const n="165",i={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},o={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},s=0,a=1,c=2,l=3,u=0,h=1,p=2,d=3,f=0,m=1,g=2,y=0,v=1,_=2,b=3,x=4,w=5,S=100,M=101,T=102,E=103,A=104,R=200,C=201,I=202,O=203,P=204,N=205,L=206,U=207,D=208,F=209,B=210,k=211,j=212,G=213,z=214,V=0,H=1,W=2,X=3,Y=4,q=5,J=6,K=7,Z=0,Q=1,$=2,ee=0,te=1,re=2,ne=3,ie=4,oe=5,se=6,ae=7,ce="attached",le="detached",ue=300,he=301,pe=302,de=303,fe=304,me=306,ge=1e3,ye=1001,ve=1002,_e=1003,be=1004,xe=1004,we=1005,Se=1005,Me=1006,Te=1007,Ee=1007,Ae=1008,Re=1008,Ce=1009,Ie=1010,Oe=1011,Pe=1012,Ne=1013,Le=1014,Ue=1015,De=1016,Fe=1017,Be=1018,ke=1020,je=35902,Ge=1021,ze=1022,Ve=1023,He=1024,We=1025,Xe=1026,Ye=1027,qe=1028,Je=1029,Ke=1030,Ze=1031,Qe=1033,$e=33776,et=33777,tt=33778,rt=33779,nt=35840,it=35841,ot=35842,st=35843,at=36196,ct=37492,lt=37496,ut=37808,ht=37809,pt=37810,dt=37811,ft=37812,mt=37813,gt=37814,yt=37815,vt=37816,_t=37817,bt=37818,xt=37819,wt=37820,St=37821,Mt=36492,Tt=36494,Et=36495,At=36283,Rt=36284,Ct=36285,It=36286,Ot=2200,Pt=2201,Nt=2202,Lt=2300,Ut=2301,Dt=2302,Ft=2400,Bt=2401,kt=2402,jt=2500,Gt=2501,zt=0,Vt=1,Ht=2,Wt=3200,Xt=3201,Yt=0,qt=1,Jt="",Kt="srgb",Zt="srgb-linear",Qt="display-p3",$t="display-p3-linear",er="linear",tr="srgb",rr="rec709",nr="p3",ir=0,or=7680,sr=7681,ar=7682,cr=7683,lr=34055,ur=34056,hr=5386,pr=512,dr=513,fr=514,mr=515,gr=516,yr=517,vr=518,_r=519,br=512,xr=513,wr=514,Sr=515,Mr=516,Tr=517,Er=518,Ar=519,Rr=35044,Cr=35048,Ir=35040,Or=35045,Pr=35049,Nr=35041,Lr=35046,Ur=35050,Dr=35042,Fr="100",Br="300 es",kr=2e3,jr=2001;class Gr{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});const r=this._listeners;void 0===r[e]&&(r[e]=[]),-1===r[e].indexOf(t)&&r[e].push(t)}hasEventListener(e,t){if(void 0===this._listeners)return!1;const r=this._listeners;return void 0!==r[e]&&-1!==r[e].indexOf(t)}removeEventListener(e,t){if(void 0===this._listeners)return;const r=this._listeners[e];if(void 0!==r){const e=r.indexOf(t);-1!==e&&r.splice(e,1)}}dispatchEvent(e){if(void 0===this._listeners)return;const t=this._listeners[e.type];if(void 0!==t){e.target=this;const r=t.slice(0);for(let t=0,n=r.length;t<n;t++)r[t].call(this,e);e.target=null}}}const zr=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let Vr=1234567;const Hr=Math.PI/180,Wr=180/Math.PI;function Xr(){const e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,r=4294967295*Math.random()|0,n=4294967295*Math.random()|0;return(zr[255&e]+zr[e>>8&255]+zr[e>>16&255]+zr[e>>24&255]+"-"+zr[255&t]+zr[t>>8&255]+"-"+zr[t>>16&15|64]+zr[t>>24&255]+"-"+zr[63&r|128]+zr[r>>8&255]+"-"+zr[r>>16&255]+zr[r>>24&255]+zr[255&n]+zr[n>>8&255]+zr[n>>16&255]+zr[n>>24&255]).toLowerCase()}function Yr(e,t,r){return Math.max(t,Math.min(r,e))}function qr(e,t){return(e%t+t)%t}function Jr(e,t,r){return(1-r)*e+r*t}function Kr(e,t){switch(t.constructor){case Float32Array:return e;case Uint32Array:return e/4294967295;case Uint16Array:return e/65535;case Uint8Array:return e/255;case Int32Array:return Math.max(e/2147483647,-1);case Int16Array:return Math.max(e/32767,-1);case Int8Array:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}function Zr(e,t){switch(t.constructor){case Float32Array:return e;case Uint32Array:return Math.round(4294967295*e);case Uint16Array:return Math.round(65535*e);case Uint8Array:return Math.round(255*e);case Int32Array:return Math.round(2147483647*e);case Int16Array:return Math.round(32767*e);case Int8Array:return Math.round(127*e);default:throw new Error("Invalid component type.")}}const Qr={DEG2RAD:Hr,RAD2DEG:Wr,generateUUID:Xr,clamp:Yr,euclideanModulo:qr,mapLinear:function(e,t,r,n,i){return n+(e-t)*(i-n)/(r-t)},inverseLerp:function(e,t,r){return e!==t?(r-e)/(t-e):0},lerp:Jr,damp:function(e,t,r,n){return Jr(e,t,1-Math.exp(-r*n))},pingpong:function(e,t=1){return t-Math.abs(qr(e,2*t)-t)},smoothstep:function(e,t,r){return e<=t?0:e>=r?1:(e=(e-t)/(r-t))*e*(3-2*e)},smootherstep:function(e,t,r){return e<=t?0:e>=r?1:(e=(e-t)/(r-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},seededRandom:function(e){void 0!==e&&(Vr=e);let t=Vr+=1831565813;return t=Math.imul(t^t>>>15,1|t),t^=t+Math.imul(t^t>>>7,61|t),((t^t>>>14)>>>0)/4294967296},degToRad:function(e){return e*Hr},radToDeg:function(e){return e*Wr},isPowerOfTwo:function(e){return 0==(e&e-1)&&0!==e},ceilPowerOfTwo:function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},floorPowerOfTwo:function(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))},setQuaternionFromProperEuler:function(e,t,r,n,i){const o=Math.cos,s=Math.sin,a=o(r/2),c=s(r/2),l=o((t+n)/2),u=s((t+n)/2),h=o((t-n)/2),p=s((t-n)/2),d=o((n-t)/2),f=s((n-t)/2);switch(i){case"XYX":e.set(a*u,c*h,c*p,a*l);break;case"YZY":e.set(c*p,a*u,c*h,a*l);break;case"ZXZ":e.set(c*h,c*p,a*u,a*l);break;case"XZX":e.set(a*u,c*f,c*d,a*l);break;case"YXY":e.set(c*d,a*u,c*f,a*l);break;case"ZYZ":e.set(c*f,c*d,a*u,a*l);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+i)}},normalize:Zr,denormalize:Kr};class $r{constructor(e=0,t=0){$r.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,r=this.y,n=e.elements;return this.x=n[0]*t+n[3]*r+n[6],this.y=n[1]*t+n[4]*r+n[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const r=this.dot(e)/t;return Math.acos(Yr(r,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,r=this.y-e.y;return t*t+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const r=Math.cos(t),n=Math.sin(t),i=this.x-e.x,o=this.y-e.y;return this.x=i*r-o*n+e.x,this.y=i*n+o*r+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class en{constructor(e,t,r,n,i,o,s,a,c){en.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],void 0!==e&&this.set(e,t,r,n,i,o,s,a,c)}set(e,t,r,n,i,o,s,a,c){const l=this.elements;return l[0]=e,l[1]=n,l[2]=s,l[3]=t,l[4]=i,l[5]=a,l[6]=r,l[7]=o,l[8]=c,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,r=e.elements;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],this}extractBasis(e,t,r){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const r=e.elements,n=t.elements,i=this.elements,o=r[0],s=r[3],a=r[6],c=r[1],l=r[4],u=r[7],h=r[2],p=r[5],d=r[8],f=n[0],m=n[3],g=n[6],y=n[1],v=n[4],_=n[7],b=n[2],x=n[5],w=n[8];return i[0]=o*f+s*y+a*b,i[3]=o*m+s*v+a*x,i[6]=o*g+s*_+a*w,i[1]=c*f+l*y+u*b,i[4]=c*m+l*v+u*x,i[7]=c*g+l*_+u*w,i[2]=h*f+p*y+d*b,i[5]=h*m+p*v+d*x,i[8]=h*g+p*_+d*w,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],r=e[1],n=e[2],i=e[3],o=e[4],s=e[5],a=e[6],c=e[7],l=e[8];return t*o*l-t*s*c-r*i*l+r*s*a+n*i*c-n*o*a}invert(){const e=this.elements,t=e[0],r=e[1],n=e[2],i=e[3],o=e[4],s=e[5],a=e[6],c=e[7],l=e[8],u=l*o-s*c,h=s*a-l*i,p=c*i-o*a,d=t*u+r*h+n*p;if(0===d)return this.set(0,0,0,0,0,0,0,0,0);const f=1/d;return e[0]=u*f,e[1]=(n*c-l*r)*f,e[2]=(s*r-n*o)*f,e[3]=h*f,e[4]=(l*t-n*a)*f,e[5]=(n*i-s*t)*f,e[6]=p*f,e[7]=(r*a-c*t)*f,e[8]=(o*t-r*i)*f,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,r,n,i,o,s){const a=Math.cos(i),c=Math.sin(i);return this.set(r*a,r*c,-r*(a*o+c*s)+o+e,-n*c,n*a,-n*(-c*o+a*s)+s+t,0,0,1),this}scale(e,t){return this.premultiply(tn.makeScale(e,t)),this}rotate(e){return this.premultiply(tn.makeRotation(-e)),this}translate(e,t){return this.premultiply(tn.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),r=Math.sin(e);return this.set(t,-r,0,r,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,r=e.elements;for(let e=0;e<9;e++)if(t[e]!==r[e])return!1;return!0}fromArray(e,t=0){for(let r=0;r<9;r++)this.elements[r]=e[r+t];return this}toArray(e=[],t=0){const r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e}clone(){return(new this.constructor).fromArray(this.elements)}}const tn=new en;function rn(e){for(let t=e.length-1;t>=0;--t)if(e[t]>=65535)return!0;return!1}const nn={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function on(e,t){return new nn[e](t)}function sn(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}function an(){const e=sn("canvas");return e.style.display="block",e}const cn={};function ln(e){e in cn||(cn[e]=!0,console.warn(e))}const un=(new en).set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),hn=(new en).set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),pn={[Zt]:{transfer:er,primaries:rr,toReference:e=>e,fromReference:e=>e},[Kt]:{transfer:tr,primaries:rr,toReference:e=>e.convertSRGBToLinear(),fromReference:e=>e.convertLinearToSRGB()},[$t]:{transfer:er,primaries:nr,toReference:e=>e.applyMatrix3(hn),fromReference:e=>e.applyMatrix3(un)},[Qt]:{transfer:tr,primaries:nr,toReference:e=>e.convertSRGBToLinear().applyMatrix3(hn),fromReference:e=>e.applyMatrix3(un).convertLinearToSRGB()}},dn=new Set([Zt,$t]),fn={enabled:!0,_workingColorSpace:Zt,get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(e){if(!dn.has(e))throw new Error(`Unsupported working color space, "${e}".`);this._workingColorSpace=e},convert:function(e,t,r){if(!1===this.enabled||t===r||!t||!r)return e;const n=pn[t].toReference;return(0,pn[r].fromReference)(n(e))},fromWorkingColorSpace:function(e,t){return this.convert(e,this._workingColorSpace,t)},toWorkingColorSpace:function(e,t){return this.convert(e,t,this._workingColorSpace)},getPrimaries:function(e){return pn[e].primaries},getTransfer:function(e){return e===Jt?er:pn[e].transfer}};function mn(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function gn(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}let yn;class vn{static getDataURL(e){if(/^data:/i.test(e.src))return e.src;if("undefined"==typeof HTMLCanvasElement)return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{void 0===yn&&(yn=sn("canvas")),yn.width=e.width,yn.height=e.height;const r=yn.getContext("2d");e instanceof ImageData?r.putImageData(e,0,0):r.drawImage(e,0,0,e.width,e.height),t=yn}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){const t=sn("canvas");t.width=e.width,t.height=e.height;const r=t.getContext("2d");r.drawImage(e,0,0,e.width,e.height);const n=r.getImageData(0,0,e.width,e.height),i=n.data;for(let e=0;e<i.length;e++)i[e]=255*mn(i[e]/255);return r.putImageData(n,0,0),t}if(e.data){const t=e.data.slice(0);for(let e=0;e<t.length;e++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[e]=Math.floor(255*mn(t[e]/255)):t[e]=mn(t[e]);return{data:t,width:e.width,height:e.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let _n=0;class bn{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:_n++}),this.uuid=Xr(),this.data=e,this.dataReady=!0,this.version=0}set needsUpdate(e){!0===e&&this.version++}toJSON(e){const t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.images[this.uuid])return e.images[this.uuid];const r={uuid:this.uuid,url:""},n=this.data;if(null!==n){let e;if(Array.isArray(n)){e=[];for(let t=0,r=n.length;t<r;t++)n[t].isDataTexture?e.push(xn(n[t].image)):e.push(xn(n[t]))}else e=xn(n);r.url=e}return t||(e.images[this.uuid]=r),r}}function xn(e){return"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?vn.getDataURL(e):e.data?{data:Array.from(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let wn=0;class Sn extends Gr{constructor(e=Sn.DEFAULT_IMAGE,t=Sn.DEFAULT_MAPPING,r=ye,n=ye,i=Me,o=Ae,s=Ve,a=Ce,c=Sn.DEFAULT_ANISOTROPY,l=Jt){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:wn++}),this.uuid=Xr(),this.name="",this.source=new bn(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=r,this.wrapT=n,this.magFilter=i,this.minFilter=o,this.anisotropy=c,this.format=s,this.internalFormat=null,this.type=a,this.offset=new $r(0,0),this.repeat=new $r(1,1),this.center=new $r(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new en,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=l,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];const r={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(r.userData=this.userData),t||(e.textures[this.uuid]=r),r}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==ue)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case ge:e.x=e.x-Math.floor(e.x);break;case ye:e.x=e.x<0?0:1;break;case ve:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case ge:e.y=e.y-Math.floor(e.y);break;case ye:e.y=e.y<0?0:1;break;case ve:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){!0===e&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){!0===e&&this.pmremVersion++}}Sn.DEFAULT_IMAGE=null,Sn.DEFAULT_MAPPING=ue,Sn.DEFAULT_ANISOTROPY=1;class Mn{constructor(e=0,t=0,r=0,n=1){Mn.prototype.isVector4=!0,this.x=e,this.y=t,this.z=r,this.w=n}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,r,n){return this.x=e,this.y=t,this.z=r,this.w=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,r=this.y,n=this.z,i=this.w,o=e.elements;return this.x=o[0]*t+o[4]*r+o[8]*n+o[12]*i,this.y=o[1]*t+o[5]*r+o[9]*n+o[13]*i,this.z=o[2]*t+o[6]*r+o[10]*n+o[14]*i,this.w=o[3]*t+o[7]*r+o[11]*n+o[15]*i,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,r,n,i;const o=.01,s=.1,a=e.elements,c=a[0],l=a[4],u=a[8],h=a[1],p=a[5],d=a[9],f=a[2],m=a[6],g=a[10];if(Math.abs(l-h)<o&&Math.abs(u-f)<o&&Math.abs(d-m)<o){if(Math.abs(l+h)<s&&Math.abs(u+f)<s&&Math.abs(d+m)<s&&Math.abs(c+p+g-3)<s)return this.set(1,0,0,0),this;t=Math.PI;const e=(c+1)/2,a=(p+1)/2,y=(g+1)/2,v=(l+h)/4,_=(u+f)/4,b=(d+m)/4;return e>a&&e>y?e<o?(r=0,n=.707106781,i=.707106781):(r=Math.sqrt(e),n=v/r,i=_/r):a>y?a<o?(r=.707106781,n=0,i=.707106781):(n=Math.sqrt(a),r=v/n,i=b/n):y<o?(r=.707106781,n=.707106781,i=0):(i=Math.sqrt(y),r=_/i,n=b/i),this.set(r,n,i,t),this}let y=Math.sqrt((m-d)*(m-d)+(u-f)*(u-f)+(h-l)*(h-l));return Math.abs(y)<.001&&(y=1),this.x=(m-d)/y,this.y=(u-f)/y,this.z=(h-l)/y,this.w=Math.acos((c+p+g-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this.z=e.z+(t.z-e.z)*r,this.w=e.w+(t.w-e.w)*r,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class Tn extends Gr{constructor(e=1,t=1,r={}){super(),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new Mn(0,0,e,t),this.scissorTest=!1,this.viewport=new Mn(0,0,e,t);const n={width:e,height:t,depth:1};r=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:Me,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1},r);const i=new Sn(n,r.mapping,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy,r.colorSpace);i.flipY=!1,i.generateMipmaps=r.generateMipmaps,i.internalFormat=r.internalFormat,this.textures=[];const o=r.count;for(let e=0;e<o;e++)this.textures[e]=i.clone(),this.textures[e].isRenderTargetTexture=!0;this.depthBuffer=r.depthBuffer,this.stencilBuffer=r.stencilBuffer,this.resolveDepthBuffer=r.resolveDepthBuffer,this.resolveStencilBuffer=r.resolveStencilBuffer,this.depthTexture=r.depthTexture,this.samples=r.samples}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}setSize(e,t,r=1){if(this.width!==e||this.height!==t||this.depth!==r){this.width=e,this.height=t,this.depth=r;for(let n=0,i=this.textures.length;n<i;n++)this.textures[n].image.width=e,this.textures[n].image.height=t,this.textures[n].image.depth=r;this.dispose()}this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return(new this.constructor).copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let t=0,r=e.textures.length;t<r;t++)this.textures[t]=e.textures[t].clone(),this.textures[t].isRenderTargetTexture=!0;const t=Object.assign({},e.texture.image);return this.texture.source=new bn(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.resolveDepthBuffer=e.resolveDepthBuffer,this.resolveStencilBuffer=e.resolveStencilBuffer,null!==e.depthTexture&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class En extends Tn{constructor(e=1,t=1,r={}){super(e,t,r),this.isWebGLRenderTarget=!0}}class An extends Sn{constructor(e=null,t=1,r=1,n=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:r,depth:n},this.magFilter=_e,this.minFilter=_e,this.wrapR=ye,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class Rn extends En{constructor(e=1,t=1,r=1,n={}){super(e,t,n),this.isWebGLArrayRenderTarget=!0,this.depth=r,this.texture=new An(null,e,t,r),this.texture.isRenderTargetTexture=!0}}class Cn extends Sn{constructor(e=null,t=1,r=1,n=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:r,depth:n},this.magFilter=_e,this.minFilter=_e,this.wrapR=ye,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class In extends En{constructor(e=1,t=1,r=1,n={}){super(e,t,n),this.isWebGL3DRenderTarget=!0,this.depth=r,this.texture=new Cn(null,e,t,r),this.texture.isRenderTargetTexture=!0}}class On{constructor(e=0,t=0,r=0,n=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=r,this._w=n}static slerpFlat(e,t,r,n,i,o,s){let a=r[n+0],c=r[n+1],l=r[n+2],u=r[n+3];const h=i[o+0],p=i[o+1],d=i[o+2],f=i[o+3];if(0===s)return e[t+0]=a,e[t+1]=c,e[t+2]=l,void(e[t+3]=u);if(1===s)return e[t+0]=h,e[t+1]=p,e[t+2]=d,void(e[t+3]=f);if(u!==f||a!==h||c!==p||l!==d){let e=1-s;const t=a*h+c*p+l*d+u*f,r=t>=0?1:-1,n=1-t*t;if(n>Number.EPSILON){const i=Math.sqrt(n),o=Math.atan2(i,t*r);e=Math.sin(e*o)/i,s=Math.sin(s*o)/i}const i=s*r;if(a=a*e+h*i,c=c*e+p*i,l=l*e+d*i,u=u*e+f*i,e===1-s){const e=1/Math.sqrt(a*a+c*c+l*l+u*u);a*=e,c*=e,l*=e,u*=e}}e[t]=a,e[t+1]=c,e[t+2]=l,e[t+3]=u}static multiplyQuaternionsFlat(e,t,r,n,i,o){const s=r[n],a=r[n+1],c=r[n+2],l=r[n+3],u=i[o],h=i[o+1],p=i[o+2],d=i[o+3];return e[t]=s*d+l*u+a*p-c*h,e[t+1]=a*d+l*h+c*u-s*p,e[t+2]=c*d+l*p+s*h-a*u,e[t+3]=l*d-s*u-a*h-c*p,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,r,n){return this._x=e,this._y=t,this._z=r,this._w=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){const r=e._x,n=e._y,i=e._z,o=e._order,s=Math.cos,a=Math.sin,c=s(r/2),l=s(n/2),u=s(i/2),h=a(r/2),p=a(n/2),d=a(i/2);switch(o){case"XYZ":this._x=h*l*u+c*p*d,this._y=c*p*u-h*l*d,this._z=c*l*d+h*p*u,this._w=c*l*u-h*p*d;break;case"YXZ":this._x=h*l*u+c*p*d,this._y=c*p*u-h*l*d,this._z=c*l*d-h*p*u,this._w=c*l*u+h*p*d;break;case"ZXY":this._x=h*l*u-c*p*d,this._y=c*p*u+h*l*d,this._z=c*l*d+h*p*u,this._w=c*l*u-h*p*d;break;case"ZYX":this._x=h*l*u-c*p*d,this._y=c*p*u+h*l*d,this._z=c*l*d-h*p*u,this._w=c*l*u+h*p*d;break;case"YZX":this._x=h*l*u+c*p*d,this._y=c*p*u+h*l*d,this._z=c*l*d-h*p*u,this._w=c*l*u-h*p*d;break;case"XZY":this._x=h*l*u-c*p*d,this._y=c*p*u-h*l*d,this._z=c*l*d+h*p*u,this._w=c*l*u+h*p*d;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return!0===t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const r=t/2,n=Math.sin(r);return this._x=e.x*n,this._y=e.y*n,this._z=e.z*n,this._w=Math.cos(r),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,r=t[0],n=t[4],i=t[8],o=t[1],s=t[5],a=t[9],c=t[2],l=t[6],u=t[10],h=r+s+u;if(h>0){const e=.5/Math.sqrt(h+1);this._w=.25/e,this._x=(l-a)*e,this._y=(i-c)*e,this._z=(o-n)*e}else if(r>s&&r>u){const e=2*Math.sqrt(1+r-s-u);this._w=(l-a)/e,this._x=.25*e,this._y=(n+o)/e,this._z=(i+c)/e}else if(s>u){const e=2*Math.sqrt(1+s-r-u);this._w=(i-c)/e,this._x=(n+o)/e,this._y=.25*e,this._z=(a+l)/e}else{const e=2*Math.sqrt(1+u-r-s);this._w=(o-n)/e,this._x=(i+c)/e,this._y=(a+l)/e,this._z=.25*e}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let r=e.dot(t)+1;return r<Number.EPSILON?(r=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=r):(this._x=0,this._y=-e.z,this._z=e.y,this._w=r)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=r),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Yr(this.dot(e),-1,1)))}rotateTowards(e,t){const r=this.angleTo(e);if(0===r)return this;const n=Math.min(1,t/r);return this.slerp(e,n),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const r=e._x,n=e._y,i=e._z,o=e._w,s=t._x,a=t._y,c=t._z,l=t._w;return this._x=r*l+o*s+n*c-i*a,this._y=n*l+o*a+i*s-r*c,this._z=i*l+o*c+r*a-n*s,this._w=o*l-r*s-n*a-i*c,this._onChangeCallback(),this}slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);const r=this._x,n=this._y,i=this._z,o=this._w;let s=o*e._w+r*e._x+n*e._y+i*e._z;if(s<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,s=-s):this.copy(e),s>=1)return this._w=o,this._x=r,this._y=n,this._z=i,this;const a=1-s*s;if(a<=Number.EPSILON){const e=1-t;return this._w=e*o+t*this._w,this._x=e*r+t*this._x,this._y=e*n+t*this._y,this._z=e*i+t*this._z,this.normalize(),this}const c=Math.sqrt(a),l=Math.atan2(c,s),u=Math.sin((1-t)*l)/c,h=Math.sin(t*l)/c;return this._w=o*u+this._w*h,this._x=r*u+this._x*h,this._y=n*u+this._y*h,this._z=i*u+this._z*h,this._onChangeCallback(),this}slerpQuaternions(e,t,r){return this.copy(e).slerp(t,r)}random(){const e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),r=Math.random(),n=Math.sqrt(1-r),i=Math.sqrt(r);return this.set(n*Math.sin(e),n*Math.cos(e),i*Math.sin(t),i*Math.cos(t))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class Pn{constructor(e=0,t=0,r=0){Pn.prototype.isVector3=!0,this.x=e,this.y=t,this.z=r}set(e,t,r){return void 0===r&&(r=this.z),this.x=e,this.y=t,this.z=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(Ln.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(Ln.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,r=this.y,n=this.z,i=e.elements;return this.x=i[0]*t+i[3]*r+i[6]*n,this.y=i[1]*t+i[4]*r+i[7]*n,this.z=i[2]*t+i[5]*r+i[8]*n,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,r=this.y,n=this.z,i=e.elements,o=1/(i[3]*t+i[7]*r+i[11]*n+i[15]);return this.x=(i[0]*t+i[4]*r+i[8]*n+i[12])*o,this.y=(i[1]*t+i[5]*r+i[9]*n+i[13])*o,this.z=(i[2]*t+i[6]*r+i[10]*n+i[14])*o,this}applyQuaternion(e){const t=this.x,r=this.y,n=this.z,i=e.x,o=e.y,s=e.z,a=e.w,c=2*(o*n-s*r),l=2*(s*t-i*n),u=2*(i*r-o*t);return this.x=t+a*c+o*u-s*l,this.y=r+a*l+s*c-i*u,this.z=n+a*u+i*l-o*c,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,r=this.y,n=this.z,i=e.elements;return this.x=i[0]*t+i[4]*r+i[8]*n,this.y=i[1]*t+i[5]*r+i[9]*n,this.z=i[2]*t+i[6]*r+i[10]*n,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this.z=e.z+(t.z-e.z)*r,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const r=e.x,n=e.y,i=e.z,o=t.x,s=t.y,a=t.z;return this.x=n*a-i*s,this.y=i*o-r*a,this.z=r*s-n*o,this}projectOnVector(e){const t=e.lengthSq();if(0===t)return this.set(0,0,0);const r=e.dot(this)/t;return this.copy(e).multiplyScalar(r)}projectOnPlane(e){return Nn.copy(this).projectOnVector(e),this.sub(Nn)}reflect(e){return this.sub(Nn.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const r=this.dot(e)/t;return Math.acos(Yr(r,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,r=this.y-e.y,n=this.z-e.z;return t*t+r*r+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,r){const n=Math.sin(t)*e;return this.x=n*Math.sin(r),this.y=Math.cos(t)*e,this.z=n*Math.cos(r),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,r){return this.x=e*Math.sin(t),this.y=r,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),r=this.setFromMatrixColumn(e,1).length(),n=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=r,this.z=n,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,t=2*Math.random()-1,r=Math.sqrt(1-t*t);return this.x=r*Math.cos(e),this.y=t,this.z=r*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const Nn=new Pn,Ln=new On;class Un{constructor(e=new Pn(1/0,1/0,1/0),t=new Pn(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,r=e.length;t<r;t+=3)this.expandByPoint(Fn.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,r=e.count;t<r;t++)this.expandByPoint(Fn.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,r=e.length;t<r;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const r=Fn.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const r=e.geometry;if(void 0!==r){const n=r.getAttribute("position");if(!0===t&&void 0!==n&&!0!==e.isInstancedMesh)for(let t=0,r=n.count;t<r;t++)!0===e.isMesh?e.getVertexPosition(t,Fn):Fn.fromBufferAttribute(n,t),Fn.applyMatrix4(e.matrixWorld),this.expandByPoint(Fn);else void 0!==e.boundingBox?(null===e.boundingBox&&e.computeBoundingBox(),Bn.copy(e.boundingBox)):(null===r.boundingBox&&r.computeBoundingBox(),Bn.copy(r.boundingBox)),Bn.applyMatrix4(e.matrixWorld),this.union(Bn)}const n=e.children;for(let e=0,r=n.length;e<r;e++)this.expandByObject(n[e],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,Fn),Fn.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,r;return e.normal.x>0?(t=e.normal.x*this.min.x,r=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,r=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,r+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,r+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,r+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,r+=e.normal.z*this.min.z),t<=-e.constant&&r>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(Wn),Xn.subVectors(this.max,Wn),kn.subVectors(e.a,Wn),jn.subVectors(e.b,Wn),Gn.subVectors(e.c,Wn),zn.subVectors(jn,kn),Vn.subVectors(Gn,jn),Hn.subVectors(kn,Gn);let t=[0,-zn.z,zn.y,0,-Vn.z,Vn.y,0,-Hn.z,Hn.y,zn.z,0,-zn.x,Vn.z,0,-Vn.x,Hn.z,0,-Hn.x,-zn.y,zn.x,0,-Vn.y,Vn.x,0,-Hn.y,Hn.x,0];return!!Jn(t,kn,jn,Gn,Xn)&&(t=[1,0,0,0,1,0,0,0,1],!!Jn(t,kn,jn,Gn,Xn)&&(Yn.crossVectors(zn,Vn),t=[Yn.x,Yn.y,Yn.z],Jn(t,kn,jn,Gn,Xn)))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,Fn).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=.5*this.getSize(Fn).length()),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(Dn[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Dn[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Dn[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Dn[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Dn[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Dn[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Dn[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Dn[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Dn)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const Dn=[new Pn,new Pn,new Pn,new Pn,new Pn,new Pn,new Pn,new Pn],Fn=new Pn,Bn=new Un,kn=new Pn,jn=new Pn,Gn=new Pn,zn=new Pn,Vn=new Pn,Hn=new Pn,Wn=new Pn,Xn=new Pn,Yn=new Pn,qn=new Pn;function Jn(e,t,r,n,i){for(let o=0,s=e.length-3;o<=s;o+=3){qn.fromArray(e,o);const s=i.x*Math.abs(qn.x)+i.y*Math.abs(qn.y)+i.z*Math.abs(qn.z),a=t.dot(qn),c=r.dot(qn),l=n.dot(qn);if(Math.max(-Math.max(a,c,l),Math.min(a,c,l))>s)return!1}return!0}const Kn=new Un,Zn=new Pn,Qn=new Pn;class $n{constructor(e=new Pn,t=-1){this.isSphere=!0,this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const r=this.center;void 0!==t?r.copy(t):Kn.setFromPoints(e).getCenter(r);let n=0;for(let t=0,i=e.length;t<i;t++)n=Math.max(n,r.distanceToSquared(e[t]));return this.radius=Math.sqrt(n),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const r=this.center.distanceToSquared(e);return t.copy(e),r>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;Zn.subVectors(e,this.center);const t=Zn.lengthSq();if(t>this.radius*this.radius){const e=Math.sqrt(t),r=.5*(e-this.radius);this.center.addScaledVector(Zn,r/e),this.radius+=r}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(!0===this.center.equals(e.center)?this.radius=Math.max(this.radius,e.radius):(Qn.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(Zn.copy(e.center).add(Qn)),this.expandByPoint(Zn.copy(e.center).sub(Qn))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const ei=new Pn,ti=new Pn,ri=new Pn,ni=new Pn,ii=new Pn,oi=new Pn,si=new Pn;class ai{constructor(e=new Pn,t=new Pn(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,ei)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const r=t.dot(this.direction);return r<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,r)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=ei.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(ei.copy(this.origin).addScaledVector(this.direction,t),ei.distanceToSquared(e))}distanceSqToSegment(e,t,r,n){ti.copy(e).add(t).multiplyScalar(.5),ri.copy(t).sub(e).normalize(),ni.copy(this.origin).sub(ti);const i=.5*e.distanceTo(t),o=-this.direction.dot(ri),s=ni.dot(this.direction),a=-ni.dot(ri),c=ni.lengthSq(),l=Math.abs(1-o*o);let u,h,p,d;if(l>0)if(u=o*a-s,h=o*s-a,d=i*l,u>=0)if(h>=-d)if(h<=d){const e=1/l;u*=e,h*=e,p=u*(u+o*h+2*s)+h*(o*u+h+2*a)+c}else h=i,u=Math.max(0,-(o*h+s)),p=-u*u+h*(h+2*a)+c;else h=-i,u=Math.max(0,-(o*h+s)),p=-u*u+h*(h+2*a)+c;else h<=-d?(u=Math.max(0,-(-o*i+s)),h=u>0?-i:Math.min(Math.max(-i,-a),i),p=-u*u+h*(h+2*a)+c):h<=d?(u=0,h=Math.min(Math.max(-i,-a),i),p=h*(h+2*a)+c):(u=Math.max(0,-(o*i+s)),h=u>0?i:Math.min(Math.max(-i,-a),i),p=-u*u+h*(h+2*a)+c);else h=o>0?-i:i,u=Math.max(0,-(o*h+s)),p=-u*u+h*(h+2*a)+c;return r&&r.copy(this.origin).addScaledVector(this.direction,u),n&&n.copy(ti).addScaledVector(ri,h),p}intersectSphere(e,t){ei.subVectors(e.center,this.origin);const r=ei.dot(this.direction),n=ei.dot(ei)-r*r,i=e.radius*e.radius;if(n>i)return null;const o=Math.sqrt(i-n),s=r-o,a=r+o;return a<0?null:s<0?this.at(a,t):this.at(s,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;const r=-(this.origin.dot(e.normal)+e.constant)/t;return r>=0?r:null}intersectPlane(e,t){const r=this.distanceToPlane(e);return null===r?null:this.at(r,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);if(0===t)return!0;return e.normal.dot(this.direction)*t<0}intersectBox(e,t){let r,n,i,o,s,a;const c=1/this.direction.x,l=1/this.direction.y,u=1/this.direction.z,h=this.origin;return c>=0?(r=(e.min.x-h.x)*c,n=(e.max.x-h.x)*c):(r=(e.max.x-h.x)*c,n=(e.min.x-h.x)*c),l>=0?(i=(e.min.y-h.y)*l,o=(e.max.y-h.y)*l):(i=(e.max.y-h.y)*l,o=(e.min.y-h.y)*l),r>o||i>n?null:((i>r||isNaN(r))&&(r=i),(o<n||isNaN(n))&&(n=o),u>=0?(s=(e.min.z-h.z)*u,a=(e.max.z-h.z)*u):(s=(e.max.z-h.z)*u,a=(e.min.z-h.z)*u),r>a||s>n?null:((s>r||r!=r)&&(r=s),(a<n||n!=n)&&(n=a),n<0?null:this.at(r>=0?r:n,t)))}intersectsBox(e){return null!==this.intersectBox(e,ei)}intersectTriangle(e,t,r,n,i){ii.subVectors(t,e),oi.subVectors(r,e),si.crossVectors(ii,oi);let o,s=this.direction.dot(si);if(s>0){if(n)return null;o=1}else{if(!(s<0))return null;o=-1,s=-s}ni.subVectors(this.origin,e);const a=o*this.direction.dot(oi.crossVectors(ni,oi));if(a<0)return null;const c=o*this.direction.dot(ii.cross(ni));if(c<0)return null;if(a+c>s)return null;const l=-o*ni.dot(si);return l<0?null:this.at(l/s,i)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class ci{constructor(e,t,r,n,i,o,s,a,c,l,u,h,p,d,f,m){ci.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],void 0!==e&&this.set(e,t,r,n,i,o,s,a,c,l,u,h,p,d,f,m)}set(e,t,r,n,i,o,s,a,c,l,u,h,p,d,f,m){const g=this.elements;return g[0]=e,g[4]=t,g[8]=r,g[12]=n,g[1]=i,g[5]=o,g[9]=s,g[13]=a,g[2]=c,g[6]=l,g[10]=u,g[14]=h,g[3]=p,g[7]=d,g[11]=f,g[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new ci).fromArray(this.elements)}copy(e){const t=this.elements,r=e.elements;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t[9]=r[9],t[10]=r[10],t[11]=r[11],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],this}copyPosition(e){const t=this.elements,r=e.elements;return t[12]=r[12],t[13]=r[13],t[14]=r[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,r){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this}makeBasis(e,t,r){return this.set(e.x,t.x,r.x,0,e.y,t.y,r.y,0,e.z,t.z,r.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,r=e.elements,n=1/li.setFromMatrixColumn(e,0).length(),i=1/li.setFromMatrixColumn(e,1).length(),o=1/li.setFromMatrixColumn(e,2).length();return t[0]=r[0]*n,t[1]=r[1]*n,t[2]=r[2]*n,t[3]=0,t[4]=r[4]*i,t[5]=r[5]*i,t[6]=r[6]*i,t[7]=0,t[8]=r[8]*o,t[9]=r[9]*o,t[10]=r[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,r=e.x,n=e.y,i=e.z,o=Math.cos(r),s=Math.sin(r),a=Math.cos(n),c=Math.sin(n),l=Math.cos(i),u=Math.sin(i);if("XYZ"===e.order){const e=o*l,r=o*u,n=s*l,i=s*u;t[0]=a*l,t[4]=-a*u,t[8]=c,t[1]=r+n*c,t[5]=e-i*c,t[9]=-s*a,t[2]=i-e*c,t[6]=n+r*c,t[10]=o*a}else if("YXZ"===e.order){const e=a*l,r=a*u,n=c*l,i=c*u;t[0]=e+i*s,t[4]=n*s-r,t[8]=o*c,t[1]=o*u,t[5]=o*l,t[9]=-s,t[2]=r*s-n,t[6]=i+e*s,t[10]=o*a}else if("ZXY"===e.order){const e=a*l,r=a*u,n=c*l,i=c*u;t[0]=e-i*s,t[4]=-o*u,t[8]=n+r*s,t[1]=r+n*s,t[5]=o*l,t[9]=i-e*s,t[2]=-o*c,t[6]=s,t[10]=o*a}else if("ZYX"===e.order){const e=o*l,r=o*u,n=s*l,i=s*u;t[0]=a*l,t[4]=n*c-r,t[8]=e*c+i,t[1]=a*u,t[5]=i*c+e,t[9]=r*c-n,t[2]=-c,t[6]=s*a,t[10]=o*a}else if("YZX"===e.order){const e=o*a,r=o*c,n=s*a,i=s*c;t[0]=a*l,t[4]=i-e*u,t[8]=n*u+r,t[1]=u,t[5]=o*l,t[9]=-s*l,t[2]=-c*l,t[6]=r*u+n,t[10]=e-i*u}else if("XZY"===e.order){const e=o*a,r=o*c,n=s*a,i=s*c;t[0]=a*l,t[4]=-u,t[8]=c*l,t[1]=e*u+i,t[5]=o*l,t[9]=r*u-n,t[2]=n*u-r,t[6]=s*l,t[10]=i*u+e}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(hi,e,pi)}lookAt(e,t,r){const n=this.elements;return mi.subVectors(e,t),0===mi.lengthSq()&&(mi.z=1),mi.normalize(),di.crossVectors(r,mi),0===di.lengthSq()&&(1===Math.abs(r.z)?mi.x+=1e-4:mi.z+=1e-4,mi.normalize(),di.crossVectors(r,mi)),di.normalize(),fi.crossVectors(mi,di),n[0]=di.x,n[4]=fi.x,n[8]=mi.x,n[1]=di.y,n[5]=fi.y,n[9]=mi.y,n[2]=di.z,n[6]=fi.z,n[10]=mi.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const r=e.elements,n=t.elements,i=this.elements,o=r[0],s=r[4],a=r[8],c=r[12],l=r[1],u=r[5],h=r[9],p=r[13],d=r[2],f=r[6],m=r[10],g=r[14],y=r[3],v=r[7],_=r[11],b=r[15],x=n[0],w=n[4],S=n[8],M=n[12],T=n[1],E=n[5],A=n[9],R=n[13],C=n[2],I=n[6],O=n[10],P=n[14],N=n[3],L=n[7],U=n[11],D=n[15];return i[0]=o*x+s*T+a*C+c*N,i[4]=o*w+s*E+a*I+c*L,i[8]=o*S+s*A+a*O+c*U,i[12]=o*M+s*R+a*P+c*D,i[1]=l*x+u*T+h*C+p*N,i[5]=l*w+u*E+h*I+p*L,i[9]=l*S+u*A+h*O+p*U,i[13]=l*M+u*R+h*P+p*D,i[2]=d*x+f*T+m*C+g*N,i[6]=d*w+f*E+m*I+g*L,i[10]=d*S+f*A+m*O+g*U,i[14]=d*M+f*R+m*P+g*D,i[3]=y*x+v*T+_*C+b*N,i[7]=y*w+v*E+_*I+b*L,i[11]=y*S+v*A+_*O+b*U,i[15]=y*M+v*R+_*P+b*D,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],r=e[4],n=e[8],i=e[12],o=e[1],s=e[5],a=e[9],c=e[13],l=e[2],u=e[6],h=e[10],p=e[14];return e[3]*(+i*a*u-n*c*u-i*s*h+r*c*h+n*s*p-r*a*p)+e[7]*(+t*a*p-t*c*h+i*o*h-n*o*p+n*c*l-i*a*l)+e[11]*(+t*c*u-t*s*p-i*o*u+r*o*p+i*s*l-r*c*l)+e[15]*(-n*s*l-t*a*u+t*s*h+n*o*u-r*o*h+r*a*l)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,r){const n=this.elements;return e.isVector3?(n[12]=e.x,n[13]=e.y,n[14]=e.z):(n[12]=e,n[13]=t,n[14]=r),this}invert(){const e=this.elements,t=e[0],r=e[1],n=e[2],i=e[3],o=e[4],s=e[5],a=e[6],c=e[7],l=e[8],u=e[9],h=e[10],p=e[11],d=e[12],f=e[13],m=e[14],g=e[15],y=u*m*c-f*h*c+f*a*p-s*m*p-u*a*g+s*h*g,v=d*h*c-l*m*c-d*a*p+o*m*p+l*a*g-o*h*g,_=l*f*c-d*u*c+d*s*p-o*f*p-l*s*g+o*u*g,b=d*u*a-l*f*a-d*s*h+o*f*h+l*s*m-o*u*m,x=t*y+r*v+n*_+i*b;if(0===x)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const w=1/x;return e[0]=y*w,e[1]=(f*h*i-u*m*i-f*n*p+r*m*p+u*n*g-r*h*g)*w,e[2]=(s*m*i-f*a*i+f*n*c-r*m*c-s*n*g+r*a*g)*w,e[3]=(u*a*i-s*h*i-u*n*c+r*h*c+s*n*p-r*a*p)*w,e[4]=v*w,e[5]=(l*m*i-d*h*i+d*n*p-t*m*p-l*n*g+t*h*g)*w,e[6]=(d*a*i-o*m*i-d*n*c+t*m*c+o*n*g-t*a*g)*w,e[7]=(o*h*i-l*a*i+l*n*c-t*h*c-o*n*p+t*a*p)*w,e[8]=_*w,e[9]=(d*u*i-l*f*i-d*r*p+t*f*p+l*r*g-t*u*g)*w,e[10]=(o*f*i-d*s*i+d*r*c-t*f*c-o*r*g+t*s*g)*w,e[11]=(l*s*i-o*u*i-l*r*c+t*u*c+o*r*p-t*s*p)*w,e[12]=b*w,e[13]=(l*f*n-d*u*n+d*r*h-t*f*h-l*r*m+t*u*m)*w,e[14]=(d*s*n-o*f*n-d*r*a+t*f*a+o*r*m-t*s*m)*w,e[15]=(o*u*n-l*s*n+l*r*a-t*u*a-o*r*h+t*s*h)*w,this}scale(e){const t=this.elements,r=e.x,n=e.y,i=e.z;return t[0]*=r,t[4]*=n,t[8]*=i,t[1]*=r,t[5]*=n,t[9]*=i,t[2]*=r,t[6]*=n,t[10]*=i,t[3]*=r,t[7]*=n,t[11]*=i,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],r=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],n=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,r,n))}makeTranslation(e,t,r){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,r,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),r=Math.sin(e);return this.set(1,0,0,0,0,t,-r,0,0,r,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),r=Math.sin(e);return this.set(t,0,r,0,0,1,0,0,-r,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),r=Math.sin(e);return this.set(t,-r,0,0,r,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const r=Math.cos(t),n=Math.sin(t),i=1-r,o=e.x,s=e.y,a=e.z,c=i*o,l=i*s;return this.set(c*o+r,c*s-n*a,c*a+n*s,0,c*s+n*a,l*s+r,l*a-n*o,0,c*a-n*s,l*a+n*o,i*a*a+r,0,0,0,0,1),this}makeScale(e,t,r){return this.set(e,0,0,0,0,t,0,0,0,0,r,0,0,0,0,1),this}makeShear(e,t,r,n,i,o){return this.set(1,r,i,0,e,1,o,0,t,n,1,0,0,0,0,1),this}compose(e,t,r){const n=this.elements,i=t._x,o=t._y,s=t._z,a=t._w,c=i+i,l=o+o,u=s+s,h=i*c,p=i*l,d=i*u,f=o*l,m=o*u,g=s*u,y=a*c,v=a*l,_=a*u,b=r.x,x=r.y,w=r.z;return n[0]=(1-(f+g))*b,n[1]=(p+_)*b,n[2]=(d-v)*b,n[3]=0,n[4]=(p-_)*x,n[5]=(1-(h+g))*x,n[6]=(m+y)*x,n[7]=0,n[8]=(d+v)*w,n[9]=(m-y)*w,n[10]=(1-(h+f))*w,n[11]=0,n[12]=e.x,n[13]=e.y,n[14]=e.z,n[15]=1,this}decompose(e,t,r){const n=this.elements;let i=li.set(n[0],n[1],n[2]).length();const o=li.set(n[4],n[5],n[6]).length(),s=li.set(n[8],n[9],n[10]).length();this.determinant()<0&&(i=-i),e.x=n[12],e.y=n[13],e.z=n[14],ui.copy(this);const a=1/i,c=1/o,l=1/s;return ui.elements[0]*=a,ui.elements[1]*=a,ui.elements[2]*=a,ui.elements[4]*=c,ui.elements[5]*=c,ui.elements[6]*=c,ui.elements[8]*=l,ui.elements[9]*=l,ui.elements[10]*=l,t.setFromRotationMatrix(ui),r.x=i,r.y=o,r.z=s,this}makePerspective(e,t,r,n,i,o,s=kr){const a=this.elements,c=2*i/(t-e),l=2*i/(r-n),u=(t+e)/(t-e),h=(r+n)/(r-n);let p,d;if(s===kr)p=-(o+i)/(o-i),d=-2*o*i/(o-i);else{if(s!==jr)throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+s);p=-o/(o-i),d=-o*i/(o-i)}return a[0]=c,a[4]=0,a[8]=u,a[12]=0,a[1]=0,a[5]=l,a[9]=h,a[13]=0,a[2]=0,a[6]=0,a[10]=p,a[14]=d,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this}makeOrthographic(e,t,r,n,i,o,s=kr){const a=this.elements,c=1/(t-e),l=1/(r-n),u=1/(o-i),h=(t+e)*c,p=(r+n)*l;let d,f;if(s===kr)d=(o+i)*u,f=-2*u;else{if(s!==jr)throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+s);d=i*u,f=-1*u}return a[0]=2*c,a[4]=0,a[8]=0,a[12]=-h,a[1]=0,a[5]=2*l,a[9]=0,a[13]=-p,a[2]=0,a[6]=0,a[10]=f,a[14]=-d,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this}equals(e){const t=this.elements,r=e.elements;for(let e=0;e<16;e++)if(t[e]!==r[e])return!1;return!0}fromArray(e,t=0){for(let r=0;r<16;r++)this.elements[r]=e[r+t];return this}toArray(e=[],t=0){const r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e[t+9]=r[9],e[t+10]=r[10],e[t+11]=r[11],e[t+12]=r[12],e[t+13]=r[13],e[t+14]=r[14],e[t+15]=r[15],e}}const li=new Pn,ui=new ci,hi=new Pn(0,0,0),pi=new Pn(1,1,1),di=new Pn,fi=new Pn,mi=new Pn,gi=new ci,yi=new On;class vi{constructor(e=0,t=0,r=0,n=vi.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=r,this._order=n}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,r,n=this._order){return this._x=e,this._y=t,this._z=r,this._order=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,r=!0){const n=e.elements,i=n[0],o=n[4],s=n[8],a=n[1],c=n[5],l=n[9],u=n[2],h=n[6],p=n[10];switch(t){case"XYZ":this._y=Math.asin(Yr(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(-l,p),this._z=Math.atan2(-o,i)):(this._x=Math.atan2(h,c),this._z=0);break;case"YXZ":this._x=Math.asin(-Yr(l,-1,1)),Math.abs(l)<.9999999?(this._y=Math.atan2(s,p),this._z=Math.atan2(a,c)):(this._y=Math.atan2(-u,i),this._z=0);break;case"ZXY":this._x=Math.asin(Yr(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(-u,p),this._z=Math.atan2(-o,c)):(this._y=0,this._z=Math.atan2(a,i));break;case"ZYX":this._y=Math.asin(-Yr(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(h,p),this._z=Math.atan2(a,i)):(this._x=0,this._z=Math.atan2(-o,c));break;case"YZX":this._z=Math.asin(Yr(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-l,c),this._y=Math.atan2(-u,i)):(this._x=0,this._y=Math.atan2(s,p));break;case"XZY":this._z=Math.asin(-Yr(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(h,c),this._y=Math.atan2(s,i)):(this._x=Math.atan2(-l,p),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!0===r&&this._onChangeCallback(),this}setFromQuaternion(e,t,r){return gi.makeRotationFromQuaternion(e),this.setFromRotationMatrix(gi,t,r)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return yi.setFromEuler(this),this.setFromQuaternion(yi,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}vi.DEFAULT_ORDER="XYZ";class _i{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return 0!=(this.mask&e.mask)}isEnabled(e){return 0!=(this.mask&(1<<e|0))}}let bi=0;const xi=new Pn,wi=new On,Si=new ci,Mi=new Pn,Ti=new Pn,Ei=new Pn,Ai=new On,Ri=new Pn(1,0,0),Ci=new Pn(0,1,0),Ii=new Pn(0,0,1),Oi={type:"added"},Pi={type:"removed"},Ni={type:"childadded",child:null},Li={type:"childremoved",child:null};class Ui extends Gr{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:bi++}),this.uuid=Xr(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Ui.DEFAULT_UP.clone();const e=new Pn,t=new vi,r=new On,n=new Pn(1,1,1);t._onChange((function(){r.setFromEuler(t,!1)})),r._onChange((function(){t.setFromQuaternion(r,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:r},scale:{configurable:!0,enumerable:!0,value:n},modelViewMatrix:{value:new ci},normalMatrix:{value:new en}}),this.matrix=new ci,this.matrixWorld=new ci,this.matrixAutoUpdate=Ui.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Ui.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new _i,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return wi.setFromAxisAngle(e,t),this.quaternion.multiply(wi),this}rotateOnWorldAxis(e,t){return wi.setFromAxisAngle(e,t),this.quaternion.premultiply(wi),this}rotateX(e){return this.rotateOnAxis(Ri,e)}rotateY(e){return this.rotateOnAxis(Ci,e)}rotateZ(e){return this.rotateOnAxis(Ii,e)}translateOnAxis(e,t){return xi.copy(e).applyQuaternion(this.quaternion),this.position.add(xi.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(Ri,e)}translateY(e){return this.translateOnAxis(Ci,e)}translateZ(e){return this.translateOnAxis(Ii,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(Si.copy(this.matrixWorld).invert())}lookAt(e,t,r){e.isVector3?Mi.copy(e):Mi.set(e,t,r);const n=this.parent;this.updateWorldMatrix(!0,!1),Ti.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Si.lookAt(Ti,Mi,this.up):Si.lookAt(Mi,Ti,this.up),this.quaternion.setFromRotationMatrix(Si),n&&(Si.extractRotation(n.matrixWorld),wi.setFromRotationMatrix(Si),this.quaternion.premultiply(wi.invert()))}add(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(Oi),Ni.child=e,this.dispatchEvent(Ni),Ni.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}const t=this.children.indexOf(e);return-1!==t&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(Pi),Li.child=e,this.dispatchEvent(Li),Li.child=null),this}removeFromParent(){const e=this.parent;return null!==e&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),Si.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),Si.multiply(e.parent.matrixWorld)),e.applyMatrix4(Si),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(Oi),Ni.child=e,this.dispatchEvent(Ni),Ni.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let r=0,n=this.children.length;r<n;r++){const n=this.children[r].getObjectByProperty(e,t);if(void 0!==n)return n}}getObjectsByProperty(e,t,r=[]){this[e]===t&&r.push(this);const n=this.children;for(let i=0,o=n.length;i<o;i++)n[i].getObjectsByProperty(e,t,r);return r}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Ti,e,Ei),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Ti,Ai,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let r=0,n=t.length;r<n;r++)t[r].traverse(e)}traverseVisible(e){if(!1===this.visible)return;e(this);const t=this.children;for(let r=0,n=t.length;r<n;r++)t[r].traverseVisible(e)}traverseAncestors(e){const t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let r=0,n=t.length;r<n;r++){const n=t[r];!0!==n.matrixWorldAutoUpdate&&!0!==e||n.updateMatrixWorld(e)}}updateWorldMatrix(e,t){const r=this.parent;if(!0===e&&null!==r&&!0===r.matrixWorldAutoUpdate&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t){const e=this.children;for(let t=0,r=e.length;t<r;t++){const r=e[t];!0===r.matrixWorldAutoUpdate&&r.updateWorldMatrix(!1,!0)}}}toJSON(e){const t=void 0===e||"string"==typeof e,r={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},r.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const n={};function i(t,r){return void 0===t[r.uuid]&&(t[r.uuid]=r.toJSON(e)),r.uuid}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),!0===this.castShadow&&(n.castShadow=!0),!0===this.receiveShadow&&(n.receiveShadow=!0),!1===this.visible&&(n.visible=!1),!1===this.frustumCulled&&(n.frustumCulled=!1),0!==this.renderOrder&&(n.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(n.userData=this.userData),n.layers=this.layers.mask,n.matrix=this.matrix.toArray(),n.up=this.up.toArray(),!1===this.matrixAutoUpdate&&(n.matrixAutoUpdate=!1),this.isInstancedMesh&&(n.type="InstancedMesh",n.count=this.count,n.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(n.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(n.type="BatchedMesh",n.perObjectFrustumCulled=this.perObjectFrustumCulled,n.sortObjects=this.sortObjects,n.drawRanges=this._drawRanges,n.reservedRanges=this._reservedRanges,n.visibility=this._visibility,n.active=this._active,n.bounds=this._bounds.map((e=>({boxInitialized:e.boxInitialized,boxMin:e.box.min.toArray(),boxMax:e.box.max.toArray(),sphereInitialized:e.sphereInitialized,sphereRadius:e.sphere.radius,sphereCenter:e.sphere.center.toArray()}))),n.maxGeometryCount=this._maxGeometryCount,n.maxVertexCount=this._maxVertexCount,n.maxIndexCount=this._maxIndexCount,n.geometryInitialized=this._geometryInitialized,n.geometryCount=this._geometryCount,n.matricesTexture=this._matricesTexture.toJSON(e),null!==this._colorsTexture&&(n.colorsTexture=this._colorsTexture.toJSON(e)),null!==this.boundingSphere&&(n.boundingSphere={center:n.boundingSphere.center.toArray(),radius:n.boundingSphere.radius}),null!==this.boundingBox&&(n.boundingBox={min:n.boundingBox.min.toArray(),max:n.boundingBox.max.toArray()})),this.isScene)this.background&&(this.background.isColor?n.background=this.background.toJSON():this.background.isTexture&&(n.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(n.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){n.geometry=i(e.geometries,this.geometry);const t=this.geometry.parameters;if(void 0!==t&&void 0!==t.shapes){const r=t.shapes;if(Array.isArray(r))for(let t=0,n=r.length;t<n;t++){const n=r[t];i(e.shapes,n)}else i(e.shapes,r)}}if(this.isSkinnedMesh&&(n.bindMode=this.bindMode,n.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(i(e.skeletons,this.skeleton),n.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const t=[];for(let r=0,n=this.material.length;r<n;r++)t.push(i(e.materials,this.material[r]));n.material=t}else n.material=i(e.materials,this.material);if(this.children.length>0){n.children=[];for(let t=0;t<this.children.length;t++)n.children.push(this.children[t].toJSON(e).object)}if(this.animations.length>0){n.animations=[];for(let t=0;t<this.animations.length;t++){const r=this.animations[t];n.animations.push(i(e.animations,r))}}if(t){const t=o(e.geometries),n=o(e.materials),i=o(e.textures),s=o(e.images),a=o(e.shapes),c=o(e.skeletons),l=o(e.animations),u=o(e.nodes);t.length>0&&(r.geometries=t),n.length>0&&(r.materials=n),i.length>0&&(r.textures=i),s.length>0&&(r.images=s),a.length>0&&(r.shapes=a),c.length>0&&(r.skeletons=c),l.length>0&&(r.animations=l),u.length>0&&(r.nodes=u)}return r.object=n,r;function o(e){const t=[];for(const r in e){const n=e[r];delete n.metadata,t.push(n)}return t}}clone(e){return(new this.constructor).copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(let t=0;t<e.children.length;t++){const r=e.children[t];this.add(r.clone())}return this}}Ui.DEFAULT_UP=new Pn(0,1,0),Ui.DEFAULT_MATRIX_AUTO_UPDATE=!0,Ui.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const Di=new Pn,Fi=new Pn,Bi=new Pn,ki=new Pn,ji=new Pn,Gi=new Pn,zi=new Pn,Vi=new Pn,Hi=new Pn,Wi=new Pn;class Xi{constructor(e=new Pn,t=new Pn,r=new Pn){this.a=e,this.b=t,this.c=r}static getNormal(e,t,r,n){n.subVectors(r,t),Di.subVectors(e,t),n.cross(Di);const i=n.lengthSq();return i>0?n.multiplyScalar(1/Math.sqrt(i)):n.set(0,0,0)}static getBarycoord(e,t,r,n,i){Di.subVectors(n,t),Fi.subVectors(r,t),Bi.subVectors(e,t);const o=Di.dot(Di),s=Di.dot(Fi),a=Di.dot(Bi),c=Fi.dot(Fi),l=Fi.dot(Bi),u=o*c-s*s;if(0===u)return i.set(0,0,0),null;const h=1/u,p=(c*a-s*l)*h,d=(o*l-s*a)*h;return i.set(1-p-d,d,p)}static containsPoint(e,t,r,n){return null!==this.getBarycoord(e,t,r,n,ki)&&(ki.x>=0&&ki.y>=0&&ki.x+ki.y<=1)}static getInterpolation(e,t,r,n,i,o,s,a){return null===this.getBarycoord(e,t,r,n,ki)?(a.x=0,a.y=0,"z"in a&&(a.z=0),"w"in a&&(a.w=0),null):(a.setScalar(0),a.addScaledVector(i,ki.x),a.addScaledVector(o,ki.y),a.addScaledVector(s,ki.z),a)}static isFrontFacing(e,t,r,n){return Di.subVectors(r,t),Fi.subVectors(e,t),Di.cross(Fi).dot(n)<0}set(e,t,r){return this.a.copy(e),this.b.copy(t),this.c.copy(r),this}setFromPointsAndIndices(e,t,r,n){return this.a.copy(e[t]),this.b.copy(e[r]),this.c.copy(e[n]),this}setFromAttributeAndIndices(e,t,r,n){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,r),this.c.fromBufferAttribute(e,n),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return Di.subVectors(this.c,this.b),Fi.subVectors(this.a,this.b),.5*Di.cross(Fi).length()}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Xi.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return Xi.getBarycoord(e,this.a,this.b,this.c,t)}getInterpolation(e,t,r,n,i){return Xi.getInterpolation(e,this.a,this.b,this.c,t,r,n,i)}containsPoint(e){return Xi.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Xi.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const r=this.a,n=this.b,i=this.c;let o,s;ji.subVectors(n,r),Gi.subVectors(i,r),Vi.subVectors(e,r);const a=ji.dot(Vi),c=Gi.dot(Vi);if(a<=0&&c<=0)return t.copy(r);Hi.subVectors(e,n);const l=ji.dot(Hi),u=Gi.dot(Hi);if(l>=0&&u<=l)return t.copy(n);const h=a*u-l*c;if(h<=0&&a>=0&&l<=0)return o=a/(a-l),t.copy(r).addScaledVector(ji,o);Wi.subVectors(e,i);const p=ji.dot(Wi),d=Gi.dot(Wi);if(d>=0&&p<=d)return t.copy(i);const f=p*c-a*d;if(f<=0&&c>=0&&d<=0)return s=c/(c-d),t.copy(r).addScaledVector(Gi,s);const m=l*d-p*u;if(m<=0&&u-l>=0&&p-d>=0)return zi.subVectors(i,n),s=(u-l)/(u-l+(p-d)),t.copy(n).addScaledVector(zi,s);const g=1/(m+f+h);return o=f*g,s=h*g,t.copy(r).addScaledVector(ji,o).addScaledVector(Gi,s)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const Yi={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},qi={h:0,s:0,l:0},Ji={h:0,s:0,l:0};function Ki(e,t,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?e+6*(t-e)*r:r<.5?t:r<2/3?e+6*(t-e)*(2/3-r):e}class Zi{constructor(e,t,r){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,r)}set(e,t,r){if(void 0===t&&void 0===r){const t=e;t&&t.isColor?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t)}else this.setRGB(e,t,r);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=Kt){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,fn.toWorkingColorSpace(this,t),this}setRGB(e,t,r,n=fn.workingColorSpace){return this.r=e,this.g=t,this.b=r,fn.toWorkingColorSpace(this,n),this}setHSL(e,t,r,n=fn.workingColorSpace){if(e=qr(e,1),t=Yr(t,0,1),r=Yr(r,0,1),0===t)this.r=this.g=this.b=r;else{const n=r<=.5?r*(1+t):r+t-r*t,i=2*r-n;this.r=Ki(i,n,e+1/3),this.g=Ki(i,n,e),this.b=Ki(i,n,e-1/3)}return fn.toWorkingColorSpace(this,n),this}setStyle(e,t=Kt){function r(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let n;if(n=/^(\w+)\(([^\)]*)\)/.exec(e)){let i;const o=n[1],s=n[2];switch(o){case"rgb":case"rgba":if(i=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return r(i[4]),this.setRGB(Math.min(255,parseInt(i[1],10))/255,Math.min(255,parseInt(i[2],10))/255,Math.min(255,parseInt(i[3],10))/255,t);if(i=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return r(i[4]),this.setRGB(Math.min(100,parseInt(i[1],10))/100,Math.min(100,parseInt(i[2],10))/100,Math.min(100,parseInt(i[3],10))/100,t);break;case"hsl":case"hsla":if(i=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return r(i[4]),this.setHSL(parseFloat(i[1])/360,parseFloat(i[2])/100,parseFloat(i[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(n=/^\#([A-Fa-f\d]+)$/.exec(e)){const r=n[1],i=r.length;if(3===i)return this.setRGB(parseInt(r.charAt(0),16)/15,parseInt(r.charAt(1),16)/15,parseInt(r.charAt(2),16)/15,t);if(6===i)return this.setHex(parseInt(r,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=Kt){const r=Yi[e.toLowerCase()];return void 0!==r?this.setHex(r,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=mn(e.r),this.g=mn(e.g),this.b=mn(e.b),this}copyLinearToSRGB(e){return this.r=gn(e.r),this.g=gn(e.g),this.b=gn(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=Kt){return fn.fromWorkingColorSpace(Qi.copy(this),e),65536*Math.round(Yr(255*Qi.r,0,255))+256*Math.round(Yr(255*Qi.g,0,255))+Math.round(Yr(255*Qi.b,0,255))}getHexString(e=Kt){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=fn.workingColorSpace){fn.fromWorkingColorSpace(Qi.copy(this),t);const r=Qi.r,n=Qi.g,i=Qi.b,o=Math.max(r,n,i),s=Math.min(r,n,i);let a,c;const l=(s+o)/2;if(s===o)a=0,c=0;else{const e=o-s;switch(c=l<=.5?e/(o+s):e/(2-o-s),o){case r:a=(n-i)/e+(n<i?6:0);break;case n:a=(i-r)/e+2;break;case i:a=(r-n)/e+4}a/=6}return e.h=a,e.s=c,e.l=l,e}getRGB(e,t=fn.workingColorSpace){return fn.fromWorkingColorSpace(Qi.copy(this),t),e.r=Qi.r,e.g=Qi.g,e.b=Qi.b,e}getStyle(e=Kt){fn.fromWorkingColorSpace(Qi.copy(this),e);const t=Qi.r,r=Qi.g,n=Qi.b;return e!==Kt?`color(${e} ${t.toFixed(3)} ${r.toFixed(3)} ${n.toFixed(3)})`:`rgb(${Math.round(255*t)},${Math.round(255*r)},${Math.round(255*n)})`}offsetHSL(e,t,r){return this.getHSL(qi),this.setHSL(qi.h+e,qi.s+t,qi.l+r)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,r){return this.r=e.r+(t.r-e.r)*r,this.g=e.g+(t.g-e.g)*r,this.b=e.b+(t.b-e.b)*r,this}lerpHSL(e,t){this.getHSL(qi),e.getHSL(Ji);const r=Jr(qi.h,Ji.h,t),n=Jr(qi.s,Ji.s,t),i=Jr(qi.l,Ji.l,t);return this.setHSL(r,n,i),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,r=this.g,n=this.b,i=e.elements;return this.r=i[0]*t+i[3]*r+i[6]*n,this.g=i[1]*t+i[4]*r+i[7]*n,this.b=i[2]*t+i[5]*r+i[8]*n,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const Qi=new Zi;Zi.NAMES=Yi;let $i=0;class eo extends Gr{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:$i++}),this.uuid=Xr(),this.name="",this.type="Material",this.blending=v,this.side=f,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=P,this.blendDst=N,this.blendEquation=S,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new Zi(0,0,0),this.blendAlpha=0,this.depthFunc=X,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=_r,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=or,this.stencilZFail=or,this.stencilZPass=or,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(void 0!==e)for(const t in e){const r=e[t];if(void 0===r){console.warn(`THREE.Material: parameter '${t}' has value of undefined.`);continue}const n=this[t];void 0!==n?n&&n.isColor?n.set(r):n&&n.isVector3&&r&&r.isVector3?n.copy(r):this[t]=r:console.warn(`THREE.Material: '${t}' is not a property of THREE.${this.type}.`)}}toJSON(e){const t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});const r={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};function n(e){const t=[];for(const r in e){const n=e[r];delete n.metadata,t.push(n)}return t}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),this.color&&this.color.isColor&&(r.color=this.color.getHex()),void 0!==this.roughness&&(r.roughness=this.roughness),void 0!==this.metalness&&(r.metalness=this.metalness),void 0!==this.sheen&&(r.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(r.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(r.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(r.emissive=this.emissive.getHex()),void 0!==this.emissiveIntensity&&1!==this.emissiveIntensity&&(r.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(r.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(r.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(r.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(r.shininess=this.shininess),void 0!==this.clearcoat&&(r.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(r.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(r.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(r.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(r.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,r.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),void 0!==this.dispersion&&(r.dispersion=this.dispersion),void 0!==this.iridescence&&(r.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(r.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(r.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(r.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(r.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),void 0!==this.anisotropy&&(r.anisotropy=this.anisotropy),void 0!==this.anisotropyRotation&&(r.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(r.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(r.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(r.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(r.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(r.lightMap=this.lightMap.toJSON(e).uuid,r.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(r.aoMap=this.aoMap.toJSON(e).uuid,r.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(r.bumpMap=this.bumpMap.toJSON(e).uuid,r.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(r.normalMap=this.normalMap.toJSON(e).uuid,r.normalMapType=this.normalMapType,r.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(r.displacementMap=this.displacementMap.toJSON(e).uuid,r.displacementScale=this.displacementScale,r.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(r.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(r.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(r.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(r.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(r.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(r.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(r.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(r.combine=this.combine)),void 0!==this.envMapRotation&&(r.envMapRotation=this.envMapRotation.toArray()),void 0!==this.envMapIntensity&&(r.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(r.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(r.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(r.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.transmission&&(r.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(r.transmissionMap=this.transmissionMap.toJSON(e).uuid),void 0!==this.thickness&&(r.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(r.thicknessMap=this.thicknessMap.toJSON(e).uuid),void 0!==this.attenuationDistance&&this.attenuationDistance!==1/0&&(r.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(r.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(r.size=this.size),null!==this.shadowSide&&(r.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(r.sizeAttenuation=this.sizeAttenuation),this.blending!==v&&(r.blending=this.blending),this.side!==f&&(r.side=this.side),!0===this.vertexColors&&(r.vertexColors=!0),this.opacity<1&&(r.opacity=this.opacity),!0===this.transparent&&(r.transparent=!0),this.blendSrc!==P&&(r.blendSrc=this.blendSrc),this.blendDst!==N&&(r.blendDst=this.blendDst),this.blendEquation!==S&&(r.blendEquation=this.blendEquation),null!==this.blendSrcAlpha&&(r.blendSrcAlpha=this.blendSrcAlpha),null!==this.blendDstAlpha&&(r.blendDstAlpha=this.blendDstAlpha),null!==this.blendEquationAlpha&&(r.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(r.blendColor=this.blendColor.getHex()),0!==this.blendAlpha&&(r.blendAlpha=this.blendAlpha),this.depthFunc!==X&&(r.depthFunc=this.depthFunc),!1===this.depthTest&&(r.depthTest=this.depthTest),!1===this.depthWrite&&(r.depthWrite=this.depthWrite),!1===this.colorWrite&&(r.colorWrite=this.colorWrite),255!==this.stencilWriteMask&&(r.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==_r&&(r.stencilFunc=this.stencilFunc),0!==this.stencilRef&&(r.stencilRef=this.stencilRef),255!==this.stencilFuncMask&&(r.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==or&&(r.stencilFail=this.stencilFail),this.stencilZFail!==or&&(r.stencilZFail=this.stencilZFail),this.stencilZPass!==or&&(r.stencilZPass=this.stencilZPass),!0===this.stencilWrite&&(r.stencilWrite=this.stencilWrite),void 0!==this.rotation&&0!==this.rotation&&(r.rotation=this.rotation),!0===this.polygonOffset&&(r.polygonOffset=!0),0!==this.polygonOffsetFactor&&(r.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(r.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(r.linewidth=this.linewidth),void 0!==this.dashSize&&(r.dashSize=this.dashSize),void 0!==this.gapSize&&(r.gapSize=this.gapSize),void 0!==this.scale&&(r.scale=this.scale),!0===this.dithering&&(r.dithering=!0),this.alphaTest>0&&(r.alphaTest=this.alphaTest),!0===this.alphaHash&&(r.alphaHash=!0),!0===this.alphaToCoverage&&(r.alphaToCoverage=!0),!0===this.premultipliedAlpha&&(r.premultipliedAlpha=!0),!0===this.forceSinglePass&&(r.forceSinglePass=!0),!0===this.wireframe&&(r.wireframe=!0),this.wireframeLinewidth>1&&(r.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(r.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(r.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(r.flatShading=!0),!1===this.visible&&(r.visible=!1),!1===this.toneMapped&&(r.toneMapped=!1),!1===this.fog&&(r.fog=!1),Object.keys(this.userData).length>0&&(r.userData=this.userData),t){const t=n(e.textures),i=n(e.images);t.length>0&&(r.textures=t),i.length>0&&(r.images=i)}return r}clone(){return(new this.constructor).copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let r=null;if(null!==t){const e=t.length;r=new Array(e);for(let n=0;n!==e;++n)r[n]=t[n].clone()}return this.clippingPlanes=r,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){!0===e&&this.version++}}class to extends eo{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Zi(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new vi,this.combine=Z,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const ro=no();function no(){const e=new ArrayBuffer(4),t=new Float32Array(e),r=new Uint32Array(e),n=new Uint32Array(512),i=new Uint32Array(512);for(let e=0;e<256;++e){const t=e-127;t<-27?(n[e]=0,n[256|e]=32768,i[e]=24,i[256|e]=24):t<-14?(n[e]=1024>>-t-14,n[256|e]=1024>>-t-14|32768,i[e]=-t-1,i[256|e]=-t-1):t<=15?(n[e]=t+15<<10,n[256|e]=t+15<<10|32768,i[e]=13,i[256|e]=13):t<128?(n[e]=31744,n[256|e]=64512,i[e]=24,i[256|e]=24):(n[e]=31744,n[256|e]=64512,i[e]=13,i[256|e]=13)}const o=new Uint32Array(2048),s=new Uint32Array(64),a=new Uint32Array(64);for(let e=1;e<1024;++e){let t=e<<13,r=0;for(;0==(8388608&t);)t<<=1,r-=8388608;t&=-8388609,r+=947912704,o[e]=t|r}for(let e=1024;e<2048;++e)o[e]=939524096+(e-1024<<13);for(let e=1;e<31;++e)s[e]=e<<23;s[31]=1199570944,s[32]=2147483648;for(let e=33;e<63;++e)s[e]=2147483648+(e-32<<23);s[63]=3347054592;for(let e=1;e<64;++e)32!==e&&(a[e]=1024);return{floatView:t,uint32View:r,baseTable:n,shiftTable:i,mantissaTable:o,exponentTable:s,offsetTable:a}}function io(e){Math.abs(e)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),e=Yr(e,-65504,65504),ro.floatView[0]=e;const t=ro.uint32View[0],r=t>>23&511;return ro.baseTable[r]+((8388607&t)>>ro.shiftTable[r])}function oo(e){const t=e>>10;return ro.uint32View[0]=ro.mantissaTable[ro.offsetTable[t]+(1023&e)]+ro.exponentTable[t],ro.floatView[0]}const so={toHalfFloat:io,fromHalfFloat:oo},ao=new Pn,co=new $r;class lo{constructor(e,t,r=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=r,this.usage=Rr,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.gpuType=Ue,this.version=0}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}get updateRange(){return ln("THREE.BufferAttribute: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,r){e*=this.itemSize,r*=t.itemSize;for(let n=0,i=this.itemSize;n<i;n++)this.array[e+n]=t.array[r+n];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(2===this.itemSize)for(let t=0,r=this.count;t<r;t++)co.fromBufferAttribute(this,t),co.applyMatrix3(e),this.setXY(t,co.x,co.y);else if(3===this.itemSize)for(let t=0,r=this.count;t<r;t++)ao.fromBufferAttribute(this,t),ao.applyMatrix3(e),this.setXYZ(t,ao.x,ao.y,ao.z);return this}applyMatrix4(e){for(let t=0,r=this.count;t<r;t++)ao.fromBufferAttribute(this,t),ao.applyMatrix4(e),this.setXYZ(t,ao.x,ao.y,ao.z);return this}applyNormalMatrix(e){for(let t=0,r=this.count;t<r;t++)ao.fromBufferAttribute(this,t),ao.applyNormalMatrix(e),this.setXYZ(t,ao.x,ao.y,ao.z);return this}transformDirection(e){for(let t=0,r=this.count;t<r;t++)ao.fromBufferAttribute(this,t),ao.transformDirection(e),this.setXYZ(t,ao.x,ao.y,ao.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let r=this.array[e*this.itemSize+t];return this.normalized&&(r=Kr(r,this.array)),r}setComponent(e,t,r){return this.normalized&&(r=Zr(r,this.array)),this.array[e*this.itemSize+t]=r,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=Kr(t,this.array)),t}setX(e,t){return this.normalized&&(t=Zr(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=Kr(t,this.array)),t}setY(e,t){return this.normalized&&(t=Zr(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=Kr(t,this.array)),t}setZ(e,t){return this.normalized&&(t=Zr(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=Kr(t,this.array)),t}setW(e,t){return this.normalized&&(t=Zr(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,r){return e*=this.itemSize,this.normalized&&(t=Zr(t,this.array),r=Zr(r,this.array)),this.array[e+0]=t,this.array[e+1]=r,this}setXYZ(e,t,r,n){return e*=this.itemSize,this.normalized&&(t=Zr(t,this.array),r=Zr(r,this.array),n=Zr(n,this.array)),this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=n,this}setXYZW(e,t,r,n,i){return e*=this.itemSize,this.normalized&&(t=Zr(t,this.array),r=Zr(r,this.array),n=Zr(n,this.array),i=Zr(i,this.array)),this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=n,this.array[e+3]=i,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),this.usage!==Rr&&(e.usage=this.usage),e}}class uo extends lo{constructor(e,t,r){super(new Int8Array(e),t,r)}}class ho extends lo{constructor(e,t,r){super(new Uint8Array(e),t,r)}}class po extends lo{constructor(e,t,r){super(new Uint8ClampedArray(e),t,r)}}class fo extends lo{constructor(e,t,r){super(new Int16Array(e),t,r)}}class mo extends lo{constructor(e,t,r){super(new Uint16Array(e),t,r)}}class go extends lo{constructor(e,t,r){super(new Int32Array(e),t,r)}}class yo extends lo{constructor(e,t,r){super(new Uint32Array(e),t,r)}}class vo extends lo{constructor(e,t,r){super(new Uint16Array(e),t,r),this.isFloat16BufferAttribute=!0}getX(e){let t=oo(this.array[e*this.itemSize]);return this.normalized&&(t=Kr(t,this.array)),t}setX(e,t){return this.normalized&&(t=Zr(t,this.array)),this.array[e*this.itemSize]=io(t),this}getY(e){let t=oo(this.array[e*this.itemSize+1]);return this.normalized&&(t=Kr(t,this.array)),t}setY(e,t){return this.normalized&&(t=Zr(t,this.array)),this.array[e*this.itemSize+1]=io(t),this}getZ(e){let t=oo(this.array[e*this.itemSize+2]);return this.normalized&&(t=Kr(t,this.array)),t}setZ(e,t){return this.normalized&&(t=Zr(t,this.array)),this.array[e*this.itemSize+2]=io(t),this}getW(e){let t=oo(this.array[e*this.itemSize+3]);return this.normalized&&(t=Kr(t,this.array)),t}setW(e,t){return this.normalized&&(t=Zr(t,this.array)),this.array[e*this.itemSize+3]=io(t),this}setXY(e,t,r){return e*=this.itemSize,this.normalized&&(t=Zr(t,this.array),r=Zr(r,this.array)),this.array[e+0]=io(t),this.array[e+1]=io(r),this}setXYZ(e,t,r,n){return e*=this.itemSize,this.normalized&&(t=Zr(t,this.array),r=Zr(r,this.array),n=Zr(n,this.array)),this.array[e+0]=io(t),this.array[e+1]=io(r),this.array[e+2]=io(n),this}setXYZW(e,t,r,n,i){return e*=this.itemSize,this.normalized&&(t=Zr(t,this.array),r=Zr(r,this.array),n=Zr(n,this.array),i=Zr(i,this.array)),this.array[e+0]=io(t),this.array[e+1]=io(r),this.array[e+2]=io(n),this.array[e+3]=io(i),this}}class _o extends lo{constructor(e,t,r){super(new Float32Array(e),t,r)}}let bo=0;const xo=new ci,wo=new Ui,So=new Pn,Mo=new Un,To=new Un,Eo=new Pn;class Ao extends Gr{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:bo++}),this.uuid=Xr(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(rn(e)?yo:mo)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return void 0!==this.attributes[e]}addGroup(e,t,r=0){this.groups.push({start:e,count:t,materialIndex:r})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);const r=this.attributes.normal;if(void 0!==r){const t=(new en).getNormalMatrix(e);r.applyNormalMatrix(t),r.needsUpdate=!0}const n=this.attributes.tangent;return void 0!==n&&(n.transformDirection(e),n.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(e){return xo.makeRotationFromQuaternion(e),this.applyMatrix4(xo),this}rotateX(e){return xo.makeRotationX(e),this.applyMatrix4(xo),this}rotateY(e){return xo.makeRotationY(e),this.applyMatrix4(xo),this}rotateZ(e){return xo.makeRotationZ(e),this.applyMatrix4(xo),this}translate(e,t,r){return xo.makeTranslation(e,t,r),this.applyMatrix4(xo),this}scale(e,t,r){return xo.makeScale(e,t,r),this.applyMatrix4(xo),this}lookAt(e){return wo.lookAt(e),wo.updateMatrix(),this.applyMatrix4(wo.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(So).negate(),this.translate(So.x,So.y,So.z),this}setFromPoints(e){const t=[];for(let r=0,n=e.length;r<n;r++){const n=e[r];t.push(n.x,n.y,n.z||0)}return this.setAttribute("position",new _o(t,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new Un);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),void this.boundingBox.set(new Pn(-1/0,-1/0,-1/0),new Pn(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(let e=0,r=t.length;e<r;e++){const r=t[e];Mo.setFromBufferAttribute(r),this.morphTargetsRelative?(Eo.addVectors(this.boundingBox.min,Mo.min),this.boundingBox.expandByPoint(Eo),Eo.addVectors(this.boundingBox.max,Mo.max),this.boundingBox.expandByPoint(Eo)):(this.boundingBox.expandByPoint(Mo.min),this.boundingBox.expandByPoint(Mo.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new $n);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),void this.boundingSphere.set(new Pn,1/0);if(e){const r=this.boundingSphere.center;if(Mo.setFromBufferAttribute(e),t)for(let e=0,r=t.length;e<r;e++){const r=t[e];To.setFromBufferAttribute(r),this.morphTargetsRelative?(Eo.addVectors(Mo.min,To.min),Mo.expandByPoint(Eo),Eo.addVectors(Mo.max,To.max),Mo.expandByPoint(Eo)):(Mo.expandByPoint(To.min),Mo.expandByPoint(To.max))}Mo.getCenter(r);let n=0;for(let t=0,i=e.count;t<i;t++)Eo.fromBufferAttribute(e,t),n=Math.max(n,r.distanceToSquared(Eo));if(t)for(let i=0,o=t.length;i<o;i++){const o=t[i],s=this.morphTargetsRelative;for(let t=0,i=o.count;t<i;t++)Eo.fromBufferAttribute(o,t),s&&(So.fromBufferAttribute(e,t),Eo.add(So)),n=Math.max(n,r.distanceToSquared(Eo))}this.boundingSphere.radius=Math.sqrt(n),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(null===e||void 0===t.position||void 0===t.normal||void 0===t.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const r=t.position,n=t.normal,i=t.uv;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new lo(new Float32Array(4*r.count),4));const o=this.getAttribute("tangent"),s=[],a=[];for(let e=0;e<r.count;e++)s[e]=new Pn,a[e]=new Pn;const c=new Pn,l=new Pn,u=new Pn,h=new $r,p=new $r,d=new $r,f=new Pn,m=new Pn;function g(e,t,n){c.fromBufferAttribute(r,e),l.fromBufferAttribute(r,t),u.fromBufferAttribute(r,n),h.fromBufferAttribute(i,e),p.fromBufferAttribute(i,t),d.fromBufferAttribute(i,n),l.sub(c),u.sub(c),p.sub(h),d.sub(h);const o=1/(p.x*d.y-d.x*p.y);isFinite(o)&&(f.copy(l).multiplyScalar(d.y).addScaledVector(u,-p.y).multiplyScalar(o),m.copy(u).multiplyScalar(p.x).addScaledVector(l,-d.x).multiplyScalar(o),s[e].add(f),s[t].add(f),s[n].add(f),a[e].add(m),a[t].add(m),a[n].add(m))}let y=this.groups;0===y.length&&(y=[{start:0,count:e.count}]);for(let t=0,r=y.length;t<r;++t){const r=y[t],n=r.start;for(let t=n,i=n+r.count;t<i;t+=3)g(e.getX(t+0),e.getX(t+1),e.getX(t+2))}const v=new Pn,_=new Pn,b=new Pn,x=new Pn;function w(e){b.fromBufferAttribute(n,e),x.copy(b);const t=s[e];v.copy(t),v.sub(b.multiplyScalar(b.dot(t))).normalize(),_.crossVectors(x,t);const r=_.dot(a[e])<0?-1:1;o.setXYZW(e,v.x,v.y,v.z,r)}for(let t=0,r=y.length;t<r;++t){const r=y[t],n=r.start;for(let t=n,i=n+r.count;t<i;t+=3)w(e.getX(t+0)),w(e.getX(t+1)),w(e.getX(t+2))}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(void 0!==t){let r=this.getAttribute("normal");if(void 0===r)r=new lo(new Float32Array(3*t.count),3),this.setAttribute("normal",r);else for(let e=0,t=r.count;e<t;e++)r.setXYZ(e,0,0,0);const n=new Pn,i=new Pn,o=new Pn,s=new Pn,a=new Pn,c=new Pn,l=new Pn,u=new Pn;if(e)for(let h=0,p=e.count;h<p;h+=3){const p=e.getX(h+0),d=e.getX(h+1),f=e.getX(h+2);n.fromBufferAttribute(t,p),i.fromBufferAttribute(t,d),o.fromBufferAttribute(t,f),l.subVectors(o,i),u.subVectors(n,i),l.cross(u),s.fromBufferAttribute(r,p),a.fromBufferAttribute(r,d),c.fromBufferAttribute(r,f),s.add(l),a.add(l),c.add(l),r.setXYZ(p,s.x,s.y,s.z),r.setXYZ(d,a.x,a.y,a.z),r.setXYZ(f,c.x,c.y,c.z)}else for(let e=0,s=t.count;e<s;e+=3)n.fromBufferAttribute(t,e+0),i.fromBufferAttribute(t,e+1),o.fromBufferAttribute(t,e+2),l.subVectors(o,i),u.subVectors(n,i),l.cross(u),r.setXYZ(e+0,l.x,l.y,l.z),r.setXYZ(e+1,l.x,l.y,l.z),r.setXYZ(e+2,l.x,l.y,l.z);this.normalizeNormals(),r.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,r=e.count;t<r;t++)Eo.fromBufferAttribute(e,t),Eo.normalize(),e.setXYZ(t,Eo.x,Eo.y,Eo.z)}toNonIndexed(){function e(e,t){const r=e.array,n=e.itemSize,i=e.normalized,o=new r.constructor(t.length*n);let s=0,a=0;for(let i=0,c=t.length;i<c;i++){s=e.isInterleavedBufferAttribute?t[i]*e.data.stride+e.offset:t[i]*n;for(let e=0;e<n;e++)o[a++]=r[s++]}return new lo(o,n,i)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new Ao,r=this.index.array,n=this.attributes;for(const i in n){const o=e(n[i],r);t.setAttribute(i,o)}const i=this.morphAttributes;for(const n in i){const o=[],s=i[n];for(let t=0,n=s.length;t<n;t++){const n=e(s[t],r);o.push(n)}t.morphAttributes[n]=o}t.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let e=0,r=o.length;e<r;e++){const r=o[e];t.addGroup(r.start,r.count,r.materialIndex)}return t}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){const t=this.parameters;for(const r in t)void 0!==t[r]&&(e[r]=t[r]);return e}e.data={attributes:{}};const t=this.index;null!==t&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const r=this.attributes;for(const t in r){const n=r[t];e.data.attributes[t]=n.toJSON(e.data)}const n={};let i=!1;for(const t in this.morphAttributes){const r=this.morphAttributes[t],o=[];for(let t=0,n=r.length;t<n;t++){const n=r[t];o.push(n.toJSON(e.data))}o.length>0&&(n[t]=o,i=!0)}i&&(e.data.morphAttributes=n,e.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(e.data.groups=JSON.parse(JSON.stringify(o)));const s=this.boundingSphere;return null!==s&&(e.data.boundingSphere={center:s.center.toArray(),radius:s.radius}),e}clone(){return(new this.constructor).copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const r=e.index;null!==r&&this.setIndex(r.clone(t));const n=e.attributes;for(const e in n){const r=n[e];this.setAttribute(e,r.clone(t))}const i=e.morphAttributes;for(const e in i){const r=[],n=i[e];for(let e=0,i=n.length;e<i;e++)r.push(n[e].clone(t));this.morphAttributes[e]=r}this.morphTargetsRelative=e.morphTargetsRelative;const o=e.groups;for(let e=0,t=o.length;e<t;e++){const t=o[e];this.addGroup(t.start,t.count,t.materialIndex)}const s=e.boundingBox;null!==s&&(this.boundingBox=s.clone());const a=e.boundingSphere;return null!==a&&(this.boundingSphere=a.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const Ro=new ci,Co=new ai,Io=new $n,Oo=new Pn,Po=new Pn,No=new Pn,Lo=new Pn,Uo=new Pn,Do=new Pn,Fo=new $r,Bo=new $r,ko=new $r,jo=new Pn,Go=new Pn,zo=new Pn,Vo=new Pn,Ho=new Pn;class Wo extends Ui{constructor(e=new Ao,t=new to){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const r=e[t[0]];if(void 0!==r){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=r.length;e<t;e++){const t=r[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}getVertexPosition(e,t){const r=this.geometry,n=r.attributes.position,i=r.morphAttributes.position,o=r.morphTargetsRelative;t.fromBufferAttribute(n,e);const s=this.morphTargetInfluences;if(i&&s){Do.set(0,0,0);for(let r=0,n=i.length;r<n;r++){const n=s[r],a=i[r];0!==n&&(Uo.fromBufferAttribute(a,e),o?Do.addScaledVector(Uo,n):Do.addScaledVector(Uo.sub(t),n))}t.add(Do)}return t}raycast(e,t){const r=this.geometry,n=this.material,i=this.matrixWorld;if(void 0!==n){if(null===r.boundingSphere&&r.computeBoundingSphere(),Io.copy(r.boundingSphere),Io.applyMatrix4(i),Co.copy(e.ray).recast(e.near),!1===Io.containsPoint(Co.origin)){if(null===Co.intersectSphere(Io,Oo))return;if(Co.origin.distanceToSquared(Oo)>(e.far-e.near)**2)return}Ro.copy(i).invert(),Co.copy(e.ray).applyMatrix4(Ro),null!==r.boundingBox&&!1===Co.intersectsBox(r.boundingBox)||this._computeIntersections(e,t,Co)}}_computeIntersections(e,t,r){let n;const i=this.geometry,o=this.material,s=i.index,a=i.attributes.position,c=i.attributes.uv,l=i.attributes.uv1,u=i.attributes.normal,h=i.groups,p=i.drawRange;if(null!==s)if(Array.isArray(o))for(let i=0,a=h.length;i<a;i++){const a=h[i],d=o[a.materialIndex];for(let i=Math.max(a.start,p.start),o=Math.min(s.count,Math.min(a.start+a.count,p.start+p.count));i<o;i+=3){n=Xo(this,d,e,r,c,l,u,s.getX(i),s.getX(i+1),s.getX(i+2)),n&&(n.faceIndex=Math.floor(i/3),n.face.materialIndex=a.materialIndex,t.push(n))}}else{for(let i=Math.max(0,p.start),a=Math.min(s.count,p.start+p.count);i<a;i+=3){n=Xo(this,o,e,r,c,l,u,s.getX(i),s.getX(i+1),s.getX(i+2)),n&&(n.faceIndex=Math.floor(i/3),t.push(n))}}else if(void 0!==a)if(Array.isArray(o))for(let i=0,s=h.length;i<s;i++){const s=h[i],d=o[s.materialIndex];for(let i=Math.max(s.start,p.start),o=Math.min(a.count,Math.min(s.start+s.count,p.start+p.count));i<o;i+=3){n=Xo(this,d,e,r,c,l,u,i,i+1,i+2),n&&(n.faceIndex=Math.floor(i/3),n.face.materialIndex=s.materialIndex,t.push(n))}}else{for(let i=Math.max(0,p.start),s=Math.min(a.count,p.start+p.count);i<s;i+=3){n=Xo(this,o,e,r,c,l,u,i,i+1,i+2),n&&(n.faceIndex=Math.floor(i/3),t.push(n))}}}}function Xo(e,t,r,n,i,o,s,a,c,l){e.getVertexPosition(a,Po),e.getVertexPosition(c,No),e.getVertexPosition(l,Lo);const u=function(e,t,r,n,i,o,s,a){let c;if(c=t.side===m?n.intersectTriangle(s,o,i,!0,a):n.intersectTriangle(i,o,s,t.side===f,a),null===c)return null;Ho.copy(a),Ho.applyMatrix4(e.matrixWorld);const l=r.ray.origin.distanceTo(Ho);return l<r.near||l>r.far?null:{distance:l,point:Ho.clone(),object:e}}(e,t,r,n,Po,No,Lo,Vo);if(u){i&&(Fo.fromBufferAttribute(i,a),Bo.fromBufferAttribute(i,c),ko.fromBufferAttribute(i,l),u.uv=Xi.getInterpolation(Vo,Po,No,Lo,Fo,Bo,ko,new $r)),o&&(Fo.fromBufferAttribute(o,a),Bo.fromBufferAttribute(o,c),ko.fromBufferAttribute(o,l),u.uv1=Xi.getInterpolation(Vo,Po,No,Lo,Fo,Bo,ko,new $r)),s&&(jo.fromBufferAttribute(s,a),Go.fromBufferAttribute(s,c),zo.fromBufferAttribute(s,l),u.normal=Xi.getInterpolation(Vo,Po,No,Lo,jo,Go,zo,new Pn),u.normal.dot(n.direction)>0&&u.normal.multiplyScalar(-1));const e={a,b:c,c:l,normal:new Pn,materialIndex:0};Xi.getNormal(Po,No,Lo,e.normal),u.face=e}return u}class Yo extends Ao{constructor(e=1,t=1,r=1,n=1,i=1,o=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:r,widthSegments:n,heightSegments:i,depthSegments:o};const s=this;n=Math.floor(n),i=Math.floor(i),o=Math.floor(o);const a=[],c=[],l=[],u=[];let h=0,p=0;function d(e,t,r,n,i,o,d,f,m,g,y){const v=o/m,_=d/g,b=o/2,x=d/2,w=f/2,S=m+1,M=g+1;let T=0,E=0;const A=new Pn;for(let o=0;o<M;o++){const s=o*_-x;for(let a=0;a<S;a++){const h=a*v-b;A[e]=h*n,A[t]=s*i,A[r]=w,c.push(A.x,A.y,A.z),A[e]=0,A[t]=0,A[r]=f>0?1:-1,l.push(A.x,A.y,A.z),u.push(a/m),u.push(1-o/g),T+=1}}for(let e=0;e<g;e++)for(let t=0;t<m;t++){const r=h+t+S*e,n=h+t+S*(e+1),i=h+(t+1)+S*(e+1),o=h+(t+1)+S*e;a.push(r,n,o),a.push(n,i,o),E+=6}s.addGroup(p,E,y),p+=E,h+=T}d("z","y","x",-1,-1,r,t,e,o,i,0),d("z","y","x",1,-1,r,t,-e,o,i,1),d("x","z","y",1,1,e,r,t,n,o,2),d("x","z","y",1,-1,e,r,-t,n,o,3),d("x","y","z",1,-1,e,t,r,n,i,4),d("x","y","z",-1,-1,e,t,-r,n,i,5),this.setIndex(a),this.setAttribute("position",new _o(c,3)),this.setAttribute("normal",new _o(l,3)),this.setAttribute("uv",new _o(u,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Yo(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function qo(e){const t={};for(const r in e){t[r]={};for(const n in e[r]){const i=e[r][n];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture||i.isQuaternion)?i.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),t[r][n]=null):t[r][n]=i.clone():Array.isArray(i)?t[r][n]=i.slice():t[r][n]=i}}return t}function Jo(e){const t={};for(let r=0;r<e.length;r++){const n=qo(e[r]);for(const e in n)t[e]=n[e]}return t}function Ko(e){const t=e.getRenderTarget();return null===t?e.outputColorSpace:!0===t.isXRRenderTarget?t.texture.colorSpace:fn.workingColorSpace}const Zo={clone:qo,merge:Jo};class Qo extends eo{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=qo(e.uniforms),this.uniformsGroups=function(e){const t=[];for(let r=0;r<e.length;r++)t.push(e[r].clone());return t}(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const r in this.uniforms){const n=this.uniforms[r].value;n&&n.isTexture?t.uniforms[r]={type:"t",value:n.toJSON(e).uuid}:n&&n.isColor?t.uniforms[r]={type:"c",value:n.getHex()}:n&&n.isVector2?t.uniforms[r]={type:"v2",value:n.toArray()}:n&&n.isVector3?t.uniforms[r]={type:"v3",value:n.toArray()}:n&&n.isVector4?t.uniforms[r]={type:"v4",value:n.toArray()}:n&&n.isMatrix3?t.uniforms[r]={type:"m3",value:n.toArray()}:n&&n.isMatrix4?t.uniforms[r]={type:"m4",value:n.toArray()}:t.uniforms[r]={value:n}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const r={};for(const e in this.extensions)!0===this.extensions[e]&&(r[e]=!0);return Object.keys(r).length>0&&(t.extensions=r),t}}class $o extends Ui{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new ci,this.projectionMatrix=new ci,this.projectionMatrixInverse=new ci,this.coordinateSystem=kr}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}const es=new Pn,ts=new $r,rs=new $r;class ns extends $o{constructor(e=50,t=1,r=.1,n=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=r,this.far=n,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=2*Wr*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(.5*Hr*this.fov);return.5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*Wr*Math.atan(Math.tan(.5*Hr*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,t,r){es.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),t.set(es.x,es.y).multiplyScalar(-e/es.z),es.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),r.set(es.x,es.y).multiplyScalar(-e/es.z)}getViewSize(e,t){return this.getViewBounds(e,ts,rs),t.subVectors(rs,ts)}setViewOffset(e,t,r,n,i,o){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=r,this.view.offsetY=n,this.view.width=i,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(.5*Hr*this.fov)/this.zoom,r=2*t,n=this.aspect*r,i=-.5*n;const o=this.view;if(null!==this.view&&this.view.enabled){const e=o.fullWidth,s=o.fullHeight;i+=o.offsetX*n/e,t-=o.offsetY*r/s,n*=o.width/e,r*=o.height/s}const s=this.filmOffset;0!==s&&(i+=e*s/this.getFilmWidth()),this.projectionMatrix.makePerspective(i,i+n,t,t-r,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const is=-90;class os extends Ui{constructor(e,t,r){super(),this.type="CubeCamera",this.renderTarget=r,this.coordinateSystem=null,this.activeMipmapLevel=0;const n=new ns(is,1,e,t);n.layers=this.layers,this.add(n);const i=new ns(is,1,e,t);i.layers=this.layers,this.add(i);const o=new ns(is,1,e,t);o.layers=this.layers,this.add(o);const s=new ns(is,1,e,t);s.layers=this.layers,this.add(s);const a=new ns(is,1,e,t);a.layers=this.layers,this.add(a);const c=new ns(is,1,e,t);c.layers=this.layers,this.add(c)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[r,n,i,o,s,a]=t;for(const e of t)this.remove(e);if(e===kr)r.up.set(0,1,0),r.lookAt(1,0,0),n.up.set(0,1,0),n.lookAt(-1,0,0),i.up.set(0,0,-1),i.lookAt(0,1,0),o.up.set(0,0,1),o.lookAt(0,-1,0),s.up.set(0,1,0),s.lookAt(0,0,1),a.up.set(0,1,0),a.lookAt(0,0,-1);else{if(e!==jr)throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);r.up.set(0,-1,0),r.lookAt(-1,0,0),n.up.set(0,-1,0),n.lookAt(1,0,0),i.up.set(0,0,1),i.lookAt(0,1,0),o.up.set(0,0,-1),o.lookAt(0,-1,0),s.up.set(0,-1,0),s.lookAt(0,0,1),a.up.set(0,-1,0),a.lookAt(0,0,-1)}for(const e of t)this.add(e),e.updateMatrixWorld()}update(e,t){null===this.parent&&this.updateMatrixWorld();const{renderTarget:r,activeMipmapLevel:n}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[i,o,s,a,c,l]=this.children,u=e.getRenderTarget(),h=e.getActiveCubeFace(),p=e.getActiveMipmapLevel(),d=e.xr.enabled;e.xr.enabled=!1;const f=r.texture.generateMipmaps;r.texture.generateMipmaps=!1,e.setRenderTarget(r,0,n),e.render(t,i),e.setRenderTarget(r,1,n),e.render(t,o),e.setRenderTarget(r,2,n),e.render(t,s),e.setRenderTarget(r,3,n),e.render(t,a),e.setRenderTarget(r,4,n),e.render(t,c),r.texture.generateMipmaps=f,e.setRenderTarget(r,5,n),e.render(t,l),e.setRenderTarget(u,h,p),e.xr.enabled=d,r.texture.needsPMREMUpdate=!0}}class ss extends Sn{constructor(e,t,r,n,i,o,s,a,c,l){super(e=void 0!==e?e:[],t=void 0!==t?t:he,r,n,i,o,s,a,c,l),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class as extends En{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const r={width:e,height:e,depth:1},n=[r,r,r,r,r,r];this.texture=new ss(n,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==t.generateMipmaps&&t.generateMipmaps,this.texture.minFilter=void 0!==t.minFilter?t.minFilter:Me}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const r={uniforms:{tEquirect:{value:null}},vertexShader:"\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",fragmentShader:"\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t"},n=new Yo(5,5,5),i=new Qo({name:"CubemapFromEquirect",uniforms:qo(r.uniforms),vertexShader:r.vertexShader,fragmentShader:r.fragmentShader,side:m,blending:y});i.uniforms.tEquirect.value=t;const o=new Wo(n,i),s=t.minFilter;t.minFilter===Ae&&(t.minFilter=Me);return new os(1,10,this).update(e,o),t.minFilter=s,o.geometry.dispose(),o.material.dispose(),this}clear(e,t,r,n){const i=e.getRenderTarget();for(let i=0;i<6;i++)e.setRenderTarget(this,i),e.clear(t,r,n);e.setRenderTarget(i)}}const cs=new Pn,ls=new Pn,us=new en;class hs{constructor(e=new Pn(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,r,n){return this.normal.set(e,t,r),this.constant=n,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,r){const n=cs.subVectors(r,t).cross(ls.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(n,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const r=e.delta(cs),n=this.normal.dot(r);if(0===n)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;const i=-(e.start.dot(this.normal)+this.constant)/n;return i<0||i>1?null:t.copy(e.start).addScaledVector(r,i)}intersectsLine(e){const t=this.distanceToPoint(e.start),r=this.distanceToPoint(e.end);return t<0&&r>0||r<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const r=t||us.getNormalMatrix(e),n=this.coplanarPoint(cs).applyMatrix4(e),i=this.normal.applyMatrix3(r).normalize();return this.constant=-n.dot(i),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return(new this.constructor).copy(this)}}const ps=new $n,ds=new Pn;class fs{constructor(e=new hs,t=new hs,r=new hs,n=new hs,i=new hs,o=new hs){this.planes=[e,t,r,n,i,o]}set(e,t,r,n,i,o){const s=this.planes;return s[0].copy(e),s[1].copy(t),s[2].copy(r),s[3].copy(n),s[4].copy(i),s[5].copy(o),this}copy(e){const t=this.planes;for(let r=0;r<6;r++)t[r].copy(e.planes[r]);return this}setFromProjectionMatrix(e,t=kr){const r=this.planes,n=e.elements,i=n[0],o=n[1],s=n[2],a=n[3],c=n[4],l=n[5],u=n[6],h=n[7],p=n[8],d=n[9],f=n[10],m=n[11],g=n[12],y=n[13],v=n[14],_=n[15];if(r[0].setComponents(a-i,h-c,m-p,_-g).normalize(),r[1].setComponents(a+i,h+c,m+p,_+g).normalize(),r[2].setComponents(a+o,h+l,m+d,_+y).normalize(),r[3].setComponents(a-o,h-l,m-d,_-y).normalize(),r[4].setComponents(a-s,h-u,m-f,_-v).normalize(),t===kr)r[5].setComponents(a+s,h+u,m+f,_+v).normalize();else{if(t!==jr)throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);r[5].setComponents(s,u,f,v).normalize()}return this}intersectsObject(e){if(void 0!==e.boundingSphere)null===e.boundingSphere&&e.computeBoundingSphere(),ps.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;null===t.boundingSphere&&t.computeBoundingSphere(),ps.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(ps)}intersectsSprite(e){return ps.center.set(0,0,0),ps.radius=.7071067811865476,ps.applyMatrix4(e.matrixWorld),this.intersectsSphere(ps)}intersectsSphere(e){const t=this.planes,r=e.center,n=-e.radius;for(let e=0;e<6;e++){if(t[e].distanceToPoint(r)<n)return!1}return!0}intersectsBox(e){const t=this.planes;for(let r=0;r<6;r++){const n=t[r];if(ds.x=n.normal.x>0?e.max.x:e.min.x,ds.y=n.normal.y>0?e.max.y:e.min.y,ds.z=n.normal.z>0?e.max.z:e.min.z,n.distanceToPoint(ds)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let r=0;r<6;r++)if(t[r].distanceToPoint(e)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function ms(){let e=null,t=!1,r=null,n=null;function i(t,o){r(t,o),n=e.requestAnimationFrame(i)}return{start:function(){!0!==t&&null!==r&&(n=e.requestAnimationFrame(i),t=!0)},stop:function(){e.cancelAnimationFrame(n),t=!1},setAnimationLoop:function(e){r=e},setContext:function(t){e=t}}}function gs(e){const t=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),t.get(e)},remove:function(r){r.isInterleavedBufferAttribute&&(r=r.data);const n=t.get(r);n&&(e.deleteBuffer(n.buffer),t.delete(r))},update:function(r,n){if(r.isGLBufferAttribute){const e=t.get(r);return void((!e||e.version<r.version)&&t.set(r,{buffer:r.buffer,type:r.type,bytesPerElement:r.elementSize,version:r.version}))}r.isInterleavedBufferAttribute&&(r=r.data);const i=t.get(r);if(void 0===i)t.set(r,function(t,r){const n=t.array,i=t.usage,o=n.byteLength,s=e.createBuffer();let a;if(e.bindBuffer(r,s),e.bufferData(r,n,i),t.onUploadCallback(),n instanceof Float32Array)a=e.FLOAT;else if(n instanceof Uint16Array)a=t.isFloat16BufferAttribute?e.HALF_FLOAT:e.UNSIGNED_SHORT;else if(n instanceof Int16Array)a=e.SHORT;else if(n instanceof Uint32Array)a=e.UNSIGNED_INT;else if(n instanceof Int32Array)a=e.INT;else if(n instanceof Int8Array)a=e.BYTE;else if(n instanceof Uint8Array)a=e.UNSIGNED_BYTE;else{if(!(n instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+n);a=e.UNSIGNED_BYTE}return{buffer:s,type:a,bytesPerElement:n.BYTES_PER_ELEMENT,version:t.version,size:o}}(r,n));else if(i.version<r.version){if(i.size!==r.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");!function(t,r,n){const i=r.array,o=r._updateRange,s=r.updateRanges;if(e.bindBuffer(n,t),-1===o.count&&0===s.length&&e.bufferSubData(n,0,i),0!==s.length){for(let t=0,r=s.length;t<r;t++){const r=s[t];e.bufferSubData(n,r.start*i.BYTES_PER_ELEMENT,i,r.start,r.count)}r.clearUpdateRanges()}-1!==o.count&&(e.bufferSubData(n,o.offset*i.BYTES_PER_ELEMENT,i,o.offset,o.count),o.count=-1),r.onUploadCallback()}(i.buffer,r,n),i.version=r.version}}}}class ys extends Ao{constructor(e=1,t=1,r=1,n=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:r,heightSegments:n};const i=e/2,o=t/2,s=Math.floor(r),a=Math.floor(n),c=s+1,l=a+1,u=e/s,h=t/a,p=[],d=[],f=[],m=[];for(let e=0;e<l;e++){const t=e*h-o;for(let r=0;r<c;r++){const n=r*u-i;d.push(n,-t,0),f.push(0,0,1),m.push(r/s),m.push(1-e/a)}}for(let e=0;e<a;e++)for(let t=0;t<s;t++){const r=t+c*e,n=t+c*(e+1),i=t+1+c*(e+1),o=t+1+c*e;p.push(r,n,o),p.push(n,i,o)}this.setIndex(p),this.setAttribute("position",new _o(d,3)),this.setAttribute("normal",new _o(f,3)),this.setAttribute("uv",new _o(m,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new ys(e.width,e.height,e.widthSegments,e.heightSegments)}}const vs={alphahash_fragment:"#ifdef USE_ALPHAHASH\n\tif ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;\n#endif",alphahash_pars_fragment:"#ifdef USE_ALPHAHASH\n\tconst float ALPHA_HASH_SCALE = 0.05;\n\tfloat hash2D( vec2 value ) {\n\t\treturn fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );\n\t}\n\tfloat hash3D( vec3 value ) {\n\t\treturn hash2D( vec2( hash2D( value.xy ), value.z ) );\n\t}\n\tfloat getAlphaHashThreshold( vec3 position ) {\n\t\tfloat maxDeriv = max(\n\t\t\tlength( dFdx( position.xyz ) ),\n\t\t\tlength( dFdy( position.xyz ) )\n\t\t);\n\t\tfloat pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );\n\t\tvec2 pixScales = vec2(\n\t\t\texp2( floor( log2( pixScale ) ) ),\n\t\t\texp2( ceil( log2( pixScale ) ) )\n\t\t);\n\t\tvec2 alpha = vec2(\n\t\t\thash3D( floor( pixScales.x * position.xyz ) ),\n\t\t\thash3D( floor( pixScales.y * position.xyz ) )\n\t\t);\n\t\tfloat lerpFactor = fract( log2( pixScale ) );\n\t\tfloat x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;\n\t\tfloat a = min( lerpFactor, 1.0 - lerpFactor );\n\t\tvec3 cases = vec3(\n\t\t\tx * x / ( 2.0 * a * ( 1.0 - a ) ),\n\t\t\t( x - 0.5 * a ) / ( 1.0 - a ),\n\t\t\t1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )\n\t\t);\n\t\tfloat threshold = ( x < ( 1.0 - a ) )\n\t\t\t? ( ( x < a ) ? cases.x : cases.y )\n\t\t\t: cases.z;\n\t\treturn clamp( threshold , 1.0e-6, 1.0 );\n\t}\n#endif",alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\t#ifdef ALPHA_TO_COVERAGE\n\tdiffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );\n\tif ( diffuseColor.a == 0.0 ) discard;\n\t#else\n\tif ( diffuseColor.a < alphaTest ) discard;\n\t#endif\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_CLEARCOAT ) \n\t\tclearcoatSpecularIndirect *= ambientOcclusion;\n\t#endif\n\t#if defined( USE_SHEEN ) \n\t\tsheenSpecularIndirect *= ambientOcclusion;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometryNormal, geometryViewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",batching_pars_vertex:"#ifdef USE_BATCHING\n\tattribute float batchId;\n\tuniform highp sampler2D batchingTexture;\n\tmat4 getBatchingMatrix( const in float i ) {\n\t\tint size = textureSize( batchingTexture, 0 ).x;\n\t\tint j = int( i ) * 4;\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\tvec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );\n\t\tvec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );\n\t\tvec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );\n\t\tvec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );\n\t\treturn mat4( v1, v2, v3, v4 );\n\t}\n#endif\n#ifdef USE_BATCHING_COLOR\n\tuniform sampler2D batchingColorTexture;\n\tvec3 getBatchingColor( const in float i ) {\n\t\tint size = textureSize( batchingColorTexture, 0 ).x;\n\t\tint j = int( i );\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\treturn texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;\n\t}\n#endif",batching_vertex:"#ifdef USE_BATCHING\n\tmat4 batchingMatrix = getBatchingMatrix( batchId );\n#endif",begin_vertex:"vec3 transformed = vec3( position );\n#ifdef USE_ALPHAHASH\n\tvPosition = vec3( position );\n#endif",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"float G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n} // validated",iridescence_fragment:"#ifdef USE_IRIDESCENCE\n\tconst mat3 XYZ_TO_REC709 = mat3(\n\t\t 3.2404542, -0.9692660,  0.0556434,\n\t\t-1.5371385,  1.8760108, -0.2040259,\n\t\t-0.4985314,  0.0415560,  1.0572252\n\t);\n\tvec3 Fresnel0ToIor( vec3 fresnel0 ) {\n\t\tvec3 sqrtF0 = sqrt( fresnel0 );\n\t\treturn ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\n\t}\n\tvec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\n\t}\n\tfloat IorToFresnel0( float transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));\n\t}\n\tvec3 evalSensitivity( float OPD, vec3 shift ) {\n\t\tfloat phase = 2.0 * PI * OPD * 1.0e-9;\n\t\tvec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\n\t\tvec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\n\t\tvec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\n\t\tvec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );\n\t\txyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );\n\t\txyz /= 1.0685e-7;\n\t\tvec3 rgb = XYZ_TO_REC709 * xyz;\n\t\treturn rgb;\n\t}\n\tvec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\n\t\tvec3 I;\n\t\tfloat iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\n\t\tfloat sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );\n\t\tfloat cosTheta2Sq = 1.0 - sinTheta2Sq;\n\t\tif ( cosTheta2Sq < 0.0 ) {\n\t\t\treturn vec3( 1.0 );\n\t\t}\n\t\tfloat cosTheta2 = sqrt( cosTheta2Sq );\n\t\tfloat R0 = IorToFresnel0( iridescenceIOR, outsideIOR );\n\t\tfloat R12 = F_Schlick( R0, 1.0, cosTheta1 );\n\t\tfloat T121 = 1.0 - R12;\n\t\tfloat phi12 = 0.0;\n\t\tif ( iridescenceIOR < outsideIOR ) phi12 = PI;\n\t\tfloat phi21 = PI - phi12;\n\t\tvec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );\t\tvec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );\n\t\tvec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );\n\t\tvec3 phi23 = vec3( 0.0 );\n\t\tif ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;\n\t\tif ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;\n\t\tif ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;\n\t\tfloat OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;\n\t\tvec3 phi = vec3( phi21 ) + phi23;\n\t\tvec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );\n\t\tvec3 r123 = sqrt( R123 );\n\t\tvec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\n\t\tvec3 C0 = R12 + Rs;\n\t\tI = C0;\n\t\tvec3 Cm = Rs - T121;\n\t\tfor ( int m = 1; m <= 2; ++ m ) {\n\t\t\tCm *= r123;\n\t\t\tvec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\n\t\t\tI += Cm * Sm;\n\t\t}\n\t\treturn max( I, vec3( 0.0 ) );\n\t}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vBumpMapUv );\n\t\tvec2 dSTdy = dFdy( vBumpMapUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );\n\t\tvec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#ifdef ALPHA_TO_COVERAGE\n\t\tfloat distanceToPlane, distanceGradient;\n\t\tfloat clipOpacity = 1.0;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tdistanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;\n\t\t\tdistanceGradient = fwidth( distanceToPlane ) / 2.0;\n\t\t\tclipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );\n\t\t\tif ( clipOpacity == 0.0 ) discard;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\t\tfloat unionClipOpacity = 1.0;\n\t\t\t#pragma unroll_loop_start\n\t\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\t\tplane = clippingPlanes[ i ];\n\t\t\t\tdistanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;\n\t\t\t\tdistanceGradient = fwidth( distanceToPlane ) / 2.0;\n\t\t\t\tunionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );\n\t\t\t}\n\t\t\t#pragma unroll_loop_end\n\t\t\tclipOpacity *= 1.0 - unionClipOpacity;\n\t\t#endif\n\t\tdiffuseColor.a *= clipOpacity;\n\t\tif ( diffuseColor.a == 0.0 ) discard;\n\t#else\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\t\tbool clipped = true;\n\t\t\t#pragma unroll_loop_start\n\t\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\t\tplane = clippingPlanes[ i ];\n\t\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t\t}\n\t\t\t#pragma unroll_loop_end\n\t\t\tif ( clipped ) discard;\n\t\t#endif\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif\n#ifdef USE_BATCHING_COLOR\n\tvec3 batchingColor = getBatchingColor( batchId );\n\tvColor.xyz *= batchingColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nvec3 pow2( const in vec3 x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\n#ifdef USE_ALPHAHASH\n\tvarying vec3 vPosition;\n#endif\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat luminance( const in vec3 rgb ) {\n\tconst vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );\n\treturn dot( weights, rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}\nvec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n} // validated",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\thighp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define cubeUV_r0 1.0\n\t#define cubeUV_m0 - 2.0\n\t#define cubeUV_r1 0.8\n\t#define cubeUV_m1 - 1.0\n\t#define cubeUV_r4 0.4\n\t#define cubeUV_m4 2.0\n\t#define cubeUV_r5 0.305\n\t#define cubeUV_m5 3.0\n\t#define cubeUV_r6 0.21\n\t#define cubeUV_m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= cubeUV_r1 ) {\n\t\t\tmip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;\n\t\t} else if ( roughness >= cubeUV_r4 ) {\n\t\t\tmip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;\n\t\t} else if ( roughness >= cubeUV_r5 ) {\n\t\t\tmip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;\n\t\t} else if ( roughness >= cubeUV_r6 ) {\n\t\t\tmip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = objectTangent;\n#endif\n#ifdef USE_BATCHING\n\tmat3 bm = mat3( batchingMatrix );\n\ttransformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );\n\ttransformedNormal = bm * transformedNormal;\n\t#ifdef USE_TANGENT\n\t\ttransformedTangent = bm * transformedTangent;\n\t#endif\n#endif\n#ifdef USE_INSTANCING\n\tmat3 im = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );\n\ttransformedNormal = im * transformedNormal;\n\t#ifdef USE_TANGENT\n\t\ttransformedTangent = im * transformedTangent;\n\t#endif\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\ttransformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",colorspace_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",colorspace_pars_fragment:"\nconst mat3 LINEAR_SRGB_TO_LINEAR_DISPLAY_P3 = mat3(\n\tvec3( 0.8224621, 0.177538, 0.0 ),\n\tvec3( 0.0331941, 0.9668058, 0.0 ),\n\tvec3( 0.0170827, 0.0723974, 0.9105199 )\n);\nconst mat3 LINEAR_DISPLAY_P3_TO_LINEAR_SRGB = mat3(\n\tvec3( 1.2249401, - 0.2249404, 0.0 ),\n\tvec3( - 0.0420569, 1.0420571, 0.0 ),\n\tvec3( - 0.0196376, - 0.0786361, 1.0982735 )\n);\nvec4 LinearSRGBToLinearDisplayP3( in vec4 value ) {\n\treturn vec4( value.rgb * LINEAR_SRGB_TO_LINEAR_DISPLAY_P3, value.a );\n}\nvec4 LinearDisplayP3ToLinearSRGB( in vec4 value ) {\n\treturn vec4( value.rgb * LINEAR_DISPLAY_P3_TO_LINEAR_SRGB, value.a );\n}\nvec4 LinearTransferOETF( in vec4 value ) {\n\treturn value;\n}\nvec4 sRGBTransferOETF( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn sRGBTransferOETF( value );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform mat3 envMapRotation;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#ifdef USE_ENVMAP\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\t#ifdef USE_ANISOTROPY\n\t\tvec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {\n\t\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\t\tvec3 bentNormal = cross( bitangent, viewDir );\n\t\t\t\tbentNormal = normalize( cross( bentNormal, bitangent ) );\n\t\t\t\tbentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );\n\t\t\t\treturn getIBLRadiance( viewDir, bentNormal, roughness );\n\t\t\t#else\n\t\t\t\treturn vec3( 0.0 );\n\t\t\t#endif\n\t\t}\n\t#endif\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\tvec2 fw = fwidth( coord ) * 0.5;\n\t\treturn mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );\n\t#endif\n}",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_fragment:"LambertMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularStrength = specularStrength;",lights_lambert_pars_fragment:"varying vec3 vViewPosition;\nstruct LambertMaterial {\n\tvec3 diffuseColor;\n\tfloat specularStrength;\n};\nvoid RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Lambert\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Lambert",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\n#if defined( USE_LIGHT_PROBES )\n\tuniform vec3 lightProbe[ 9 ];\n#endif\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif ( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometryPosition;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometryPosition;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\tmaterial.ior = ior;\n\t#ifdef USE_SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULAR_COLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;\n\t\t#endif\n\t\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_DISPERSION\n\tmaterial.dispersion = dispersion;\n#endif\n#ifdef USE_IRIDESCENCE\n\tmaterial.iridescence = iridescence;\n\tmaterial.iridescenceIOR = iridescenceIOR;\n\t#ifdef USE_IRIDESCENCEMAP\n\t\tmaterial.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;\n\t#endif\n\t#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\t\tmaterial.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;\n\t#else\n\t\tmaterial.iridescenceThickness = iridescenceThicknessMaximum;\n\t#endif\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\t#ifdef USE_ANISOTROPYMAP\n\t\tmat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );\n\t\tvec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;\n\t\tvec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;\n\t#else\n\t\tvec2 anisotropyV = anisotropyVector;\n\t#endif\n\tmaterial.anisotropy = length( anisotropyV );\n\tif( material.anisotropy == 0.0 ) {\n\t\tanisotropyV = vec2( 1.0, 0.0 );\n\t} else {\n\t\tanisotropyV /= material.anisotropy;\n\t\tmaterial.anisotropy = saturate( material.anisotropy );\n\t}\n\tmaterial.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );\n\tmaterial.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;\n\tmaterial.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\tfloat dispersion;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\tfloat iridescence;\n\t\tfloat iridescenceIOR;\n\t\tfloat iridescenceThickness;\n\t\tvec3 iridescenceFresnel;\n\t\tvec3 iridescenceF0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n\t#ifdef IOR\n\t\tfloat ior;\n\t#endif\n\t#ifdef USE_TRANSMISSION\n\t\tfloat transmission;\n\t\tfloat transmissionAlpha;\n\t\tfloat thickness;\n\t\tfloat attenuationDistance;\n\t\tvec3 attenuationColor;\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat anisotropy;\n\t\tfloat alphaT;\n\t\tvec3 anisotropyT;\n\t\tvec3 anisotropyB;\n\t#endif\n};\nvec3 clearcoatSpecularDirect = vec3( 0.0 );\nvec3 clearcoatSpecularIndirect = vec3( 0.0 );\nvec3 sheenSpecularDirect = vec3( 0.0 );\nvec3 sheenSpecularIndirect = vec3(0.0 );\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\n    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );\n    float x2 = x * x;\n    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );\n    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\n#ifdef USE_ANISOTROPY\n\tfloat V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {\n\t\tfloat gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );\n\t\tfloat gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );\n\t\tfloat v = 0.5 / ( gv + gl );\n\t\treturn saturate(v);\n\t}\n\tfloat D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {\n\t\tfloat a2 = alphaT * alphaB;\n\t\thighp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );\n\t\thighp float v2 = dot( v, v );\n\t\tfloat w2 = a2 / v2;\n\t\treturn RECIPROCAL_PI * a2 * pow2 ( w2 );\n\t}\n#endif\n#ifdef USE_CLEARCOAT\n\tvec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {\n\t\tvec3 f0 = material.clearcoatF0;\n\t\tfloat f90 = material.clearcoatF90;\n\t\tfloat roughness = material.clearcoatRoughness;\n\t\tfloat alpha = pow2( roughness );\n\t\tvec3 halfDir = normalize( lightDir + viewDir );\n\t\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\t\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\t\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\t\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\t\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t\treturn F * ( V * D );\n\t}\n#endif\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {\n\tvec3 f0 = material.specularColor;\n\tfloat f90 = material.specularF90;\n\tfloat roughness = material.roughness;\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t#ifdef USE_IRIDESCENCE\n\t\tF = mix( F, material.iridescenceFresnel, material.iridescence );\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat dotTL = dot( material.anisotropyT, lightDir );\n\t\tfloat dotTV = dot( material.anisotropyT, viewDir );\n\t\tfloat dotTH = dot( material.anisotropyT, halfDir );\n\t\tfloat dotBL = dot( material.anisotropyB, lightDir );\n\t\tfloat dotBV = dot( material.anisotropyB, viewDir );\n\t\tfloat dotBH = dot( material.anisotropyB, halfDir );\n\t\tfloat V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );\n\t\tfloat D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );\n\t#else\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t#endif\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\n#ifdef USE_IRIDESCENCE\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#else\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#endif\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\t#ifdef USE_IRIDESCENCE\n\t\tvec3 Fr = mix( specularColor, iridescenceF0, iridescence );\n\t#else\n\t\tvec3 Fr = specularColor;\n\t#endif\n\tvec3 FssEss = Fr * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometryNormal;\n\t\tvec3 viewDir = geometryViewDir;\n\t\tvec3 position = geometryPosition;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\t#ifdef USE_IRIDESCENCE\n\t\tcomputeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );\n\t#else\n\t\tcomputeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\t#endif\n\tvec3 totalScattering = singleScattering + multiScattering;\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nvec3 geometryPosition = - vViewPosition;\nvec3 geometryNormal = normal;\nvec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\nvec3 geometryClearcoatNormal = vec3( 0.0 );\n#ifdef USE_CLEARCOAT\n\tgeometryClearcoatNormal = clearcoatNormal;\n#endif\n#ifdef USE_IRIDESCENCE\n\tfloat dotNVi = saturate( dot( normal, geometryViewDir ) );\n\tif ( material.iridescenceThickness == 0.0 ) {\n\t\tmaterial.iridescence = 0.0;\n\t} else {\n\t\tmaterial.iridescence = saturate( material.iridescence );\n\t}\n\tif ( material.iridescence > 0.0 ) {\n\t\tmaterial.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\n\t\tmaterial.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\n\t}\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometryPosition, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tvec4 spotColor;\n\tvec3 spotLightCoord;\n\tbool inSpotLightMap;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometryPosition, directLight );\n\t\t#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX\n\t\t#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS\n\t\t#else\n\t\t#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#endif\n\t\t#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )\n\t\t\tspotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;\n\t\t\tinSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );\n\t\t\tspotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );\n\t\t\tdirectLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;\n\t\t#endif\n\t\t#undef SPOT_LIGHT_MAP_INDEX\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t#if defined( USE_LIGHT_PROBES )\n\t\tirradiance += getLightProbeIrradiance( lightProbe, geometryNormal );\n\t#endif\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometryNormal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\t#ifdef USE_ANISOTROPY\n\t\tradiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );\n\t#else\n\t\tradiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF )\n\tgl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\tvFragDepth = 1.0 + gl_Position.w;\n\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 sampledDiffuseColor = texture2D( map, vMapUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );\n\t\n\t#endif\n\tdiffuseColor *= sampledDiffuseColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t#if defined( USE_POINTS_UV )\n\t\tvec2 uv = vUv;\n\t#else\n\t\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_POINTS_UV )\n\tvarying vec2 vUv;\n#else\n\t#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t\tuniform mat3 uvTransform;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphinstance_vertex:"#ifdef USE_INSTANCING_MORPH\n\tfloat morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\tfloat morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\tmorphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;\n\t}\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\t\t#endif\n\t}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t}\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\t#ifndef USE_INSTANCING_MORPH\n\t\tuniform float morphTargetBaseInfluence;\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t#endif\n\tuniform sampler2DArray morphTargetsTexture;\n\tuniform ivec2 morphTargetsTextureSize;\n\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\t}\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t}\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = dFdx( vViewPosition );\n\tvec3 fdy = dFdy( vViewPosition );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal *= faceDirection;\n\t#endif\n#endif\n#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn = getTangentFrame( - vViewPosition, normal,\n\t\t#if defined( USE_NORMALMAP )\n\t\t\tvNormalMapUv\n\t\t#elif defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tvClearcoatNormalMapUv\n\t\t#else\n\t\t\tvUv\n\t\t#endif\n\t\t);\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn[0] *= faceDirection;\n\t\ttbn[1] *= faceDirection;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn2[0] *= faceDirection;\n\t\ttbn2[1] *= faceDirection;\n\t#endif\n#endif\nvec3 nonPerturbedNormal = normal;",normal_fragment_maps:"#ifdef USE_NORMALMAP_OBJECTSPACE\n\tnormal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( USE_NORMALMAP_TANGENTSPACE )\n\tvec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\tnormal = normalize( tbn * mapN );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef USE_NORMALMAP_OBJECTSPACE\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )\n\tmat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( uv.st );\n\t\tvec2 st1 = dFdy( uv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );\n\t\treturn mat3( T * scale, B * scale, N );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = nonPerturbedNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\tclearcoatNormal = normalize( tbn2 * clearcoatMapN );\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif",iridescence_pars_fragment:"#ifdef USE_IRIDESCENCEMAP\n\tuniform sampler2D iridescenceMap;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform sampler2D iridescenceThicknessMap;\n#endif",opaque_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= material.transmissionAlpha;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec2 packDepthToRG( in highp float v ) {\n\treturn packDepthToRGBA( v ).yx;\n}\nfloat unpackRGToDepth( const in highp vec2 v ) {\n\treturn unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn depth * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * depth - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_BATCHING\n\tmvPosition = batchingMatrix * mvPosition;\n#endif\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#if NUM_SPOT_LIGHT_MAPS > 0\n\tuniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;\n\t\tbool frustumTest = inFrustum && shadowCoord.z <= 1.0;\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tfloat shadow = 1.0;\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\t\n\t\tfloat lightToPositionLength = length( lightToPosition );\n\t\tif ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {\n\t\t\tfloat dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\t\tdp += shadowBias;\n\t\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\t\tshadow = (\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t\t) * ( 1.0 / 9.0 );\n\t\t\t#else\n\t\t\t\tshadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n#endif",shadowmap_pars_vertex:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tuniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )\n\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\tvec4 shadowWorldPosition;\n#endif\n#if defined( USE_SHADOWMAP )\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if NUM_SPOT_LIGHT_COORDS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition;\n\t\t#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t\tshadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;\n\t\t#endif\n\t\tvSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\tuniform highp sampler2D boneTexture;\n\tmat4 getBoneMatrix( const in float i ) {\n\t\tint size = textureSize( boneTexture, 0 ).x;\n\t\tint j = int( i ) * 4;\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\tvec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );\n\t\tvec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );\n\t\tvec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );\n\t\tvec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );\n\t\treturn mat4( v1, v2, v3, v4 );\n\t}\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn saturate( toneMappingExposure * color );\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nconst mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(\n\tvec3( 1.6605, - 0.1246, - 0.0182 ),\n\tvec3( - 0.5876, 1.1329, - 0.1006 ),\n\tvec3( - 0.0728, - 0.0083, 1.1187 )\n);\nconst mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(\n\tvec3( 0.6274, 0.0691, 0.0164 ),\n\tvec3( 0.3293, 0.9195, 0.0880 ),\n\tvec3( 0.0433, 0.0113, 0.8956 )\n);\nvec3 agxDefaultContrastApprox( vec3 x ) {\n\tvec3 x2 = x * x;\n\tvec3 x4 = x2 * x2;\n\treturn + 15.5 * x4 * x2\n\t\t- 40.14 * x4 * x\n\t\t+ 31.96 * x4\n\t\t- 6.868 * x2 * x\n\t\t+ 0.4298 * x2\n\t\t+ 0.1191 * x\n\t\t- 0.00232;\n}\nvec3 AgXToneMapping( vec3 color ) {\n\tconst mat3 AgXInsetMatrix = mat3(\n\t\tvec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),\n\t\tvec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),\n\t\tvec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )\n\t);\n\tconst mat3 AgXOutsetMatrix = mat3(\n\t\tvec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),\n\t\tvec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),\n\t\tvec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )\n\t);\n\tconst float AgxMinEv = - 12.47393;\tconst float AgxMaxEv = 4.026069;\n\tcolor *= toneMappingExposure;\n\tcolor = LINEAR_SRGB_TO_LINEAR_REC2020 * color;\n\tcolor = AgXInsetMatrix * color;\n\tcolor = max( color, 1e-10 );\tcolor = log2( color );\n\tcolor = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );\n\tcolor = clamp( color, 0.0, 1.0 );\n\tcolor = agxDefaultContrastApprox( color );\n\tcolor = AgXOutsetMatrix * color;\n\tcolor = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );\n\tcolor = LINEAR_REC2020_TO_LINEAR_SRGB * color;\n\tcolor = clamp( color, 0.0, 1.0 );\n\treturn color;\n}\nvec3 NeutralToneMapping( vec3 color ) {\n\tconst float StartCompression = 0.8 - 0.04;\n\tconst float Desaturation = 0.15;\n\tcolor *= toneMappingExposure;\n\tfloat x = min( color.r, min( color.g, color.b ) );\n\tfloat offset = x < 0.08 ? x - 6.25 * x * x : 0.04;\n\tcolor -= offset;\n\tfloat peak = max( color.r, max( color.g, color.b ) );\n\tif ( peak < StartCompression ) return color;\n\tfloat d = 1. - StartCompression;\n\tfloat newPeak = 1. - d * d / ( peak + d - StartCompression );\n\tcolor *= newPeak / peak;\n\tfloat g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );\n\treturn mix( color, vec3( newPeak ), g );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tmaterial.transmission = transmission;\n\tmaterial.transmissionAlpha = 1.0;\n\tmaterial.thickness = thickness;\n\tmaterial.attenuationDistance = attenuationDistance;\n\tmaterial.attenuationColor = attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tmaterial.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tmaterial.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmitted = getIBLVolumeRefraction(\n\t\tn, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,\n\t\tmaterial.attenuationColor, material.attenuationDistance );\n\tmaterial.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );\n\ttotalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tfloat w0( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );\n\t}\n\tfloat w1( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );\n\t}\n\tfloat w2( float a ){\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );\n\t}\n\tfloat w3( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * a * a );\n\t}\n\tfloat g0( float a ) {\n\t\treturn w0( a ) + w1( a );\n\t}\n\tfloat g1( float a ) {\n\t\treturn w2( a ) + w3( a );\n\t}\n\tfloat h0( float a ) {\n\t\treturn - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );\n\t}\n\tfloat h1( float a ) {\n\t\treturn 1.0 + w3( a ) / ( w2( a ) + w3( a ) );\n\t}\n\tvec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {\n\t\tuv = uv * texelSize.zw + 0.5;\n\t\tvec2 iuv = floor( uv );\n\t\tvec2 fuv = fract( uv );\n\t\tfloat g0x = g0( fuv.x );\n\t\tfloat g1x = g1( fuv.x );\n\t\tfloat h0x = h0( fuv.x );\n\t\tfloat h1x = h1( fuv.x );\n\t\tfloat h0y = h0( fuv.y );\n\t\tfloat h1y = h1( fuv.y );\n\t\tvec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\treturn g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +\n\t\t\tg1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );\n\t}\n\tvec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {\n\t\tvec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );\n\t\tvec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );\n\t\tvec2 fLodSizeInv = 1.0 / fLodSize;\n\t\tvec2 cLodSizeInv = 1.0 / cLodSize;\n\t\tvec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );\n\t\tvec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );\n\t\treturn mix( fSample, cSample, fract( lod ) );\n\t}\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\treturn textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );\n\t}\n\tvec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( isinf( attenuationDistance ) ) {\n\t\t\treturn vec3( 1.0 );\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec4 transmittedLight;\n\t\tvec3 transmittance;\n\t\t#ifdef USE_DISPERSION\n\t\t\tfloat halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;\n\t\t\tvec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );\n\t\t\tfor ( int i = 0; i < 3; i ++ ) {\n\t\t\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );\n\t\t\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\t\n\t\t\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\t\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\t\t\trefractionCoords += 1.0;\n\t\t\t\trefractionCoords /= 2.0;\n\t\t\n\t\t\t\tvec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );\n\t\t\t\ttransmittedLight[ i ] = transmissionSample[ i ];\n\t\t\t\ttransmittedLight.a += transmissionSample.a;\n\t\t\t\ttransmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];\n\t\t\t}\n\t\t\ttransmittedLight.a /= 3.0;\n\t\t\n\t\t#else\n\t\t\n\t\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\t\trefractionCoords += 1.0;\n\t\t\trefractionCoords /= 2.0;\n\t\t\ttransmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\t\ttransmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\t\n\t\t#endif\n\t\tvec3 attenuatedColor = transmittance * transmittedLight.rgb;\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\tfloat transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );\n\t}\n#endif",uv_pars_fragment:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_pars_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tuniform mat3 mapTransform;\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform mat3 alphaMapTransform;\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tuniform mat3 lightMapTransform;\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tuniform mat3 aoMapTransform;\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tuniform mat3 bumpMapTransform;\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tuniform mat3 normalMapTransform;\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tuniform mat3 displacementMapTransform;\n\tvarying vec2 vDisplacementMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tuniform mat3 emissiveMapTransform;\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tuniform mat3 metalnessMapTransform;\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tuniform mat3 roughnessMapTransform;\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tuniform mat3 anisotropyMapTransform;\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tuniform mat3 clearcoatMapTransform;\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform mat3 clearcoatNormalMapTransform;\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform mat3 clearcoatRoughnessMapTransform;\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tuniform mat3 sheenColorMapTransform;\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tuniform mat3 sheenRoughnessMapTransform;\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tuniform mat3 iridescenceMapTransform;\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform mat3 iridescenceThicknessMapTransform;\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tuniform mat3 specularMapTransform;\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tuniform mat3 specularColorMapTransform;\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tuniform mat3 specularIntensityMapTransform;\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvUv = vec3( uv, 1 ).xy;\n#endif\n#ifdef USE_MAP\n\tvMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ALPHAMAP\n\tvAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_LIGHTMAP\n\tvLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_AOMAP\n\tvAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_BUMPMAP\n\tvBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_NORMALMAP\n\tvNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tvDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_METALNESSMAP\n\tvMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULARMAP\n\tvSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tvTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_THICKNESSMAP\n\tvThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_BATCHING\n\t\tworldPosition = batchingMatrix * worldPosition;\n\t#endif\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nuniform float backgroundIntensity;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\ttexColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",backgroundCube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",backgroundCube_frag:"#ifdef ENVMAP_TYPE_CUBE\n\tuniform samplerCube envMap;\n#elif defined( ENVMAP_TYPE_CUBE_UV )\n\tuniform sampler2D envMap;\n#endif\nuniform float flipEnvMap;\nuniform float backgroundBlurriness;\nuniform float backgroundIntensity;\nuniform mat3 backgroundRotation;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );\n\t#else\n\t\tvec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\tgl_FragColor = texColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",depth_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <skinbase_vertex>\n\t#include <morphinstance_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <clipping_planes_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <skinbase_vertex>\n\t#include <morphinstance_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <clipping_planes_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"#define LAMBERT\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_lambert_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_lambert_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define USE_SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef USE_SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULAR_COLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_DISPERSION\n\tuniform float dispersion;\n#endif\n#ifdef USE_IRIDESCENCE\n\tuniform float iridescence;\n\tuniform float iridescenceIOR;\n\tuniform float iridescenceThicknessMinimum;\n\tuniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\tuniform vec2 anisotropyVector;\n\t#ifdef USE_ANISOTROPYMAP\n\t\tuniform sampler2D anisotropyMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;\n\t#endif\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n#ifdef USE_POINTS_UV\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif\nvoid main() {\n\t#ifdef USE_POINTS_UV\n\t\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\t#endif\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <logdepthbuf_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}"},_s={common:{diffuse:{value:new Zi(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new en},alphaMap:{value:null},alphaMapTransform:{value:new en},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new en}},envmap:{envMap:{value:null},envMapRotation:{value:new en},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new en}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new en}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new en},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new en},normalScale:{value:new $r(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new en},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new en}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new en}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new en}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Zi(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Zi(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new en},alphaTest:{value:0},uvTransform:{value:new en}},sprite:{diffuse:{value:new Zi(16777215)},opacity:{value:1},center:{value:new $r(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new en},alphaMap:{value:null},alphaMapTransform:{value:new en},alphaTest:{value:0}}},bs={basic:{uniforms:Jo([_s.common,_s.specularmap,_s.envmap,_s.aomap,_s.lightmap,_s.fog]),vertexShader:vs.meshbasic_vert,fragmentShader:vs.meshbasic_frag},lambert:{uniforms:Jo([_s.common,_s.specularmap,_s.envmap,_s.aomap,_s.lightmap,_s.emissivemap,_s.bumpmap,_s.normalmap,_s.displacementmap,_s.fog,_s.lights,{emissive:{value:new Zi(0)}}]),vertexShader:vs.meshlambert_vert,fragmentShader:vs.meshlambert_frag},phong:{uniforms:Jo([_s.common,_s.specularmap,_s.envmap,_s.aomap,_s.lightmap,_s.emissivemap,_s.bumpmap,_s.normalmap,_s.displacementmap,_s.fog,_s.lights,{emissive:{value:new Zi(0)},specular:{value:new Zi(1118481)},shininess:{value:30}}]),vertexShader:vs.meshphong_vert,fragmentShader:vs.meshphong_frag},standard:{uniforms:Jo([_s.common,_s.envmap,_s.aomap,_s.lightmap,_s.emissivemap,_s.bumpmap,_s.normalmap,_s.displacementmap,_s.roughnessmap,_s.metalnessmap,_s.fog,_s.lights,{emissive:{value:new Zi(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:vs.meshphysical_vert,fragmentShader:vs.meshphysical_frag},toon:{uniforms:Jo([_s.common,_s.aomap,_s.lightmap,_s.emissivemap,_s.bumpmap,_s.normalmap,_s.displacementmap,_s.gradientmap,_s.fog,_s.lights,{emissive:{value:new Zi(0)}}]),vertexShader:vs.meshtoon_vert,fragmentShader:vs.meshtoon_frag},matcap:{uniforms:Jo([_s.common,_s.bumpmap,_s.normalmap,_s.displacementmap,_s.fog,{matcap:{value:null}}]),vertexShader:vs.meshmatcap_vert,fragmentShader:vs.meshmatcap_frag},points:{uniforms:Jo([_s.points,_s.fog]),vertexShader:vs.points_vert,fragmentShader:vs.points_frag},dashed:{uniforms:Jo([_s.common,_s.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:vs.linedashed_vert,fragmentShader:vs.linedashed_frag},depth:{uniforms:Jo([_s.common,_s.displacementmap]),vertexShader:vs.depth_vert,fragmentShader:vs.depth_frag},normal:{uniforms:Jo([_s.common,_s.bumpmap,_s.normalmap,_s.displacementmap,{opacity:{value:1}}]),vertexShader:vs.meshnormal_vert,fragmentShader:vs.meshnormal_frag},sprite:{uniforms:Jo([_s.sprite,_s.fog]),vertexShader:vs.sprite_vert,fragmentShader:vs.sprite_frag},background:{uniforms:{uvTransform:{value:new en},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:vs.background_vert,fragmentShader:vs.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new en}},vertexShader:vs.backgroundCube_vert,fragmentShader:vs.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:vs.cube_vert,fragmentShader:vs.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:vs.equirect_vert,fragmentShader:vs.equirect_frag},distanceRGBA:{uniforms:Jo([_s.common,_s.displacementmap,{referencePosition:{value:new Pn},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:vs.distanceRGBA_vert,fragmentShader:vs.distanceRGBA_frag},shadow:{uniforms:Jo([_s.lights,_s.fog,{color:{value:new Zi(0)},opacity:{value:1}}]),vertexShader:vs.shadow_vert,fragmentShader:vs.shadow_frag}};bs.physical={uniforms:Jo([bs.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new en},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new en},clearcoatNormalScale:{value:new $r(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new en},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new en},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new en},sheen:{value:0},sheenColor:{value:new Zi(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new en},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new en},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new en},transmissionSamplerSize:{value:new $r},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new en},attenuationDistance:{value:0},attenuationColor:{value:new Zi(0)},specularColor:{value:new Zi(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new en},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new en},anisotropyVector:{value:new $r},anisotropyMap:{value:null},anisotropyMapTransform:{value:new en}}]),vertexShader:vs.meshphysical_vert,fragmentShader:vs.meshphysical_frag};const xs={r:0,b:0,g:0},ws=new vi,Ss=new ci;function Ms(e,t,r,n,i,o,s){const a=new Zi(0);let c,l,u=!0===o?0:1,h=null,p=0,d=null;function g(e){let n=!0===e.isScene?e.background:null;if(n&&n.isTexture){n=(e.backgroundBlurriness>0?r:t).get(n)}return n}function y(t,r){t.getRGB(xs,Ko(e)),n.buffers.color.setClear(xs.r,xs.g,xs.b,r,s)}return{getClearColor:function(){return a},setClearColor:function(e,t=1){a.set(e),u=t,y(a,u)},getClearAlpha:function(){return u},setClearAlpha:function(e){u=e,y(a,u)},render:function(t){let r=!1;const i=g(t);null===i?y(a,u):i&&i.isColor&&(y(i,1),r=!0);const o=e.xr.getEnvironmentBlendMode();"additive"===o?n.buffers.color.setClear(0,0,0,1,s):"alpha-blend"===o&&n.buffers.color.setClear(0,0,0,0,s),(e.autoClear||r)&&(n.buffers.depth.setTest(!0),n.buffers.depth.setMask(!0),n.buffers.color.setMask(!0),e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil))},addToRenderList:function(t,r){const n=g(r);n&&(n.isCubeTexture||n.mapping===me)?(void 0===l&&(l=new Wo(new Yo(1,1,1),new Qo({name:"BackgroundCubeMaterial",uniforms:qo(bs.backgroundCube.uniforms),vertexShader:bs.backgroundCube.vertexShader,fragmentShader:bs.backgroundCube.fragmentShader,side:m,depthTest:!1,depthWrite:!1,fog:!1})),l.geometry.deleteAttribute("normal"),l.geometry.deleteAttribute("uv"),l.onBeforeRender=function(e,t,r){this.matrixWorld.copyPosition(r.matrixWorld)},Object.defineProperty(l.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),i.update(l)),ws.copy(r.backgroundRotation),ws.x*=-1,ws.y*=-1,ws.z*=-1,n.isCubeTexture&&!1===n.isRenderTargetTexture&&(ws.y*=-1,ws.z*=-1),l.material.uniforms.envMap.value=n,l.material.uniforms.flipEnvMap.value=n.isCubeTexture&&!1===n.isRenderTargetTexture?-1:1,l.material.uniforms.backgroundBlurriness.value=r.backgroundBlurriness,l.material.uniforms.backgroundIntensity.value=r.backgroundIntensity,l.material.uniforms.backgroundRotation.value.setFromMatrix4(Ss.makeRotationFromEuler(ws)),l.material.toneMapped=fn.getTransfer(n.colorSpace)!==tr,h===n&&p===n.version&&d===e.toneMapping||(l.material.needsUpdate=!0,h=n,p=n.version,d=e.toneMapping),l.layers.enableAll(),t.unshift(l,l.geometry,l.material,0,0,null)):n&&n.isTexture&&(void 0===c&&(c=new Wo(new ys(2,2),new Qo({name:"BackgroundMaterial",uniforms:qo(bs.background.uniforms),vertexShader:bs.background.vertexShader,fragmentShader:bs.background.fragmentShader,side:f,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),Object.defineProperty(c.material,"map",{get:function(){return this.uniforms.t2D.value}}),i.update(c)),c.material.uniforms.t2D.value=n,c.material.uniforms.backgroundIntensity.value=r.backgroundIntensity,c.material.toneMapped=fn.getTransfer(n.colorSpace)!==tr,!0===n.matrixAutoUpdate&&n.updateMatrix(),c.material.uniforms.uvTransform.value.copy(n.matrix),h===n&&p===n.version&&d===e.toneMapping||(c.material.needsUpdate=!0,h=n,p=n.version,d=e.toneMapping),c.layers.enableAll(),t.unshift(c,c.geometry,c.material,0,0,null))}}}function Ts(e,t){const r=e.getParameter(e.MAX_VERTEX_ATTRIBS),n={},i=l(null);let o=i,s=!1;function a(t){return e.bindVertexArray(t)}function c(t){return e.deleteVertexArray(t)}function l(e){const t=[],n=[],i=[];for(let e=0;e<r;e++)t[e]=0,n[e]=0,i[e]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:t,enabledAttributes:n,attributeDivisors:i,object:e,attributes:{},index:null}}function u(){const e=o.newAttributes;for(let t=0,r=e.length;t<r;t++)e[t]=0}function h(e){p(e,0)}function p(t,r){const n=o.newAttributes,i=o.enabledAttributes,s=o.attributeDivisors;n[t]=1,0===i[t]&&(e.enableVertexAttribArray(t),i[t]=1),s[t]!==r&&(e.vertexAttribDivisor(t,r),s[t]=r)}function d(){const t=o.newAttributes,r=o.enabledAttributes;for(let n=0,i=r.length;n<i;n++)r[n]!==t[n]&&(e.disableVertexAttribArray(n),r[n]=0)}function f(t,r,n,i,o,s,a){!0===a?e.vertexAttribIPointer(t,r,n,o,s):e.vertexAttribPointer(t,r,n,i,o,s)}function m(){g(),s=!0,o!==i&&(o=i,a(o.object))}function g(){i.geometry=null,i.program=null,i.wireframe=!1}return{setup:function(r,i,c,m,g){let y=!1;const v=function(t,r,i){const o=!0===i.wireframe;let s=n[t.id];void 0===s&&(s={},n[t.id]=s);let a=s[r.id];void 0===a&&(a={},s[r.id]=a);let c=a[o];void 0===c&&(c=l(e.createVertexArray()),a[o]=c);return c}(m,c,i);o!==v&&(o=v,a(o.object)),y=function(e,t,r,n){const i=o.attributes,s=t.attributes;let a=0;const c=r.getAttributes();for(const t in c){if(c[t].location>=0){const r=i[t];let n=s[t];if(void 0===n&&("instanceMatrix"===t&&e.instanceMatrix&&(n=e.instanceMatrix),"instanceColor"===t&&e.instanceColor&&(n=e.instanceColor)),void 0===r)return!0;if(r.attribute!==n)return!0;if(n&&r.data!==n.data)return!0;a++}}return o.attributesNum!==a||o.index!==n}(r,m,c,g),y&&function(e,t,r,n){const i={},s=t.attributes;let a=0;const c=r.getAttributes();for(const t in c){if(c[t].location>=0){let r=s[t];void 0===r&&("instanceMatrix"===t&&e.instanceMatrix&&(r=e.instanceMatrix),"instanceColor"===t&&e.instanceColor&&(r=e.instanceColor));const n={};n.attribute=r,r&&r.data&&(n.data=r.data),i[t]=n,a++}}o.attributes=i,o.attributesNum=a,o.index=n}(r,m,c,g),null!==g&&t.update(g,e.ELEMENT_ARRAY_BUFFER),(y||s)&&(s=!1,function(r,n,i,o){u();const s=o.attributes,a=i.getAttributes(),c=n.defaultAttributeValues;for(const n in a){const i=a[n];if(i.location>=0){let a=s[n];if(void 0===a&&("instanceMatrix"===n&&r.instanceMatrix&&(a=r.instanceMatrix),"instanceColor"===n&&r.instanceColor&&(a=r.instanceColor)),void 0!==a){const n=a.normalized,s=a.itemSize,c=t.get(a);if(void 0===c)continue;const l=c.buffer,u=c.type,d=c.bytesPerElement,m=u===e.INT||u===e.UNSIGNED_INT||a.gpuType===Ne;if(a.isInterleavedBufferAttribute){const t=a.data,c=t.stride,g=a.offset;if(t.isInstancedInterleavedBuffer){for(let e=0;e<i.locationSize;e++)p(i.location+e,t.meshPerAttribute);!0!==r.isInstancedMesh&&void 0===o._maxInstanceCount&&(o._maxInstanceCount=t.meshPerAttribute*t.count)}else for(let e=0;e<i.locationSize;e++)h(i.location+e);e.bindBuffer(e.ARRAY_BUFFER,l);for(let e=0;e<i.locationSize;e++)f(i.location+e,s/i.locationSize,u,n,c*d,(g+s/i.locationSize*e)*d,m)}else{if(a.isInstancedBufferAttribute){for(let e=0;e<i.locationSize;e++)p(i.location+e,a.meshPerAttribute);!0!==r.isInstancedMesh&&void 0===o._maxInstanceCount&&(o._maxInstanceCount=a.meshPerAttribute*a.count)}else for(let e=0;e<i.locationSize;e++)h(i.location+e);e.bindBuffer(e.ARRAY_BUFFER,l);for(let e=0;e<i.locationSize;e++)f(i.location+e,s/i.locationSize,u,n,s*d,s/i.locationSize*e*d,m)}}else if(void 0!==c){const t=c[n];if(void 0!==t)switch(t.length){case 2:e.vertexAttrib2fv(i.location,t);break;case 3:e.vertexAttrib3fv(i.location,t);break;case 4:e.vertexAttrib4fv(i.location,t);break;default:e.vertexAttrib1fv(i.location,t)}}}}d()}(r,i,c,m),null!==g&&e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t.get(g).buffer))},reset:m,resetDefaultState:g,dispose:function(){m();for(const e in n){const t=n[e];for(const e in t){const r=t[e];for(const e in r)c(r[e].object),delete r[e];delete t[e]}delete n[e]}},releaseStatesOfGeometry:function(e){if(void 0===n[e.id])return;const t=n[e.id];for(const e in t){const r=t[e];for(const e in r)c(r[e].object),delete r[e];delete t[e]}delete n[e.id]},releaseStatesOfProgram:function(e){for(const t in n){const r=n[t];if(void 0===r[e.id])continue;const i=r[e.id];for(const e in i)c(i[e].object),delete i[e];delete r[e.id]}},initAttributes:u,enableAttribute:h,disableUnusedAttributes:d}}function Es(e,t,r){let n;function i(t,i,o){0!==o&&(e.drawArraysInstanced(n,t,i,o),r.update(i,n,o))}this.setMode=function(e){n=e},this.render=function(t,i){e.drawArrays(n,t,i),r.update(i,n,1)},this.renderInstances=i,this.renderMultiDraw=function(e,i,o){if(0===o)return;const s=t.get("WEBGL_multi_draw");if(null===s)for(let t=0;t<o;t++)this.render(e[t],i[t]);else{s.multiDrawArraysWEBGL(n,e,0,i,0,o);let t=0;for(let e=0;e<o;e++)t+=i[e];r.update(t,n,1)}},this.renderMultiDrawInstances=function(e,o,s,a){if(0===s)return;const c=t.get("WEBGL_multi_draw");if(null===c)for(let t=0;t<e.length;t++)i(e[t],o[t],a[t]);else{c.multiDrawArraysInstancedWEBGL(n,e,0,o,0,a,0,s);let t=0;for(let e=0;e<s;e++)t+=o[e];for(let e=0;e<a.length;e++)r.update(t,n,a[e])}}}function As(e,t,r,n){let i;function o(t){if("highp"===t){if(e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let s=void 0!==r.precision?r.precision:"highp";const a=o(s);a!==s&&(console.warn("THREE.WebGLRenderer:",s,"not supported, using",a,"instead."),s=a);const c=!0===r.logarithmicDepthBuffer,l=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),u=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS);return{isWebGL2:!0,getMaxAnisotropy:function(){if(void 0!==i)return i;if(!0===t.has("EXT_texture_filter_anisotropic")){const r=t.get("EXT_texture_filter_anisotropic");i=e.getParameter(r.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else i=0;return i},getMaxPrecision:o,textureFormatReadable:function(t){return t===Ve||n.convert(t)===e.getParameter(e.IMPLEMENTATION_COLOR_READ_FORMAT)},textureTypeReadable:function(r){const i=r===De&&(t.has("EXT_color_buffer_half_float")||t.has("EXT_color_buffer_float"));return!(r!==Ce&&n.convert(r)!==e.getParameter(e.IMPLEMENTATION_COLOR_READ_TYPE)&&r!==Ue&&!i)},precision:s,logarithmicDepthBuffer:c,maxTextures:l,maxVertexTextures:u,maxTextureSize:e.getParameter(e.MAX_TEXTURE_SIZE),maxCubemapSize:e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),maxAttributes:e.getParameter(e.MAX_VERTEX_ATTRIBS),maxVertexUniforms:e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),maxVaryings:e.getParameter(e.MAX_VARYING_VECTORS),maxFragmentUniforms:e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS),vertexTextures:u>0,maxSamples:e.getParameter(e.MAX_SAMPLES)}}function Rs(e){const t=this;let r=null,n=0,i=!1,o=!1;const s=new hs,a=new en,c={value:null,needsUpdate:!1};function l(e,r,n,i){const o=null!==e?e.length:0;let l=null;if(0!==o){if(l=c.value,!0!==i||null===l){const t=n+4*o,i=r.matrixWorldInverse;a.getNormalMatrix(i),(null===l||l.length<t)&&(l=new Float32Array(t));for(let t=0,r=n;t!==o;++t,r+=4)s.copy(e[t]).applyMatrix4(i,a),s.normal.toArray(l,r),l[r+3]=s.constant}c.value=l,c.needsUpdate=!0}return t.numPlanes=o,t.numIntersection=0,l}this.uniform=c,this.numPlanes=0,this.numIntersection=0,this.init=function(e,t){const r=0!==e.length||t||0!==n||i;return i=t,n=e.length,r},this.beginShadows=function(){o=!0,l(null)},this.endShadows=function(){o=!1},this.setGlobalState=function(e,t){r=l(e,t,0)},this.setState=function(s,a,u){const h=s.clippingPlanes,p=s.clipIntersection,d=s.clipShadows,f=e.get(s);if(!i||null===h||0===h.length||o&&!d)o?l(null):function(){c.value!==r&&(c.value=r,c.needsUpdate=n>0);t.numPlanes=n,t.numIntersection=0}();else{const e=o?0:n,t=4*e;let i=f.clippingState||null;c.value=i,i=l(h,a,t,u);for(let e=0;e!==t;++e)i[e]=r[e];f.clippingState=i,this.numIntersection=p?this.numPlanes:0,this.numPlanes+=e}}}function Cs(e){let t=new WeakMap;function r(e,t){return t===de?e.mapping=he:t===fe&&(e.mapping=pe),e}function n(e){const r=e.target;r.removeEventListener("dispose",n);const i=t.get(r);void 0!==i&&(t.delete(r),i.dispose())}return{get:function(i){if(i&&i.isTexture){const o=i.mapping;if(o===de||o===fe){if(t.has(i)){return r(t.get(i).texture,i.mapping)}{const o=i.image;if(o&&o.height>0){const s=new as(o.height);return s.fromEquirectangularTexture(e,i),t.set(i,s),i.addEventListener("dispose",n),r(s.texture,i.mapping)}return null}}}return i},dispose:function(){t=new WeakMap}}}class Is extends $o{constructor(e=-1,t=1,r=1,n=-1,i=.1,o=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=r,this.bottom=n,this.near=i,this.far=o,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}setViewOffset(e,t,r,n,i,o){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=r,this.view.offsetY=n,this.view.width=i,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),r=(this.right+this.left)/2,n=(this.top+this.bottom)/2;let i=r-e,o=r+e,s=n+t,a=n-t;if(null!==this.view&&this.view.enabled){const e=(this.right-this.left)/this.view.fullWidth/this.zoom,t=(this.top-this.bottom)/this.view.fullHeight/this.zoom;i+=e*this.view.offsetX,o=i+e*this.view.width,s-=t*this.view.offsetY,a=s-t*this.view.height}this.projectionMatrix.makeOrthographic(i,o,s,a,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}const Os=[.125,.215,.35,.446,.526,.582],Ps=20,Ns=new Is,Ls=new Zi;let Us=null,Ds=0,Fs=0,Bs=!1;const ks=(1+Math.sqrt(5))/2,js=1/ks,Gs=[new Pn(-ks,js,0),new Pn(ks,js,0),new Pn(-js,0,ks),new Pn(js,0,ks),new Pn(0,ks,-js),new Pn(0,ks,js),new Pn(-1,1,-1),new Pn(1,1,-1),new Pn(-1,1,1),new Pn(1,1,1)];class zs{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,r=.1,n=100){Us=this._renderer.getRenderTarget(),Ds=this._renderer.getActiveCubeFace(),Fs=this._renderer.getActiveMipmapLevel(),Bs=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(256);const i=this._allocateTargets();return i.depthBuffer=!0,this._sceneToCubeUV(e,r,n,i),t>0&&this._blur(i,0,0,t),this._applyPMREM(i),this._cleanup(i),i}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=Xs(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=Ws(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(Us,Ds,Fs),this._renderer.xr.enabled=Bs,e.scissorTest=!1,Hs(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===he||e.mapping===pe?this._setSize(0===e.image.length?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),Us=this._renderer.getRenderTarget(),Ds=this._renderer.getActiveCubeFace(),Fs=this._renderer.getActiveMipmapLevel(),Bs=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const r=t||this._allocateTargets();return this._textureToCubeUV(e,r),this._applyPMREM(r),this._cleanup(r),r}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,r={magFilter:Me,minFilter:Me,generateMipmaps:!1,type:De,format:Ve,colorSpace:Zt,depthBuffer:!1},n=Vs(e,t,r);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=Vs(e,t,r);const{_lodMax:n}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function(e){const t=[],r=[],n=[];let i=e;const o=e-4+1+Os.length;for(let s=0;s<o;s++){const o=Math.pow(2,i);r.push(o);let a=1/o;s>e-4?a=Os[s-e+4-1]:0===s&&(a=0),n.push(a);const c=1/(o-2),l=-c,u=1+c,h=[l,l,u,l,u,u,l,l,u,u,l,u],p=6,d=6,f=3,m=2,g=1,y=new Float32Array(f*d*p),v=new Float32Array(m*d*p),_=new Float32Array(g*d*p);for(let e=0;e<p;e++){const t=e%3*2/3-1,r=e>2?0:-1,n=[t,r,0,t+2/3,r,0,t+2/3,r+1,0,t,r,0,t+2/3,r+1,0,t,r+1,0];y.set(n,f*d*e),v.set(h,m*d*e);const i=[e,e,e,e,e,e];_.set(i,g*d*e)}const b=new Ao;b.setAttribute("position",new lo(y,f)),b.setAttribute("uv",new lo(v,m)),b.setAttribute("faceIndex",new lo(_,g)),t.push(b),i>4&&i--}return{lodPlanes:t,sizeLods:r,sigmas:n}}(n)),this._blurMaterial=function(e,t,r){const n=new Float32Array(Ps),i=new Pn(0,1,0),o=new Qo({name:"SphericalGaussianBlur",defines:{n:Ps,CUBEUV_TEXEL_WIDTH:1/t,CUBEUV_TEXEL_HEIGHT:1/r,CUBEUV_MAX_MIP:`${e}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:n},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:i}},vertexShader:Ys(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:y,depthTest:!1,depthWrite:!1});return o}(n,e,t)}return n}_compileMaterial(e){const t=new Wo(this._lodPlanes[0],e);this._renderer.compile(t,Ns)}_sceneToCubeUV(e,t,r,n){const i=new ns(90,1,t,r),o=[1,-1,1,1,1,1],s=[1,1,1,-1,-1,-1],a=this._renderer,c=a.autoClear,l=a.toneMapping;a.getClearColor(Ls),a.toneMapping=ee,a.autoClear=!1;const u=new to({name:"PMREM.Background",side:m,depthWrite:!1,depthTest:!1}),h=new Wo(new Yo,u);let p=!1;const d=e.background;d?d.isColor&&(u.color.copy(d),e.background=null,p=!0):(u.color.copy(Ls),p=!0);for(let t=0;t<6;t++){const r=t%3;0===r?(i.up.set(0,o[t],0),i.lookAt(s[t],0,0)):1===r?(i.up.set(0,0,o[t]),i.lookAt(0,s[t],0)):(i.up.set(0,o[t],0),i.lookAt(0,0,s[t]));const c=this._cubeSize;Hs(n,r*c,t>2?c:0,c,c),a.setRenderTarget(n),p&&a.render(h,i),a.render(e,i)}h.geometry.dispose(),h.material.dispose(),a.toneMapping=l,a.autoClear=c,e.background=d}_textureToCubeUV(e,t){const r=this._renderer,n=e.mapping===he||e.mapping===pe;n?(null===this._cubemapMaterial&&(this._cubemapMaterial=Xs()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===e.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=Ws());const i=n?this._cubemapMaterial:this._equirectMaterial,o=new Wo(this._lodPlanes[0],i);i.uniforms.envMap.value=e;const s=this._cubeSize;Hs(t,0,0,3*s,2*s),r.setRenderTarget(t),r.render(o,Ns)}_applyPMREM(e){const t=this._renderer,r=t.autoClear;t.autoClear=!1;const n=this._lodPlanes.length;for(let t=1;t<n;t++){const r=Math.sqrt(this._sigmas[t]*this._sigmas[t]-this._sigmas[t-1]*this._sigmas[t-1]),i=Gs[(n-t-1)%Gs.length];this._blur(e,t-1,t,r,i)}t.autoClear=r}_blur(e,t,r,n,i){const o=this._pingPongRenderTarget;this._halfBlur(e,o,t,r,n,"latitudinal",i),this._halfBlur(o,e,r,r,n,"longitudinal",i)}_halfBlur(e,t,r,n,i,o,s){const a=this._renderer,c=this._blurMaterial;"latitudinal"!==o&&"longitudinal"!==o&&console.error("blur direction must be either latitudinal or longitudinal!");const l=new Wo(this._lodPlanes[n],c),u=c.uniforms,h=this._sizeLods[r]-1,p=isFinite(i)?Math.PI/(2*h):2*Math.PI/39,d=i/p,f=isFinite(i)?1+Math.floor(3*d):Ps;f>Ps&&console.warn(`sigmaRadians, ${i}, is too large and will clip, as it requested ${f} samples when the maximum is set to 20`);const m=[];let g=0;for(let e=0;e<Ps;++e){const t=e/d,r=Math.exp(-t*t/2);m.push(r),0===e?g+=r:e<f&&(g+=2*r)}for(let e=0;e<m.length;e++)m[e]=m[e]/g;u.envMap.value=e.texture,u.samples.value=f,u.weights.value=m,u.latitudinal.value="latitudinal"===o,s&&(u.poleAxis.value=s);const{_lodMax:y}=this;u.dTheta.value=p,u.mipInt.value=y-r;const v=this._sizeLods[n];Hs(t,3*v*(n>y-4?n-y+4:0),4*(this._cubeSize-v),3*v,2*v),a.setRenderTarget(t),a.render(l,Ns)}}function Vs(e,t,r){const n=new En(e,t,r);return n.texture.mapping=me,n.texture.name="PMREM.cubeUv",n.scissorTest=!0,n}function Hs(e,t,r,n,i){e.viewport.set(t,r,n,i),e.scissor.set(t,r,n,i)}function Ws(){return new Qo({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:Ys(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",blending:y,depthTest:!1,depthWrite:!1})}function Xs(){return new Qo({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:Ys(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:y,depthTest:!1,depthWrite:!1})}function Ys(){return"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t"}function qs(e){let t=new WeakMap,r=null;function n(e){const r=e.target;r.removeEventListener("dispose",n);const i=t.get(r);void 0!==i&&(t.delete(r),i.dispose())}return{get:function(i){if(i&&i.isTexture){const o=i.mapping,s=o===de||o===fe,a=o===he||o===pe;if(s||a){let o=t.get(i);const c=void 0!==o?o.texture.pmremVersion:0;if(i.isRenderTargetTexture&&i.pmremVersion!==c)return null===r&&(r=new zs(e)),o=s?r.fromEquirectangular(i,o):r.fromCubemap(i,o),o.texture.pmremVersion=i.pmremVersion,t.set(i,o),o.texture;if(void 0!==o)return o.texture;{const c=i.image;return s&&c&&c.height>0||a&&c&&function(e){let t=0;const r=6;for(let n=0;n<r;n++)void 0!==e[n]&&t++;return t===r}(c)?(null===r&&(r=new zs(e)),o=s?r.fromEquirectangular(i):r.fromCubemap(i),o.texture.pmremVersion=i.pmremVersion,t.set(i,o),i.addEventListener("dispose",n),o.texture):null}}}return i},dispose:function(){t=new WeakMap,null!==r&&(r.dispose(),r=null)}}}function Js(e){const t={};function r(r){if(void 0!==t[r])return t[r];let n;switch(r){case"WEBGL_depth_texture":n=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":n=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:n=e.getExtension(r)}return t[r]=n,n}return{has:function(e){return null!==r(e)},init:function(){r("EXT_color_buffer_float"),r("WEBGL_clip_cull_distance"),r("OES_texture_float_linear"),r("EXT_color_buffer_half_float"),r("WEBGL_multisampled_render_to_texture"),r("WEBGL_render_shared_exponent")},get:function(e){const t=r(e);return null===t&&ln("THREE.WebGLRenderer: "+e+" extension not supported."),t}}}function Ks(e,t,r,n){const i={},o=new WeakMap;function s(e){const a=e.target;null!==a.index&&t.remove(a.index);for(const e in a.attributes)t.remove(a.attributes[e]);for(const e in a.morphAttributes){const r=a.morphAttributes[e];for(let e=0,n=r.length;e<n;e++)t.remove(r[e])}a.removeEventListener("dispose",s),delete i[a.id];const c=o.get(a);c&&(t.remove(c),o.delete(a)),n.releaseStatesOfGeometry(a),!0===a.isInstancedBufferGeometry&&delete a._maxInstanceCount,r.memory.geometries--}function a(e){const r=[],n=e.index,i=e.attributes.position;let s=0;if(null!==n){const e=n.array;s=n.version;for(let t=0,n=e.length;t<n;t+=3){const n=e[t+0],i=e[t+1],o=e[t+2];r.push(n,i,i,o,o,n)}}else{if(void 0===i)return;{const e=i.array;s=i.version;for(let t=0,n=e.length/3-1;t<n;t+=3){const e=t+0,n=t+1,i=t+2;r.push(e,n,n,i,i,e)}}}const a=new(rn(r)?yo:mo)(r,1);a.version=s;const c=o.get(e);c&&t.remove(c),o.set(e,a)}return{get:function(e,t){return!0===i[t.id]||(t.addEventListener("dispose",s),i[t.id]=!0,r.memory.geometries++),t},update:function(r){const n=r.attributes;for(const r in n)t.update(n[r],e.ARRAY_BUFFER);const i=r.morphAttributes;for(const r in i){const n=i[r];for(let r=0,i=n.length;r<i;r++)t.update(n[r],e.ARRAY_BUFFER)}},getWireframeAttribute:function(e){const t=o.get(e);if(t){const r=e.index;null!==r&&t.version<r.version&&a(e)}else a(e);return o.get(e)}}}function Zs(e,t,r){let n,i,o;function s(t,s,a){0!==a&&(e.drawElementsInstanced(n,s,i,t*o,a),r.update(s,n,a))}this.setMode=function(e){n=e},this.setIndex=function(e){i=e.type,o=e.bytesPerElement},this.render=function(t,s){e.drawElements(n,s,i,t*o),r.update(s,n,1)},this.renderInstances=s,this.renderMultiDraw=function(e,s,a){if(0===a)return;const c=t.get("WEBGL_multi_draw");if(null===c)for(let t=0;t<a;t++)this.render(e[t]/o,s[t]);else{c.multiDrawElementsWEBGL(n,s,0,i,e,0,a);let t=0;for(let e=0;e<a;e++)t+=s[e];r.update(t,n,1)}},this.renderMultiDrawInstances=function(e,a,c,l){if(0===c)return;const u=t.get("WEBGL_multi_draw");if(null===u)for(let t=0;t<e.length;t++)s(e[t]/o,a[t],l[t]);else{u.multiDrawElementsInstancedWEBGL(n,a,0,i,e,0,l,0,c);let t=0;for(let e=0;e<c;e++)t+=a[e];for(let e=0;e<l.length;e++)r.update(t,n,l[e])}}}function Qs(e){const t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(r,n,i){switch(t.calls++,n){case e.TRIANGLES:t.triangles+=i*(r/3);break;case e.LINES:t.lines+=i*(r/2);break;case e.LINE_STRIP:t.lines+=i*(r-1);break;case e.LINE_LOOP:t.lines+=i*r;break;case e.POINTS:t.points+=i*r;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",n)}}}}function $s(e,t,r){const n=new WeakMap,i=new Mn;return{update:function(o,s,a){const c=o.morphTargetInfluences,l=s.morphAttributes.position||s.morphAttributes.normal||s.morphAttributes.color,u=void 0!==l?l.length:0;let h=n.get(s);if(void 0===h||h.count!==u){void 0!==h&&h.texture.dispose();const p=void 0!==s.morphAttributes.position,d=void 0!==s.morphAttributes.normal,f=void 0!==s.morphAttributes.color,m=s.morphAttributes.position||[],g=s.morphAttributes.normal||[],y=s.morphAttributes.color||[];let v=0;!0===p&&(v=1),!0===d&&(v=2),!0===f&&(v=3);let _=s.attributes.position.count*v,b=1;_>t.maxTextureSize&&(b=Math.ceil(_/t.maxTextureSize),_=t.maxTextureSize);const x=new Float32Array(_*b*4*u),w=new An(x,_,b,u);w.type=Ue,w.needsUpdate=!0;const S=4*v;for(let T=0;T<u;T++){const E=m[T],A=g[T],R=y[T],C=_*b*4*T;for(let I=0;I<E.count;I++){const O=I*S;!0===p&&(i.fromBufferAttribute(E,I),x[C+O+0]=i.x,x[C+O+1]=i.y,x[C+O+2]=i.z,x[C+O+3]=0),!0===d&&(i.fromBufferAttribute(A,I),x[C+O+4]=i.x,x[C+O+5]=i.y,x[C+O+6]=i.z,x[C+O+7]=0),!0===f&&(i.fromBufferAttribute(R,I),x[C+O+8]=i.x,x[C+O+9]=i.y,x[C+O+10]=i.z,x[C+O+11]=4===R.itemSize?i.w:1)}}function M(){w.dispose(),n.delete(s),s.removeEventListener("dispose",M)}h={count:u,texture:w,size:new $r(_,b)},n.set(s,h),s.addEventListener("dispose",M)}if(!0===o.isInstancedMesh&&null!==o.morphTexture)a.getUniforms().setValue(e,"morphTexture",o.morphTexture,r);else{let P=0;for(let L=0;L<c.length;L++)P+=c[L];const N=s.morphTargetsRelative?1:1-P;a.getUniforms().setValue(e,"morphTargetBaseInfluence",N),a.getUniforms().setValue(e,"morphTargetInfluences",c)}a.getUniforms().setValue(e,"morphTargetsTexture",h.texture,r),a.getUniforms().setValue(e,"morphTargetsTextureSize",h.size)}}}function ea(e,t,r,n){let i=new WeakMap;function o(e){const t=e.target;t.removeEventListener("dispose",o),r.remove(t.instanceMatrix),null!==t.instanceColor&&r.remove(t.instanceColor)}return{update:function(s){const a=n.render.frame,c=s.geometry,l=t.get(s,c);if(i.get(l)!==a&&(t.update(l),i.set(l,a)),s.isInstancedMesh&&(!1===s.hasEventListener("dispose",o)&&s.addEventListener("dispose",o),i.get(s)!==a&&(r.update(s.instanceMatrix,e.ARRAY_BUFFER),null!==s.instanceColor&&r.update(s.instanceColor,e.ARRAY_BUFFER),i.set(s,a))),s.isSkinnedMesh){const e=s.skeleton;i.get(e)!==a&&(e.update(),i.set(e,a))}return l},dispose:function(){i=new WeakMap}}}class ta extends Sn{constructor(e,t,r,n,i,o,s,a,c,l=Xe){if(l!==Xe&&l!==Ye)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===r&&l===Xe&&(r=Le),void 0===r&&l===Ye&&(r=ke),super(null,n,i,o,s,a,l,r,c),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=void 0!==s?s:_e,this.minFilter=void 0!==a?a:_e,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return null!==this.compareFunction&&(t.compareFunction=this.compareFunction),t}}const ra=new Sn,na=new ta(1,1);na.compareFunction=Sr;const ia=new An,oa=new Cn,sa=new ss,aa=[],ca=[],la=new Float32Array(16),ua=new Float32Array(9),ha=new Float32Array(4);function pa(e,t,r){const n=e[0];if(n<=0||n>0)return e;const i=t*r;let o=aa[i];if(void 0===o&&(o=new Float32Array(i),aa[i]=o),0!==t){n.toArray(o,0);for(let n=1,i=0;n!==t;++n)i+=r,e[n].toArray(o,i)}return o}function da(e,t){if(e.length!==t.length)return!1;for(let r=0,n=e.length;r<n;r++)if(e[r]!==t[r])return!1;return!0}function fa(e,t){for(let r=0,n=t.length;r<n;r++)e[r]=t[r]}function ma(e,t){let r=ca[t];void 0===r&&(r=new Int32Array(t),ca[t]=r);for(let n=0;n!==t;++n)r[n]=e.allocateTextureUnit();return r}function ga(e,t){const r=this.cache;r[0]!==t&&(e.uniform1f(this.addr,t),r[0]=t)}function ya(e,t){const r=this.cache;if(void 0!==t.x)r[0]===t.x&&r[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),r[0]=t.x,r[1]=t.y);else{if(da(r,t))return;e.uniform2fv(this.addr,t),fa(r,t)}}function va(e,t){const r=this.cache;if(void 0!==t.x)r[0]===t.x&&r[1]===t.y&&r[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),r[0]=t.x,r[1]=t.y,r[2]=t.z);else if(void 0!==t.r)r[0]===t.r&&r[1]===t.g&&r[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),r[0]=t.r,r[1]=t.g,r[2]=t.b);else{if(da(r,t))return;e.uniform3fv(this.addr,t),fa(r,t)}}function _a(e,t){const r=this.cache;if(void 0!==t.x)r[0]===t.x&&r[1]===t.y&&r[2]===t.z&&r[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),r[0]=t.x,r[1]=t.y,r[2]=t.z,r[3]=t.w);else{if(da(r,t))return;e.uniform4fv(this.addr,t),fa(r,t)}}function ba(e,t){const r=this.cache,n=t.elements;if(void 0===n){if(da(r,t))return;e.uniformMatrix2fv(this.addr,!1,t),fa(r,t)}else{if(da(r,n))return;ha.set(n),e.uniformMatrix2fv(this.addr,!1,ha),fa(r,n)}}function xa(e,t){const r=this.cache,n=t.elements;if(void 0===n){if(da(r,t))return;e.uniformMatrix3fv(this.addr,!1,t),fa(r,t)}else{if(da(r,n))return;ua.set(n),e.uniformMatrix3fv(this.addr,!1,ua),fa(r,n)}}function wa(e,t){const r=this.cache,n=t.elements;if(void 0===n){if(da(r,t))return;e.uniformMatrix4fv(this.addr,!1,t),fa(r,t)}else{if(da(r,n))return;la.set(n),e.uniformMatrix4fv(this.addr,!1,la),fa(r,n)}}function Sa(e,t){const r=this.cache;r[0]!==t&&(e.uniform1i(this.addr,t),r[0]=t)}function Ma(e,t){const r=this.cache;if(void 0!==t.x)r[0]===t.x&&r[1]===t.y||(e.uniform2i(this.addr,t.x,t.y),r[0]=t.x,r[1]=t.y);else{if(da(r,t))return;e.uniform2iv(this.addr,t),fa(r,t)}}function Ta(e,t){const r=this.cache;if(void 0!==t.x)r[0]===t.x&&r[1]===t.y&&r[2]===t.z||(e.uniform3i(this.addr,t.x,t.y,t.z),r[0]=t.x,r[1]=t.y,r[2]=t.z);else{if(da(r,t))return;e.uniform3iv(this.addr,t),fa(r,t)}}function Ea(e,t){const r=this.cache;if(void 0!==t.x)r[0]===t.x&&r[1]===t.y&&r[2]===t.z&&r[3]===t.w||(e.uniform4i(this.addr,t.x,t.y,t.z,t.w),r[0]=t.x,r[1]=t.y,r[2]=t.z,r[3]=t.w);else{if(da(r,t))return;e.uniform4iv(this.addr,t),fa(r,t)}}function Aa(e,t){const r=this.cache;r[0]!==t&&(e.uniform1ui(this.addr,t),r[0]=t)}function Ra(e,t){const r=this.cache;if(void 0!==t.x)r[0]===t.x&&r[1]===t.y||(e.uniform2ui(this.addr,t.x,t.y),r[0]=t.x,r[1]=t.y);else{if(da(r,t))return;e.uniform2uiv(this.addr,t),fa(r,t)}}function Ca(e,t){const r=this.cache;if(void 0!==t.x)r[0]===t.x&&r[1]===t.y&&r[2]===t.z||(e.uniform3ui(this.addr,t.x,t.y,t.z),r[0]=t.x,r[1]=t.y,r[2]=t.z);else{if(da(r,t))return;e.uniform3uiv(this.addr,t),fa(r,t)}}function Ia(e,t){const r=this.cache;if(void 0!==t.x)r[0]===t.x&&r[1]===t.y&&r[2]===t.z&&r[3]===t.w||(e.uniform4ui(this.addr,t.x,t.y,t.z,t.w),r[0]=t.x,r[1]=t.y,r[2]=t.z,r[3]=t.w);else{if(da(r,t))return;e.uniform4uiv(this.addr,t),fa(r,t)}}function Oa(e,t,r){const n=this.cache,i=r.allocateTextureUnit();n[0]!==i&&(e.uniform1i(this.addr,i),n[0]=i);const o=this.type===e.SAMPLER_2D_SHADOW?na:ra;r.setTexture2D(t||o,i)}function Pa(e,t,r){const n=this.cache,i=r.allocateTextureUnit();n[0]!==i&&(e.uniform1i(this.addr,i),n[0]=i),r.setTexture3D(t||oa,i)}function Na(e,t,r){const n=this.cache,i=r.allocateTextureUnit();n[0]!==i&&(e.uniform1i(this.addr,i),n[0]=i),r.setTextureCube(t||sa,i)}function La(e,t,r){const n=this.cache,i=r.allocateTextureUnit();n[0]!==i&&(e.uniform1i(this.addr,i),n[0]=i),r.setTexture2DArray(t||ia,i)}function Ua(e,t){e.uniform1fv(this.addr,t)}function Da(e,t){const r=pa(t,this.size,2);e.uniform2fv(this.addr,r)}function Fa(e,t){const r=pa(t,this.size,3);e.uniform3fv(this.addr,r)}function Ba(e,t){const r=pa(t,this.size,4);e.uniform4fv(this.addr,r)}function ka(e,t){const r=pa(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,r)}function ja(e,t){const r=pa(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,r)}function Ga(e,t){const r=pa(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,r)}function za(e,t){e.uniform1iv(this.addr,t)}function Va(e,t){e.uniform2iv(this.addr,t)}function Ha(e,t){e.uniform3iv(this.addr,t)}function Wa(e,t){e.uniform4iv(this.addr,t)}function Xa(e,t){e.uniform1uiv(this.addr,t)}function Ya(e,t){e.uniform2uiv(this.addr,t)}function qa(e,t){e.uniform3uiv(this.addr,t)}function Ja(e,t){e.uniform4uiv(this.addr,t)}function Ka(e,t,r){const n=this.cache,i=t.length,o=ma(r,i);da(n,o)||(e.uniform1iv(this.addr,o),fa(n,o));for(let e=0;e!==i;++e)r.setTexture2D(t[e]||ra,o[e])}function Za(e,t,r){const n=this.cache,i=t.length,o=ma(r,i);da(n,o)||(e.uniform1iv(this.addr,o),fa(n,o));for(let e=0;e!==i;++e)r.setTexture3D(t[e]||oa,o[e])}function Qa(e,t,r){const n=this.cache,i=t.length,o=ma(r,i);da(n,o)||(e.uniform1iv(this.addr,o),fa(n,o));for(let e=0;e!==i;++e)r.setTextureCube(t[e]||sa,o[e])}function $a(e,t,r){const n=this.cache,i=t.length,o=ma(r,i);da(n,o)||(e.uniform1iv(this.addr,o),fa(n,o));for(let e=0;e!==i;++e)r.setTexture2DArray(t[e]||ia,o[e])}class ec{constructor(e,t,r){this.id=e,this.addr=r,this.cache=[],this.type=t.type,this.setValue=function(e){switch(e){case 5126:return ga;case 35664:return ya;case 35665:return va;case 35666:return _a;case 35674:return ba;case 35675:return xa;case 35676:return wa;case 5124:case 35670:return Sa;case 35667:case 35671:return Ma;case 35668:case 35672:return Ta;case 35669:case 35673:return Ea;case 5125:return Aa;case 36294:return Ra;case 36295:return Ca;case 36296:return Ia;case 35678:case 36198:case 36298:case 36306:case 35682:return Oa;case 35679:case 36299:case 36307:return Pa;case 35680:case 36300:case 36308:case 36293:return Na;case 36289:case 36303:case 36311:case 36292:return La}}(t.type)}}class tc{constructor(e,t,r){this.id=e,this.addr=r,this.cache=[],this.type=t.type,this.size=t.size,this.setValue=function(e){switch(e){case 5126:return Ua;case 35664:return Da;case 35665:return Fa;case 35666:return Ba;case 35674:return ka;case 35675:return ja;case 35676:return Ga;case 5124:case 35670:return za;case 35667:case 35671:return Va;case 35668:case 35672:return Ha;case 35669:case 35673:return Wa;case 5125:return Xa;case 36294:return Ya;case 36295:return qa;case 36296:return Ja;case 35678:case 36198:case 36298:case 36306:case 35682:return Ka;case 35679:case 36299:case 36307:return Za;case 35680:case 36300:case 36308:case 36293:return Qa;case 36289:case 36303:case 36311:case 36292:return $a}}(t.type)}}class rc{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,r){const n=this.seq;for(let i=0,o=n.length;i!==o;++i){const o=n[i];o.setValue(e,t[o.id],r)}}}const nc=/(\w+)(\])?(\[|\.)?/g;function ic(e,t){e.seq.push(t),e.map[t.id]=t}function oc(e,t,r){const n=e.name,i=n.length;for(nc.lastIndex=0;;){const o=nc.exec(n),s=nc.lastIndex;let a=o[1];const c="]"===o[2],l=o[3];if(c&&(a|=0),void 0===l||"["===l&&s+2===i){ic(r,void 0===l?new ec(a,e,t):new tc(a,e,t));break}{let e=r.map[a];void 0===e&&(e=new rc(a),ic(r,e)),r=e}}}class sc{constructor(e,t){this.seq=[],this.map={};const r=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let n=0;n<r;++n){const r=e.getActiveUniform(t,n);oc(r,e.getUniformLocation(t,r.name),this)}}setValue(e,t,r,n){const i=this.map[t];void 0!==i&&i.setValue(e,r,n)}setOptional(e,t,r){const n=t[r];void 0!==n&&this.setValue(e,r,n)}static upload(e,t,r,n){for(let i=0,o=t.length;i!==o;++i){const o=t[i],s=r[o.id];!1!==s.needsUpdate&&o.setValue(e,s.value,n)}}static seqWithValue(e,t){const r=[];for(let n=0,i=e.length;n!==i;++n){const i=e[n];i.id in t&&r.push(i)}return r}}function ac(e,t,r){const n=e.createShader(t);return e.shaderSource(n,r),e.compileShader(n),n}const cc=37297;let lc=0;function uc(e,t,r){const n=e.getShaderParameter(t,e.COMPILE_STATUS),i=e.getShaderInfoLog(t).trim();if(n&&""===i)return"";const o=/ERROR: 0:(\d+)/.exec(i);if(o){const n=parseInt(o[1]);return r.toUpperCase()+"\n\n"+i+"\n\n"+function(e,t){const r=e.split("\n"),n=[],i=Math.max(t-6,0),o=Math.min(t+6,r.length);for(let e=i;e<o;e++){const i=e+1;n.push(`${i===t?">":" "} ${i}: ${r[e]}`)}return n.join("\n")}(e.getShaderSource(t),n)}return i}function hc(e,t){const r=function(e){const t=fn.getPrimaries(fn.workingColorSpace),r=fn.getPrimaries(e);let n;switch(t===r?n="":t===nr&&r===rr?n="LinearDisplayP3ToLinearSRGB":t===rr&&r===nr&&(n="LinearSRGBToLinearDisplayP3"),e){case Zt:case $t:return[n,"LinearTransferOETF"];case Kt:case Qt:return[n,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",e),[n,"LinearTransferOETF"]}}(t);return`vec4 ${e}( vec4 value ) { return ${r[0]}( ${r[1]}( value ) ); }`}function pc(e,t){let r;switch(t){case te:r="Linear";break;case re:r="Reinhard";break;case ne:r="OptimizedCineon";break;case ie:r="ACESFilmic";break;case se:r="AgX";break;case ae:r="Neutral";break;case oe:r="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),r="Linear"}return"vec3 "+e+"( vec3 color ) { return "+r+"ToneMapping( color ); }"}function dc(e){return""!==e}function fc(e,t){const r=t.numSpotLightShadows+t.numSpotLightMaps-t.numSpotLightShadowsWithMaps;return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,t.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,r).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,t.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function mc(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}const gc=/^[ \t]*#include +<([\w\d./]+)>/gm;function yc(e){return e.replace(gc,_c)}const vc=new Map;function _c(e,t){let r=vs[t];if(void 0===r){const e=vc.get(t);if(void 0===e)throw new Error("Can not resolve #include <"+t+">");r=vs[e],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',t,e)}return yc(r)}const bc=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function xc(e){return e.replace(bc,wc)}function wc(e,t,r,n){let i="";for(let e=parseInt(t);e<parseInt(r);e++)i+=n.replace(/\[\s*i\s*\]/g,"[ "+e+" ]").replace(/UNROLLED_LOOP_INDEX/g,e);return i}function Sc(e){let t=`precision ${e.precision} float;\n\tprecision ${e.precision} int;\n\tprecision ${e.precision} sampler2D;\n\tprecision ${e.precision} samplerCube;\n\tprecision ${e.precision} sampler3D;\n\tprecision ${e.precision} sampler2DArray;\n\tprecision ${e.precision} sampler2DShadow;\n\tprecision ${e.precision} samplerCubeShadow;\n\tprecision ${e.precision} sampler2DArrayShadow;\n\tprecision ${e.precision} isampler2D;\n\tprecision ${e.precision} isampler3D;\n\tprecision ${e.precision} isamplerCube;\n\tprecision ${e.precision} isampler2DArray;\n\tprecision ${e.precision} usampler2D;\n\tprecision ${e.precision} usampler3D;\n\tprecision ${e.precision} usamplerCube;\n\tprecision ${e.precision} usampler2DArray;\n\t`;return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function Mc(e,t,r,n){const i=e.getContext(),o=r.defines;let s=r.vertexShader,a=r.fragmentShader;const c=function(e){let t="SHADOWMAP_TYPE_BASIC";return e.shadowMapType===h?t="SHADOWMAP_TYPE_PCF":e.shadowMapType===p?t="SHADOWMAP_TYPE_PCF_SOFT":e.shadowMapType===d&&(t="SHADOWMAP_TYPE_VSM"),t}(r),l=function(e){let t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case he:case pe:t="ENVMAP_TYPE_CUBE";break;case me:t="ENVMAP_TYPE_CUBE_UV"}return t}(r),u=function(e){let t="ENVMAP_MODE_REFLECTION";e.envMap&&e.envMapMode===pe&&(t="ENVMAP_MODE_REFRACTION");return t}(r),f=function(e){let t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case Z:t="ENVMAP_BLENDING_MULTIPLY";break;case Q:t="ENVMAP_BLENDING_MIX";break;case $:t="ENVMAP_BLENDING_ADD"}return t}(r),m=function(e){const t=e.envMapCubeUVHeight;if(null===t)return null;const r=Math.log2(t)-2,n=1/t;return{texelWidth:1/(3*Math.max(Math.pow(2,r),112)),texelHeight:n,maxMip:r}}(r),g=function(e){return[e.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",e.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(dc).join("\n")}(r),y=function(e){const t=[];for(const r in e){const n=e[r];!1!==n&&t.push("#define "+r+" "+n)}return t.join("\n")}(o),v=i.createProgram();let _,b,x=r.glslVersion?"#version "+r.glslVersion+"\n":"";r.isRawShaderMaterial?(_=["#define SHADER_TYPE "+r.shaderType,"#define SHADER_NAME "+r.shaderName,y].filter(dc).join("\n"),_.length>0&&(_+="\n"),b=["#define SHADER_TYPE "+r.shaderType,"#define SHADER_NAME "+r.shaderName,y].filter(dc).join("\n"),b.length>0&&(b+="\n")):(_=[Sc(r),"#define SHADER_TYPE "+r.shaderType,"#define SHADER_NAME "+r.shaderName,y,r.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",r.batching?"#define USE_BATCHING":"",r.batchingColor?"#define USE_BATCHING_COLOR":"",r.instancing?"#define USE_INSTANCING":"",r.instancingColor?"#define USE_INSTANCING_COLOR":"",r.instancingMorph?"#define USE_INSTANCING_MORPH":"",r.useFog&&r.fog?"#define USE_FOG":"",r.useFog&&r.fogExp2?"#define FOG_EXP2":"",r.map?"#define USE_MAP":"",r.envMap?"#define USE_ENVMAP":"",r.envMap?"#define "+u:"",r.lightMap?"#define USE_LIGHTMAP":"",r.aoMap?"#define USE_AOMAP":"",r.bumpMap?"#define USE_BUMPMAP":"",r.normalMap?"#define USE_NORMALMAP":"",r.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",r.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",r.displacementMap?"#define USE_DISPLACEMENTMAP":"",r.emissiveMap?"#define USE_EMISSIVEMAP":"",r.anisotropy?"#define USE_ANISOTROPY":"",r.anisotropyMap?"#define USE_ANISOTROPYMAP":"",r.clearcoatMap?"#define USE_CLEARCOATMAP":"",r.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",r.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",r.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",r.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",r.specularMap?"#define USE_SPECULARMAP":"",r.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",r.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",r.roughnessMap?"#define USE_ROUGHNESSMAP":"",r.metalnessMap?"#define USE_METALNESSMAP":"",r.alphaMap?"#define USE_ALPHAMAP":"",r.alphaHash?"#define USE_ALPHAHASH":"",r.transmission?"#define USE_TRANSMISSION":"",r.transmissionMap?"#define USE_TRANSMISSIONMAP":"",r.thicknessMap?"#define USE_THICKNESSMAP":"",r.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",r.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",r.mapUv?"#define MAP_UV "+r.mapUv:"",r.alphaMapUv?"#define ALPHAMAP_UV "+r.alphaMapUv:"",r.lightMapUv?"#define LIGHTMAP_UV "+r.lightMapUv:"",r.aoMapUv?"#define AOMAP_UV "+r.aoMapUv:"",r.emissiveMapUv?"#define EMISSIVEMAP_UV "+r.emissiveMapUv:"",r.bumpMapUv?"#define BUMPMAP_UV "+r.bumpMapUv:"",r.normalMapUv?"#define NORMALMAP_UV "+r.normalMapUv:"",r.displacementMapUv?"#define DISPLACEMENTMAP_UV "+r.displacementMapUv:"",r.metalnessMapUv?"#define METALNESSMAP_UV "+r.metalnessMapUv:"",r.roughnessMapUv?"#define ROUGHNESSMAP_UV "+r.roughnessMapUv:"",r.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+r.anisotropyMapUv:"",r.clearcoatMapUv?"#define CLEARCOATMAP_UV "+r.clearcoatMapUv:"",r.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+r.clearcoatNormalMapUv:"",r.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+r.clearcoatRoughnessMapUv:"",r.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+r.iridescenceMapUv:"",r.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+r.iridescenceThicknessMapUv:"",r.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+r.sheenColorMapUv:"",r.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+r.sheenRoughnessMapUv:"",r.specularMapUv?"#define SPECULARMAP_UV "+r.specularMapUv:"",r.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+r.specularColorMapUv:"",r.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+r.specularIntensityMapUv:"",r.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+r.transmissionMapUv:"",r.thicknessMapUv?"#define THICKNESSMAP_UV "+r.thicknessMapUv:"",r.vertexTangents&&!1===r.flatShading?"#define USE_TANGENT":"",r.vertexColors?"#define USE_COLOR":"",r.vertexAlphas?"#define USE_COLOR_ALPHA":"",r.vertexUv1s?"#define USE_UV1":"",r.vertexUv2s?"#define USE_UV2":"",r.vertexUv3s?"#define USE_UV3":"",r.pointsUvs?"#define USE_POINTS_UV":"",r.flatShading?"#define FLAT_SHADED":"",r.skinning?"#define USE_SKINNING":"",r.morphTargets?"#define USE_MORPHTARGETS":"",r.morphNormals&&!1===r.flatShading?"#define USE_MORPHNORMALS":"",r.morphColors?"#define USE_MORPHCOLORS":"",r.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+r.morphTextureStride:"",r.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+r.morphTargetsCount:"",r.doubleSided?"#define DOUBLE_SIDED":"",r.flipSided?"#define FLIP_SIDED":"",r.shadowMapEnabled?"#define USE_SHADOWMAP":"",r.shadowMapEnabled?"#define "+c:"",r.sizeAttenuation?"#define USE_SIZEATTENUATION":"",r.numLightProbes>0?"#define USE_LIGHT_PROBES":"",r.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","\tuniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","\tattribute vec2 uv1;","#endif","#ifdef USE_UV2","\tattribute vec2 uv2;","#endif","#ifdef USE_UV3","\tattribute vec2 uv3;","#endif","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(dc).join("\n"),b=[Sc(r),"#define SHADER_TYPE "+r.shaderType,"#define SHADER_NAME "+r.shaderName,y,r.useFog&&r.fog?"#define USE_FOG":"",r.useFog&&r.fogExp2?"#define FOG_EXP2":"",r.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",r.map?"#define USE_MAP":"",r.matcap?"#define USE_MATCAP":"",r.envMap?"#define USE_ENVMAP":"",r.envMap?"#define "+l:"",r.envMap?"#define "+u:"",r.envMap?"#define "+f:"",m?"#define CUBEUV_TEXEL_WIDTH "+m.texelWidth:"",m?"#define CUBEUV_TEXEL_HEIGHT "+m.texelHeight:"",m?"#define CUBEUV_MAX_MIP "+m.maxMip+".0":"",r.lightMap?"#define USE_LIGHTMAP":"",r.aoMap?"#define USE_AOMAP":"",r.bumpMap?"#define USE_BUMPMAP":"",r.normalMap?"#define USE_NORMALMAP":"",r.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",r.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",r.emissiveMap?"#define USE_EMISSIVEMAP":"",r.anisotropy?"#define USE_ANISOTROPY":"",r.anisotropyMap?"#define USE_ANISOTROPYMAP":"",r.clearcoat?"#define USE_CLEARCOAT":"",r.clearcoatMap?"#define USE_CLEARCOATMAP":"",r.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",r.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",r.dispersion?"#define USE_DISPERSION":"",r.iridescence?"#define USE_IRIDESCENCE":"",r.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",r.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",r.specularMap?"#define USE_SPECULARMAP":"",r.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",r.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",r.roughnessMap?"#define USE_ROUGHNESSMAP":"",r.metalnessMap?"#define USE_METALNESSMAP":"",r.alphaMap?"#define USE_ALPHAMAP":"",r.alphaTest?"#define USE_ALPHATEST":"",r.alphaHash?"#define USE_ALPHAHASH":"",r.sheen?"#define USE_SHEEN":"",r.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",r.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",r.transmission?"#define USE_TRANSMISSION":"",r.transmissionMap?"#define USE_TRANSMISSIONMAP":"",r.thicknessMap?"#define USE_THICKNESSMAP":"",r.vertexTangents&&!1===r.flatShading?"#define USE_TANGENT":"",r.vertexColors||r.instancingColor||r.batchingColor?"#define USE_COLOR":"",r.vertexAlphas?"#define USE_COLOR_ALPHA":"",r.vertexUv1s?"#define USE_UV1":"",r.vertexUv2s?"#define USE_UV2":"",r.vertexUv3s?"#define USE_UV3":"",r.pointsUvs?"#define USE_POINTS_UV":"",r.gradientMap?"#define USE_GRADIENTMAP":"",r.flatShading?"#define FLAT_SHADED":"",r.doubleSided?"#define DOUBLE_SIDED":"",r.flipSided?"#define FLIP_SIDED":"",r.shadowMapEnabled?"#define USE_SHADOWMAP":"",r.shadowMapEnabled?"#define "+c:"",r.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",r.numLightProbes>0?"#define USE_LIGHT_PROBES":"",r.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",r.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",r.toneMapping!==ee?"#define TONE_MAPPING":"",r.toneMapping!==ee?vs.tonemapping_pars_fragment:"",r.toneMapping!==ee?pc("toneMapping",r.toneMapping):"",r.dithering?"#define DITHERING":"",r.opaque?"#define OPAQUE":"",vs.colorspace_pars_fragment,hc("linearToOutputTexel",r.outputColorSpace),r.useDepthPacking?"#define DEPTH_PACKING "+r.depthPacking:"","\n"].filter(dc).join("\n")),s=yc(s),s=fc(s,r),s=mc(s,r),a=yc(a),a=fc(a,r),a=mc(a,r),s=xc(s),a=xc(a),!0!==r.isRawShaderMaterial&&(x="#version 300 es\n",_=[g,"#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+_,b=["#define varying in",r.glslVersion===Br?"":"layout(location = 0) out highp vec4 pc_fragColor;",r.glslVersion===Br?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+b);const w=x+_+s,S=x+b+a,M=ac(i,i.VERTEX_SHADER,w),T=ac(i,i.FRAGMENT_SHADER,S);function E(t){if(e.debug.checkShaderErrors){const r=i.getProgramInfoLog(v).trim(),n=i.getShaderInfoLog(M).trim(),o=i.getShaderInfoLog(T).trim();let s=!0,a=!0;if(!1===i.getProgramParameter(v,i.LINK_STATUS))if(s=!1,"function"==typeof e.debug.onShaderError)e.debug.onShaderError(i,v,M,T);else{const e=uc(i,M,"vertex"),n=uc(i,T,"fragment");console.error("THREE.WebGLProgram: Shader Error "+i.getError()+" - VALIDATE_STATUS "+i.getProgramParameter(v,i.VALIDATE_STATUS)+"\n\nMaterial Name: "+t.name+"\nMaterial Type: "+t.type+"\n\nProgram Info Log: "+r+"\n"+e+"\n"+n)}else""!==r?console.warn("THREE.WebGLProgram: Program Info Log:",r):""!==n&&""!==o||(a=!1);a&&(t.diagnostics={runnable:s,programLog:r,vertexShader:{log:n,prefix:_},fragmentShader:{log:o,prefix:b}})}i.deleteShader(M),i.deleteShader(T),A=new sc(i,v),R=function(e,t){const r={},n=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES);for(let i=0;i<n;i++){const n=e.getActiveAttrib(t,i),o=n.name;let s=1;n.type===e.FLOAT_MAT2&&(s=2),n.type===e.FLOAT_MAT3&&(s=3),n.type===e.FLOAT_MAT4&&(s=4),r[o]={type:n.type,location:e.getAttribLocation(t,o),locationSize:s}}return r}(i,v)}let A,R;i.attachShader(v,M),i.attachShader(v,T),void 0!==r.index0AttributeName?i.bindAttribLocation(v,0,r.index0AttributeName):!0===r.morphTargets&&i.bindAttribLocation(v,0,"position"),i.linkProgram(v),this.getUniforms=function(){return void 0===A&&E(this),A},this.getAttributes=function(){return void 0===R&&E(this),R};let C=!1===r.rendererExtensionParallelShaderCompile;return this.isReady=function(){return!1===C&&(C=i.getProgramParameter(v,cc)),C},this.destroy=function(){n.releaseStatesOfProgram(this),i.deleteProgram(v),this.program=void 0},this.type=r.shaderType,this.name=r.shaderName,this.id=lc++,this.cacheKey=t,this.usedTimes=1,this.program=v,this.vertexShader=M,this.fragmentShader=T,this}let Tc=0;class Ec{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,r=e.fragmentShader,n=this._getShaderStage(t),i=this._getShaderStage(r),o=this._getShaderCacheForMaterial(e);return!1===o.has(n)&&(o.add(n),n.usedTimes++),!1===o.has(i)&&(o.add(i),i.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const e of t)e.usedTimes--,0===e.usedTimes&&this.shaderCache.delete(e.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let r=t.get(e);return void 0===r&&(r=new Set,t.set(e,r)),r}_getShaderStage(e){const t=this.shaderCache;let r=t.get(e);return void 0===r&&(r=new Ac(e),t.set(e,r)),r}}class Ac{constructor(e){this.id=Tc++,this.code=e,this.usedTimes=0}}function Rc(e,t,r,n,i,o,s){const a=new _i,c=new Ec,l=new Set,u=[],h=i.logarithmicDepthBuffer,p=i.vertexTextures;let d=i.precision;const f={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function y(e){return l.add(e),0===e?"uv":`uv${e}`}return{getParameters:function(o,a,u,_,b){const x=_.fog,w=b.geometry,S=o.isMeshStandardMaterial?_.environment:null,M=(o.isMeshStandardMaterial?r:t).get(o.envMap||S),T=M&&M.mapping===me?M.image.height:null,E=f[o.type];null!==o.precision&&(d=i.getMaxPrecision(o.precision),d!==o.precision&&console.warn("THREE.WebGLProgram.getParameters:",o.precision,"not supported, using",d,"instead."));const A=w.morphAttributes.position||w.morphAttributes.normal||w.morphAttributes.color,R=void 0!==A?A.length:0;let C,I,O,P,N=0;if(void 0!==w.morphAttributes.position&&(N=1),void 0!==w.morphAttributes.normal&&(N=2),void 0!==w.morphAttributes.color&&(N=3),E){const e=bs[E];C=e.vertexShader,I=e.fragmentShader}else C=o.vertexShader,I=o.fragmentShader,c.update(o),O=c.getVertexShaderID(o),P=c.getFragmentShaderID(o);const L=e.getRenderTarget(),U=!0===b.isInstancedMesh,D=!0===b.isBatchedMesh,F=!!o.map,B=!!o.matcap,k=!!M,j=!!o.aoMap,G=!!o.lightMap,z=!!o.bumpMap,V=!!o.normalMap,H=!!o.displacementMap,W=!!o.emissiveMap,X=!!o.metalnessMap,Y=!!o.roughnessMap,q=o.anisotropy>0,J=o.clearcoat>0,K=o.dispersion>0,Z=o.iridescence>0,Q=o.sheen>0,$=o.transmission>0,te=q&&!!o.anisotropyMap,re=J&&!!o.clearcoatMap,ne=J&&!!o.clearcoatNormalMap,ie=J&&!!o.clearcoatRoughnessMap,oe=Z&&!!o.iridescenceMap,se=Z&&!!o.iridescenceThicknessMap,ae=Q&&!!o.sheenColorMap,ce=Q&&!!o.sheenRoughnessMap,le=!!o.specularMap,ue=!!o.specularColorMap,he=!!o.specularIntensityMap,pe=$&&!!o.transmissionMap,de=$&&!!o.thicknessMap,fe=!!o.gradientMap,ge=!!o.alphaMap,ye=o.alphaTest>0,ve=!!o.alphaHash,_e=!!o.extensions;let be=ee;o.toneMapped&&(null!==L&&!0!==L.isXRRenderTarget||(be=e.toneMapping));const xe={shaderID:E,shaderType:o.type,shaderName:o.name,vertexShader:C,fragmentShader:I,defines:o.defines,customVertexShaderID:O,customFragmentShaderID:P,isRawShaderMaterial:!0===o.isRawShaderMaterial,glslVersion:o.glslVersion,precision:d,batching:D,batchingColor:D&&null!==b._colorsTexture,instancing:U,instancingColor:U&&null!==b.instanceColor,instancingMorph:U&&null!==b.morphTexture,supportsVertexTextures:p,outputColorSpace:null===L?e.outputColorSpace:!0===L.isXRRenderTarget?L.texture.colorSpace:Zt,alphaToCoverage:!!o.alphaToCoverage,map:F,matcap:B,envMap:k,envMapMode:k&&M.mapping,envMapCubeUVHeight:T,aoMap:j,lightMap:G,bumpMap:z,normalMap:V,displacementMap:p&&H,emissiveMap:W,normalMapObjectSpace:V&&o.normalMapType===qt,normalMapTangentSpace:V&&o.normalMapType===Yt,metalnessMap:X,roughnessMap:Y,anisotropy:q,anisotropyMap:te,clearcoat:J,clearcoatMap:re,clearcoatNormalMap:ne,clearcoatRoughnessMap:ie,dispersion:K,iridescence:Z,iridescenceMap:oe,iridescenceThicknessMap:se,sheen:Q,sheenColorMap:ae,sheenRoughnessMap:ce,specularMap:le,specularColorMap:ue,specularIntensityMap:he,transmission:$,transmissionMap:pe,thicknessMap:de,gradientMap:fe,opaque:!1===o.transparent&&o.blending===v&&!1===o.alphaToCoverage,alphaMap:ge,alphaTest:ye,alphaHash:ve,combine:o.combine,mapUv:F&&y(o.map.channel),aoMapUv:j&&y(o.aoMap.channel),lightMapUv:G&&y(o.lightMap.channel),bumpMapUv:z&&y(o.bumpMap.channel),normalMapUv:V&&y(o.normalMap.channel),displacementMapUv:H&&y(o.displacementMap.channel),emissiveMapUv:W&&y(o.emissiveMap.channel),metalnessMapUv:X&&y(o.metalnessMap.channel),roughnessMapUv:Y&&y(o.roughnessMap.channel),anisotropyMapUv:te&&y(o.anisotropyMap.channel),clearcoatMapUv:re&&y(o.clearcoatMap.channel),clearcoatNormalMapUv:ne&&y(o.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:ie&&y(o.clearcoatRoughnessMap.channel),iridescenceMapUv:oe&&y(o.iridescenceMap.channel),iridescenceThicknessMapUv:se&&y(o.iridescenceThicknessMap.channel),sheenColorMapUv:ae&&y(o.sheenColorMap.channel),sheenRoughnessMapUv:ce&&y(o.sheenRoughnessMap.channel),specularMapUv:le&&y(o.specularMap.channel),specularColorMapUv:ue&&y(o.specularColorMap.channel),specularIntensityMapUv:he&&y(o.specularIntensityMap.channel),transmissionMapUv:pe&&y(o.transmissionMap.channel),thicknessMapUv:de&&y(o.thicknessMap.channel),alphaMapUv:ge&&y(o.alphaMap.channel),vertexTangents:!!w.attributes.tangent&&(V||q),vertexColors:o.vertexColors,vertexAlphas:!0===o.vertexColors&&!!w.attributes.color&&4===w.attributes.color.itemSize,pointsUvs:!0===b.isPoints&&!!w.attributes.uv&&(F||ge),fog:!!x,useFog:!0===o.fog,fogExp2:!!x&&x.isFogExp2,flatShading:!0===o.flatShading,sizeAttenuation:!0===o.sizeAttenuation,logarithmicDepthBuffer:h,skinning:!0===b.isSkinnedMesh,morphTargets:void 0!==w.morphAttributes.position,morphNormals:void 0!==w.morphAttributes.normal,morphColors:void 0!==w.morphAttributes.color,morphTargetsCount:R,morphTextureStride:N,numDirLights:a.directional.length,numPointLights:a.point.length,numSpotLights:a.spot.length,numSpotLightMaps:a.spotLightMap.length,numRectAreaLights:a.rectArea.length,numHemiLights:a.hemi.length,numDirLightShadows:a.directionalShadowMap.length,numPointLightShadows:a.pointShadowMap.length,numSpotLightShadows:a.spotShadowMap.length,numSpotLightShadowsWithMaps:a.numSpotLightShadowsWithMaps,numLightProbes:a.numLightProbes,numClippingPlanes:s.numPlanes,numClipIntersection:s.numIntersection,dithering:o.dithering,shadowMapEnabled:e.shadowMap.enabled&&u.length>0,shadowMapType:e.shadowMap.type,toneMapping:be,decodeVideoTexture:F&&!0===o.map.isVideoTexture&&fn.getTransfer(o.map.colorSpace)===tr,premultipliedAlpha:o.premultipliedAlpha,doubleSided:o.side===g,flipSided:o.side===m,useDepthPacking:o.depthPacking>=0,depthPacking:o.depthPacking||0,index0AttributeName:o.index0AttributeName,extensionClipCullDistance:_e&&!0===o.extensions.clipCullDistance&&n.has("WEBGL_clip_cull_distance"),extensionMultiDraw:_e&&!0===o.extensions.multiDraw&&n.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:n.has("KHR_parallel_shader_compile"),customProgramCacheKey:o.customProgramCacheKey()};return xe.vertexUv1s=l.has(1),xe.vertexUv2s=l.has(2),xe.vertexUv3s=l.has(3),l.clear(),xe},getProgramCacheKey:function(t){const r=[];if(t.shaderID?r.push(t.shaderID):(r.push(t.customVertexShaderID),r.push(t.customFragmentShaderID)),void 0!==t.defines)for(const e in t.defines)r.push(e),r.push(t.defines[e]);return!1===t.isRawShaderMaterial&&(!function(e,t){e.push(t.precision),e.push(t.outputColorSpace),e.push(t.envMapMode),e.push(t.envMapCubeUVHeight),e.push(t.mapUv),e.push(t.alphaMapUv),e.push(t.lightMapUv),e.push(t.aoMapUv),e.push(t.bumpMapUv),e.push(t.normalMapUv),e.push(t.displacementMapUv),e.push(t.emissiveMapUv),e.push(t.metalnessMapUv),e.push(t.roughnessMapUv),e.push(t.anisotropyMapUv),e.push(t.clearcoatMapUv),e.push(t.clearcoatNormalMapUv),e.push(t.clearcoatRoughnessMapUv),e.push(t.iridescenceMapUv),e.push(t.iridescenceThicknessMapUv),e.push(t.sheenColorMapUv),e.push(t.sheenRoughnessMapUv),e.push(t.specularMapUv),e.push(t.specularColorMapUv),e.push(t.specularIntensityMapUv),e.push(t.transmissionMapUv),e.push(t.thicknessMapUv),e.push(t.combine),e.push(t.fogExp2),e.push(t.sizeAttenuation),e.push(t.morphTargetsCount),e.push(t.morphAttributeCount),e.push(t.numDirLights),e.push(t.numPointLights),e.push(t.numSpotLights),e.push(t.numSpotLightMaps),e.push(t.numHemiLights),e.push(t.numRectAreaLights),e.push(t.numDirLightShadows),e.push(t.numPointLightShadows),e.push(t.numSpotLightShadows),e.push(t.numSpotLightShadowsWithMaps),e.push(t.numLightProbes),e.push(t.shadowMapType),e.push(t.toneMapping),e.push(t.numClippingPlanes),e.push(t.numClipIntersection),e.push(t.depthPacking)}(r,t),function(e,t){a.disableAll(),t.supportsVertexTextures&&a.enable(0);t.instancing&&a.enable(1);t.instancingColor&&a.enable(2);t.instancingMorph&&a.enable(3);t.matcap&&a.enable(4);t.envMap&&a.enable(5);t.normalMapObjectSpace&&a.enable(6);t.normalMapTangentSpace&&a.enable(7);t.clearcoat&&a.enable(8);t.iridescence&&a.enable(9);t.alphaTest&&a.enable(10);t.vertexColors&&a.enable(11);t.vertexAlphas&&a.enable(12);t.vertexUv1s&&a.enable(13);t.vertexUv2s&&a.enable(14);t.vertexUv3s&&a.enable(15);t.vertexTangents&&a.enable(16);t.anisotropy&&a.enable(17);t.alphaHash&&a.enable(18);t.batching&&a.enable(19);t.dispersion&&a.enable(20);t.batchingColor&&a.enable(21);e.push(a.mask),a.disableAll(),t.fog&&a.enable(0);t.useFog&&a.enable(1);t.flatShading&&a.enable(2);t.logarithmicDepthBuffer&&a.enable(3);t.skinning&&a.enable(4);t.morphTargets&&a.enable(5);t.morphNormals&&a.enable(6);t.morphColors&&a.enable(7);t.premultipliedAlpha&&a.enable(8);t.shadowMapEnabled&&a.enable(9);t.doubleSided&&a.enable(10);t.flipSided&&a.enable(11);t.useDepthPacking&&a.enable(12);t.dithering&&a.enable(13);t.transmission&&a.enable(14);t.sheen&&a.enable(15);t.opaque&&a.enable(16);t.pointsUvs&&a.enable(17);t.decodeVideoTexture&&a.enable(18);t.alphaToCoverage&&a.enable(19);e.push(a.mask)}(r,t),r.push(e.outputColorSpace)),r.push(t.customProgramCacheKey),r.join()},getUniforms:function(e){const t=f[e.type];let r;if(t){const e=bs[t];r=Zo.clone(e.uniforms)}else r=e.uniforms;return r},acquireProgram:function(t,r){let n;for(let e=0,t=u.length;e<t;e++){const t=u[e];if(t.cacheKey===r){n=t,++n.usedTimes;break}}return void 0===n&&(n=new Mc(e,r,t,o),u.push(n)),n},releaseProgram:function(e){if(0==--e.usedTimes){const t=u.indexOf(e);u[t]=u[u.length-1],u.pop(),e.destroy()}},releaseShaderCache:function(e){c.remove(e)},programs:u,dispose:function(){c.dispose()}}}function Cc(){let e=new WeakMap;return{get:function(t){let r=e.get(t);return void 0===r&&(r={},e.set(t,r)),r},remove:function(t){e.delete(t)},update:function(t,r,n){e.get(t)[r]=n},dispose:function(){e=new WeakMap}}}function Ic(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function Oc(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function Pc(){const e=[];let t=0;const r=[],n=[],i=[];function o(r,n,i,o,s,a){let c=e[t];return void 0===c?(c={id:r.id,object:r,geometry:n,material:i,groupOrder:o,renderOrder:r.renderOrder,z:s,group:a},e[t]=c):(c.id=r.id,c.object=r,c.geometry=n,c.material=i,c.groupOrder=o,c.renderOrder=r.renderOrder,c.z=s,c.group=a),t++,c}return{opaque:r,transmissive:n,transparent:i,init:function(){t=0,r.length=0,n.length=0,i.length=0},push:function(e,t,s,a,c,l){const u=o(e,t,s,a,c,l);s.transmission>0?n.push(u):!0===s.transparent?i.push(u):r.push(u)},unshift:function(e,t,s,a,c,l){const u=o(e,t,s,a,c,l);s.transmission>0?n.unshift(u):!0===s.transparent?i.unshift(u):r.unshift(u)},finish:function(){for(let r=t,n=e.length;r<n;r++){const t=e[r];if(null===t.id)break;t.id=null,t.object=null,t.geometry=null,t.material=null,t.group=null}},sort:function(e,t){r.length>1&&r.sort(e||Ic),n.length>1&&n.sort(t||Oc),i.length>1&&i.sort(t||Oc)}}}function Nc(){let e=new WeakMap;return{get:function(t,r){const n=e.get(t);let i;return void 0===n?(i=new Pc,e.set(t,[i])):r>=n.length?(i=new Pc,n.push(i)):i=n[r],i},dispose:function(){e=new WeakMap}}}function Lc(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let r;switch(t.type){case"DirectionalLight":r={direction:new Pn,color:new Zi};break;case"SpotLight":r={position:new Pn,direction:new Pn,color:new Zi,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":r={position:new Pn,color:new Zi,distance:0,decay:0};break;case"HemisphereLight":r={direction:new Pn,skyColor:new Zi,groundColor:new Zi};break;case"RectAreaLight":r={color:new Zi,position:new Pn,halfWidth:new Pn,halfHeight:new Pn}}return e[t.id]=r,r}}}let Uc=0;function Dc(e,t){return(t.castShadow?2:0)-(e.castShadow?2:0)+(t.map?1:0)-(e.map?1:0)}function Fc(e){const t=new Lc,r=function(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let r;switch(t.type){case"DirectionalLight":case"SpotLight":r={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new $r};break;case"PointLight":r={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new $r,shadowCameraNear:1,shadowCameraFar:1e3}}return e[t.id]=r,r}}}(),n={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let e=0;e<9;e++)n.probe.push(new Pn);const i=new Pn,o=new ci,s=new ci;return{setup:function(i){let o=0,s=0,a=0;for(let e=0;e<9;e++)n.probe[e].set(0,0,0);let c=0,l=0,u=0,h=0,p=0,d=0,f=0,m=0,g=0,y=0,v=0;i.sort(Dc);for(let e=0,_=i.length;e<_;e++){const _=i[e],b=_.color,x=_.intensity,w=_.distance,S=_.shadow&&_.shadow.map?_.shadow.map.texture:null;if(_.isAmbientLight)o+=b.r*x,s+=b.g*x,a+=b.b*x;else if(_.isLightProbe){for(let e=0;e<9;e++)n.probe[e].addScaledVector(_.sh.coefficients[e],x);v++}else if(_.isDirectionalLight){const e=t.get(_);if(e.color.copy(_.color).multiplyScalar(_.intensity),_.castShadow){const e=_.shadow,t=r.get(_);t.shadowBias=e.bias,t.shadowNormalBias=e.normalBias,t.shadowRadius=e.radius,t.shadowMapSize=e.mapSize,n.directionalShadow[c]=t,n.directionalShadowMap[c]=S,n.directionalShadowMatrix[c]=_.shadow.matrix,d++}n.directional[c]=e,c++}else if(_.isSpotLight){const e=t.get(_);e.position.setFromMatrixPosition(_.matrixWorld),e.color.copy(b).multiplyScalar(x),e.distance=w,e.coneCos=Math.cos(_.angle),e.penumbraCos=Math.cos(_.angle*(1-_.penumbra)),e.decay=_.decay,n.spot[u]=e;const i=_.shadow;if(_.map&&(n.spotLightMap[g]=_.map,g++,i.updateMatrices(_),_.castShadow&&y++),n.spotLightMatrix[u]=i.matrix,_.castShadow){const e=r.get(_);e.shadowBias=i.bias,e.shadowNormalBias=i.normalBias,e.shadowRadius=i.radius,e.shadowMapSize=i.mapSize,n.spotShadow[u]=e,n.spotShadowMap[u]=S,m++}u++}else if(_.isRectAreaLight){const e=t.get(_);e.color.copy(b).multiplyScalar(x),e.halfWidth.set(.5*_.width,0,0),e.halfHeight.set(0,.5*_.height,0),n.rectArea[h]=e,h++}else if(_.isPointLight){const e=t.get(_);if(e.color.copy(_.color).multiplyScalar(_.intensity),e.distance=_.distance,e.decay=_.decay,_.castShadow){const e=_.shadow,t=r.get(_);t.shadowBias=e.bias,t.shadowNormalBias=e.normalBias,t.shadowRadius=e.radius,t.shadowMapSize=e.mapSize,t.shadowCameraNear=e.camera.near,t.shadowCameraFar=e.camera.far,n.pointShadow[l]=t,n.pointShadowMap[l]=S,n.pointShadowMatrix[l]=_.shadow.matrix,f++}n.point[l]=e,l++}else if(_.isHemisphereLight){const e=t.get(_);e.skyColor.copy(_.color).multiplyScalar(x),e.groundColor.copy(_.groundColor).multiplyScalar(x),n.hemi[p]=e,p++}}h>0&&(!0===e.has("OES_texture_float_linear")?(n.rectAreaLTC1=_s.LTC_FLOAT_1,n.rectAreaLTC2=_s.LTC_FLOAT_2):(n.rectAreaLTC1=_s.LTC_HALF_1,n.rectAreaLTC2=_s.LTC_HALF_2)),n.ambient[0]=o,n.ambient[1]=s,n.ambient[2]=a;const _=n.hash;_.directionalLength===c&&_.pointLength===l&&_.spotLength===u&&_.rectAreaLength===h&&_.hemiLength===p&&_.numDirectionalShadows===d&&_.numPointShadows===f&&_.numSpotShadows===m&&_.numSpotMaps===g&&_.numLightProbes===v||(n.directional.length=c,n.spot.length=u,n.rectArea.length=h,n.point.length=l,n.hemi.length=p,n.directionalShadow.length=d,n.directionalShadowMap.length=d,n.pointShadow.length=f,n.pointShadowMap.length=f,n.spotShadow.length=m,n.spotShadowMap.length=m,n.directionalShadowMatrix.length=d,n.pointShadowMatrix.length=f,n.spotLightMatrix.length=m+g-y,n.spotLightMap.length=g,n.numSpotLightShadowsWithMaps=y,n.numLightProbes=v,_.directionalLength=c,_.pointLength=l,_.spotLength=u,_.rectAreaLength=h,_.hemiLength=p,_.numDirectionalShadows=d,_.numPointShadows=f,_.numSpotShadows=m,_.numSpotMaps=g,_.numLightProbes=v,n.version=Uc++)},setupView:function(e,t){let r=0,a=0,c=0,l=0,u=0;const h=t.matrixWorldInverse;for(let t=0,p=e.length;t<p;t++){const p=e[t];if(p.isDirectionalLight){const e=n.directional[r];e.direction.setFromMatrixPosition(p.matrixWorld),i.setFromMatrixPosition(p.target.matrixWorld),e.direction.sub(i),e.direction.transformDirection(h),r++}else if(p.isSpotLight){const e=n.spot[c];e.position.setFromMatrixPosition(p.matrixWorld),e.position.applyMatrix4(h),e.direction.setFromMatrixPosition(p.matrixWorld),i.setFromMatrixPosition(p.target.matrixWorld),e.direction.sub(i),e.direction.transformDirection(h),c++}else if(p.isRectAreaLight){const e=n.rectArea[l];e.position.setFromMatrixPosition(p.matrixWorld),e.position.applyMatrix4(h),s.identity(),o.copy(p.matrixWorld),o.premultiply(h),s.extractRotation(o),e.halfWidth.set(.5*p.width,0,0),e.halfHeight.set(0,.5*p.height,0),e.halfWidth.applyMatrix4(s),e.halfHeight.applyMatrix4(s),l++}else if(p.isPointLight){const e=n.point[a];e.position.setFromMatrixPosition(p.matrixWorld),e.position.applyMatrix4(h),a++}else if(p.isHemisphereLight){const e=n.hemi[u];e.direction.setFromMatrixPosition(p.matrixWorld),e.direction.transformDirection(h),u++}}},state:n}}function Bc(e){const t=new Fc(e),r=[],n=[];const i={lightsArray:r,shadowsArray:n,camera:null,lights:t,transmissionRenderTarget:{}};return{init:function(e){i.camera=e,r.length=0,n.length=0},state:i,setupLights:function(){t.setup(r)},setupLightsView:function(e){t.setupView(r,e)},pushLight:function(e){r.push(e)},pushShadow:function(e){n.push(e)}}}function kc(e){let t=new WeakMap;return{get:function(r,n=0){const i=t.get(r);let o;return void 0===i?(o=new Bc(e),t.set(r,[o])):n>=i.length?(o=new Bc(e),i.push(o)):o=i[n],o},dispose:function(){t=new WeakMap}}}class jc extends eo{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=Wt,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class Gc extends eo{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}function zc(e,t,r){let n=new fs;const i=new $r,o=new $r,s=new Mn,a=new jc({depthPacking:Xt}),c=new Gc,l={},u=r.maxTextureSize,p={[f]:m,[m]:f,[g]:g},v=new Qo({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new $r},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),_=v.clone();_.defines.HORIZONTAL_PASS=1;const b=new Ao;b.setAttribute("position",new lo(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const x=new Wo(b,v),w=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=h;let S=this.type;function M(r,n){const o=t.update(x);v.defines.VSM_SAMPLES!==r.blurSamples&&(v.defines.VSM_SAMPLES=r.blurSamples,_.defines.VSM_SAMPLES=r.blurSamples,v.needsUpdate=!0,_.needsUpdate=!0),null===r.mapPass&&(r.mapPass=new En(i.x,i.y)),v.uniforms.shadow_pass.value=r.map.texture,v.uniforms.resolution.value=r.mapSize,v.uniforms.radius.value=r.radius,e.setRenderTarget(r.mapPass),e.clear(),e.renderBufferDirect(n,null,o,v,x,null),_.uniforms.shadow_pass.value=r.mapPass.texture,_.uniforms.resolution.value=r.mapSize,_.uniforms.radius.value=r.radius,e.setRenderTarget(r.map),e.clear(),e.renderBufferDirect(n,null,o,_,x,null)}function T(t,r,n,i){let o=null;const s=!0===n.isPointLight?t.customDistanceMaterial:t.customDepthMaterial;if(void 0!==s)o=s;else if(o=!0===n.isPointLight?c:a,e.localClippingEnabled&&!0===r.clipShadows&&Array.isArray(r.clippingPlanes)&&0!==r.clippingPlanes.length||r.displacementMap&&0!==r.displacementScale||r.alphaMap&&r.alphaTest>0||r.map&&r.alphaTest>0){const e=o.uuid,t=r.uuid;let n=l[e];void 0===n&&(n={},l[e]=n);let i=n[t];void 0===i&&(i=o.clone(),n[t]=i,r.addEventListener("dispose",A)),o=i}if(o.visible=r.visible,o.wireframe=r.wireframe,o.side=i===d?null!==r.shadowSide?r.shadowSide:r.side:null!==r.shadowSide?r.shadowSide:p[r.side],o.alphaMap=r.alphaMap,o.alphaTest=r.alphaTest,o.map=r.map,o.clipShadows=r.clipShadows,o.clippingPlanes=r.clippingPlanes,o.clipIntersection=r.clipIntersection,o.displacementMap=r.displacementMap,o.displacementScale=r.displacementScale,o.displacementBias=r.displacementBias,o.wireframeLinewidth=r.wireframeLinewidth,o.linewidth=r.linewidth,!0===n.isPointLight&&!0===o.isMeshDistanceMaterial){e.properties.get(o).light=n}return o}function E(r,i,o,s,a){if(!1===r.visible)return;if(r.layers.test(i.layers)&&(r.isMesh||r.isLine||r.isPoints)&&(r.castShadow||r.receiveShadow&&a===d)&&(!r.frustumCulled||n.intersectsObject(r))){r.modelViewMatrix.multiplyMatrices(o.matrixWorldInverse,r.matrixWorld);const n=t.update(r),c=r.material;if(Array.isArray(c)){const t=n.groups;for(let l=0,u=t.length;l<u;l++){const u=t[l],h=c[u.materialIndex];if(h&&h.visible){const t=T(r,h,s,a);r.onBeforeShadow(e,r,i,o,n,t,u),e.renderBufferDirect(o,null,n,t,r,u),r.onAfterShadow(e,r,i,o,n,t,u)}}}else if(c.visible){const t=T(r,c,s,a);r.onBeforeShadow(e,r,i,o,n,t,null),e.renderBufferDirect(o,null,n,t,r,null),r.onAfterShadow(e,r,i,o,n,t,null)}}const c=r.children;for(let e=0,t=c.length;e<t;e++)E(c[e],i,o,s,a)}function A(e){e.target.removeEventListener("dispose",A);for(const t in l){const r=l[t],n=e.target.uuid;if(n in r){r[n].dispose(),delete r[n]}}}this.render=function(t,r,a){if(!1===w.enabled)return;if(!1===w.autoUpdate&&!1===w.needsUpdate)return;if(0===t.length)return;const c=e.getRenderTarget(),l=e.getActiveCubeFace(),h=e.getActiveMipmapLevel(),p=e.state;p.setBlending(y),p.buffers.color.setClear(1,1,1,1),p.buffers.depth.setTest(!0),p.setScissorTest(!1);const f=S!==d&&this.type===d,m=S===d&&this.type!==d;for(let c=0,l=t.length;c<l;c++){const l=t[c],h=l.shadow;if(void 0===h){console.warn("THREE.WebGLShadowMap:",l,"has no shadow.");continue}if(!1===h.autoUpdate&&!1===h.needsUpdate)continue;i.copy(h.mapSize);const g=h.getFrameExtents();if(i.multiply(g),o.copy(h.mapSize),(i.x>u||i.y>u)&&(i.x>u&&(o.x=Math.floor(u/g.x),i.x=o.x*g.x,h.mapSize.x=o.x),i.y>u&&(o.y=Math.floor(u/g.y),i.y=o.y*g.y,h.mapSize.y=o.y)),null===h.map||!0===f||!0===m){const e=this.type!==d?{minFilter:_e,magFilter:_e}:{};null!==h.map&&h.map.dispose(),h.map=new En(i.x,i.y,e),h.map.texture.name=l.name+".shadowMap",h.camera.updateProjectionMatrix()}e.setRenderTarget(h.map),e.clear();const y=h.getViewportCount();for(let e=0;e<y;e++){const t=h.getViewport(e);s.set(o.x*t.x,o.y*t.y,o.x*t.z,o.y*t.w),p.viewport(s),h.updateMatrices(l,e),n=h.getFrustum(),E(r,a,h.camera,l,this.type)}!0!==h.isPointLightShadow&&this.type===d&&M(h,a),h.needsUpdate=!1}S=this.type,w.needsUpdate=!1,e.setRenderTarget(c,l,h)}}function Vc(e){const t=new function(){let t=!1;const r=new Mn;let n=null;const i=new Mn(0,0,0,0);return{setMask:function(r){n===r||t||(e.colorMask(r,r,r,r),n=r)},setLocked:function(e){t=e},setClear:function(t,n,o,s,a){!0===a&&(t*=s,n*=s,o*=s),r.set(t,n,o,s),!1===i.equals(r)&&(e.clearColor(t,n,o,s),i.copy(r))},reset:function(){t=!1,n=null,i.set(-1,0,0,0)}}},r=new function(){let t=!1,r=null,n=null,i=null;return{setTest:function(t){t?Me(e.DEPTH_TEST):Te(e.DEPTH_TEST)},setMask:function(n){r===n||t||(e.depthMask(n),r=n)},setFunc:function(t){if(n!==t){switch(t){case V:e.depthFunc(e.NEVER);break;case H:e.depthFunc(e.ALWAYS);break;case W:e.depthFunc(e.LESS);break;case X:e.depthFunc(e.LEQUAL);break;case Y:e.depthFunc(e.EQUAL);break;case q:e.depthFunc(e.GEQUAL);break;case J:e.depthFunc(e.GREATER);break;case K:e.depthFunc(e.NOTEQUAL);break;default:e.depthFunc(e.LEQUAL)}n=t}},setLocked:function(e){t=e},setClear:function(t){i!==t&&(e.clearDepth(t),i=t)},reset:function(){t=!1,r=null,n=null,i=null}}},n=new function(){let t=!1,r=null,n=null,i=null,o=null,s=null,a=null,c=null,l=null;return{setTest:function(r){t||(r?Me(e.STENCIL_TEST):Te(e.STENCIL_TEST))},setMask:function(n){r===n||t||(e.stencilMask(n),r=n)},setFunc:function(t,r,s){n===t&&i===r&&o===s||(e.stencilFunc(t,r,s),n=t,i=r,o=s)},setOp:function(t,r,n){s===t&&a===r&&c===n||(e.stencilOp(t,r,n),s=t,a=r,c=n)},setLocked:function(e){t=e},setClear:function(t){l!==t&&(e.clearStencil(t),l=t)},reset:function(){t=!1,r=null,n=null,i=null,o=null,s=null,a=null,c=null,l=null}}},i=new WeakMap,o=new WeakMap;let l={},u={},h=new WeakMap,p=[],d=null,f=!1,Z=null,Q=null,$=null,ee=null,te=null,re=null,ne=null,ie=new Zi(0,0,0),oe=0,se=!1,ae=null,ce=null,le=null,ue=null,he=null;const pe=e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let de=!1,fe=0;const me=e.getParameter(e.VERSION);-1!==me.indexOf("WebGL")?(fe=parseFloat(/^WebGL (\d)/.exec(me)[1]),de=fe>=1):-1!==me.indexOf("OpenGL ES")&&(fe=parseFloat(/^OpenGL ES (\d)/.exec(me)[1]),de=fe>=2);let ge=null,ye={};const ve=e.getParameter(e.SCISSOR_BOX),_e=e.getParameter(e.VIEWPORT),be=(new Mn).fromArray(ve),xe=(new Mn).fromArray(_e);function we(t,r,n,i){const o=new Uint8Array(4),s=e.createTexture();e.bindTexture(t,s),e.texParameteri(t,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(t,e.TEXTURE_MAG_FILTER,e.NEAREST);for(let s=0;s<n;s++)t===e.TEXTURE_3D||t===e.TEXTURE_2D_ARRAY?e.texImage3D(r,0,e.RGBA,1,1,i,0,e.RGBA,e.UNSIGNED_BYTE,o):e.texImage2D(r+s,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,o);return s}const Se={};function Me(t){!0!==l[t]&&(e.enable(t),l[t]=!0)}function Te(t){!1!==l[t]&&(e.disable(t),l[t]=!1)}Se[e.TEXTURE_2D]=we(e.TEXTURE_2D,e.TEXTURE_2D,1),Se[e.TEXTURE_CUBE_MAP]=we(e.TEXTURE_CUBE_MAP,e.TEXTURE_CUBE_MAP_POSITIVE_X,6),Se[e.TEXTURE_2D_ARRAY]=we(e.TEXTURE_2D_ARRAY,e.TEXTURE_2D_ARRAY,1,1),Se[e.TEXTURE_3D]=we(e.TEXTURE_3D,e.TEXTURE_3D,1,1),t.setClear(0,0,0,1),r.setClear(1),n.setClear(0),Me(e.DEPTH_TEST),r.setFunc(X),Ce(!1),Ie(a),Me(e.CULL_FACE),Re(y);const Ee={[S]:e.FUNC_ADD,[M]:e.FUNC_SUBTRACT,[T]:e.FUNC_REVERSE_SUBTRACT};Ee[E]=e.MIN,Ee[A]=e.MAX;const Ae={[R]:e.ZERO,[C]:e.ONE,[I]:e.SRC_COLOR,[P]:e.SRC_ALPHA,[B]:e.SRC_ALPHA_SATURATE,[D]:e.DST_COLOR,[L]:e.DST_ALPHA,[O]:e.ONE_MINUS_SRC_COLOR,[N]:e.ONE_MINUS_SRC_ALPHA,[F]:e.ONE_MINUS_DST_COLOR,[U]:e.ONE_MINUS_DST_ALPHA,[k]:e.CONSTANT_COLOR,[j]:e.ONE_MINUS_CONSTANT_COLOR,[G]:e.CONSTANT_ALPHA,[z]:e.ONE_MINUS_CONSTANT_ALPHA};function Re(t,r,n,i,o,s,a,c,l,u){if(t!==y){if(!1===f&&(Me(e.BLEND),f=!0),t===w)o=o||r,s=s||n,a=a||i,r===Q&&o===te||(e.blendEquationSeparate(Ee[r],Ee[o]),Q=r,te=o),n===$&&i===ee&&s===re&&a===ne||(e.blendFuncSeparate(Ae[n],Ae[i],Ae[s],Ae[a]),$=n,ee=i,re=s,ne=a),!1!==c.equals(ie)&&l===oe||(e.blendColor(c.r,c.g,c.b,l),ie.copy(c),oe=l),Z=t,se=!1;else if(t!==Z||u!==se){if(Q===S&&te===S||(e.blendEquation(e.FUNC_ADD),Q=S,te=S),u)switch(t){case v:e.blendFuncSeparate(e.ONE,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case _:e.blendFunc(e.ONE,e.ONE);break;case b:e.blendFuncSeparate(e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ZERO,e.ONE);break;case x:e.blendFuncSeparate(e.ZERO,e.SRC_COLOR,e.ZERO,e.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case v:e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case _:e.blendFunc(e.SRC_ALPHA,e.ONE);break;case b:e.blendFuncSeparate(e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ZERO,e.ONE);break;case x:e.blendFunc(e.ZERO,e.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}$=null,ee=null,re=null,ne=null,ie.set(0,0,0),oe=0,Z=t,se=u}}else!0===f&&(Te(e.BLEND),f=!1)}function Ce(t){ae!==t&&(t?e.frontFace(e.CW):e.frontFace(e.CCW),ae=t)}function Ie(t){t!==s?(Me(e.CULL_FACE),t!==ce&&(t===a?e.cullFace(e.BACK):t===c?e.cullFace(e.FRONT):e.cullFace(e.FRONT_AND_BACK))):Te(e.CULL_FACE),ce=t}function Oe(t,r,n){t?(Me(e.POLYGON_OFFSET_FILL),ue===r&&he===n||(e.polygonOffset(r,n),ue=r,he=n)):Te(e.POLYGON_OFFSET_FILL)}return{buffers:{color:t,depth:r,stencil:n},enable:Me,disable:Te,bindFramebuffer:function(t,r){return u[t]!==r&&(e.bindFramebuffer(t,r),u[t]=r,t===e.DRAW_FRAMEBUFFER&&(u[e.FRAMEBUFFER]=r),t===e.FRAMEBUFFER&&(u[e.DRAW_FRAMEBUFFER]=r),!0)},drawBuffers:function(t,r){let n=p,i=!1;if(t){n=h.get(r),void 0===n&&(n=[],h.set(r,n));const o=t.textures;if(n.length!==o.length||n[0]!==e.COLOR_ATTACHMENT0){for(let t=0,r=o.length;t<r;t++)n[t]=e.COLOR_ATTACHMENT0+t;n.length=o.length,i=!0}}else n[0]!==e.BACK&&(n[0]=e.BACK,i=!0);i&&e.drawBuffers(n)},useProgram:function(t){return d!==t&&(e.useProgram(t),d=t,!0)},setBlending:Re,setMaterial:function(i,o){i.side===g?Te(e.CULL_FACE):Me(e.CULL_FACE);let s=i.side===m;o&&(s=!s),Ce(s),i.blending===v&&!1===i.transparent?Re(y):Re(i.blending,i.blendEquation,i.blendSrc,i.blendDst,i.blendEquationAlpha,i.blendSrcAlpha,i.blendDstAlpha,i.blendColor,i.blendAlpha,i.premultipliedAlpha),r.setFunc(i.depthFunc),r.setTest(i.depthTest),r.setMask(i.depthWrite),t.setMask(i.colorWrite);const a=i.stencilWrite;n.setTest(a),a&&(n.setMask(i.stencilWriteMask),n.setFunc(i.stencilFunc,i.stencilRef,i.stencilFuncMask),n.setOp(i.stencilFail,i.stencilZFail,i.stencilZPass)),Oe(i.polygonOffset,i.polygonOffsetFactor,i.polygonOffsetUnits),!0===i.alphaToCoverage?Me(e.SAMPLE_ALPHA_TO_COVERAGE):Te(e.SAMPLE_ALPHA_TO_COVERAGE)},setFlipSided:Ce,setCullFace:Ie,setLineWidth:function(t){t!==le&&(de&&e.lineWidth(t),le=t)},setPolygonOffset:Oe,setScissorTest:function(t){t?Me(e.SCISSOR_TEST):Te(e.SCISSOR_TEST)},activeTexture:function(t){void 0===t&&(t=e.TEXTURE0+pe-1),ge!==t&&(e.activeTexture(t),ge=t)},bindTexture:function(t,r,n){void 0===n&&(n=null===ge?e.TEXTURE0+pe-1:ge);let i=ye[n];void 0===i&&(i={type:void 0,texture:void 0},ye[n]=i),i.type===t&&i.texture===r||(ge!==n&&(e.activeTexture(n),ge=n),e.bindTexture(t,r||Se[t]),i.type=t,i.texture=r)},unbindTexture:function(){const t=ye[ge];void 0!==t&&void 0!==t.type&&(e.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},compressedTexImage3D:function(){try{e.compressedTexImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},updateUBOMapping:function(t,r){let n=o.get(r);void 0===n&&(n=new WeakMap,o.set(r,n));let i=n.get(t);void 0===i&&(i=e.getUniformBlockIndex(r,t.name),n.set(t,i))},uniformBlockBinding:function(t,r){const n=o.get(r).get(t);i.get(r)!==n&&(e.uniformBlockBinding(r,n,t.__bindingPointIndex),i.set(r,n))},texStorage2D:function(){try{e.texStorage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texStorage3D:function(){try{e.texStorage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texSubImage2D:function(){try{e.texSubImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texSubImage3D:function(){try{e.texSubImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},compressedTexSubImage2D:function(){try{e.compressedTexSubImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},compressedTexSubImage3D:function(){try{e.compressedTexSubImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},scissor:function(t){!1===be.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),be.copy(t))},viewport:function(t){!1===xe.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),xe.copy(t))},reset:function(){e.disable(e.BLEND),e.disable(e.CULL_FACE),e.disable(e.DEPTH_TEST),e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.SCISSOR_TEST),e.disable(e.STENCIL_TEST),e.disable(e.SAMPLE_ALPHA_TO_COVERAGE),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ONE,e.ZERO),e.blendFuncSeparate(e.ONE,e.ZERO,e.ONE,e.ZERO),e.blendColor(0,0,0,0),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(e.LESS),e.clearDepth(1),e.stencilMask(4294967295),e.stencilFunc(e.ALWAYS,0,4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP),e.clearStencil(0),e.cullFace(e.BACK),e.frontFace(e.CCW),e.polygonOffset(0,0),e.activeTexture(e.TEXTURE0),e.bindFramebuffer(e.FRAMEBUFFER,null),e.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),e.bindFramebuffer(e.READ_FRAMEBUFFER,null),e.useProgram(null),e.lineWidth(1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),l={},ge=null,ye={},u={},h=new WeakMap,p=[],d=null,f=!1,Z=null,Q=null,$=null,ee=null,te=null,re=null,ne=null,ie=new Zi(0,0,0),oe=0,se=!1,ae=null,ce=null,le=null,ue=null,he=null,be.set(0,0,e.canvas.width,e.canvas.height),xe.set(0,0,e.canvas.width,e.canvas.height),t.reset(),r.reset(),n.reset()}}}function Hc(e,t,r,n,i,o,s){const a=t.has("WEBGL_multisampled_render_to_texture")?t.get("WEBGL_multisampled_render_to_texture"):null,c="undefined"!=typeof navigator&&/OculusBrowser/g.test(navigator.userAgent),l=new $r,u=new WeakMap;let h;const p=new WeakMap;let d=!1;try{d="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(e){}function f(e,t){return d?new OffscreenCanvas(e,t):sn("canvas")}function m(e,t,r){let n=1;const i=j(e);if((i.width>r||i.height>r)&&(n=r/Math.max(i.width,i.height)),n<1){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!=typeof VideoFrame&&e instanceof VideoFrame){const r=Math.floor(n*i.width),o=Math.floor(n*i.height);void 0===h&&(h=f(r,o));const s=t?f(r,o):h;s.width=r,s.height=o;return s.getContext("2d").drawImage(e,0,0,r,o),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+i.width+"x"+i.height+") to ("+r+"x"+o+")."),s}return"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+i.width+"x"+i.height+")."),e}return e}function g(e){return e.generateMipmaps&&e.minFilter!==_e&&e.minFilter!==Me}function y(t){e.generateMipmap(t)}function v(r,n,i,o,s=!1){if(null!==r){if(void 0!==e[r])return e[r];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+r+"'")}let a=n;if(n===e.RED&&(i===e.FLOAT&&(a=e.R32F),i===e.HALF_FLOAT&&(a=e.R16F),i===e.UNSIGNED_BYTE&&(a=e.R8)),n===e.RED_INTEGER&&(i===e.UNSIGNED_BYTE&&(a=e.R8UI),i===e.UNSIGNED_SHORT&&(a=e.R16UI),i===e.UNSIGNED_INT&&(a=e.R32UI),i===e.BYTE&&(a=e.R8I),i===e.SHORT&&(a=e.R16I),i===e.INT&&(a=e.R32I)),n===e.RG&&(i===e.FLOAT&&(a=e.RG32F),i===e.HALF_FLOAT&&(a=e.RG16F),i===e.UNSIGNED_BYTE&&(a=e.RG8)),n===e.RG_INTEGER&&(i===e.UNSIGNED_BYTE&&(a=e.RG8UI),i===e.UNSIGNED_SHORT&&(a=e.RG16UI),i===e.UNSIGNED_INT&&(a=e.RG32UI),i===e.BYTE&&(a=e.RG8I),i===e.SHORT&&(a=e.RG16I),i===e.INT&&(a=e.RG32I)),n===e.RGB&&i===e.UNSIGNED_INT_5_9_9_9_REV&&(a=e.RGB9_E5),n===e.RGBA){const t=s?er:fn.getTransfer(o);i===e.FLOAT&&(a=e.RGBA32F),i===e.HALF_FLOAT&&(a=e.RGBA16F),i===e.UNSIGNED_BYTE&&(a=t===tr?e.SRGB8_ALPHA8:e.RGBA8),i===e.UNSIGNED_SHORT_4_4_4_4&&(a=e.RGBA4),i===e.UNSIGNED_SHORT_5_5_5_1&&(a=e.RGB5_A1)}return a!==e.R16F&&a!==e.R32F&&a!==e.RG16F&&a!==e.RG32F&&a!==e.RGBA16F&&a!==e.RGBA32F||t.get("EXT_color_buffer_float"),a}function _(t,r){let n;return t?null===r||r===Le||r===ke?n=e.DEPTH24_STENCIL8:r===Ue?n=e.DEPTH32F_STENCIL8:r===Pe&&(n=e.DEPTH24_STENCIL8,console.warn("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):null===r||r===Le||r===ke?n=e.DEPTH_COMPONENT24:r===Ue?n=e.DEPTH_COMPONENT32F:r===Pe&&(n=e.DEPTH_COMPONENT16),n}function b(e,t){return!0===g(e)||e.isFramebufferTexture&&e.minFilter!==_e&&e.minFilter!==Me?Math.log2(Math.max(t.width,t.height))+1:void 0!==e.mipmaps&&e.mipmaps.length>0?e.mipmaps.length:e.isCompressedTexture&&Array.isArray(e.image)?t.mipmaps.length:1}function x(e){const t=e.target;t.removeEventListener("dispose",x),function(e){const t=n.get(e);if(void 0===t.__webglInit)return;const r=e.source,i=p.get(r);if(i){const n=i[t.__cacheKey];n.usedTimes--,0===n.usedTimes&&S(e),0===Object.keys(i).length&&p.delete(r)}n.remove(e)}(t),t.isVideoTexture&&u.delete(t)}function w(t){const r=t.target;r.removeEventListener("dispose",w),function(t){const r=n.get(t);t.depthTexture&&t.depthTexture.dispose();if(t.isWebGLCubeRenderTarget)for(let t=0;t<6;t++){if(Array.isArray(r.__webglFramebuffer[t]))for(let n=0;n<r.__webglFramebuffer[t].length;n++)e.deleteFramebuffer(r.__webglFramebuffer[t][n]);else e.deleteFramebuffer(r.__webglFramebuffer[t]);r.__webglDepthbuffer&&e.deleteRenderbuffer(r.__webglDepthbuffer[t])}else{if(Array.isArray(r.__webglFramebuffer))for(let t=0;t<r.__webglFramebuffer.length;t++)e.deleteFramebuffer(r.__webglFramebuffer[t]);else e.deleteFramebuffer(r.__webglFramebuffer);if(r.__webglDepthbuffer&&e.deleteRenderbuffer(r.__webglDepthbuffer),r.__webglMultisampledFramebuffer&&e.deleteFramebuffer(r.__webglMultisampledFramebuffer),r.__webglColorRenderbuffer)for(let t=0;t<r.__webglColorRenderbuffer.length;t++)r.__webglColorRenderbuffer[t]&&e.deleteRenderbuffer(r.__webglColorRenderbuffer[t]);r.__webglDepthRenderbuffer&&e.deleteRenderbuffer(r.__webglDepthRenderbuffer)}const i=t.textures;for(let t=0,r=i.length;t<r;t++){const r=n.get(i[t]);r.__webglTexture&&(e.deleteTexture(r.__webglTexture),s.memory.textures--),n.remove(i[t])}n.remove(t)}(r)}function S(t){const r=n.get(t);e.deleteTexture(r.__webglTexture);const i=t.source;delete p.get(i)[r.__cacheKey],s.memory.textures--}let M=0;function T(t,i){const o=n.get(t);if(t.isVideoTexture&&function(e){const t=s.render.frame;u.get(e)!==t&&(u.set(e,t),e.update())}(t),!1===t.isRenderTargetTexture&&t.version>0&&o.__version!==t.version){const e=t.image;if(null===e)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(!1!==e.complete)return void O(o,t,i);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}r.bindTexture(e.TEXTURE_2D,o.__webglTexture,e.TEXTURE0+i)}const E={[ge]:e.REPEAT,[ye]:e.CLAMP_TO_EDGE,[ve]:e.MIRRORED_REPEAT},A={[_e]:e.NEAREST,[be]:e.NEAREST_MIPMAP_NEAREST,[we]:e.NEAREST_MIPMAP_LINEAR,[Me]:e.LINEAR,[Te]:e.LINEAR_MIPMAP_NEAREST,[Ae]:e.LINEAR_MIPMAP_LINEAR},R={[br]:e.NEVER,[Ar]:e.ALWAYS,[xr]:e.LESS,[Sr]:e.LEQUAL,[wr]:e.EQUAL,[Er]:e.GEQUAL,[Mr]:e.GREATER,[Tr]:e.NOTEQUAL};function C(r,o){if(o.type!==Ue||!1!==t.has("OES_texture_float_linear")||o.magFilter!==Me&&o.magFilter!==Te&&o.magFilter!==we&&o.magFilter!==Ae&&o.minFilter!==Me&&o.minFilter!==Te&&o.minFilter!==we&&o.minFilter!==Ae||console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),e.texParameteri(r,e.TEXTURE_WRAP_S,E[o.wrapS]),e.texParameteri(r,e.TEXTURE_WRAP_T,E[o.wrapT]),r!==e.TEXTURE_3D&&r!==e.TEXTURE_2D_ARRAY||e.texParameteri(r,e.TEXTURE_WRAP_R,E[o.wrapR]),e.texParameteri(r,e.TEXTURE_MAG_FILTER,A[o.magFilter]),e.texParameteri(r,e.TEXTURE_MIN_FILTER,A[o.minFilter]),o.compareFunction&&(e.texParameteri(r,e.TEXTURE_COMPARE_MODE,e.COMPARE_REF_TO_TEXTURE),e.texParameteri(r,e.TEXTURE_COMPARE_FUNC,R[o.compareFunction])),!0===t.has("EXT_texture_filter_anisotropic")){if(o.magFilter===_e)return;if(o.minFilter!==we&&o.minFilter!==Ae)return;if(o.type===Ue&&!1===t.has("OES_texture_float_linear"))return;if(o.anisotropy>1||n.get(o).__currentAnisotropy){const s=t.get("EXT_texture_filter_anisotropic");e.texParameterf(r,s.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(o.anisotropy,i.getMaxAnisotropy())),n.get(o).__currentAnisotropy=o.anisotropy}}}function I(t,r){let n=!1;void 0===t.__webglInit&&(t.__webglInit=!0,r.addEventListener("dispose",x));const i=r.source;let o=p.get(i);void 0===o&&(o={},p.set(i,o));const a=function(e){const t=[];return t.push(e.wrapS),t.push(e.wrapT),t.push(e.wrapR||0),t.push(e.magFilter),t.push(e.minFilter),t.push(e.anisotropy),t.push(e.internalFormat),t.push(e.format),t.push(e.type),t.push(e.generateMipmaps),t.push(e.premultiplyAlpha),t.push(e.flipY),t.push(e.unpackAlignment),t.push(e.colorSpace),t.join()}(r);if(a!==t.__cacheKey){void 0===o[a]&&(o[a]={texture:e.createTexture(),usedTimes:0},s.memory.textures++,n=!0),o[a].usedTimes++;const i=o[t.__cacheKey];void 0!==i&&(o[t.__cacheKey].usedTimes--,0===i.usedTimes&&S(r)),t.__cacheKey=a,t.__webglTexture=o[a].texture}return n}function O(t,s,a){let c=e.TEXTURE_2D;(s.isDataArrayTexture||s.isCompressedArrayTexture)&&(c=e.TEXTURE_2D_ARRAY),s.isData3DTexture&&(c=e.TEXTURE_3D);const l=I(t,s),u=s.source;r.bindTexture(c,t.__webglTexture,e.TEXTURE0+a);const h=n.get(u);if(u.version!==h.__version||!0===l){r.activeTexture(e.TEXTURE0+a);const t=fn.getPrimaries(fn.workingColorSpace),n=s.colorSpace===Jt?null:fn.getPrimaries(s.colorSpace),p=s.colorSpace===Jt||t===n?e.NONE:e.BROWSER_DEFAULT_WEBGL;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,s.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,s.unpackAlignment),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,p);let d=m(s.image,!1,i.maxTextureSize);d=k(s,d);const f=o.convert(s.format,s.colorSpace),x=o.convert(s.type);let w,S=v(s.internalFormat,f,x,s.colorSpace,s.isVideoTexture);C(c,s);const M=s.mipmaps,T=!0!==s.isVideoTexture,E=void 0===h.__version||!0===l,A=u.dataReady,R=b(s,d);if(s.isDepthTexture)S=_(s.format===Ye,s.type),E&&(T?r.texStorage2D(e.TEXTURE_2D,1,S,d.width,d.height):r.texImage2D(e.TEXTURE_2D,0,S,d.width,d.height,0,f,x,null));else if(s.isDataTexture)if(M.length>0){T&&E&&r.texStorage2D(e.TEXTURE_2D,R,S,M[0].width,M[0].height);for(let t=0,n=M.length;t<n;t++)w=M[t],T?A&&r.texSubImage2D(e.TEXTURE_2D,t,0,0,w.width,w.height,f,x,w.data):r.texImage2D(e.TEXTURE_2D,t,S,w.width,w.height,0,f,x,w.data);s.generateMipmaps=!1}else T?(E&&r.texStorage2D(e.TEXTURE_2D,R,S,d.width,d.height),A&&r.texSubImage2D(e.TEXTURE_2D,0,0,0,d.width,d.height,f,x,d.data)):r.texImage2D(e.TEXTURE_2D,0,S,d.width,d.height,0,f,x,d.data);else if(s.isCompressedTexture)if(s.isCompressedArrayTexture){T&&E&&r.texStorage3D(e.TEXTURE_2D_ARRAY,R,S,M[0].width,M[0].height,d.depth);for(let t=0,n=M.length;t<n;t++)if(w=M[t],s.format!==Ve)if(null!==f)if(T){if(A)if(s.layerUpdates.size>0){for(const n of s.layerUpdates){const i=w.width*w.height;r.compressedTexSubImage3D(e.TEXTURE_2D_ARRAY,t,0,0,n,w.width,w.height,1,f,w.data.slice(i*n,i*(n+1)),0,0)}s.clearLayerUpdates()}else r.compressedTexSubImage3D(e.TEXTURE_2D_ARRAY,t,0,0,0,w.width,w.height,d.depth,f,w.data,0,0)}else r.compressedTexImage3D(e.TEXTURE_2D_ARRAY,t,S,w.width,w.height,d.depth,0,w.data,0,0);else console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else T?A&&r.texSubImage3D(e.TEXTURE_2D_ARRAY,t,0,0,0,w.width,w.height,d.depth,f,x,w.data):r.texImage3D(e.TEXTURE_2D_ARRAY,t,S,w.width,w.height,d.depth,0,f,x,w.data)}else{T&&E&&r.texStorage2D(e.TEXTURE_2D,R,S,M[0].width,M[0].height);for(let t=0,n=M.length;t<n;t++)w=M[t],s.format!==Ve?null!==f?T?A&&r.compressedTexSubImage2D(e.TEXTURE_2D,t,0,0,w.width,w.height,f,w.data):r.compressedTexImage2D(e.TEXTURE_2D,t,S,w.width,w.height,0,w.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):T?A&&r.texSubImage2D(e.TEXTURE_2D,t,0,0,w.width,w.height,f,x,w.data):r.texImage2D(e.TEXTURE_2D,t,S,w.width,w.height,0,f,x,w.data)}else if(s.isDataArrayTexture)if(T){if(E&&r.texStorage3D(e.TEXTURE_2D_ARRAY,R,S,d.width,d.height,d.depth),A)if(s.layerUpdates.size>0){let t;switch(x){case e.UNSIGNED_BYTE:switch(f){case e.ALPHA:case e.LUMINANCE:t=1;break;case e.LUMINANCE_ALPHA:t=2;break;case e.RGB:t=3;break;case e.RGBA:t=4;break;default:throw new Error(`Unknown texel size for format ${f}.`)}break;case e.UNSIGNED_SHORT_4_4_4_4:case e.UNSIGNED_SHORT_5_5_5_1:case e.UNSIGNED_SHORT_5_6_5:t=1;break;default:throw new Error(`Unknown texel size for type ${x}.`)}const n=d.width*d.height*t;for(const t of s.layerUpdates)r.texSubImage3D(e.TEXTURE_2D_ARRAY,0,0,0,t,d.width,d.height,1,f,x,d.data.slice(n*t,n*(t+1)));s.clearLayerUpdates()}else r.texSubImage3D(e.TEXTURE_2D_ARRAY,0,0,0,0,d.width,d.height,d.depth,f,x,d.data)}else r.texImage3D(e.TEXTURE_2D_ARRAY,0,S,d.width,d.height,d.depth,0,f,x,d.data);else if(s.isData3DTexture)T?(E&&r.texStorage3D(e.TEXTURE_3D,R,S,d.width,d.height,d.depth),A&&r.texSubImage3D(e.TEXTURE_3D,0,0,0,0,d.width,d.height,d.depth,f,x,d.data)):r.texImage3D(e.TEXTURE_3D,0,S,d.width,d.height,d.depth,0,f,x,d.data);else if(s.isFramebufferTexture){if(E)if(T)r.texStorage2D(e.TEXTURE_2D,R,S,d.width,d.height);else{let t=d.width,n=d.height;for(let i=0;i<R;i++)r.texImage2D(e.TEXTURE_2D,i,S,t,n,0,f,x,null),t>>=1,n>>=1}}else if(M.length>0){if(T&&E){const t=j(M[0]);r.texStorage2D(e.TEXTURE_2D,R,S,t.width,t.height)}for(let t=0,n=M.length;t<n;t++)w=M[t],T?A&&r.texSubImage2D(e.TEXTURE_2D,t,0,0,f,x,w):r.texImage2D(e.TEXTURE_2D,t,S,f,x,w);s.generateMipmaps=!1}else if(T){if(E){const t=j(d);r.texStorage2D(e.TEXTURE_2D,R,S,t.width,t.height)}A&&r.texSubImage2D(e.TEXTURE_2D,0,0,0,f,x,d)}else r.texImage2D(e.TEXTURE_2D,0,S,f,x,d);g(s)&&y(c),h.__version=u.version,s.onUpdate&&s.onUpdate(s)}t.__version=s.version}function P(t,i,s,c,l,u){const h=o.convert(s.format,s.colorSpace),p=o.convert(s.type),d=v(s.internalFormat,h,p,s.colorSpace);if(!n.get(i).__hasExternalTextures){const t=Math.max(1,i.width>>u),n=Math.max(1,i.height>>u);l===e.TEXTURE_3D||l===e.TEXTURE_2D_ARRAY?r.texImage3D(l,u,d,t,n,i.depth,0,h,p,null):r.texImage2D(l,u,d,t,n,0,h,p,null)}r.bindFramebuffer(e.FRAMEBUFFER,t),B(i)?a.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,c,l,n.get(s).__webglTexture,0,F(i)):(l===e.TEXTURE_2D||l>=e.TEXTURE_CUBE_MAP_POSITIVE_X&&l<=e.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&e.framebufferTexture2D(e.FRAMEBUFFER,c,l,n.get(s).__webglTexture,u),r.bindFramebuffer(e.FRAMEBUFFER,null)}function N(t,r,n){if(e.bindRenderbuffer(e.RENDERBUFFER,t),r.depthBuffer){const i=r.depthTexture,o=i&&i.isDepthTexture?i.type:null,s=_(r.stencilBuffer,o),c=r.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT,l=F(r);B(r)?a.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,l,s,r.width,r.height):n?e.renderbufferStorageMultisample(e.RENDERBUFFER,l,s,r.width,r.height):e.renderbufferStorage(e.RENDERBUFFER,s,r.width,r.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,c,e.RENDERBUFFER,t)}else{const t=r.textures;for(let i=0;i<t.length;i++){const s=t[i],c=o.convert(s.format,s.colorSpace),l=o.convert(s.type),u=v(s.internalFormat,c,l,s.colorSpace),h=F(r);n&&!1===B(r)?e.renderbufferStorageMultisample(e.RENDERBUFFER,h,u,r.width,r.height):B(r)?a.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,h,u,r.width,r.height):e.renderbufferStorage(e.RENDERBUFFER,u,r.width,r.height)}}e.bindRenderbuffer(e.RENDERBUFFER,null)}function L(t){const i=n.get(t),o=!0===t.isWebGLCubeRenderTarget;if(t.depthTexture&&!i.__autoAllocateDepthBuffer){if(o)throw new Error("target.depthTexture not supported in Cube render targets");!function(t,i){if(i&&i.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(r.bindFramebuffer(e.FRAMEBUFFER,t),!i.depthTexture||!i.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");n.get(i.depthTexture).__webglTexture&&i.depthTexture.image.width===i.width&&i.depthTexture.image.height===i.height||(i.depthTexture.image.width=i.width,i.depthTexture.image.height=i.height,i.depthTexture.needsUpdate=!0),T(i.depthTexture,0);const o=n.get(i.depthTexture).__webglTexture,s=F(i);if(i.depthTexture.format===Xe)B(i)?a.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,o,0,s):e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,o,0);else{if(i.depthTexture.format!==Ye)throw new Error("Unknown depthTexture format");B(i)?a.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,o,0,s):e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,o,0)}}(i.__webglFramebuffer,t)}else if(o){i.__webglDepthbuffer=[];for(let n=0;n<6;n++)r.bindFramebuffer(e.FRAMEBUFFER,i.__webglFramebuffer[n]),i.__webglDepthbuffer[n]=e.createRenderbuffer(),N(i.__webglDepthbuffer[n],t,!1)}else r.bindFramebuffer(e.FRAMEBUFFER,i.__webglFramebuffer),i.__webglDepthbuffer=e.createRenderbuffer(),N(i.__webglDepthbuffer,t,!1);r.bindFramebuffer(e.FRAMEBUFFER,null)}const U=[],D=[];function F(e){return Math.min(i.maxSamples,e.samples)}function B(e){const r=n.get(e);return e.samples>0&&!0===t.has("WEBGL_multisampled_render_to_texture")&&!1!==r.__useRenderToTexture}function k(e,t){const r=e.colorSpace,n=e.format,i=e.type;return!0===e.isCompressedTexture||!0===e.isVideoTexture||r!==Zt&&r!==Jt&&(fn.getTransfer(r)===tr?n===Ve&&i===Ce||console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",r)),t}function j(e){return"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement?(l.width=e.naturalWidth||e.width,l.height=e.naturalHeight||e.height):"undefined"!=typeof VideoFrame&&e instanceof VideoFrame?(l.width=e.displayWidth,l.height=e.displayHeight):(l.width=e.width,l.height=e.height),l}this.allocateTextureUnit=function(){const e=M;return e>=i.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+i.maxTextures),M+=1,e},this.resetTextureUnits=function(){M=0},this.setTexture2D=T,this.setTexture2DArray=function(t,i){const o=n.get(t);t.version>0&&o.__version!==t.version?O(o,t,i):r.bindTexture(e.TEXTURE_2D_ARRAY,o.__webglTexture,e.TEXTURE0+i)},this.setTexture3D=function(t,i){const o=n.get(t);t.version>0&&o.__version!==t.version?O(o,t,i):r.bindTexture(e.TEXTURE_3D,o.__webglTexture,e.TEXTURE0+i)},this.setTextureCube=function(t,s){const a=n.get(t);t.version>0&&a.__version!==t.version?function(t,s,a){if(6!==s.image.length)return;const c=I(t,s),l=s.source;r.bindTexture(e.TEXTURE_CUBE_MAP,t.__webglTexture,e.TEXTURE0+a);const u=n.get(l);if(l.version!==u.__version||!0===c){r.activeTexture(e.TEXTURE0+a);const t=fn.getPrimaries(fn.workingColorSpace),n=s.colorSpace===Jt?null:fn.getPrimaries(s.colorSpace),h=s.colorSpace===Jt||t===n?e.NONE:e.BROWSER_DEFAULT_WEBGL;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,s.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,s.unpackAlignment),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,h);const p=s.isCompressedTexture||s.image[0].isCompressedTexture,d=s.image[0]&&s.image[0].isDataTexture,f=[];for(let e=0;e<6;e++)f[e]=p||d?d?s.image[e].image:s.image[e]:m(s.image[e],!0,i.maxCubemapSize),f[e]=k(s,f[e]);const _=f[0],x=o.convert(s.format,s.colorSpace),w=o.convert(s.type),S=v(s.internalFormat,x,w,s.colorSpace),M=!0!==s.isVideoTexture,T=void 0===u.__version||!0===c,E=l.dataReady;let A,R=b(s,_);if(C(e.TEXTURE_CUBE_MAP,s),p){M&&T&&r.texStorage2D(e.TEXTURE_CUBE_MAP,R,S,_.width,_.height);for(let t=0;t<6;t++){A=f[t].mipmaps;for(let n=0;n<A.length;n++){const i=A[n];s.format!==Ve?null!==x?M?E&&r.compressedTexSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,n,0,0,i.width,i.height,x,i.data):r.compressedTexImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,n,S,i.width,i.height,0,i.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):M?E&&r.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,n,0,0,i.width,i.height,x,w,i.data):r.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,n,S,i.width,i.height,0,x,w,i.data)}}}else{if(A=s.mipmaps,M&&T){A.length>0&&R++;const t=j(f[0]);r.texStorage2D(e.TEXTURE_CUBE_MAP,R,S,t.width,t.height)}for(let t=0;t<6;t++)if(d){M?E&&r.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,0,0,f[t].width,f[t].height,x,w,f[t].data):r.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,S,f[t].width,f[t].height,0,x,w,f[t].data);for(let n=0;n<A.length;n++){const i=A[n].image[t].image;M?E&&r.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,n+1,0,0,i.width,i.height,x,w,i.data):r.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,n+1,S,i.width,i.height,0,x,w,i.data)}}else{M?E&&r.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,0,0,x,w,f[t]):r.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,S,x,w,f[t]);for(let n=0;n<A.length;n++){const i=A[n];M?E&&r.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,n+1,0,0,x,w,i.image[t]):r.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,n+1,S,x,w,i.image[t])}}}g(s)&&y(e.TEXTURE_CUBE_MAP),u.__version=l.version,s.onUpdate&&s.onUpdate(s)}t.__version=s.version}(a,t,s):r.bindTexture(e.TEXTURE_CUBE_MAP,a.__webglTexture,e.TEXTURE0+s)},this.rebindTextures=function(t,r,i){const o=n.get(t);void 0!==r&&P(o.__webglFramebuffer,t,t.texture,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,0),void 0!==i&&L(t)},this.setupRenderTarget=function(t){const i=t.texture,a=n.get(t),c=n.get(i);t.addEventListener("dispose",w);const l=t.textures,u=!0===t.isWebGLCubeRenderTarget,h=l.length>1;if(h||(void 0===c.__webglTexture&&(c.__webglTexture=e.createTexture()),c.__version=i.version,s.memory.textures++),u){a.__webglFramebuffer=[];for(let t=0;t<6;t++)if(i.mipmaps&&i.mipmaps.length>0){a.__webglFramebuffer[t]=[];for(let r=0;r<i.mipmaps.length;r++)a.__webglFramebuffer[t][r]=e.createFramebuffer()}else a.__webglFramebuffer[t]=e.createFramebuffer()}else{if(i.mipmaps&&i.mipmaps.length>0){a.__webglFramebuffer=[];for(let t=0;t<i.mipmaps.length;t++)a.__webglFramebuffer[t]=e.createFramebuffer()}else a.__webglFramebuffer=e.createFramebuffer();if(h)for(let t=0,r=l.length;t<r;t++){const r=n.get(l[t]);void 0===r.__webglTexture&&(r.__webglTexture=e.createTexture(),s.memory.textures++)}if(t.samples>0&&!1===B(t)){a.__webglMultisampledFramebuffer=e.createFramebuffer(),a.__webglColorRenderbuffer=[],r.bindFramebuffer(e.FRAMEBUFFER,a.__webglMultisampledFramebuffer);for(let r=0;r<l.length;r++){const n=l[r];a.__webglColorRenderbuffer[r]=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,a.__webglColorRenderbuffer[r]);const i=o.convert(n.format,n.colorSpace),s=o.convert(n.type),c=v(n.internalFormat,i,s,n.colorSpace,!0===t.isXRRenderTarget),u=F(t);e.renderbufferStorageMultisample(e.RENDERBUFFER,u,c,t.width,t.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+r,e.RENDERBUFFER,a.__webglColorRenderbuffer[r])}e.bindRenderbuffer(e.RENDERBUFFER,null),t.depthBuffer&&(a.__webglDepthRenderbuffer=e.createRenderbuffer(),N(a.__webglDepthRenderbuffer,t,!0)),r.bindFramebuffer(e.FRAMEBUFFER,null)}}if(u){r.bindTexture(e.TEXTURE_CUBE_MAP,c.__webglTexture),C(e.TEXTURE_CUBE_MAP,i);for(let r=0;r<6;r++)if(i.mipmaps&&i.mipmaps.length>0)for(let n=0;n<i.mipmaps.length;n++)P(a.__webglFramebuffer[r][n],t,i,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+r,n);else P(a.__webglFramebuffer[r],t,i,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+r,0);g(i)&&y(e.TEXTURE_CUBE_MAP),r.unbindTexture()}else if(h){for(let i=0,o=l.length;i<o;i++){const o=l[i],s=n.get(o);r.bindTexture(e.TEXTURE_2D,s.__webglTexture),C(e.TEXTURE_2D,o),P(a.__webglFramebuffer,t,o,e.COLOR_ATTACHMENT0+i,e.TEXTURE_2D,0),g(o)&&y(e.TEXTURE_2D)}r.unbindTexture()}else{let n=e.TEXTURE_2D;if((t.isWebGL3DRenderTarget||t.isWebGLArrayRenderTarget)&&(n=t.isWebGL3DRenderTarget?e.TEXTURE_3D:e.TEXTURE_2D_ARRAY),r.bindTexture(n,c.__webglTexture),C(n,i),i.mipmaps&&i.mipmaps.length>0)for(let r=0;r<i.mipmaps.length;r++)P(a.__webglFramebuffer[r],t,i,e.COLOR_ATTACHMENT0,n,r);else P(a.__webglFramebuffer,t,i,e.COLOR_ATTACHMENT0,n,0);g(i)&&y(n),r.unbindTexture()}t.depthBuffer&&L(t)},this.updateRenderTargetMipmap=function(t){const i=t.textures;for(let o=0,s=i.length;o<s;o++){const s=i[o];if(g(s)){const i=t.isWebGLCubeRenderTarget?e.TEXTURE_CUBE_MAP:e.TEXTURE_2D,o=n.get(s).__webglTexture;r.bindTexture(i,o),y(i),r.unbindTexture()}}},this.updateMultisampleRenderTarget=function(t){if(t.samples>0)if(!1===B(t)){const i=t.textures,o=t.width,s=t.height;let a=e.COLOR_BUFFER_BIT;const l=t.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT,u=n.get(t),h=i.length>1;if(h)for(let t=0;t<i.length;t++)r.bindFramebuffer(e.FRAMEBUFFER,u.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.RENDERBUFFER,null),r.bindFramebuffer(e.FRAMEBUFFER,u.__webglFramebuffer),e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.TEXTURE_2D,null,0);r.bindFramebuffer(e.READ_FRAMEBUFFER,u.__webglMultisampledFramebuffer),r.bindFramebuffer(e.DRAW_FRAMEBUFFER,u.__webglFramebuffer);for(let r=0;r<i.length;r++){if(t.resolveDepthBuffer&&(t.depthBuffer&&(a|=e.DEPTH_BUFFER_BIT),t.stencilBuffer&&t.resolveStencilBuffer&&(a|=e.STENCIL_BUFFER_BIT)),h){e.framebufferRenderbuffer(e.READ_FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.RENDERBUFFER,u.__webglColorRenderbuffer[r]);const t=n.get(i[r]).__webglTexture;e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0)}e.blitFramebuffer(0,0,o,s,0,0,o,s,a,e.NEAREST),!0===c&&(U.length=0,D.length=0,U.push(e.COLOR_ATTACHMENT0+r),t.depthBuffer&&!1===t.resolveDepthBuffer&&(U.push(l),D.push(l),e.invalidateFramebuffer(e.DRAW_FRAMEBUFFER,D)),e.invalidateFramebuffer(e.READ_FRAMEBUFFER,U))}if(r.bindFramebuffer(e.READ_FRAMEBUFFER,null),r.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),h)for(let t=0;t<i.length;t++){r.bindFramebuffer(e.FRAMEBUFFER,u.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.RENDERBUFFER,u.__webglColorRenderbuffer[t]);const o=n.get(i[t]).__webglTexture;r.bindFramebuffer(e.FRAMEBUFFER,u.__webglFramebuffer),e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.TEXTURE_2D,o,0)}r.bindFramebuffer(e.DRAW_FRAMEBUFFER,u.__webglMultisampledFramebuffer)}else if(t.depthBuffer&&!1===t.resolveDepthBuffer&&c){const r=t.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT;e.invalidateFramebuffer(e.DRAW_FRAMEBUFFER,[r])}},this.setupDepthRenderbuffer=L,this.setupFrameBufferTexture=P,this.useMultisampledRTT=B}function Wc(e,t){return{convert:function(r,n=Jt){let i;const o=fn.getTransfer(n);if(r===Ce)return e.UNSIGNED_BYTE;if(r===Fe)return e.UNSIGNED_SHORT_4_4_4_4;if(r===Be)return e.UNSIGNED_SHORT_5_5_5_1;if(r===je)return e.UNSIGNED_INT_5_9_9_9_REV;if(r===Ie)return e.BYTE;if(r===Oe)return e.SHORT;if(r===Pe)return e.UNSIGNED_SHORT;if(r===Ne)return e.INT;if(r===Le)return e.UNSIGNED_INT;if(r===Ue)return e.FLOAT;if(r===De)return e.HALF_FLOAT;if(r===Ge)return e.ALPHA;if(r===ze)return e.RGB;if(r===Ve)return e.RGBA;if(r===He)return e.LUMINANCE;if(r===We)return e.LUMINANCE_ALPHA;if(r===Xe)return e.DEPTH_COMPONENT;if(r===Ye)return e.DEPTH_STENCIL;if(r===qe)return e.RED;if(r===Je)return e.RED_INTEGER;if(r===Ke)return e.RG;if(r===Ze)return e.RG_INTEGER;if(r===Qe)return e.RGBA_INTEGER;if(r===$e||r===et||r===tt||r===rt)if(o===tr){if(i=t.get("WEBGL_compressed_texture_s3tc_srgb"),null===i)return null;if(r===$e)return i.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(r===et)return i.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(r===tt)return i.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(r===rt)return i.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(i=t.get("WEBGL_compressed_texture_s3tc"),null===i)return null;if(r===$e)return i.COMPRESSED_RGB_S3TC_DXT1_EXT;if(r===et)return i.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(r===tt)return i.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(r===rt)return i.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(r===nt||r===it||r===ot||r===st){if(i=t.get("WEBGL_compressed_texture_pvrtc"),null===i)return null;if(r===nt)return i.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(r===it)return i.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(r===ot)return i.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(r===st)return i.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(r===at||r===ct||r===lt){if(i=t.get("WEBGL_compressed_texture_etc"),null===i)return null;if(r===at||r===ct)return o===tr?i.COMPRESSED_SRGB8_ETC2:i.COMPRESSED_RGB8_ETC2;if(r===lt)return o===tr?i.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:i.COMPRESSED_RGBA8_ETC2_EAC}if(r===ut||r===ht||r===pt||r===dt||r===ft||r===mt||r===gt||r===yt||r===vt||r===_t||r===bt||r===xt||r===wt||r===St){if(i=t.get("WEBGL_compressed_texture_astc"),null===i)return null;if(r===ut)return o===tr?i.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:i.COMPRESSED_RGBA_ASTC_4x4_KHR;if(r===ht)return o===tr?i.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:i.COMPRESSED_RGBA_ASTC_5x4_KHR;if(r===pt)return o===tr?i.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:i.COMPRESSED_RGBA_ASTC_5x5_KHR;if(r===dt)return o===tr?i.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:i.COMPRESSED_RGBA_ASTC_6x5_KHR;if(r===ft)return o===tr?i.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:i.COMPRESSED_RGBA_ASTC_6x6_KHR;if(r===mt)return o===tr?i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:i.COMPRESSED_RGBA_ASTC_8x5_KHR;if(r===gt)return o===tr?i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:i.COMPRESSED_RGBA_ASTC_8x6_KHR;if(r===yt)return o===tr?i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:i.COMPRESSED_RGBA_ASTC_8x8_KHR;if(r===vt)return o===tr?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:i.COMPRESSED_RGBA_ASTC_10x5_KHR;if(r===_t)return o===tr?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:i.COMPRESSED_RGBA_ASTC_10x6_KHR;if(r===bt)return o===tr?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:i.COMPRESSED_RGBA_ASTC_10x8_KHR;if(r===xt)return o===tr?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:i.COMPRESSED_RGBA_ASTC_10x10_KHR;if(r===wt)return o===tr?i.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:i.COMPRESSED_RGBA_ASTC_12x10_KHR;if(r===St)return o===tr?i.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:i.COMPRESSED_RGBA_ASTC_12x12_KHR}if(r===Mt||r===Tt||r===Et){if(i=t.get("EXT_texture_compression_bptc"),null===i)return null;if(r===Mt)return o===tr?i.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:i.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(r===Tt)return i.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(r===Et)return i.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}if(r===At||r===Rt||r===Ct||r===It){if(i=t.get("EXT_texture_compression_rgtc"),null===i)return null;if(r===Mt)return i.COMPRESSED_RED_RGTC1_EXT;if(r===Rt)return i.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(r===Ct)return i.COMPRESSED_RED_GREEN_RGTC2_EXT;if(r===It)return i.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}return r===ke?e.UNSIGNED_INT_24_8:void 0!==e[r]?e[r]:null}}}class Xc extends ns{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}class Yc extends Ui{constructor(){super(),this.isGroup=!0,this.type="Group"}}const qc={type:"move"};class Jc{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new Yc,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new Yc,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new Pn,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new Pn),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new Yc,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new Pn,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new Pn),this._grip}dispatchEvent(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const r of e.hand.values())this._getHandJoint(t,r)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(e,t,r){let n=null,i=null,o=null;const s=this._targetRay,a=this._grip,c=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState){if(c&&e.hand){o=!0;for(const n of e.hand.values()){const e=t.getJointPose(n,r),i=this._getHandJoint(c,n);null!==e&&(i.matrix.fromArray(e.transform.matrix),i.matrix.decompose(i.position,i.rotation,i.scale),i.matrixWorldNeedsUpdate=!0,i.jointRadius=e.radius),i.visible=null!==e}const n=c.joints["index-finger-tip"],i=c.joints["thumb-tip"],s=n.position.distanceTo(i.position),a=.02,l=.005;c.inputState.pinching&&s>a+l?(c.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!c.inputState.pinching&&s<=a-l&&(c.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==a&&e.gripSpace&&(i=t.getPose(e.gripSpace,r),null!==i&&(a.matrix.fromArray(i.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),a.matrixWorldNeedsUpdate=!0,i.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(i.linearVelocity)):a.hasLinearVelocity=!1,i.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(i.angularVelocity)):a.hasAngularVelocity=!1));null!==s&&(n=t.getPose(e.targetRaySpace,r),null===n&&null!==i&&(n=i),null!==n&&(s.matrix.fromArray(n.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale),s.matrixWorldNeedsUpdate=!0,n.linearVelocity?(s.hasLinearVelocity=!0,s.linearVelocity.copy(n.linearVelocity)):s.hasLinearVelocity=!1,n.angularVelocity?(s.hasAngularVelocity=!0,s.angularVelocity.copy(n.angularVelocity)):s.hasAngularVelocity=!1,this.dispatchEvent(qc)))}return null!==s&&(s.visible=null!==n),null!==a&&(a.visible=null!==i),null!==c&&(c.visible=null!==o),this}_getHandJoint(e,t){if(void 0===e.joints[t.jointName]){const r=new Yc;r.matrixAutoUpdate=!1,r.visible=!1,e.joints[t.jointName]=r,e.add(r)}return e.joints[t.jointName]}}class Kc{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,t,r){if(null===this.texture){const n=new Sn;e.properties.get(n).__webglTexture=t.texture,t.depthNear==r.depthNear&&t.depthFar==r.depthFar||(this.depthNear=t.depthNear,this.depthFar=t.depthFar),this.texture=n}}getMesh(e){if(null!==this.texture&&null===this.mesh){const t=e.cameras[0].viewport,r=new Qo({vertexShader:"\nvoid main() {\n\n\tgl_Position = vec4( position, 1.0 );\n\n}",fragmentShader:"\nuniform sampler2DArray depthColor;\nuniform float depthWidth;\nuniform float depthHeight;\n\nvoid main() {\n\n\tvec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );\n\n\tif ( coord.x >= 1.0 ) {\n\n\t\tgl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;\n\n\t} else {\n\n\t\tgl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;\n\n\t}\n\n}",uniforms:{depthColor:{value:this.texture},depthWidth:{value:t.z},depthHeight:{value:t.w}}});this.mesh=new Wo(new ys(20,20),r)}return this.mesh}reset(){this.texture=null,this.mesh=null}}class Zc extends Gr{constructor(e,t){super();const r=this;let n=null,i=1,o=null,s="local-floor",a=1,c=null,l=null,u=null,h=null,p=null,d=null;const f=new Kc,m=t.getContextAttributes();let g=null,y=null;const v=[],_=[],b=new $r;let x=null;const w=new ns;w.layers.enable(1),w.viewport=new Mn;const S=new ns;S.layers.enable(2),S.viewport=new Mn;const M=[w,S],T=new Xc;T.layers.enable(1),T.layers.enable(2);let E=null,A=null;function R(e){const t=_.indexOf(e.inputSource);if(-1===t)return;const r=v[t];void 0!==r&&(r.update(e.inputSource,e.frame,c||o),r.dispatchEvent({type:e.type,data:e.inputSource}))}function C(){n.removeEventListener("select",R),n.removeEventListener("selectstart",R),n.removeEventListener("selectend",R),n.removeEventListener("squeeze",R),n.removeEventListener("squeezestart",R),n.removeEventListener("squeezeend",R),n.removeEventListener("end",C),n.removeEventListener("inputsourceschange",I);for(let e=0;e<v.length;e++){const t=_[e];null!==t&&(_[e]=null,v[e].disconnect(t))}E=null,A=null,f.reset(),e.setRenderTarget(g),p=null,h=null,u=null,n=null,y=null,U.stop(),r.isPresenting=!1,e.setPixelRatio(x),e.setSize(b.width,b.height,!1),r.dispatchEvent({type:"sessionend"})}function I(e){for(let t=0;t<e.removed.length;t++){const r=e.removed[t],n=_.indexOf(r);n>=0&&(_[n]=null,v[n].disconnect(r))}for(let t=0;t<e.added.length;t++){const r=e.added[t];let n=_.indexOf(r);if(-1===n){for(let e=0;e<v.length;e++){if(e>=_.length){_.push(r),n=e;break}if(null===_[e]){_[e]=r,n=e;break}}if(-1===n)break}const i=v[n];i&&i.connect(r)}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(e){let t=v[e];return void 0===t&&(t=new Jc,v[e]=t),t.getTargetRaySpace()},this.getControllerGrip=function(e){let t=v[e];return void 0===t&&(t=new Jc,v[e]=t),t.getGripSpace()},this.getHand=function(e){let t=v[e];return void 0===t&&(t=new Jc,v[e]=t),t.getHandSpace()},this.setFramebufferScaleFactor=function(e){i=e,!0===r.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(e){s=e,!0===r.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return c||o},this.setReferenceSpace=function(e){c=e},this.getBaseLayer=function(){return null!==h?h:p},this.getBinding=function(){return u},this.getFrame=function(){return d},this.getSession=function(){return n},this.setSession=async function(l){if(n=l,null!==n){if(g=e.getRenderTarget(),n.addEventListener("select",R),n.addEventListener("selectstart",R),n.addEventListener("selectend",R),n.addEventListener("squeeze",R),n.addEventListener("squeezestart",R),n.addEventListener("squeezeend",R),n.addEventListener("end",C),n.addEventListener("inputsourceschange",I),!0!==m.xrCompatible&&await t.makeXRCompatible(),x=e.getPixelRatio(),e.getSize(b),void 0===n.renderState.layers){const r={antialias:m.antialias,alpha:!0,depth:m.depth,stencil:m.stencil,framebufferScaleFactor:i};p=new XRWebGLLayer(n,t,r),n.updateRenderState({baseLayer:p}),e.setPixelRatio(1),e.setSize(p.framebufferWidth,p.framebufferHeight,!1),y=new En(p.framebufferWidth,p.framebufferHeight,{format:Ve,type:Ce,colorSpace:e.outputColorSpace,stencilBuffer:m.stencil})}else{let r=null,o=null,s=null;m.depth&&(s=m.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,r=m.stencil?Ye:Xe,o=m.stencil?ke:Le);const a={colorFormat:t.RGBA8,depthFormat:s,scaleFactor:i};u=new XRWebGLBinding(n,t),h=u.createProjectionLayer(a),n.updateRenderState({layers:[h]}),e.setPixelRatio(1),e.setSize(h.textureWidth,h.textureHeight,!1),y=new En(h.textureWidth,h.textureHeight,{format:Ve,type:Ce,depthTexture:new ta(h.textureWidth,h.textureHeight,o,void 0,void 0,void 0,void 0,void 0,void 0,r),stencilBuffer:m.stencil,colorSpace:e.outputColorSpace,samples:m.antialias?4:0,resolveDepthBuffer:!1===h.ignoreDepthValues})}y.isXRRenderTarget=!0,this.setFoveation(a),c=null,o=await n.requestReferenceSpace(s),U.setContext(n),U.start(),r.isPresenting=!0,r.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(null!==n)return n.environmentBlendMode};const O=new Pn,P=new Pn;function N(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.copy(e.matrixWorld).invert()}this.updateCamera=function(e){if(null===n)return;null!==f.texture&&(e.near=f.depthNear,e.far=f.depthFar),T.near=S.near=w.near=e.near,T.far=S.far=w.far=e.far,E===T.near&&A===T.far||(n.updateRenderState({depthNear:T.near,depthFar:T.far}),E=T.near,A=T.far,w.near=E,w.far=A,S.near=E,S.far=A,w.updateProjectionMatrix(),S.updateProjectionMatrix(),e.updateProjectionMatrix());const t=e.parent,r=T.cameras;N(T,t);for(let e=0;e<r.length;e++)N(r[e],t);2===r.length?function(e,t,r){O.setFromMatrixPosition(t.matrixWorld),P.setFromMatrixPosition(r.matrixWorld);const n=O.distanceTo(P),i=t.projectionMatrix.elements,o=r.projectionMatrix.elements,s=i[14]/(i[10]-1),a=i[14]/(i[10]+1),c=(i[9]+1)/i[5],l=(i[9]-1)/i[5],u=(i[8]-1)/i[0],h=(o[8]+1)/o[0],p=s*u,d=s*h,f=n/(-u+h),m=f*-u;t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(m),e.translateZ(f),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.copy(e.matrixWorld).invert();const g=s+f,y=a+f,v=p-m,_=d+(n-m),b=c*a/y*g,x=l*a/y*g;e.projectionMatrix.makePerspective(v,_,b,x,g,y),e.projectionMatrixInverse.copy(e.projectionMatrix).invert()}(T,w,S):T.projectionMatrix.copy(w.projectionMatrix),function(e,t,r){null===r?e.matrix.copy(t.matrixWorld):(e.matrix.copy(r.matrixWorld),e.matrix.invert(),e.matrix.multiply(t.matrixWorld));e.matrix.decompose(e.position,e.quaternion,e.scale),e.updateMatrixWorld(!0),e.projectionMatrix.copy(t.projectionMatrix),e.projectionMatrixInverse.copy(t.projectionMatrixInverse),e.isPerspectiveCamera&&(e.fov=2*Wr*Math.atan(1/e.projectionMatrix.elements[5]),e.zoom=1)}(e,T,t)},this.getCamera=function(){return T},this.getFoveation=function(){if(null!==h||null!==p)return a},this.setFoveation=function(e){a=e,null!==h&&(h.fixedFoveation=e),null!==p&&void 0!==p.fixedFoveation&&(p.fixedFoveation=e)},this.hasDepthSensing=function(){return null!==f.texture},this.getDepthSensingMesh=function(){return f.getMesh(T)};let L=null;const U=new ms;U.setAnimationLoop((function(t,i){if(l=i.getViewerPose(c||o),d=i,null!==l){const t=l.views;null!==p&&(e.setRenderTargetFramebuffer(y,p.framebuffer),e.setRenderTarget(y));let r=!1;t.length!==T.cameras.length&&(T.cameras.length=0,r=!0);for(let n=0;n<t.length;n++){const i=t[n];let o=null;if(null!==p)o=p.getViewport(i);else{const t=u.getViewSubImage(h,i);o=t.viewport,0===n&&(e.setRenderTargetTextures(y,t.colorTexture,h.ignoreDepthValues?void 0:t.depthStencilTexture),e.setRenderTarget(y))}let s=M[n];void 0===s&&(s=new ns,s.layers.enable(n),s.viewport=new Mn,M[n]=s),s.matrix.fromArray(i.transform.matrix),s.matrix.decompose(s.position,s.quaternion,s.scale),s.projectionMatrix.fromArray(i.projectionMatrix),s.projectionMatrixInverse.copy(s.projectionMatrix).invert(),s.viewport.set(o.x,o.y,o.width,o.height),0===n&&(T.matrix.copy(s.matrix),T.matrix.decompose(T.position,T.quaternion,T.scale)),!0===r&&T.cameras.push(s)}const i=n.enabledFeatures;if(i&&i.includes("depth-sensing")){const r=u.getDepthInformation(t[0]);r&&r.isValid&&r.texture&&f.init(e,r,n.renderState)}}for(let e=0;e<v.length;e++){const t=_[e],r=v[e];null!==t&&void 0!==r&&r.update(t,i,c||o)}L&&L(t,i),i.detectedPlanes&&r.dispatchEvent({type:"planesdetected",data:i}),d=null})),this.setAnimationLoop=function(e){L=e},this.dispose=function(){}}}const Qc=new vi,$c=new ci;function el(e,t){function r(e,t){!0===e.matrixAutoUpdate&&e.updateMatrix(),t.value.copy(e.matrix)}function n(e,n){e.opacity.value=n.opacity,n.color&&e.diffuse.value.copy(n.color),n.emissive&&e.emissive.value.copy(n.emissive).multiplyScalar(n.emissiveIntensity),n.map&&(e.map.value=n.map,r(n.map,e.mapTransform)),n.alphaMap&&(e.alphaMap.value=n.alphaMap,r(n.alphaMap,e.alphaMapTransform)),n.bumpMap&&(e.bumpMap.value=n.bumpMap,r(n.bumpMap,e.bumpMapTransform),e.bumpScale.value=n.bumpScale,n.side===m&&(e.bumpScale.value*=-1)),n.normalMap&&(e.normalMap.value=n.normalMap,r(n.normalMap,e.normalMapTransform),e.normalScale.value.copy(n.normalScale),n.side===m&&e.normalScale.value.negate()),n.displacementMap&&(e.displacementMap.value=n.displacementMap,r(n.displacementMap,e.displacementMapTransform),e.displacementScale.value=n.displacementScale,e.displacementBias.value=n.displacementBias),n.emissiveMap&&(e.emissiveMap.value=n.emissiveMap,r(n.emissiveMap,e.emissiveMapTransform)),n.specularMap&&(e.specularMap.value=n.specularMap,r(n.specularMap,e.specularMapTransform)),n.alphaTest>0&&(e.alphaTest.value=n.alphaTest);const i=t.get(n),o=i.envMap,s=i.envMapRotation;o&&(e.envMap.value=o,Qc.copy(s),Qc.x*=-1,Qc.y*=-1,Qc.z*=-1,o.isCubeTexture&&!1===o.isRenderTargetTexture&&(Qc.y*=-1,Qc.z*=-1),e.envMapRotation.value.setFromMatrix4($c.makeRotationFromEuler(Qc)),e.flipEnvMap.value=o.isCubeTexture&&!1===o.isRenderTargetTexture?-1:1,e.reflectivity.value=n.reflectivity,e.ior.value=n.ior,e.refractionRatio.value=n.refractionRatio),n.lightMap&&(e.lightMap.value=n.lightMap,e.lightMapIntensity.value=n.lightMapIntensity,r(n.lightMap,e.lightMapTransform)),n.aoMap&&(e.aoMap.value=n.aoMap,e.aoMapIntensity.value=n.aoMapIntensity,r(n.aoMap,e.aoMapTransform))}return{refreshFogUniforms:function(t,r){r.color.getRGB(t.fogColor.value,Ko(e)),r.isFog?(t.fogNear.value=r.near,t.fogFar.value=r.far):r.isFogExp2&&(t.fogDensity.value=r.density)},refreshMaterialUniforms:function(e,i,o,s,a){i.isMeshBasicMaterial||i.isMeshLambertMaterial?n(e,i):i.isMeshToonMaterial?(n(e,i),function(e,t){t.gradientMap&&(e.gradientMap.value=t.gradientMap)}(e,i)):i.isMeshPhongMaterial?(n(e,i),function(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4)}(e,i)):i.isMeshStandardMaterial?(n(e,i),function(e,t){e.metalness.value=t.metalness,t.metalnessMap&&(e.metalnessMap.value=t.metalnessMap,r(t.metalnessMap,e.metalnessMapTransform));e.roughness.value=t.roughness,t.roughnessMap&&(e.roughnessMap.value=t.roughnessMap,r(t.roughnessMap,e.roughnessMapTransform));t.envMap&&(e.envMapIntensity.value=t.envMapIntensity)}(e,i),i.isMeshPhysicalMaterial&&function(e,t,n){e.ior.value=t.ior,t.sheen>0&&(e.sheenColor.value.copy(t.sheenColor).multiplyScalar(t.sheen),e.sheenRoughness.value=t.sheenRoughness,t.sheenColorMap&&(e.sheenColorMap.value=t.sheenColorMap,r(t.sheenColorMap,e.sheenColorMapTransform)),t.sheenRoughnessMap&&(e.sheenRoughnessMap.value=t.sheenRoughnessMap,r(t.sheenRoughnessMap,e.sheenRoughnessMapTransform)));t.clearcoat>0&&(e.clearcoat.value=t.clearcoat,e.clearcoatRoughness.value=t.clearcoatRoughness,t.clearcoatMap&&(e.clearcoatMap.value=t.clearcoatMap,r(t.clearcoatMap,e.clearcoatMapTransform)),t.clearcoatRoughnessMap&&(e.clearcoatRoughnessMap.value=t.clearcoatRoughnessMap,r(t.clearcoatRoughnessMap,e.clearcoatRoughnessMapTransform)),t.clearcoatNormalMap&&(e.clearcoatNormalMap.value=t.clearcoatNormalMap,r(t.clearcoatNormalMap,e.clearcoatNormalMapTransform),e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale),t.side===m&&e.clearcoatNormalScale.value.negate()));t.dispersion>0&&(e.dispersion.value=t.dispersion);t.iridescence>0&&(e.iridescence.value=t.iridescence,e.iridescenceIOR.value=t.iridescenceIOR,e.iridescenceThicknessMinimum.value=t.iridescenceThicknessRange[0],e.iridescenceThicknessMaximum.value=t.iridescenceThicknessRange[1],t.iridescenceMap&&(e.iridescenceMap.value=t.iridescenceMap,r(t.iridescenceMap,e.iridescenceMapTransform)),t.iridescenceThicknessMap&&(e.iridescenceThicknessMap.value=t.iridescenceThicknessMap,r(t.iridescenceThicknessMap,e.iridescenceThicknessMapTransform)));t.transmission>0&&(e.transmission.value=t.transmission,e.transmissionSamplerMap.value=n.texture,e.transmissionSamplerSize.value.set(n.width,n.height),t.transmissionMap&&(e.transmissionMap.value=t.transmissionMap,r(t.transmissionMap,e.transmissionMapTransform)),e.thickness.value=t.thickness,t.thicknessMap&&(e.thicknessMap.value=t.thicknessMap,r(t.thicknessMap,e.thicknessMapTransform)),e.attenuationDistance.value=t.attenuationDistance,e.attenuationColor.value.copy(t.attenuationColor));t.anisotropy>0&&(e.anisotropyVector.value.set(t.anisotropy*Math.cos(t.anisotropyRotation),t.anisotropy*Math.sin(t.anisotropyRotation)),t.anisotropyMap&&(e.anisotropyMap.value=t.anisotropyMap,r(t.anisotropyMap,e.anisotropyMapTransform)));e.specularIntensity.value=t.specularIntensity,e.specularColor.value.copy(t.specularColor),t.specularColorMap&&(e.specularColorMap.value=t.specularColorMap,r(t.specularColorMap,e.specularColorMapTransform));t.specularIntensityMap&&(e.specularIntensityMap.value=t.specularIntensityMap,r(t.specularIntensityMap,e.specularIntensityMapTransform))}(e,i,a)):i.isMeshMatcapMaterial?(n(e,i),function(e,t){t.matcap&&(e.matcap.value=t.matcap)}(e,i)):i.isMeshDepthMaterial?n(e,i):i.isMeshDistanceMaterial?(n(e,i),function(e,r){const n=t.get(r).light;e.referencePosition.value.setFromMatrixPosition(n.matrixWorld),e.nearDistance.value=n.shadow.camera.near,e.farDistance.value=n.shadow.camera.far}(e,i)):i.isMeshNormalMaterial?n(e,i):i.isLineBasicMaterial?(function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,t.map&&(e.map.value=t.map,r(t.map,e.mapTransform))}(e,i),i.isLineDashedMaterial&&function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(e,i)):i.isPointsMaterial?function(e,t,n,i){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*n,e.scale.value=.5*i,t.map&&(e.map.value=t.map,r(t.map,e.uvTransform));t.alphaMap&&(e.alphaMap.value=t.alphaMap,r(t.alphaMap,e.alphaMapTransform));t.alphaTest>0&&(e.alphaTest.value=t.alphaTest)}(e,i,o,s):i.isSpriteMaterial?function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.rotation.value=t.rotation,t.map&&(e.map.value=t.map,r(t.map,e.mapTransform));t.alphaMap&&(e.alphaMap.value=t.alphaMap,r(t.alphaMap,e.alphaMapTransform));t.alphaTest>0&&(e.alphaTest.value=t.alphaTest)}(e,i):i.isShadowMaterial?(e.color.value.copy(i.color),e.opacity.value=i.opacity):i.isShaderMaterial&&(i.uniformsNeedUpdate=!1)}}}function tl(e,t,r,n){let i={},o={},s=[];const a=e.getParameter(e.MAX_UNIFORM_BUFFER_BINDINGS);function c(e,t,r,n){const i=e.value,o=t+"_"+r;if(void 0===n[o])return n[o]="number"==typeof i||"boolean"==typeof i?i:i.clone(),!0;{const e=n[o];if("number"==typeof i||"boolean"==typeof i){if(e!==i)return n[o]=i,!0}else if(!1===e.equals(i))return e.copy(i),!0}return!1}function l(e){const t={boundary:0,storage:0};return"number"==typeof e||"boolean"==typeof e?(t.boundary=4,t.storage=4):e.isVector2?(t.boundary=8,t.storage=8):e.isVector3||e.isColor?(t.boundary=16,t.storage=12):e.isVector4?(t.boundary=16,t.storage=16):e.isMatrix3?(t.boundary=48,t.storage=48):e.isMatrix4?(t.boundary=64,t.storage=64):e.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",e),t}function u(t){const r=t.target;r.removeEventListener("dispose",u);const n=s.indexOf(r.__bindingPointIndex);s.splice(n,1),e.deleteBuffer(i[r.id]),delete i[r.id],delete o[r.id]}return{bind:function(e,t){const r=t.program;n.uniformBlockBinding(e,r)},update:function(r,h){let p=i[r.id];void 0===p&&(!function(e){const t=e.uniforms;let r=0;const n=16;for(let e=0,i=t.length;e<i;e++){const i=Array.isArray(t[e])?t[e]:[t[e]];for(let e=0,t=i.length;e<t;e++){const t=i[e],o=Array.isArray(t.value)?t.value:[t.value];for(let e=0,i=o.length;e<i;e++){const i=l(o[e]),s=r%n;0!==s&&n-s<i.boundary&&(r+=n-s),t.__data=new Float32Array(i.storage/Float32Array.BYTES_PER_ELEMENT),t.__offset=r,r+=i.storage}}}const i=r%n;i>0&&(r+=n-i);e.__size=r,e.__cache={}}(r),p=function(t){const r=function(){for(let e=0;e<a;e++)if(-1===s.indexOf(e))return s.push(e),e;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}();t.__bindingPointIndex=r;const n=e.createBuffer(),i=t.__size,o=t.usage;return e.bindBuffer(e.UNIFORM_BUFFER,n),e.bufferData(e.UNIFORM_BUFFER,i,o),e.bindBuffer(e.UNIFORM_BUFFER,null),e.bindBufferBase(e.UNIFORM_BUFFER,r,n),n}(r),i[r.id]=p,r.addEventListener("dispose",u));const d=h.program;n.updateUBOMapping(r,d);const f=t.render.frame;o[r.id]!==f&&(!function(t){const r=i[t.id],n=t.uniforms,o=t.__cache;e.bindBuffer(e.UNIFORM_BUFFER,r);for(let t=0,r=n.length;t<r;t++){const r=Array.isArray(n[t])?n[t]:[n[t]];for(let n=0,i=r.length;n<i;n++){const i=r[n];if(!0===c(i,t,n,o)){const t=i.__offset,r=Array.isArray(i.value)?i.value:[i.value];let n=0;for(let o=0;o<r.length;o++){const s=r[o],a=l(s);"number"==typeof s||"boolean"==typeof s?(i.__data[0]=s,e.bufferSubData(e.UNIFORM_BUFFER,t+n,i.__data)):s.isMatrix3?(i.__data[0]=s.elements[0],i.__data[1]=s.elements[1],i.__data[2]=s.elements[2],i.__data[3]=0,i.__data[4]=s.elements[3],i.__data[5]=s.elements[4],i.__data[6]=s.elements[5],i.__data[7]=0,i.__data[8]=s.elements[6],i.__data[9]=s.elements[7],i.__data[10]=s.elements[8],i.__data[11]=0):(s.toArray(i.__data,n),n+=a.storage/Float32Array.BYTES_PER_ELEMENT)}e.bufferSubData(e.UNIFORM_BUFFER,t,i.__data)}}}e.bindBuffer(e.UNIFORM_BUFFER,null)}(r),o[r.id]=f)},dispose:function(){for(const t in i)e.deleteBuffer(i[t]);s=[],i={},o={}}}}class rl{constructor(e={}){const{canvas:t=an(),context:r=null,depth:i=!0,stencil:o=!1,alpha:s=!1,antialias:a=!1,premultipliedAlpha:c=!0,preserveDrawingBuffer:l=!1,powerPreference:u="default",failIfMajorPerformanceCaveat:h=!1}=e;let p;if(this.isWebGLRenderer=!0,null!==r){if("undefined"!=typeof WebGLRenderingContext&&r instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");p=r.getContextAttributes().alpha}else p=s;const d=new Uint32Array(4),y=new Int32Array(4);let v=null,_=null;const b=[],x=[];this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=Kt,this.toneMapping=ee,this.toneMappingExposure=1;const w=this;let S=!1,M=0,T=0,E=null,A=-1,R=null;const C=new Mn,I=new Mn;let O=null;const P=new Zi(0);let N=0,L=t.width,U=t.height,D=1,F=null,B=null;const k=new Mn(0,0,L,U),j=new Mn(0,0,L,U);let G=!1;const z=new fs;let V=!1,H=!1;const W=new ci,X=new Pn,Y={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let q=!1;function J(){return null===E?D:1}let K,Z,Q,$,te,re,ne,ie,oe,se,ae,ce,le,ue,he,pe,de,fe,me,ge,ye,ve,_e,be,xe=r;function we(e,r){return t.getContext(e,r)}try{const e={alpha:!0,depth:i,stencil:o,antialias:a,premultipliedAlpha:c,preserveDrawingBuffer:l,powerPreference:u,failIfMajorPerformanceCaveat:h};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${n}`),t.addEventListener("webglcontextlost",Te,!1),t.addEventListener("webglcontextrestored",Ee,!1),t.addEventListener("webglcontextcreationerror",Re,!1),null===xe){const t="webgl2";if(xe=we(t,e),null===xe)throw we(t)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(e){throw console.error("THREE.WebGLRenderer: "+e.message),e}function Se(){K=new Js(xe),K.init(),ve=new Wc(xe,K),Z=new As(xe,K,e,ve),Q=new Vc(xe),$=new Qs(xe),te=new Cc,re=new Hc(xe,K,Q,te,Z,ve,$),ne=new Cs(w),ie=new qs(w),oe=new gs(xe),_e=new Ts(xe,oe),se=new Ks(xe,oe,$,_e),ae=new ea(xe,se,oe,$),me=new $s(xe,Z,re),pe=new Rs(te),ce=new Rc(w,ne,ie,K,Z,_e,pe),le=new el(w,te),ue=new Nc,he=new kc(K),fe=new Ms(w,ne,ie,Q,ae,p,c),de=new zc(w,ae,Z),be=new tl(xe,$,Z,Q),ge=new Es(xe,K,$),ye=new Zs(xe,K,$),$.programs=ce.programs,w.capabilities=Z,w.extensions=K,w.properties=te,w.renderLists=ue,w.shadowMap=de,w.state=Q,w.info=$}Se();const Me=new Zc(w,xe);function Te(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),S=!0}function Ee(){console.log("THREE.WebGLRenderer: Context Restored."),S=!1;const e=$.autoReset,t=de.enabled,r=de.autoUpdate,n=de.needsUpdate,i=de.type;Se(),$.autoReset=e,de.enabled=t,de.autoUpdate=r,de.needsUpdate=n,de.type=i}function Re(e){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",e.statusMessage)}function Ie(e){const t=e.target;t.removeEventListener("dispose",Ie),function(e){(function(e){const t=te.get(e).programs;void 0!==t&&(t.forEach((function(e){ce.releaseProgram(e)})),e.isShaderMaterial&&ce.releaseShaderCache(e))})(e),te.remove(e)}(t)}function Oe(e,t,r){!0===e.transparent&&e.side===g&&!1===e.forceSinglePass?(e.side=m,e.needsUpdate=!0,Ye(e,t,r),e.side=f,e.needsUpdate=!0,Ye(e,t,r),e.side=g):Ye(e,t,r)}this.xr=Me,this.getContext=function(){return xe},this.getContextAttributes=function(){return xe.getContextAttributes()},this.forceContextLoss=function(){const e=K.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){const e=K.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return D},this.setPixelRatio=function(e){void 0!==e&&(D=e,this.setSize(L,U,!1))},this.getSize=function(e){return e.set(L,U)},this.setSize=function(e,r,n=!0){Me.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(L=e,U=r,t.width=Math.floor(e*D),t.height=Math.floor(r*D),!0===n&&(t.style.width=e+"px",t.style.height=r+"px"),this.setViewport(0,0,e,r))},this.getDrawingBufferSize=function(e){return e.set(L*D,U*D).floor()},this.setDrawingBufferSize=function(e,r,n){L=e,U=r,D=n,t.width=Math.floor(e*n),t.height=Math.floor(r*n),this.setViewport(0,0,e,r)},this.getCurrentViewport=function(e){return e.copy(C)},this.getViewport=function(e){return e.copy(k)},this.setViewport=function(e,t,r,n){e.isVector4?k.set(e.x,e.y,e.z,e.w):k.set(e,t,r,n),Q.viewport(C.copy(k).multiplyScalar(D).round())},this.getScissor=function(e){return e.copy(j)},this.setScissor=function(e,t,r,n){e.isVector4?j.set(e.x,e.y,e.z,e.w):j.set(e,t,r,n),Q.scissor(I.copy(j).multiplyScalar(D).round())},this.getScissorTest=function(){return G},this.setScissorTest=function(e){Q.setScissorTest(G=e)},this.setOpaqueSort=function(e){F=e},this.setTransparentSort=function(e){B=e},this.getClearColor=function(e){return e.copy(fe.getClearColor())},this.setClearColor=function(){fe.setClearColor.apply(fe,arguments)},this.getClearAlpha=function(){return fe.getClearAlpha()},this.setClearAlpha=function(){fe.setClearAlpha.apply(fe,arguments)},this.clear=function(e=!0,t=!0,r=!0){let n=0;if(e){let e=!1;if(null!==E){const t=E.texture.format;e=t===Qe||t===Ze||t===Je}if(e){const e=E.texture.type,t=e===Ce||e===Le||e===Pe||e===ke||e===Fe||e===Be,r=fe.getClearColor(),n=fe.getClearAlpha(),i=r.r,o=r.g,s=r.b;t?(d[0]=i,d[1]=o,d[2]=s,d[3]=n,xe.clearBufferuiv(xe.COLOR,0,d)):(y[0]=i,y[1]=o,y[2]=s,y[3]=n,xe.clearBufferiv(xe.COLOR,0,y))}else n|=xe.COLOR_BUFFER_BIT}t&&(n|=xe.DEPTH_BUFFER_BIT),r&&(n|=xe.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),xe.clear(n)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",Te,!1),t.removeEventListener("webglcontextrestored",Ee,!1),t.removeEventListener("webglcontextcreationerror",Re,!1),ue.dispose(),he.dispose(),te.dispose(),ne.dispose(),ie.dispose(),ae.dispose(),_e.dispose(),be.dispose(),ce.dispose(),Me.dispose(),Me.removeEventListener("sessionstart",Ue),Me.removeEventListener("sessionend",je),Ge.stop()},this.renderBufferDirect=function(e,t,r,n,i,o){null===t&&(t=Y);const s=i.isMesh&&i.matrixWorld.determinant()<0,a=function(e,t,r,n,i){!0!==t.isScene&&(t=Y);re.resetTextureUnits();const o=t.fog,s=n.isMeshStandardMaterial?t.environment:null,a=null===E?w.outputColorSpace:!0===E.isXRRenderTarget?E.texture.colorSpace:Zt,c=(n.isMeshStandardMaterial?ie:ne).get(n.envMap||s),l=!0===n.vertexColors&&!!r.attributes.color&&4===r.attributes.color.itemSize,u=!!r.attributes.tangent&&(!!n.normalMap||n.anisotropy>0),h=!!r.morphAttributes.position,p=!!r.morphAttributes.normal,d=!!r.morphAttributes.color;let f=ee;n.toneMapped&&(null!==E&&!0!==E.isXRRenderTarget||(f=w.toneMapping));const m=r.morphAttributes.position||r.morphAttributes.normal||r.morphAttributes.color,g=void 0!==m?m.length:0,y=te.get(n),v=_.state.lights;if(!0===V&&(!0===H||e!==R)){const t=e===R&&n.id===A;pe.setState(n,e,t)}let b=!1;n.version===y.__version?y.needsLights&&y.lightsStateVersion!==v.state.version||y.outputColorSpace!==a||i.isBatchedMesh&&!1===y.batching?b=!0:i.isBatchedMesh||!0!==y.batching?i.isBatchedMesh&&!0===y.batchingColor&&null===i.colorTexture||i.isBatchedMesh&&!1===y.batchingColor&&null!==i.colorTexture||i.isInstancedMesh&&!1===y.instancing?b=!0:i.isInstancedMesh||!0!==y.instancing?i.isSkinnedMesh&&!1===y.skinning?b=!0:i.isSkinnedMesh||!0!==y.skinning?i.isInstancedMesh&&!0===y.instancingColor&&null===i.instanceColor||i.isInstancedMesh&&!1===y.instancingColor&&null!==i.instanceColor||i.isInstancedMesh&&!0===y.instancingMorph&&null===i.morphTexture||i.isInstancedMesh&&!1===y.instancingMorph&&null!==i.morphTexture||y.envMap!==c||!0===n.fog&&y.fog!==o?b=!0:void 0===y.numClippingPlanes||y.numClippingPlanes===pe.numPlanes&&y.numIntersection===pe.numIntersection?(y.vertexAlphas!==l||y.vertexTangents!==u||y.morphTargets!==h||y.morphNormals!==p||y.morphColors!==d||y.toneMapping!==f||y.morphTargetsCount!==g)&&(b=!0):b=!0:b=!0:b=!0:b=!0:(b=!0,y.__version=n.version);let x=y.currentProgram;!0===b&&(x=Ye(n,t,i));let S=!1,M=!1,T=!1;const C=x.getUniforms(),I=y.uniforms;Q.useProgram(x.program)&&(S=!0,M=!0,T=!0);n.id!==A&&(A=n.id,M=!0);if(S||R!==e){C.setValue(xe,"projectionMatrix",e.projectionMatrix),C.setValue(xe,"viewMatrix",e.matrixWorldInverse);const t=C.map.cameraPosition;void 0!==t&&t.setValue(xe,X.setFromMatrixPosition(e.matrixWorld)),Z.logarithmicDepthBuffer&&C.setValue(xe,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial)&&C.setValue(xe,"isOrthographic",!0===e.isOrthographicCamera),R!==e&&(R=e,M=!0,T=!0)}if(i.isSkinnedMesh){C.setOptional(xe,i,"bindMatrix"),C.setOptional(xe,i,"bindMatrixInverse");const e=i.skeleton;e&&(null===e.boneTexture&&e.computeBoneTexture(),C.setValue(xe,"boneTexture",e.boneTexture,re))}i.isBatchedMesh&&(C.setOptional(xe,i,"batchingTexture"),C.setValue(xe,"batchingTexture",i._matricesTexture,re),C.setOptional(xe,i,"batchingColorTexture"),null!==i._colorsTexture&&C.setValue(xe,"batchingColorTexture",i._colorsTexture,re));const O=r.morphAttributes;void 0===O.position&&void 0===O.normal&&void 0===O.color||me.update(i,r,x);(M||y.receiveShadow!==i.receiveShadow)&&(y.receiveShadow=i.receiveShadow,C.setValue(xe,"receiveShadow",i.receiveShadow));n.isMeshGouraudMaterial&&null!==n.envMap&&(I.envMap.value=c,I.flipEnvMap.value=c.isCubeTexture&&!1===c.isRenderTargetTexture?-1:1);n.isMeshStandardMaterial&&null===n.envMap&&null!==t.environment&&(I.envMapIntensity.value=t.environmentIntensity);M&&(C.setValue(xe,"toneMappingExposure",w.toneMappingExposure),y.needsLights&&(N=T,(P=I).ambientLightColor.needsUpdate=N,P.lightProbe.needsUpdate=N,P.directionalLights.needsUpdate=N,P.directionalLightShadows.needsUpdate=N,P.pointLights.needsUpdate=N,P.pointLightShadows.needsUpdate=N,P.spotLights.needsUpdate=N,P.spotLightShadows.needsUpdate=N,P.rectAreaLights.needsUpdate=N,P.hemisphereLights.needsUpdate=N),o&&!0===n.fog&&le.refreshFogUniforms(I,o),le.refreshMaterialUniforms(I,n,D,U,_.state.transmissionRenderTarget[e.id]),sc.upload(xe,qe(y),I,re));var P,N;n.isShaderMaterial&&!0===n.uniformsNeedUpdate&&(sc.upload(xe,qe(y),I,re),n.uniformsNeedUpdate=!1);n.isSpriteMaterial&&C.setValue(xe,"center",i.center);if(C.setValue(xe,"modelViewMatrix",i.modelViewMatrix),C.setValue(xe,"normalMatrix",i.normalMatrix),C.setValue(xe,"modelMatrix",i.matrixWorld),n.isShaderMaterial||n.isRawShaderMaterial){const e=n.uniformsGroups;for(let t=0,r=e.length;t<r;t++){const r=e[t];be.update(r,x),be.bind(r,x)}}return x}(e,t,r,n,i);Q.setMaterial(n,s);let c=r.index,l=1;if(!0===n.wireframe){if(c=se.getWireframeAttribute(r),void 0===c)return;l=2}const u=r.drawRange,h=r.attributes.position;let p=u.start*l,d=(u.start+u.count)*l;null!==o&&(p=Math.max(p,o.start*l),d=Math.min(d,(o.start+o.count)*l)),null!==c?(p=Math.max(p,0),d=Math.min(d,c.count)):null!=h&&(p=Math.max(p,0),d=Math.min(d,h.count));const f=d-p;if(f<0||f===1/0)return;let m;_e.setup(i,n,a,r,c);let g=ge;if(null!==c&&(m=oe.get(c),g=ye,g.setIndex(m)),i.isMesh)!0===n.wireframe?(Q.setLineWidth(n.wireframeLinewidth*J()),g.setMode(xe.LINES)):g.setMode(xe.TRIANGLES);else if(i.isLine){let e=n.linewidth;void 0===e&&(e=1),Q.setLineWidth(e*J()),i.isLineSegments?g.setMode(xe.LINES):i.isLineLoop?g.setMode(xe.LINE_LOOP):g.setMode(xe.LINE_STRIP)}else i.isPoints?g.setMode(xe.POINTS):i.isSprite&&g.setMode(xe.TRIANGLES);if(i.isBatchedMesh)null!==i._multiDrawInstances?g.renderMultiDrawInstances(i._multiDrawStarts,i._multiDrawCounts,i._multiDrawCount,i._multiDrawInstances):g.renderMultiDraw(i._multiDrawStarts,i._multiDrawCounts,i._multiDrawCount);else if(i.isInstancedMesh)g.renderInstances(p,f,i.count);else if(r.isInstancedBufferGeometry){const e=void 0!==r._maxInstanceCount?r._maxInstanceCount:1/0,t=Math.min(r.instanceCount,e);g.renderInstances(p,f,t)}else g.render(p,f)},this.compile=function(e,t,r=null){null===r&&(r=e),_=he.get(r),_.init(t),x.push(_),r.traverseVisible((function(e){e.isLight&&e.layers.test(t.layers)&&(_.pushLight(e),e.castShadow&&_.pushShadow(e))})),e!==r&&e.traverseVisible((function(e){e.isLight&&e.layers.test(t.layers)&&(_.pushLight(e),e.castShadow&&_.pushShadow(e))})),_.setupLights();const n=new Set;return e.traverse((function(e){const t=e.material;if(t)if(Array.isArray(t))for(let i=0;i<t.length;i++){const o=t[i];Oe(o,r,e),n.add(o)}else Oe(t,r,e),n.add(t)})),x.pop(),_=null,n},this.compileAsync=function(e,t,r=null){const n=this.compile(e,t,r);return new Promise((t=>{function r(){n.forEach((function(e){te.get(e).currentProgram.isReady()&&n.delete(e)})),0!==n.size?setTimeout(r,10):t(e)}null!==K.get("KHR_parallel_shader_compile")?r():setTimeout(r,10)}))};let Ne=null;function Ue(){Ge.stop()}function je(){Ge.start()}const Ge=new ms;function ze(e,t,r,n){if(!1===e.visible)return;if(e.layers.test(t.layers))if(e.isGroup)r=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(t);else if(e.isLight)_.pushLight(e),e.castShadow&&_.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||z.intersectsSprite(e)){n&&X.setFromMatrixPosition(e.matrixWorld).applyMatrix4(W);const t=ae.update(e),i=e.material;i.visible&&v.push(e,t,i,r,X.z,null)}}else if((e.isMesh||e.isLine||e.isPoints)&&(!e.frustumCulled||z.intersectsObject(e))){const t=ae.update(e),i=e.material;if(n&&(void 0!==e.boundingSphere?(null===e.boundingSphere&&e.computeBoundingSphere(),X.copy(e.boundingSphere.center)):(null===t.boundingSphere&&t.computeBoundingSphere(),X.copy(t.boundingSphere.center)),X.applyMatrix4(e.matrixWorld).applyMatrix4(W)),Array.isArray(i)){const n=t.groups;for(let o=0,s=n.length;o<s;o++){const s=n[o],a=i[s.materialIndex];a&&a.visible&&v.push(e,t,a,r,X.z,s)}}else i.visible&&v.push(e,t,i,r,X.z,null)}const i=e.children;for(let e=0,o=i.length;e<o;e++)ze(i[e],t,r,n)}function Ve(e,t,r,n){const i=e.opaque,o=e.transmissive,s=e.transparent;_.setupLightsView(r),!0===V&&pe.setGlobalState(w.clippingPlanes,r),n&&Q.viewport(C.copy(n)),i.length>0&&We(i,t,r),o.length>0&&We(o,t,r),s.length>0&&We(s,t,r),Q.buffers.depth.setTest(!0),Q.buffers.depth.setMask(!0),Q.buffers.color.setMask(!0),Q.setPolygonOffset(!1)}function He(e,t,r,n){if(null!==(!0===r.isScene?r.overrideMaterial:null))return;void 0===_.state.transmissionRenderTarget[n.id]&&(_.state.transmissionRenderTarget[n.id]=new En(1,1,{generateMipmaps:!0,type:K.has("EXT_color_buffer_half_float")||K.has("EXT_color_buffer_float")?De:Ce,minFilter:Ae,samples:4,stencilBuffer:o,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:fn.workingColorSpace}));const i=_.state.transmissionRenderTarget[n.id],s=n.viewport||C;i.setSize(s.z,s.w);const a=w.getRenderTarget();w.setRenderTarget(i),w.getClearColor(P),N=w.getClearAlpha(),N<1&&w.setClearColor(16777215,.5),q?fe.render(r):w.clear();const c=w.toneMapping;w.toneMapping=ee;const l=n.viewport;if(void 0!==n.viewport&&(n.viewport=void 0),_.setupLightsView(n),!0===V&&pe.setGlobalState(w.clippingPlanes,n),We(e,r,n),re.updateMultisampleRenderTarget(i),re.updateRenderTargetMipmap(i),!1===K.has("WEBGL_multisampled_render_to_texture")){let e=!1;for(let i=0,o=t.length;i<o;i++){const o=t[i],s=o.object,a=o.geometry,c=o.material,l=o.group;if(c.side===g&&s.layers.test(n.layers)){const t=c.side;c.side=m,c.needsUpdate=!0,Xe(s,r,n,a,c,l),c.side=t,c.needsUpdate=!0,e=!0}}!0===e&&(re.updateMultisampleRenderTarget(i),re.updateRenderTargetMipmap(i))}w.setRenderTarget(a),w.setClearColor(P,N),void 0!==l&&(n.viewport=l),w.toneMapping=c}function We(e,t,r){const n=!0===t.isScene?t.overrideMaterial:null;for(let i=0,o=e.length;i<o;i++){const o=e[i],s=o.object,a=o.geometry,c=null===n?o.material:n,l=o.group;s.layers.test(r.layers)&&Xe(s,t,r,a,c,l)}}function Xe(e,t,r,n,i,o){e.onBeforeRender(w,t,r,n,i,o),e.modelViewMatrix.multiplyMatrices(r.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),i.onBeforeRender(w,t,r,n,e,o),!0===i.transparent&&i.side===g&&!1===i.forceSinglePass?(i.side=m,i.needsUpdate=!0,w.renderBufferDirect(r,t,n,i,e,o),i.side=f,i.needsUpdate=!0,w.renderBufferDirect(r,t,n,i,e,o),i.side=g):w.renderBufferDirect(r,t,n,i,e,o),e.onAfterRender(w,t,r,n,i,o)}function Ye(e,t,r){!0!==t.isScene&&(t=Y);const n=te.get(e),i=_.state.lights,o=_.state.shadowsArray,s=i.state.version,a=ce.getParameters(e,i.state,o,t,r),c=ce.getProgramCacheKey(a);let l=n.programs;n.environment=e.isMeshStandardMaterial?t.environment:null,n.fog=t.fog,n.envMap=(e.isMeshStandardMaterial?ie:ne).get(e.envMap||n.environment),n.envMapRotation=null!==n.environment&&null===e.envMap?t.environmentRotation:e.envMapRotation,void 0===l&&(e.addEventListener("dispose",Ie),l=new Map,n.programs=l);let u=l.get(c);if(void 0!==u){if(n.currentProgram===u&&n.lightsStateVersion===s)return Ke(e,a),u}else a.uniforms=ce.getUniforms(e),e.onBuild(r,a,w),e.onBeforeCompile(a,w),u=ce.acquireProgram(a,c),l.set(c,u),n.uniforms=a.uniforms;const h=n.uniforms;return(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(h.clippingPlanes=pe.uniform),Ke(e,a),n.needsLights=function(e){return e.isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights}(e),n.lightsStateVersion=s,n.needsLights&&(h.ambientLightColor.value=i.state.ambient,h.lightProbe.value=i.state.probe,h.directionalLights.value=i.state.directional,h.directionalLightShadows.value=i.state.directionalShadow,h.spotLights.value=i.state.spot,h.spotLightShadows.value=i.state.spotShadow,h.rectAreaLights.value=i.state.rectArea,h.ltc_1.value=i.state.rectAreaLTC1,h.ltc_2.value=i.state.rectAreaLTC2,h.pointLights.value=i.state.point,h.pointLightShadows.value=i.state.pointShadow,h.hemisphereLights.value=i.state.hemi,h.directionalShadowMap.value=i.state.directionalShadowMap,h.directionalShadowMatrix.value=i.state.directionalShadowMatrix,h.spotShadowMap.value=i.state.spotShadowMap,h.spotLightMatrix.value=i.state.spotLightMatrix,h.spotLightMap.value=i.state.spotLightMap,h.pointShadowMap.value=i.state.pointShadowMap,h.pointShadowMatrix.value=i.state.pointShadowMatrix),n.currentProgram=u,n.uniformsList=null,u}function qe(e){if(null===e.uniformsList){const t=e.currentProgram.getUniforms();e.uniformsList=sc.seqWithValue(t.seq,e.uniforms)}return e.uniformsList}function Ke(e,t){const r=te.get(e);r.outputColorSpace=t.outputColorSpace,r.batching=t.batching,r.batchingColor=t.batchingColor,r.instancing=t.instancing,r.instancingColor=t.instancingColor,r.instancingMorph=t.instancingMorph,r.skinning=t.skinning,r.morphTargets=t.morphTargets,r.morphNormals=t.morphNormals,r.morphColors=t.morphColors,r.morphTargetsCount=t.morphTargetsCount,r.numClippingPlanes=t.numClippingPlanes,r.numIntersection=t.numClipIntersection,r.vertexAlphas=t.vertexAlphas,r.vertexTangents=t.vertexTangents,r.toneMapping=t.toneMapping}Ge.setAnimationLoop((function(e){Ne&&Ne(e)})),"undefined"!=typeof self&&Ge.setContext(self),this.setAnimationLoop=function(e){Ne=e,Me.setAnimationLoop(e),null===e?Ge.stop():Ge.start()},Me.addEventListener("sessionstart",Ue),Me.addEventListener("sessionend",je),this.render=function(e,t){if(void 0!==t&&!0!==t.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===S)return;if(!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),null===t.parent&&!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),!0===Me.enabled&&!0===Me.isPresenting&&(!0===Me.cameraAutoUpdate&&Me.updateCamera(t),t=Me.getCamera()),!0===e.isScene&&e.onBeforeRender(w,e,t,E),_=he.get(e,x.length),_.init(t),x.push(_),W.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),z.setFromProjectionMatrix(W),H=this.localClippingEnabled,V=pe.init(this.clippingPlanes,H),v=ue.get(e,b.length),v.init(),b.push(v),!0===Me.enabled&&!0===Me.isPresenting){const e=w.xr.getDepthSensingMesh();null!==e&&ze(e,t,-1/0,w.sortObjects)}ze(e,t,0,w.sortObjects),v.finish(),!0===w.sortObjects&&v.sort(F,B),q=!1===Me.enabled||!1===Me.isPresenting||!1===Me.hasDepthSensing(),q&&fe.addToRenderList(v,e),this.info.render.frame++,!0===V&&pe.beginShadows();const r=_.state.shadowsArray;de.render(r,e,t),!0===V&&pe.endShadows(),!0===this.info.autoReset&&this.info.reset();const n=v.opaque,i=v.transmissive;if(_.setupLights(),t.isArrayCamera){const r=t.cameras;if(i.length>0)for(let t=0,o=r.length;t<o;t++){He(n,i,e,r[t])}q&&fe.render(e);for(let t=0,n=r.length;t<n;t++){const n=r[t];Ve(v,e,n,n.viewport)}}else i.length>0&&He(n,i,e,t),q&&fe.render(e),Ve(v,e,t);null!==E&&(re.updateMultisampleRenderTarget(E),re.updateRenderTargetMipmap(E)),!0===e.isScene&&e.onAfterRender(w,e,t),_e.resetDefaultState(),A=-1,R=null,x.pop(),x.length>0?(_=x[x.length-1],!0===V&&pe.setGlobalState(w.clippingPlanes,_.state.camera)):_=null,b.pop(),v=b.length>0?b[b.length-1]:null},this.getActiveCubeFace=function(){return M},this.getActiveMipmapLevel=function(){return T},this.getRenderTarget=function(){return E},this.setRenderTargetTextures=function(e,t,r){te.get(e.texture).__webglTexture=t,te.get(e.depthTexture).__webglTexture=r;const n=te.get(e);n.__hasExternalTextures=!0,n.__autoAllocateDepthBuffer=void 0===r,n.__autoAllocateDepthBuffer||!0===K.has("WEBGL_multisampled_render_to_texture")&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),n.__useRenderToTexture=!1)},this.setRenderTargetFramebuffer=function(e,t){const r=te.get(e);r.__webglFramebuffer=t,r.__useDefaultFramebuffer=void 0===t},this.setRenderTarget=function(e,t=0,r=0){E=e,M=t,T=r;let n=!0,i=null,o=!1,s=!1;if(e){const a=te.get(e);void 0!==a.__useDefaultFramebuffer?(Q.bindFramebuffer(xe.FRAMEBUFFER,null),n=!1):void 0===a.__webglFramebuffer?re.setupRenderTarget(e):a.__hasExternalTextures&&re.rebindTextures(e,te.get(e.texture).__webglTexture,te.get(e.depthTexture).__webglTexture);const c=e.texture;(c.isData3DTexture||c.isDataArrayTexture||c.isCompressedArrayTexture)&&(s=!0);const l=te.get(e).__webglFramebuffer;e.isWebGLCubeRenderTarget?(i=Array.isArray(l[t])?l[t][r]:l[t],o=!0):i=e.samples>0&&!1===re.useMultisampledRTT(e)?te.get(e).__webglMultisampledFramebuffer:Array.isArray(l)?l[r]:l,C.copy(e.viewport),I.copy(e.scissor),O=e.scissorTest}else C.copy(k).multiplyScalar(D).floor(),I.copy(j).multiplyScalar(D).floor(),O=G;if(Q.bindFramebuffer(xe.FRAMEBUFFER,i)&&n&&Q.drawBuffers(e,i),Q.viewport(C),Q.scissor(I),Q.setScissorTest(O),o){const n=te.get(e.texture);xe.framebufferTexture2D(xe.FRAMEBUFFER,xe.COLOR_ATTACHMENT0,xe.TEXTURE_CUBE_MAP_POSITIVE_X+t,n.__webglTexture,r)}else if(s){const n=te.get(e.texture),i=t||0;xe.framebufferTextureLayer(xe.FRAMEBUFFER,xe.COLOR_ATTACHMENT0,n.__webglTexture,r||0,i)}A=-1},this.readRenderTargetPixels=function(e,t,r,n,i,o,s){if(!e||!e.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let a=te.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==s&&(a=a[s]),a){Q.bindFramebuffer(xe.FRAMEBUFFER,a);try{const s=e.texture,a=s.format,c=s.type;if(!Z.textureFormatReadable(a))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(!Z.textureTypeReadable(c))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");t>=0&&t<=e.width-n&&r>=0&&r<=e.height-i&&xe.readPixels(t,r,n,i,ve.convert(a),ve.convert(c),o)}finally{const e=null!==E?te.get(E).__webglFramebuffer:null;Q.bindFramebuffer(xe.FRAMEBUFFER,e)}}},this.readRenderTargetPixelsAsync=async function(e,t,r,n,i,o,s){if(!e||!e.isWebGLRenderTarget)throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let a=te.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==s&&(a=a[s]),a){Q.bindFramebuffer(xe.FRAMEBUFFER,a);try{const s=e.texture,a=s.format,c=s.type;if(!Z.textureFormatReadable(a))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!Z.textureTypeReadable(c))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");if(t>=0&&t<=e.width-n&&r>=0&&r<=e.height-i){const e=xe.createBuffer();xe.bindBuffer(xe.PIXEL_PACK_BUFFER,e),xe.bufferData(xe.PIXEL_PACK_BUFFER,o.byteLength,xe.STREAM_READ),xe.readPixels(t,r,n,i,ve.convert(a),ve.convert(c),0),xe.flush();const s=xe.fenceSync(xe.SYNC_GPU_COMMANDS_COMPLETE,0);await function(e,t,r){return new Promise((function(n,i){setTimeout((function o(){switch(e.clientWaitSync(t,e.SYNC_FLUSH_COMMANDS_BIT,0)){case e.WAIT_FAILED:i();break;case e.TIMEOUT_EXPIRED:setTimeout(o,r);break;default:n()}}),r)}))}(xe,s,4);try{xe.bindBuffer(xe.PIXEL_PACK_BUFFER,e),xe.getBufferSubData(xe.PIXEL_PACK_BUFFER,0,o)}finally{xe.deleteBuffer(e),xe.deleteSync(s)}return o}}finally{const e=null!==E?te.get(E).__webglFramebuffer:null;Q.bindFramebuffer(xe.FRAMEBUFFER,e)}}},this.copyFramebufferToTexture=function(e,t=null,r=0){!0!==e.isTexture&&(console.warn("WebGLRenderer: copyFramebufferToTexture function signature has changed."),t=arguments[0]||null,e=arguments[1]);const n=Math.pow(2,-r),i=Math.floor(e.image.width*n),o=Math.floor(e.image.height*n),s=null!==t?t.x:0,a=null!==t?t.y:0;re.setTexture2D(e,0),xe.copyTexSubImage2D(xe.TEXTURE_2D,r,0,0,s,a,i,o),Q.unbindTexture()},this.copyTextureToTexture=function(e,t,r=null,n=null,i=0){let o,s,a,c,l,u;!0!==e.isTexture&&(console.warn("WebGLRenderer: copyTextureToTexture function signature has changed."),n=arguments[0]||null,e=arguments[1],t=arguments[2],i=arguments[3]||0,r=null),null!==r?(o=r.max.x-r.min.x,s=r.max.y-r.min.y,a=r.min.x,c=r.min.y):(o=e.image.width,s=e.image.height,a=0,c=0),null!==n?(l=n.x,u=n.y):(l=0,u=0);const h=ve.convert(t.format),p=ve.convert(t.type);re.setTexture2D(t,0),xe.pixelStorei(xe.UNPACK_FLIP_Y_WEBGL,t.flipY),xe.pixelStorei(xe.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),xe.pixelStorei(xe.UNPACK_ALIGNMENT,t.unpackAlignment);const d=xe.getParameter(xe.UNPACK_ROW_LENGTH),f=xe.getParameter(xe.UNPACK_IMAGE_HEIGHT),m=xe.getParameter(xe.UNPACK_SKIP_PIXELS),g=xe.getParameter(xe.UNPACK_SKIP_ROWS),y=xe.getParameter(xe.UNPACK_SKIP_IMAGES),v=e.isCompressedTexture?e.mipmaps[i]:e.image;xe.pixelStorei(xe.UNPACK_ROW_LENGTH,v.width),xe.pixelStorei(xe.UNPACK_IMAGE_HEIGHT,v.height),xe.pixelStorei(xe.UNPACK_SKIP_PIXELS,a),xe.pixelStorei(xe.UNPACK_SKIP_ROWS,c),e.isDataTexture?xe.texSubImage2D(xe.TEXTURE_2D,i,l,u,o,s,h,p,v.data):e.isCompressedTexture?xe.compressedTexSubImage2D(xe.TEXTURE_2D,i,l,u,v.width,v.height,h,v.data):xe.texSubImage2D(xe.TEXTURE_2D,i,l,u,h,p,v),xe.pixelStorei(xe.UNPACK_ROW_LENGTH,d),xe.pixelStorei(xe.UNPACK_IMAGE_HEIGHT,f),xe.pixelStorei(xe.UNPACK_SKIP_PIXELS,m),xe.pixelStorei(xe.UNPACK_SKIP_ROWS,g),xe.pixelStorei(xe.UNPACK_SKIP_IMAGES,y),0===i&&t.generateMipmaps&&xe.generateMipmap(xe.TEXTURE_2D),Q.unbindTexture()},this.copyTextureToTexture3D=function(e,t,r=null,n=null,i=0){let o,s,a,c,l,u,h,p,d;!0!==e.isTexture&&(console.warn("WebGLRenderer: copyTextureToTexture3D function signature has changed."),r=arguments[0]||null,n=arguments[1]||null,e=arguments[2],t=arguments[3],i=arguments[4]||0);const f=e.isCompressedTexture?e.mipmaps[i]:e.image;null!==r?(o=r.max.x-r.min.x,s=r.max.y-r.min.y,a=r.max.z-r.min.z,c=r.min.x,l=r.min.y,u=r.min.z):(o=f.width,s=f.height,a=f.depth,c=0,l=0,u=0),null!==n?(h=n.x,p=n.y,d=n.z):(h=0,p=0,d=0);const m=ve.convert(t.format),g=ve.convert(t.type);let y;if(t.isData3DTexture)re.setTexture3D(t,0),y=xe.TEXTURE_3D;else{if(!t.isDataArrayTexture&&!t.isCompressedArrayTexture)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");re.setTexture2DArray(t,0),y=xe.TEXTURE_2D_ARRAY}xe.pixelStorei(xe.UNPACK_FLIP_Y_WEBGL,t.flipY),xe.pixelStorei(xe.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),xe.pixelStorei(xe.UNPACK_ALIGNMENT,t.unpackAlignment);const v=xe.getParameter(xe.UNPACK_ROW_LENGTH),_=xe.getParameter(xe.UNPACK_IMAGE_HEIGHT),b=xe.getParameter(xe.UNPACK_SKIP_PIXELS),x=xe.getParameter(xe.UNPACK_SKIP_ROWS),w=xe.getParameter(xe.UNPACK_SKIP_IMAGES);xe.pixelStorei(xe.UNPACK_ROW_LENGTH,f.width),xe.pixelStorei(xe.UNPACK_IMAGE_HEIGHT,f.height),xe.pixelStorei(xe.UNPACK_SKIP_PIXELS,c),xe.pixelStorei(xe.UNPACK_SKIP_ROWS,l),xe.pixelStorei(xe.UNPACK_SKIP_IMAGES,u),e.isDataTexture||e.isData3DTexture?xe.texSubImage3D(y,i,h,p,d,o,s,a,m,g,f.data):t.isCompressedArrayTexture?xe.compressedTexSubImage3D(y,i,h,p,d,o,s,a,m,f.data):xe.texSubImage3D(y,i,h,p,d,o,s,a,m,g,f),xe.pixelStorei(xe.UNPACK_ROW_LENGTH,v),xe.pixelStorei(xe.UNPACK_IMAGE_HEIGHT,_),xe.pixelStorei(xe.UNPACK_SKIP_PIXELS,b),xe.pixelStorei(xe.UNPACK_SKIP_ROWS,x),xe.pixelStorei(xe.UNPACK_SKIP_IMAGES,w),0===i&&t.generateMipmaps&&xe.generateMipmap(y),Q.unbindTexture()},this.initRenderTarget=function(e){void 0===te.get(e).__webglFramebuffer&&re.setupRenderTarget(e)},this.initTexture=function(e){e.isCubeTexture?re.setTextureCube(e,0):e.isData3DTexture?re.setTexture3D(e,0):e.isDataArrayTexture||e.isCompressedArrayTexture?re.setTexture2DArray(e,0):re.setTexture2D(e,0),Q.unbindTexture()},this.resetState=function(){M=0,T=0,E=null,Q.reset(),_e.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return kr}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const t=this.getContext();t.drawingBufferColorSpace=e===Qt?"display-p3":"srgb",t.unpackColorSpace=fn.workingColorSpace===$t?"display-p3":"srgb"}}class nl{constructor(e,t=25e-5){this.isFogExp2=!0,this.name="",this.color=new Zi(e),this.density=t}clone(){return new nl(this.color,this.density)}toJSON(){return{type:"FogExp2",name:this.name,color:this.color.getHex(),density:this.density}}}class il{constructor(e,t=1,r=1e3){this.isFog=!0,this.name="",this.color=new Zi(e),this.near=t,this.far=r}clone(){return new il(this.color,this.near,this.far)}toJSON(){return{type:"Fog",name:this.name,color:this.color.getHex(),near:this.near,far:this.far}}}class ol extends Ui{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new vi,this.environmentIntensity=1,this.environmentRotation=new vi,this.overrideMaterial=null,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return null!==this.fog&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),1!==this.backgroundIntensity&&(t.object.backgroundIntensity=this.backgroundIntensity),t.object.backgroundRotation=this.backgroundRotation.toArray(),1!==this.environmentIntensity&&(t.object.environmentIntensity=this.environmentIntensity),t.object.environmentRotation=this.environmentRotation.toArray(),t}}class sl{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.usage=Rr,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.version=0,this.uuid=Xr()}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}get updateRange(){return ln("THREE.InterleavedBuffer: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,r){e*=this.stride,r*=t.stride;for(let n=0,i=this.stride;n<i;n++)this.array[e+n]=t.array[r+n];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Xr()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),r=new this.constructor(t,this.stride);return r.setUsage(this.usage),r}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Xr()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const al=new Pn;class cl{constructor(e,t,r,n=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=r,this.normalized=n}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,r=this.data.count;t<r;t++)al.fromBufferAttribute(this,t),al.applyMatrix4(e),this.setXYZ(t,al.x,al.y,al.z);return this}applyNormalMatrix(e){for(let t=0,r=this.count;t<r;t++)al.fromBufferAttribute(this,t),al.applyNormalMatrix(e),this.setXYZ(t,al.x,al.y,al.z);return this}transformDirection(e){for(let t=0,r=this.count;t<r;t++)al.fromBufferAttribute(this,t),al.transformDirection(e),this.setXYZ(t,al.x,al.y,al.z);return this}getComponent(e,t){let r=this.array[e*this.data.stride+this.offset+t];return this.normalized&&(r=Kr(r,this.array)),r}setComponent(e,t,r){return this.normalized&&(r=Zr(r,this.array)),this.data.array[e*this.data.stride+this.offset+t]=r,this}setX(e,t){return this.normalized&&(t=Zr(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=Zr(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=Zr(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=Zr(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=Kr(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=Kr(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=Kr(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=Kr(t,this.array)),t}setXY(e,t,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=Zr(t,this.array),r=Zr(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=r,this}setXYZ(e,t,r,n){return e=e*this.data.stride+this.offset,this.normalized&&(t=Zr(t,this.array),r=Zr(r,this.array),n=Zr(n,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=r,this.data.array[e+2]=n,this}setXYZW(e,t,r,n,i){return e=e*this.data.stride+this.offset,this.normalized&&(t=Zr(t,this.array),r=Zr(r,this.array),n=Zr(n,this.array),i=Zr(i,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=r,this.data.array[e+2]=n,this.data.array[e+3]=i,this}clone(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const e=[];for(let t=0;t<this.count;t++){const r=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[r+t])}return new lo(new this.array.constructor(e),this.itemSize,this.normalized)}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new cl(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const e=[];for(let t=0;t<this.count;t++){const r=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[r+t])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:e,normalized:this.normalized}}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class ll extends eo{constructor(e){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new Zi(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}let ul;const hl=new Pn,pl=new Pn,dl=new Pn,fl=new $r,ml=new $r,gl=new ci,yl=new Pn,vl=new Pn,_l=new Pn,bl=new $r,xl=new $r,wl=new $r;class Sl extends Ui{constructor(e=new ll){if(super(),this.isSprite=!0,this.type="Sprite",void 0===ul){ul=new Ao;const e=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),t=new sl(e,5);ul.setIndex([0,1,2,0,2,3]),ul.setAttribute("position",new cl(t,3,0,!1)),ul.setAttribute("uv",new cl(t,2,3,!1))}this.geometry=ul,this.material=e,this.center=new $r(.5,.5)}raycast(e,t){null===e.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),pl.setFromMatrixScale(this.matrixWorld),gl.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),dl.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&pl.multiplyScalar(-dl.z);const r=this.material.rotation;let n,i;0!==r&&(i=Math.cos(r),n=Math.sin(r));const o=this.center;Ml(yl.set(-.5,-.5,0),dl,o,pl,n,i),Ml(vl.set(.5,-.5,0),dl,o,pl,n,i),Ml(_l.set(.5,.5,0),dl,o,pl,n,i),bl.set(0,0),xl.set(1,0),wl.set(1,1);let s=e.ray.intersectTriangle(yl,vl,_l,!1,hl);if(null===s&&(Ml(vl.set(-.5,.5,0),dl,o,pl,n,i),xl.set(0,1),s=e.ray.intersectTriangle(yl,_l,vl,!1,hl),null===s))return;const a=e.ray.origin.distanceTo(hl);a<e.near||a>e.far||t.push({distance:a,point:hl.clone(),uv:Xi.getInterpolation(hl,yl,vl,_l,bl,xl,wl,new $r),face:null,object:this})}copy(e,t){return super.copy(e,t),void 0!==e.center&&this.center.copy(e.center),this.material=e.material,this}}function Ml(e,t,r,n,i,o){fl.subVectors(e,r).addScalar(.5).multiply(n),void 0!==i?(ml.x=o*fl.x-i*fl.y,ml.y=i*fl.x+o*fl.y):ml.copy(fl),e.copy(t),e.x+=ml.x,e.y+=ml.y,e.applyMatrix4(gl)}const Tl=new Pn,El=new Pn;class Al extends Ui{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);const t=e.levels;for(let e=0,r=t.length;e<r;e++){const r=t[e];this.addLevel(r.object.clone(),r.distance,r.hysteresis)}return this.autoUpdate=e.autoUpdate,this}addLevel(e,t=0,r=0){t=Math.abs(t);const n=this.levels;let i;for(i=0;i<n.length&&!(t<n[i].distance);i++);return n.splice(i,0,{distance:t,hysteresis:r,object:e}),this.add(e),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(e){const t=this.levels;if(t.length>0){let r,n;for(r=1,n=t.length;r<n;r++){let n=t[r].distance;if(t[r].object.visible&&(n-=n*t[r].hysteresis),e<n)break}return t[r-1].object}return null}raycast(e,t){if(this.levels.length>0){Tl.setFromMatrixPosition(this.matrixWorld);const r=e.ray.origin.distanceTo(Tl);this.getObjectForDistance(r).raycast(e,t)}}update(e){const t=this.levels;if(t.length>1){Tl.setFromMatrixPosition(e.matrixWorld),El.setFromMatrixPosition(this.matrixWorld);const r=Tl.distanceTo(El)/e.zoom;let n,i;for(t[0].object.visible=!0,n=1,i=t.length;n<i;n++){let e=t[n].distance;if(t[n].object.visible&&(e-=e*t[n].hysteresis),!(r>=e))break;t[n-1].object.visible=!1,t[n].object.visible=!0}for(this._currentLevel=n-1;n<i;n++)t[n].object.visible=!1}}toJSON(e){const t=super.toJSON(e);!1===this.autoUpdate&&(t.object.autoUpdate=!1),t.object.levels=[];const r=this.levels;for(let e=0,n=r.length;e<n;e++){const n=r[e];t.object.levels.push({object:n.object.uuid,distance:n.distance,hysteresis:n.hysteresis})}return t}}const Rl=new Pn,Cl=new Mn,Il=new Mn,Ol=new Pn,Pl=new ci,Nl=new Pn,Ll=new $n,Ul=new ci,Dl=new ai;class Fl extends Wo{constructor(e,t){super(e,t),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=ce,this.bindMatrix=new ci,this.bindMatrixInverse=new ci,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const e=this.geometry;null===this.boundingBox&&(this.boundingBox=new Un),this.boundingBox.makeEmpty();const t=e.getAttribute("position");for(let e=0;e<t.count;e++)this.getVertexPosition(e,Nl),this.boundingBox.expandByPoint(Nl)}computeBoundingSphere(){const e=this.geometry;null===this.boundingSphere&&(this.boundingSphere=new $n),this.boundingSphere.makeEmpty();const t=e.getAttribute("position");for(let e=0;e<t.count;e++)this.getVertexPosition(e,Nl),this.boundingSphere.expandByPoint(Nl)}copy(e,t){return super.copy(e,t),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this}raycast(e,t){const r=this.material,n=this.matrixWorld;void 0!==r&&(null===this.boundingSphere&&this.computeBoundingSphere(),Ll.copy(this.boundingSphere),Ll.applyMatrix4(n),!1!==e.ray.intersectsSphere(Ll)&&(Ul.copy(n).invert(),Dl.copy(e.ray).applyMatrix4(Ul),null!==this.boundingBox&&!1===Dl.intersectsBox(this.boundingBox)||this._computeIntersections(e,t,Dl)))}getVertexPosition(e,t){return super.getVertexPosition(e,t),this.applyBoneTransform(e,t),t}bind(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new Mn,t=this.geometry.attributes.skinWeight;for(let r=0,n=t.count;r<n;r++){e.fromBufferAttribute(t,r);const n=1/e.manhattanLength();n!==1/0?e.multiplyScalar(n):e.set(1,0,0,0),t.setXYZW(r,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode===ce?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===le?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(e,t){const r=this.skeleton,n=this.geometry;Cl.fromBufferAttribute(n.attributes.skinIndex,e),Il.fromBufferAttribute(n.attributes.skinWeight,e),Rl.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let e=0;e<4;e++){const n=Il.getComponent(e);if(0!==n){const i=Cl.getComponent(e);Pl.multiplyMatrices(r.bones[i].matrixWorld,r.boneInverses[i]),t.addScaledVector(Ol.copy(Rl).applyMatrix4(Pl),n)}}return t.applyMatrix4(this.bindMatrixInverse)}}class Bl extends Ui{constructor(){super(),this.isBone=!0,this.type="Bone"}}class kl extends Sn{constructor(e=null,t=1,r=1,n,i,o,s,a,c=_e,l=_e,u,h){super(null,o,s,a,c,l,n,i,u,h),this.isDataTexture=!0,this.image={data:e,width:t,height:r},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const jl=new ci,Gl=new ci;class zl{constructor(e=[],t=[]){this.uuid=Xr(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(16*e.length),0===t.length)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let e=0,t=this.bones.length;e<t;e++)this.boneInverses.push(new ci)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const t=new ci;this.bones[e]&&t.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(t)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const t=this.bones[e];t&&t.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const t=this.bones[e];t&&(t.parent&&t.parent.isBone?(t.matrix.copy(t.parent.matrixWorld).invert(),t.matrix.multiply(t.matrixWorld)):t.matrix.copy(t.matrixWorld),t.matrix.decompose(t.position,t.quaternion,t.scale))}}update(){const e=this.bones,t=this.boneInverses,r=this.boneMatrices,n=this.boneTexture;for(let n=0,i=e.length;n<i;n++){const i=e[n]?e[n].matrixWorld:Gl;jl.multiplyMatrices(i,t[n]),jl.toArray(r,16*n)}null!==n&&(n.needsUpdate=!0)}clone(){return new zl(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(4*this.bones.length);e=4*Math.ceil(e/4),e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const r=new kl(t,e,e,Ve,Ue);return r.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=r,this}getBoneByName(e){for(let t=0,r=this.bones.length;t<r;t++){const r=this.bones[t];if(r.name===e||r.uuid===e)return r}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let r=0,n=e.bones.length;r<n;r++){const n=e.bones[r];let i=t[n];void 0===i&&(console.warn("THREE.Skeleton: No bone found with UUID:",n),i=new Bl),this.bones.push(i),this.boneInverses.push((new ci).fromArray(e.boneInverses[r]))}return this.init(),this}toJSON(){const e={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,r=this.boneInverses;for(let n=0,i=t.length;n<i;n++){const i=t[n];e.bones.push(i.uuid);const o=r[n];e.boneInverses.push(o.toArray())}return e}}class Vl extends lo{constructor(e,t,r,n=1){super(e,t,r),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=n}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const Hl=new ci,Wl=new ci,Xl=[],Yl=new Un,ql=new ci,Jl=new Wo,Kl=new $n;class Zl extends Wo{constructor(e,t,r){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new Vl(new Float32Array(16*r),16),this.instanceColor=null,this.morphTexture=null,this.count=r,this.boundingBox=null,this.boundingSphere=null;for(let e=0;e<r;e++)this.setMatrixAt(e,ql)}computeBoundingBox(){const e=this.geometry,t=this.count;null===this.boundingBox&&(this.boundingBox=new Un),null===e.boundingBox&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(let r=0;r<t;r++)this.getMatrixAt(r,Hl),Yl.copy(e.boundingBox).applyMatrix4(Hl),this.boundingBox.union(Yl)}computeBoundingSphere(){const e=this.geometry,t=this.count;null===this.boundingSphere&&(this.boundingSphere=new $n),null===e.boundingSphere&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let r=0;r<t;r++)this.getMatrixAt(r,Hl),Kl.copy(e.boundingSphere).applyMatrix4(Hl),this.boundingSphere.union(Kl)}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),null!==e.morphTexture&&(this.morphTexture=e.morphTexture.clone()),null!==e.instanceColor&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this}getColorAt(e,t){t.fromArray(this.instanceColor.array,3*e)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,16*e)}getMorphAt(e,t){const r=t.morphTargetInfluences,n=this.morphTexture.source.data.data,i=e*(r.length+1)+1;for(let e=0;e<r.length;e++)r[e]=n[i+e]}raycast(e,t){const r=this.matrixWorld,n=this.count;if(Jl.geometry=this.geometry,Jl.material=this.material,void 0!==Jl.material&&(null===this.boundingSphere&&this.computeBoundingSphere(),Kl.copy(this.boundingSphere),Kl.applyMatrix4(r),!1!==e.ray.intersectsSphere(Kl)))for(let i=0;i<n;i++){this.getMatrixAt(i,Hl),Wl.multiplyMatrices(r,Hl),Jl.matrixWorld=Wl,Jl.raycast(e,Xl);for(let e=0,r=Xl.length;e<r;e++){const r=Xl[e];r.instanceId=i,r.object=this,t.push(r)}Xl.length=0}}setColorAt(e,t){null===this.instanceColor&&(this.instanceColor=new Vl(new Float32Array(3*this.instanceMatrix.count),3)),t.toArray(this.instanceColor.array,3*e)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,16*e)}setMorphAt(e,t){const r=t.morphTargetInfluences,n=r.length+1;null===this.morphTexture&&(this.morphTexture=new kl(new Float32Array(n*this.count),n,this.count,qe,Ue));const i=this.morphTexture.source.data.data;let o=0;for(let e=0;e<r.length;e++)o+=r[e];const s=this.geometry.morphTargetsRelative?1:1-o,a=n*e;i[a]=s,i.set(r,a+1)}updateMorphTargets(){}dispose(){return this.dispatchEvent({type:"dispose"}),null!==this.morphTexture&&(this.morphTexture.dispose(),this.morphTexture=null),this}}function Ql(e,t){return e.z-t.z}function $l(e,t){return t.z-e.z}class eu{constructor(){this.index=0,this.pool=[],this.list=[]}push(e,t){const r=this.pool,n=this.list;this.index>=r.length&&r.push({start:-1,count:-1,z:-1});const i=r[this.index];n.push(i),this.index++,i.start=e.start,i.count=e.count,i.z=t}reset(){this.list.length=0,this.index=0}}const tu="batchId",ru=new ci,nu=new ci,iu=new ci,ou=new Zi(1,1,1),su=new ci,au=new fs,cu=new Un,lu=new $n,uu=new Pn,hu=new Pn,pu=new Pn,du=new eu,fu=new Wo,mu=[];function gu(e,t,r=0){const n=t.itemSize;if(e.isInterleavedBufferAttribute||e.array.constructor!==t.array.constructor){const i=e.count;for(let o=0;o<i;o++)for(let i=0;i<n;i++)t.setComponent(o+r,i,e.getComponent(o,i))}else t.array.set(e.array,r*n);t.needsUpdate=!0}class yu extends Wo{get maxGeometryCount(){return this._maxGeometryCount}constructor(e,t,r=2*t,n){super(new Ao,n),this.isBatchedMesh=!0,this.perObjectFrustumCulled=!0,this.sortObjects=!0,this.boundingBox=null,this.boundingSphere=null,this.customSort=null,this._drawRanges=[],this._reservedRanges=[],this._visibility=[],this._active=[],this._bounds=[],this._maxGeometryCount=e,this._maxVertexCount=t,this._maxIndexCount=r,this._geometryInitialized=!1,this._geometryCount=0,this._multiDrawCounts=new Int32Array(e),this._multiDrawStarts=new Int32Array(e),this._multiDrawCount=0,this._multiDrawInstances=null,this._visibilityChanged=!0,this._matricesTexture=null,this._initMatricesTexture(),this._colorsTexture=null}_initMatricesTexture(){let e=Math.sqrt(4*this._maxGeometryCount);e=4*Math.ceil(e/4),e=Math.max(e,4);const t=new Float32Array(e*e*4),r=new kl(t,e,e,Ve,Ue);this._matricesTexture=r}_initColorsTexture(){let e=Math.sqrt(this._maxGeometryCount);e=Math.ceil(e);const t=new Float32Array(e*e*4).fill(1),r=new kl(t,e,e,Ve,Ue);r.colorSpace=fn.workingColorSpace,this._colorsTexture=r}_initializeGeometry(e){const t=this.geometry,r=this._maxVertexCount,n=this._maxGeometryCount,i=this._maxIndexCount;if(!1===this._geometryInitialized){for(const n in e.attributes){const i=e.getAttribute(n),{array:o,itemSize:s,normalized:a}=i,c=new o.constructor(r*s),l=new lo(c,s,a);t.setAttribute(n,l)}if(null!==e.getIndex()){const e=r>65536?new Uint32Array(i):new Uint16Array(i);t.setIndex(new lo(e,1))}const o=n>65536?new Uint32Array(r):new Uint16Array(r);t.setAttribute(tu,new lo(o,1)),this._geometryInitialized=!0}}_validateGeometry(e){if(e.getAttribute(tu))throw new Error(`BatchedMesh: Geometry cannot use attribute "${tu}"`);const t=this.geometry;if(Boolean(e.getIndex())!==Boolean(t.getIndex()))throw new Error('BatchedMesh: All geometries must consistently have "index".');for(const r in t.attributes){if(r===tu)continue;if(!e.hasAttribute(r))throw new Error(`BatchedMesh: Added geometry missing "${r}". All geometries must have consistent attributes.`);const n=e.getAttribute(r),i=t.getAttribute(r);if(n.itemSize!==i.itemSize||n.normalized!==i.normalized)throw new Error("BatchedMesh: All attributes must have a consistent itemSize and normalized value.")}}setCustomSort(e){return this.customSort=e,this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new Un);const e=this._geometryCount,t=this.boundingBox,r=this._active;t.makeEmpty();for(let n=0;n<e;n++)!1!==r[n]&&(this.getMatrixAt(n,ru),this.getBoundingBoxAt(n,cu).applyMatrix4(ru),t.union(cu))}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new $n);const e=this._geometryCount,t=this.boundingSphere,r=this._active;t.makeEmpty();for(let n=0;n<e;n++)!1!==r[n]&&(this.getMatrixAt(n,ru),this.getBoundingSphereAt(n,lu).applyMatrix4(ru),t.union(lu))}addGeometry(e,t=-1,r=-1){if(this._initializeGeometry(e),this._validateGeometry(e),this._geometryCount>=this._maxGeometryCount)throw new Error("BatchedMesh: Maximum geometry count reached.");const n={vertexStart:-1,vertexCount:-1,indexStart:-1,indexCount:-1};let i=null;const o=this._reservedRanges,s=this._drawRanges,a=this._bounds;0!==this._geometryCount&&(i=o[o.length-1]),n.vertexCount=-1===t?e.getAttribute("position").count:t,n.vertexStart=null===i?0:i.vertexStart+i.vertexCount;const c=e.getIndex(),l=null!==c;if(l&&(n.indexCount=-1===r?c.count:r,n.indexStart=null===i?0:i.indexStart+i.indexCount),-1!==n.indexStart&&n.indexStart+n.indexCount>this._maxIndexCount||n.vertexStart+n.vertexCount>this._maxVertexCount)throw new Error("BatchedMesh: Reserved space request exceeds the maximum buffer size.");const u=this._visibility,h=this._active,p=this._matricesTexture,d=this._matricesTexture.image.data,f=this._colorsTexture;u.push(!0),h.push(!0);const m=this._geometryCount;this._geometryCount++,iu.toArray(d,16*m),p.needsUpdate=!0,null!==f&&(ou.toArray(f.image.data,4*m),f.needsUpdate=!0),o.push(n),s.push({start:l?n.indexStart:n.vertexStart,count:-1}),a.push({boxInitialized:!1,box:new Un,sphereInitialized:!1,sphere:new $n});const g=this.geometry.getAttribute(tu);for(let e=0;e<n.vertexCount;e++)g.setX(n.vertexStart+e,m);return g.needsUpdate=!0,this.setGeometryAt(m,e),m}setGeometryAt(e,t){if(e>=this._geometryCount)throw new Error("BatchedMesh: Maximum geometry count reached.");this._validateGeometry(t);const r=this.geometry,n=null!==r.getIndex(),i=r.getIndex(),o=t.getIndex(),s=this._reservedRanges[e];if(n&&o.count>s.indexCount||t.attributes.position.count>s.vertexCount)throw new Error("BatchedMesh: Reserved space not large enough for provided geometry.");const a=s.vertexStart,c=s.vertexCount;for(const e in r.attributes){if(e===tu)continue;const n=t.getAttribute(e),i=r.getAttribute(e);gu(n,i,a);const o=n.itemSize;for(let e=n.count,t=c;e<t;e++){const t=a+e;for(let e=0;e<o;e++)i.setComponent(t,e,0)}i.needsUpdate=!0,i.addUpdateRange(a*o,c*o)}if(n){const e=s.indexStart;for(let t=0;t<o.count;t++)i.setX(e+t,a+o.getX(t));for(let t=o.count,r=s.indexCount;t<r;t++)i.setX(e+t,a);i.needsUpdate=!0,i.addUpdateRange(e,s.indexCount)}const l=this._bounds[e];null!==t.boundingBox?(l.box.copy(t.boundingBox),l.boxInitialized=!0):l.boxInitialized=!1,null!==t.boundingSphere?(l.sphere.copy(t.boundingSphere),l.sphereInitialized=!0):l.sphereInitialized=!1;const u=this._drawRanges[e],h=t.getAttribute("position");return u.count=n?o.count:h.count,this._visibilityChanged=!0,e}deleteGeometry(e){const t=this._active;return e>=t.length||!1===t[e]||(t[e]=!1,this._visibilityChanged=!0),this}getInstanceCountAt(e){return null===this._multiDrawInstances?null:this._multiDrawInstances[e]}setInstanceCountAt(e,t){return null===this._multiDrawInstances&&(this._multiDrawInstances=new Int32Array(this._maxGeometryCount).fill(1)),this._multiDrawInstances[e]=t,e}getBoundingBoxAt(e,t){if(!1===this._active[e])return null;const r=this._bounds[e],n=r.box,i=this.geometry;if(!1===r.boxInitialized){n.makeEmpty();const t=i.index,o=i.attributes.position,s=this._drawRanges[e];for(let e=s.start,r=s.start+s.count;e<r;e++){let r=e;t&&(r=t.getX(r)),n.expandByPoint(uu.fromBufferAttribute(o,r))}r.boxInitialized=!0}return t.copy(n),t}getBoundingSphereAt(e,t){if(!1===this._active[e])return null;const r=this._bounds[e],n=r.sphere,i=this.geometry;if(!1===r.sphereInitialized){n.makeEmpty(),this.getBoundingBoxAt(e,cu),cu.getCenter(n.center);const t=i.index,o=i.attributes.position,s=this._drawRanges[e];let a=0;for(let e=s.start,r=s.start+s.count;e<r;e++){let r=e;t&&(r=t.getX(r)),uu.fromBufferAttribute(o,r),a=Math.max(a,n.center.distanceToSquared(uu))}n.radius=Math.sqrt(a),r.sphereInitialized=!0}return t.copy(n),t}setMatrixAt(e,t){const r=this._active,n=this._matricesTexture,i=this._matricesTexture.image.data;return e>=this._geometryCount||!1===r[e]||(t.toArray(i,16*e),n.needsUpdate=!0),this}getMatrixAt(e,t){const r=this._active,n=this._matricesTexture.image.data;return e>=this._geometryCount||!1===r[e]?null:t.fromArray(n,16*e)}setColorAt(e,t){null===this._colorsTexture&&this._initColorsTexture();const r=this._active,n=this._colorsTexture,i=this._colorsTexture.image.data;return e>=this._geometryCount||!1===r[e]||(t.toArray(i,4*e),n.needsUpdate=!0),this}getColorAt(e,t){const r=this._active,n=this._colorsTexture.image.data;return e>=this._geometryCount||!1===r[e]?null:t.fromArray(n,4*e)}setVisibleAt(e,t){const r=this._visibility,n=this._active;return e>=this._geometryCount||!1===n[e]||r[e]===t||(r[e]=t,this._visibilityChanged=!0),this}getVisibleAt(e){const t=this._visibility,r=this._active;return!(e>=this._geometryCount||!1===r[e])&&t[e]}raycast(e,t){const r=this._visibility,n=this._active,i=this._drawRanges,o=this._geometryCount,s=this.matrixWorld,a=this.geometry;fu.material=this.material,fu.geometry.index=a.index,fu.geometry.attributes=a.attributes,null===fu.geometry.boundingBox&&(fu.geometry.boundingBox=new Un),null===fu.geometry.boundingSphere&&(fu.geometry.boundingSphere=new $n);for(let a=0;a<o;a++){if(!r[a]||!n[a])continue;const o=i[a];fu.geometry.setDrawRange(o.start,o.count),this.getMatrixAt(a,fu.matrixWorld).premultiply(s),this.getBoundingBoxAt(a,fu.geometry.boundingBox),this.getBoundingSphereAt(a,fu.geometry.boundingSphere),fu.raycast(e,mu);for(let e=0,r=mu.length;e<r;e++){const r=mu[e];r.object=this,r.batchId=a,t.push(r)}mu.length=0}fu.material=null,fu.geometry.index=null,fu.geometry.attributes={},fu.geometry.setDrawRange(0,1/0)}copy(e){return super.copy(e),this.geometry=e.geometry.clone(),this.perObjectFrustumCulled=e.perObjectFrustumCulled,this.sortObjects=e.sortObjects,this.boundingBox=null!==e.boundingBox?e.boundingBox.clone():null,this.boundingSphere=null!==e.boundingSphere?e.boundingSphere.clone():null,this._drawRanges=e._drawRanges.map((e=>({...e}))),this._reservedRanges=e._reservedRanges.map((e=>({...e}))),this._visibility=e._visibility.slice(),this._active=e._active.slice(),this._bounds=e._bounds.map((e=>({boxInitialized:e.boxInitialized,box:e.box.clone(),sphereInitialized:e.sphereInitialized,sphere:e.sphere.clone()}))),this._maxGeometryCount=e._maxGeometryCount,this._maxVertexCount=e._maxVertexCount,this._maxIndexCount=e._maxIndexCount,this._geometryInitialized=e._geometryInitialized,this._geometryCount=e._geometryCount,this._multiDrawCounts=e._multiDrawCounts.slice(),this._multiDrawStarts=e._multiDrawStarts.slice(),this._matricesTexture=e._matricesTexture.clone(),this._matricesTexture.image.data=this._matricesTexture.image.slice(),null!==this._colorsTexture&&(this._colorsTexture=e._colorsTexture.clone(),this._colorsTexture.image.data=this._colorsTexture.image.slice()),this}dispose(){return this.geometry.dispose(),this._matricesTexture.dispose(),this._matricesTexture=null,null!==this._colorsTexture&&(this._colorsTexture.dispose(),this._colorsTexture=null),this}onBeforeRender(e,t,r,n,i){if(!this._visibilityChanged&&!this.perObjectFrustumCulled&&!this.sortObjects)return;const o=n.getIndex(),s=null===o?1:o.array.BYTES_PER_ELEMENT,a=this._active,c=this._visibility,l=this._multiDrawStarts,u=this._multiDrawCounts,h=this._drawRanges,p=this.perObjectFrustumCulled;p&&(su.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse).multiply(this.matrixWorld),au.setFromProjectionMatrix(su,e.coordinateSystem));let d=0;if(this.sortObjects){nu.copy(this.matrixWorld).invert(),uu.setFromMatrixPosition(r.matrixWorld).applyMatrix4(nu),hu.set(0,0,-1).transformDirection(r.matrixWorld).transformDirection(nu);for(let e=0,t=c.length;e<t;e++)if(c[e]&&a[e]){this.getMatrixAt(e,ru),this.getBoundingSphereAt(e,lu).applyMatrix4(ru);let t=!1;if(p&&(t=!au.intersectsSphere(lu)),!t){const t=pu.subVectors(lu.center,uu).dot(hu);du.push(h[e],t)}}const e=du.list,t=this.customSort;null===t?e.sort(i.transparent?$l:Ql):t.call(this,e,r);for(let t=0,r=e.length;t<r;t++){const r=e[t];l[d]=r.start*s,u[d]=r.count,d++}du.reset()}else for(let e=0,t=c.length;e<t;e++)if(c[e]&&a[e]){let t=!1;if(p&&(this.getMatrixAt(e,ru),this.getBoundingSphereAt(e,lu).applyMatrix4(ru),t=!au.intersectsSphere(lu)),!t){const t=h[e];l[d]=t.start*s,u[d]=t.count,d++}}this._multiDrawCount=d,this._visibilityChanged=!1}onBeforeShadow(e,t,r,n,i,o){this.onBeforeRender(e,null,n,i,o)}}class vu extends eo{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Zi(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const _u=new Pn,bu=new Pn,xu=new ci,wu=new ai,Su=new $n,Mu=new Pn,Tu=new Pn;class Eu extends Ui{constructor(e=new Ao,t=new vu){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(null===e.index){const t=e.attributes.position,r=[0];for(let e=1,n=t.count;e<n;e++)_u.fromBufferAttribute(t,e-1),bu.fromBufferAttribute(t,e),r[e]=r[e-1],r[e]+=_u.distanceTo(bu);e.setAttribute("lineDistance",new _o(r,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const r=this.geometry,n=this.matrixWorld,i=e.params.Line.threshold,o=r.drawRange;if(null===r.boundingSphere&&r.computeBoundingSphere(),Su.copy(r.boundingSphere),Su.applyMatrix4(n),Su.radius+=i,!1===e.ray.intersectsSphere(Su))return;xu.copy(n).invert(),wu.copy(e.ray).applyMatrix4(xu);const s=i/((this.scale.x+this.scale.y+this.scale.z)/3),a=s*s,c=this.isLineSegments?2:1,l=r.index,u=r.attributes.position;if(null!==l){const r=Math.max(0,o.start),n=Math.min(l.count,o.start+o.count);for(let i=r,o=n-1;i<o;i+=c){const r=l.getX(i),n=l.getX(i+1),o=Au(this,e,wu,a,r,n);o&&t.push(o)}if(this.isLineLoop){const i=l.getX(n-1),o=l.getX(r),s=Au(this,e,wu,a,i,o);s&&t.push(s)}}else{const r=Math.max(0,o.start),n=Math.min(u.count,o.start+o.count);for(let i=r,o=n-1;i<o;i+=c){const r=Au(this,e,wu,a,i,i+1);r&&t.push(r)}if(this.isLineLoop){const i=Au(this,e,wu,a,n-1,r);i&&t.push(i)}}}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const r=e[t[0]];if(void 0!==r){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=r.length;e<t;e++){const t=r[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}}function Au(e,t,r,n,i,o){const s=e.geometry.attributes.position;_u.fromBufferAttribute(s,i),bu.fromBufferAttribute(s,o);if(r.distanceSqToSegment(_u,bu,Mu,Tu)>n)return;Mu.applyMatrix4(e.matrixWorld);const a=t.ray.origin.distanceTo(Mu);return a<t.near||a>t.far?void 0:{distance:a,point:Tu.clone().applyMatrix4(e.matrixWorld),index:i,face:null,faceIndex:null,object:e}}const Ru=new Pn,Cu=new Pn;class Iu extends Eu{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(null===e.index){const t=e.attributes.position,r=[];for(let e=0,n=t.count;e<n;e+=2)Ru.fromBufferAttribute(t,e),Cu.fromBufferAttribute(t,e+1),r[e]=0===e?0:r[e-1],r[e+1]=r[e]+Ru.distanceTo(Cu);e.setAttribute("lineDistance",new _o(r,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class Ou extends Eu{constructor(e,t){super(e,t),this.isLineLoop=!0,this.type="LineLoop"}}class Pu extends eo{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new Zi(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const Nu=new ci,Lu=new ai,Uu=new $n,Du=new Pn;class Fu extends Ui{constructor(e=new Ao,t=new Pu){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}raycast(e,t){const r=this.geometry,n=this.matrixWorld,i=e.params.Points.threshold,o=r.drawRange;if(null===r.boundingSphere&&r.computeBoundingSphere(),Uu.copy(r.boundingSphere),Uu.applyMatrix4(n),Uu.radius+=i,!1===e.ray.intersectsSphere(Uu))return;Nu.copy(n).invert(),Lu.copy(e.ray).applyMatrix4(Nu);const s=i/((this.scale.x+this.scale.y+this.scale.z)/3),a=s*s,c=r.index,l=r.attributes.position;if(null!==c){for(let r=Math.max(0,o.start),i=Math.min(c.count,o.start+o.count);r<i;r++){const i=c.getX(r);Du.fromBufferAttribute(l,i),Bu(Du,i,a,n,e,t,this)}}else{for(let r=Math.max(0,o.start),i=Math.min(l.count,o.start+o.count);r<i;r++)Du.fromBufferAttribute(l,r),Bu(Du,r,a,n,e,t,this)}}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const r=e[t[0]];if(void 0!==r){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=r.length;e<t;e++){const t=r[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}}function Bu(e,t,r,n,i,o,s){const a=Lu.distanceSqToPoint(e);if(a<r){const r=new Pn;Lu.closestPointToPoint(e,r),r.applyMatrix4(n);const c=i.ray.origin.distanceTo(r);if(c<i.near||c>i.far)return;o.push({distance:c,distanceToRay:Math.sqrt(a),point:r,index:t,face:null,object:s})}}class ku extends Sn{constructor(e,t,r,n,i,o,s,a,c){super(e,t,r,n,i,o,s,a,c),this.isVideoTexture=!0,this.minFilter=void 0!==o?o:Me,this.magFilter=void 0!==i?i:Me,this.generateMipmaps=!1;const l=this;"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback((function t(){l.needsUpdate=!0,e.requestVideoFrameCallback(t)}))}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;!1==="requestVideoFrameCallback"in e&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class ju extends Sn{constructor(e,t){super({width:e,height:t}),this.isFramebufferTexture=!0,this.magFilter=_e,this.minFilter=_e,this.generateMipmaps=!1,this.needsUpdate=!0}}class Gu extends Sn{constructor(e,t,r,n,i,o,s,a,c,l,u,h){super(null,o,s,a,c,l,n,i,u,h),this.isCompressedTexture=!0,this.image={width:t,height:r},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}class zu extends Gu{constructor(e,t,r,n,i,o){super(e,t,r,i,o),this.isCompressedArrayTexture=!0,this.image.depth=n,this.wrapR=ye,this.layerUpdates=new Set}addLayerUpdates(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class Vu extends Gu{constructor(e,t,r){super(void 0,e[0].width,e[0].height,t,r,he),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=e}}class Hu extends Sn{constructor(e,t,r,n,i,o,s,a,c){super(e,t,r,n,i,o,s,a,c),this.isCanvasTexture=!0,this.needsUpdate=!0}}class Wu{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){const r=this.getUtoTmapping(e);return this.getPoint(r,t)}getPoints(e=5){const t=[];for(let r=0;r<=e;r++)t.push(this.getPoint(r/e));return t}getSpacedPoints(e=5){const t=[];for(let r=0;r<=e;r++)t.push(this.getPointAt(r/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let r,n=this.getPoint(0),i=0;t.push(0);for(let o=1;o<=e;o++)r=this.getPoint(o/e),i+=r.distanceTo(n),t.push(i),n=r;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){const r=this.getLengths();let n=0;const i=r.length;let o;o=t||e*r[i-1];let s,a=0,c=i-1;for(;a<=c;)if(n=Math.floor(a+(c-a)/2),s=r[n]-o,s<0)a=n+1;else{if(!(s>0)){c=n;break}c=n-1}if(n=c,r[n]===o)return n/(i-1);const l=r[n];return(n+(o-l)/(r[n+1]-l))/(i-1)}getTangent(e,t){const r=1e-4;let n=e-r,i=e+r;n<0&&(n=0),i>1&&(i=1);const o=this.getPoint(n),s=this.getPoint(i),a=t||(o.isVector2?new $r:new Pn);return a.copy(s).sub(o).normalize(),a}getTangentAt(e,t){const r=this.getUtoTmapping(e);return this.getTangent(r,t)}computeFrenetFrames(e,t){const r=new Pn,n=[],i=[],o=[],s=new Pn,a=new ci;for(let t=0;t<=e;t++){const r=t/e;n[t]=this.getTangentAt(r,new Pn)}i[0]=new Pn,o[0]=new Pn;let c=Number.MAX_VALUE;const l=Math.abs(n[0].x),u=Math.abs(n[0].y),h=Math.abs(n[0].z);l<=c&&(c=l,r.set(1,0,0)),u<=c&&(c=u,r.set(0,1,0)),h<=c&&r.set(0,0,1),s.crossVectors(n[0],r).normalize(),i[0].crossVectors(n[0],s),o[0].crossVectors(n[0],i[0]);for(let t=1;t<=e;t++){if(i[t]=i[t-1].clone(),o[t]=o[t-1].clone(),s.crossVectors(n[t-1],n[t]),s.length()>Number.EPSILON){s.normalize();const e=Math.acos(Yr(n[t-1].dot(n[t]),-1,1));i[t].applyMatrix4(a.makeRotationAxis(s,e))}o[t].crossVectors(n[t],i[t])}if(!0===t){let t=Math.acos(Yr(i[0].dot(i[e]),-1,1));t/=e,n[0].dot(s.crossVectors(i[0],i[e]))>0&&(t=-t);for(let r=1;r<=e;r++)i[r].applyMatrix4(a.makeRotationAxis(n[r],t*r)),o[r].crossVectors(n[r],i[r])}return{tangents:n,normals:i,binormals:o}}clone(){return(new this.constructor).copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class Xu extends Wu{constructor(e=0,t=0,r=1,n=1,i=0,o=2*Math.PI,s=!1,a=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=r,this.yRadius=n,this.aStartAngle=i,this.aEndAngle=o,this.aClockwise=s,this.aRotation=a}getPoint(e,t=new $r){const r=t,n=2*Math.PI;let i=this.aEndAngle-this.aStartAngle;const o=Math.abs(i)<Number.EPSILON;for(;i<0;)i+=n;for(;i>n;)i-=n;i<Number.EPSILON&&(i=o?0:n),!0!==this.aClockwise||o||(i===n?i=-n:i-=n);const s=this.aStartAngle+e*i;let a=this.aX+this.xRadius*Math.cos(s),c=this.aY+this.yRadius*Math.sin(s);if(0!==this.aRotation){const e=Math.cos(this.aRotation),t=Math.sin(this.aRotation),r=a-this.aX,n=c-this.aY;a=r*e-n*t+this.aX,c=r*t+n*e+this.aY}return r.set(a,c)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}class Yu extends Xu{constructor(e,t,r,n,i,o){super(e,t,r,r,n,i,o),this.isArcCurve=!0,this.type="ArcCurve"}}function qu(){let e=0,t=0,r=0,n=0;function i(i,o,s,a){e=i,t=s,r=-3*i+3*o-2*s-a,n=2*i-2*o+s+a}return{initCatmullRom:function(e,t,r,n,o){i(t,r,o*(r-e),o*(n-t))},initNonuniformCatmullRom:function(e,t,r,n,o,s,a){let c=(t-e)/o-(r-e)/(o+s)+(r-t)/s,l=(r-t)/s-(n-t)/(s+a)+(n-r)/a;c*=s,l*=s,i(t,r,c,l)},calc:function(i){const o=i*i;return e+t*i+r*o+n*(o*i)}}}const Ju=new Pn,Ku=new qu,Zu=new qu,Qu=new qu;class $u extends Wu{constructor(e=[],t=!1,r="centripetal",n=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=r,this.tension=n}getPoint(e,t=new Pn){const r=t,n=this.points,i=n.length,o=(i-(this.closed?0:1))*e;let s,a,c=Math.floor(o),l=o-c;this.closed?c+=c>0?0:(Math.floor(Math.abs(c)/i)+1)*i:0===l&&c===i-1&&(c=i-2,l=1),this.closed||c>0?s=n[(c-1)%i]:(Ju.subVectors(n[0],n[1]).add(n[0]),s=Ju);const u=n[c%i],h=n[(c+1)%i];if(this.closed||c+2<i?a=n[(c+2)%i]:(Ju.subVectors(n[i-1],n[i-2]).add(n[i-1]),a=Ju),"centripetal"===this.curveType||"chordal"===this.curveType){const e="chordal"===this.curveType?.5:.25;let t=Math.pow(s.distanceToSquared(u),e),r=Math.pow(u.distanceToSquared(h),e),n=Math.pow(h.distanceToSquared(a),e);r<1e-4&&(r=1),t<1e-4&&(t=r),n<1e-4&&(n=r),Ku.initNonuniformCatmullRom(s.x,u.x,h.x,a.x,t,r,n),Zu.initNonuniformCatmullRom(s.y,u.y,h.y,a.y,t,r,n),Qu.initNonuniformCatmullRom(s.z,u.z,h.z,a.z,t,r,n)}else"catmullrom"===this.curveType&&(Ku.initCatmullRom(s.x,u.x,h.x,a.x,this.tension),Zu.initCatmullRom(s.y,u.y,h.y,a.y,this.tension),Qu.initCatmullRom(s.z,u.z,h.z,a.z,this.tension));return r.set(Ku.calc(l),Zu.calc(l),Qu.calc(l)),r}copy(e){super.copy(e),this.points=[];for(let t=0,r=e.points.length;t<r;t++){const r=e.points[t];this.points.push(r.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,r=this.points.length;t<r;t++){const r=this.points[t];e.points.push(r.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,r=e.points.length;t<r;t++){const r=e.points[t];this.points.push((new Pn).fromArray(r))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function eh(e,t,r,n,i){const o=.5*(n-t),s=.5*(i-r),a=e*e;return(2*r-2*n+o+s)*(e*a)+(-3*r+3*n-2*o-s)*a+o*e+r}function th(e,t,r,n){return function(e,t){const r=1-e;return r*r*t}(e,t)+function(e,t){return 2*(1-e)*e*t}(e,r)+function(e,t){return e*e*t}(e,n)}function rh(e,t,r,n,i){return function(e,t){const r=1-e;return r*r*r*t}(e,t)+function(e,t){const r=1-e;return 3*r*r*e*t}(e,r)+function(e,t){return 3*(1-e)*e*e*t}(e,n)+function(e,t){return e*e*e*t}(e,i)}class nh extends Wu{constructor(e=new $r,t=new $r,r=new $r,n=new $r){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=r,this.v3=n}getPoint(e,t=new $r){const r=t,n=this.v0,i=this.v1,o=this.v2,s=this.v3;return r.set(rh(e,n.x,i.x,o.x,s.x),rh(e,n.y,i.y,o.y,s.y)),r}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class ih extends Wu{constructor(e=new Pn,t=new Pn,r=new Pn,n=new Pn){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=r,this.v3=n}getPoint(e,t=new Pn){const r=t,n=this.v0,i=this.v1,o=this.v2,s=this.v3;return r.set(rh(e,n.x,i.x,o.x,s.x),rh(e,n.y,i.y,o.y,s.y),rh(e,n.z,i.z,o.z,s.z)),r}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class oh extends Wu{constructor(e=new $r,t=new $r){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new $r){const r=t;return 1===e?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(e).add(this.v1)),r}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new $r){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class sh extends Wu{constructor(e=new Pn,t=new Pn){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e,t=new Pn){const r=t;return 1===e?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(e).add(this.v1)),r}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new Pn){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class ah extends Wu{constructor(e=new $r,t=new $r,r=new $r){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=r}getPoint(e,t=new $r){const r=t,n=this.v0,i=this.v1,o=this.v2;return r.set(th(e,n.x,i.x,o.x),th(e,n.y,i.y,o.y)),r}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class ch extends Wu{constructor(e=new Pn,t=new Pn,r=new Pn){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=r}getPoint(e,t=new Pn){const r=t,n=this.v0,i=this.v1,o=this.v2;return r.set(th(e,n.x,i.x,o.x),th(e,n.y,i.y,o.y),th(e,n.z,i.z,o.z)),r}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class lh extends Wu{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,t=new $r){const r=t,n=this.points,i=(n.length-1)*e,o=Math.floor(i),s=i-o,a=n[0===o?o:o-1],c=n[o],l=n[o>n.length-2?n.length-1:o+1],u=n[o>n.length-3?n.length-1:o+2];return r.set(eh(s,a.x,c.x,l.x,u.x),eh(s,a.y,c.y,l.y,u.y)),r}copy(e){super.copy(e),this.points=[];for(let t=0,r=e.points.length;t<r;t++){const r=e.points[t];this.points.push(r.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,r=this.points.length;t<r;t++){const r=this.points[t];e.points.push(r.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,r=e.points.length;t<r;t++){const r=e.points[t];this.points.push((new $r).fromArray(r))}return this}}var uh=Object.freeze({__proto__:null,ArcCurve:Yu,CatmullRomCurve3:$u,CubicBezierCurve:nh,CubicBezierCurve3:ih,EllipseCurve:Xu,LineCurve:oh,LineCurve3:sh,QuadraticBezierCurve:ah,QuadraticBezierCurve3:ch,SplineCurve:lh});class hh extends Wu{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);if(!e.equals(t)){const r=!0===e.isVector2?"LineCurve":"LineCurve3";this.curves.push(new uh[r](t,e))}return this}getPoint(e,t){const r=e*this.getLength(),n=this.getCurveLengths();let i=0;for(;i<n.length;){if(n[i]>=r){const e=n[i]-r,o=this.curves[i],s=o.getLength(),a=0===s?0:1-e/s;return o.getPointAt(a,t)}i++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let r=0,n=this.curves.length;r<n;r++)t+=this.curves[r].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){const t=[];for(let r=0;r<=e;r++)t.push(this.getPoint(r/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){const t=[];let r;for(let n=0,i=this.curves;n<i.length;n++){const o=i[n],s=o.isEllipseCurve?2*e:o.isLineCurve||o.isLineCurve3?1:o.isSplineCurve?e*o.points.length:e,a=o.getPoints(s);for(let e=0;e<a.length;e++){const n=a[e];r&&r.equals(n)||(t.push(n),r=n)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,r=e.curves.length;t<r;t++){const r=e.curves[t];this.curves.push(r.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,r=this.curves.length;t<r;t++){const r=this.curves[t];e.curves.push(r.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,r=e.curves.length;t<r;t++){const r=e.curves[t];this.curves.push((new uh[r.type]).fromJSON(r))}return this}}class ph extends hh{constructor(e){super(),this.type="Path",this.currentPoint=new $r,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,r=e.length;t<r;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){const r=new oh(this.currentPoint.clone(),new $r(e,t));return this.curves.push(r),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,r,n){const i=new ah(this.currentPoint.clone(),new $r(e,t),new $r(r,n));return this.curves.push(i),this.currentPoint.set(r,n),this}bezierCurveTo(e,t,r,n,i,o){const s=new nh(this.currentPoint.clone(),new $r(e,t),new $r(r,n),new $r(i,o));return this.curves.push(s),this.currentPoint.set(i,o),this}splineThru(e){const t=[this.currentPoint.clone()].concat(e),r=new lh(t);return this.curves.push(r),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,r,n,i,o){const s=this.currentPoint.x,a=this.currentPoint.y;return this.absarc(e+s,t+a,r,n,i,o),this}absarc(e,t,r,n,i,o){return this.absellipse(e,t,r,r,n,i,o),this}ellipse(e,t,r,n,i,o,s,a){const c=this.currentPoint.x,l=this.currentPoint.y;return this.absellipse(e+c,t+l,r,n,i,o,s,a),this}absellipse(e,t,r,n,i,o,s,a){const c=new Xu(e,t,r,n,i,o,s,a);if(this.curves.length>0){const e=c.getPoint(0);e.equals(this.currentPoint)||this.lineTo(e.x,e.y)}this.curves.push(c);const l=c.getPoint(1);return this.currentPoint.copy(l),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class dh extends Ao{constructor(e=[new $r(0,-.5),new $r(.5,0),new $r(0,.5)],t=12,r=0,n=2*Math.PI){super(),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:r,phiLength:n},t=Math.floor(t),n=Yr(n,0,2*Math.PI);const i=[],o=[],s=[],a=[],c=[],l=1/t,u=new Pn,h=new $r,p=new Pn,d=new Pn,f=new Pn;let m=0,g=0;for(let t=0;t<=e.length-1;t++)switch(t){case 0:m=e[t+1].x-e[t].x,g=e[t+1].y-e[t].y,p.x=1*g,p.y=-m,p.z=0*g,f.copy(p),p.normalize(),a.push(p.x,p.y,p.z);break;case e.length-1:a.push(f.x,f.y,f.z);break;default:m=e[t+1].x-e[t].x,g=e[t+1].y-e[t].y,p.x=1*g,p.y=-m,p.z=0*g,d.copy(p),p.x+=f.x,p.y+=f.y,p.z+=f.z,p.normalize(),a.push(p.x,p.y,p.z),f.copy(d)}for(let i=0;i<=t;i++){const p=r+i*l*n,d=Math.sin(p),f=Math.cos(p);for(let r=0;r<=e.length-1;r++){u.x=e[r].x*d,u.y=e[r].y,u.z=e[r].x*f,o.push(u.x,u.y,u.z),h.x=i/t,h.y=r/(e.length-1),s.push(h.x,h.y);const n=a[3*r+0]*d,l=a[3*r+1],p=a[3*r+0]*f;c.push(n,l,p)}}for(let r=0;r<t;r++)for(let t=0;t<e.length-1;t++){const n=t+r*e.length,o=n,s=n+e.length,a=n+e.length+1,c=n+1;i.push(o,s,c),i.push(a,c,s)}this.setIndex(i),this.setAttribute("position",new _o(o,3)),this.setAttribute("uv",new _o(s,2)),this.setAttribute("normal",new _o(c,3))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new dh(e.points,e.segments,e.phiStart,e.phiLength)}}class fh extends dh{constructor(e=1,t=1,r=4,n=8){const i=new ph;i.absarc(0,-t/2,e,1.5*Math.PI,0),i.absarc(0,t/2,e,0,.5*Math.PI),super(i.getPoints(r),n),this.type="CapsuleGeometry",this.parameters={radius:e,length:t,capSegments:r,radialSegments:n}}static fromJSON(e){return new fh(e.radius,e.length,e.capSegments,e.radialSegments)}}class mh extends Ao{constructor(e=1,t=32,r=0,n=2*Math.PI){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:r,thetaLength:n},t=Math.max(3,t);const i=[],o=[],s=[],a=[],c=new Pn,l=new $r;o.push(0,0,0),s.push(0,0,1),a.push(.5,.5);for(let i=0,u=3;i<=t;i++,u+=3){const h=r+i/t*n;c.x=e*Math.cos(h),c.y=e*Math.sin(h),o.push(c.x,c.y,c.z),s.push(0,0,1),l.x=(o[u]/e+1)/2,l.y=(o[u+1]/e+1)/2,a.push(l.x,l.y)}for(let e=1;e<=t;e++)i.push(e,e+1,0);this.setIndex(i),this.setAttribute("position",new _o(o,3)),this.setAttribute("normal",new _o(s,3)),this.setAttribute("uv",new _o(a,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new mh(e.radius,e.segments,e.thetaStart,e.thetaLength)}}class gh extends Ao{constructor(e=1,t=1,r=1,n=32,i=1,o=!1,s=0,a=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:r,radialSegments:n,heightSegments:i,openEnded:o,thetaStart:s,thetaLength:a};const c=this;n=Math.floor(n),i=Math.floor(i);const l=[],u=[],h=[],p=[];let d=0;const f=[],m=r/2;let g=0;function y(r){const i=d,o=new $r,f=new Pn;let y=0;const v=!0===r?e:t,_=!0===r?1:-1;for(let e=1;e<=n;e++)u.push(0,m*_,0),h.push(0,_,0),p.push(.5,.5),d++;const b=d;for(let e=0;e<=n;e++){const t=e/n*a+s,r=Math.cos(t),i=Math.sin(t);f.x=v*i,f.y=m*_,f.z=v*r,u.push(f.x,f.y,f.z),h.push(0,_,0),o.x=.5*r+.5,o.y=.5*i*_+.5,p.push(o.x,o.y),d++}for(let e=0;e<n;e++){const t=i+e,n=b+e;!0===r?l.push(n,n+1,t):l.push(n+1,n,t),y+=3}c.addGroup(g,y,!0===r?1:2),g+=y}!function(){const o=new Pn,y=new Pn;let v=0;const _=(t-e)/r;for(let c=0;c<=i;c++){const l=[],g=c/i,v=g*(t-e)+e;for(let e=0;e<=n;e++){const t=e/n,i=t*a+s,c=Math.sin(i),f=Math.cos(i);y.x=v*c,y.y=-g*r+m,y.z=v*f,u.push(y.x,y.y,y.z),o.set(c,_,f).normalize(),h.push(o.x,o.y,o.z),p.push(t,1-g),l.push(d++)}f.push(l)}for(let e=0;e<n;e++)for(let t=0;t<i;t++){const r=f[t][e],n=f[t+1][e],i=f[t+1][e+1],o=f[t][e+1];l.push(r,n,o),l.push(n,i,o),v+=6}c.addGroup(g,v,0),g+=v}(),!1===o&&(e>0&&y(!0),t>0&&y(!1)),this.setIndex(l),this.setAttribute("position",new _o(u,3)),this.setAttribute("normal",new _o(h,3)),this.setAttribute("uv",new _o(p,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new gh(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class yh extends gh{constructor(e=1,t=1,r=32,n=1,i=!1,o=0,s=2*Math.PI){super(0,e,t,r,n,i,o,s),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:r,heightSegments:n,openEnded:i,thetaStart:o,thetaLength:s}}static fromJSON(e){return new yh(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class vh extends Ao{constructor(e=[],t=[],r=1,n=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:r,detail:n};const i=[],o=[];function s(e,t,r,n){const i=n+1,o=[];for(let n=0;n<=i;n++){o[n]=[];const s=e.clone().lerp(r,n/i),a=t.clone().lerp(r,n/i),c=i-n;for(let e=0;e<=c;e++)o[n][e]=0===e&&n===i?s:s.clone().lerp(a,e/c)}for(let e=0;e<i;e++)for(let t=0;t<2*(i-e)-1;t++){const r=Math.floor(t/2);t%2==0?(a(o[e][r+1]),a(o[e+1][r]),a(o[e][r])):(a(o[e][r+1]),a(o[e+1][r+1]),a(o[e+1][r]))}}function a(e){i.push(e.x,e.y,e.z)}function c(t,r){const n=3*t;r.x=e[n+0],r.y=e[n+1],r.z=e[n+2]}function l(e,t,r,n){n<0&&1===e.x&&(o[t]=e.x-1),0===r.x&&0===r.z&&(o[t]=n/2/Math.PI+.5)}function u(e){return Math.atan2(e.z,-e.x)}!function(e){const r=new Pn,n=new Pn,i=new Pn;for(let o=0;o<t.length;o+=3)c(t[o+0],r),c(t[o+1],n),c(t[o+2],i),s(r,n,i,e)}(n),function(e){const t=new Pn;for(let r=0;r<i.length;r+=3)t.x=i[r+0],t.y=i[r+1],t.z=i[r+2],t.normalize().multiplyScalar(e),i[r+0]=t.x,i[r+1]=t.y,i[r+2]=t.z}(r),function(){const e=new Pn;for(let r=0;r<i.length;r+=3){e.x=i[r+0],e.y=i[r+1],e.z=i[r+2];const n=u(e)/2/Math.PI+.5,s=(t=e,Math.atan2(-t.y,Math.sqrt(t.x*t.x+t.z*t.z))/Math.PI+.5);o.push(n,1-s)}var t;(function(){const e=new Pn,t=new Pn,r=new Pn,n=new Pn,s=new $r,a=new $r,c=new $r;for(let h=0,p=0;h<i.length;h+=9,p+=6){e.set(i[h+0],i[h+1],i[h+2]),t.set(i[h+3],i[h+4],i[h+5]),r.set(i[h+6],i[h+7],i[h+8]),s.set(o[p+0],o[p+1]),a.set(o[p+2],o[p+3]),c.set(o[p+4],o[p+5]),n.copy(e).add(t).add(r).divideScalar(3);const d=u(n);l(s,p+0,e,d),l(a,p+2,t,d),l(c,p+4,r,d)}})(),function(){for(let e=0;e<o.length;e+=6){const t=o[e+0],r=o[e+2],n=o[e+4],i=Math.max(t,r,n),s=Math.min(t,r,n);i>.9&&s<.1&&(t<.2&&(o[e+0]+=1),r<.2&&(o[e+2]+=1),n<.2&&(o[e+4]+=1))}}()}(),this.setAttribute("position",new _o(i,3)),this.setAttribute("normal",new _o(i.slice(),3)),this.setAttribute("uv",new _o(o,2)),0===n?this.computeVertexNormals():this.normalizeNormals()}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new vh(e.vertices,e.indices,e.radius,e.details)}}class _h extends vh{constructor(e=1,t=0){const r=(1+Math.sqrt(5))/2,n=1/r;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-n,-r,0,-n,r,0,n,-r,0,n,r,-n,-r,0,-n,r,0,n,-r,0,n,r,0,-r,0,-n,r,0,-n,-r,0,n,r,0,n],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new _h(e.radius,e.detail)}}const bh=new Pn,xh=new Pn,wh=new Pn,Sh=new Xi;class Mh extends Ao{constructor(e=null,t=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:e,thresholdAngle:t},null!==e){const r=4,n=Math.pow(10,r),i=Math.cos(Hr*t),o=e.getIndex(),s=e.getAttribute("position"),a=o?o.count:s.count,c=[0,0,0],l=["a","b","c"],u=new Array(3),h={},p=[];for(let e=0;e<a;e+=3){o?(c[0]=o.getX(e),c[1]=o.getX(e+1),c[2]=o.getX(e+2)):(c[0]=e,c[1]=e+1,c[2]=e+2);const{a:t,b:r,c:a}=Sh;if(t.fromBufferAttribute(s,c[0]),r.fromBufferAttribute(s,c[1]),a.fromBufferAttribute(s,c[2]),Sh.getNormal(wh),u[0]=`${Math.round(t.x*n)},${Math.round(t.y*n)},${Math.round(t.z*n)}`,u[1]=`${Math.round(r.x*n)},${Math.round(r.y*n)},${Math.round(r.z*n)}`,u[2]=`${Math.round(a.x*n)},${Math.round(a.y*n)},${Math.round(a.z*n)}`,u[0]!==u[1]&&u[1]!==u[2]&&u[2]!==u[0])for(let e=0;e<3;e++){const t=(e+1)%3,r=u[e],n=u[t],o=Sh[l[e]],s=Sh[l[t]],a=`${r}_${n}`,d=`${n}_${r}`;d in h&&h[d]?(wh.dot(h[d].normal)<=i&&(p.push(o.x,o.y,o.z),p.push(s.x,s.y,s.z)),h[d]=null):a in h||(h[a]={index0:c[e],index1:c[t],normal:wh.clone()})}}for(const e in h)if(h[e]){const{index0:t,index1:r}=h[e];bh.fromBufferAttribute(s,t),xh.fromBufferAttribute(s,r),p.push(bh.x,bh.y,bh.z),p.push(xh.x,xh.y,xh.z)}this.setAttribute("position",new _o(p,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}class Th extends ph{constructor(e){super(e),this.uuid=Xr(),this.type="Shape",this.holes=[]}getPointsHoles(e){const t=[];for(let r=0,n=this.holes.length;r<n;r++)t[r]=this.holes[r].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,r=e.holes.length;t<r;t++){const r=e.holes[t];this.holes.push(r.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,r=this.holes.length;t<r;t++){const r=this.holes[t];e.holes.push(r.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,r=e.holes.length;t<r;t++){const r=e.holes[t];this.holes.push((new ph).fromJSON(r))}return this}}const Eh=function(e,t,r=2){const n=t&&t.length,i=n?t[0]*r:e.length;let o=Ah(e,0,i,r,!0);const s=[];if(!o||o.next===o.prev)return s;let a,c,l,u,h,p,d;if(n&&(o=function(e,t,r,n){const i=[];let o,s,a,c,l;for(o=0,s=t.length;o<s;o++)a=t[o]*n,c=o<s-1?t[o+1]*n:e.length,l=Ah(e,a,c,n,!1),l===l.next&&(l.steiner=!0),i.push(Bh(l));for(i.sort(Lh),o=0;o<i.length;o++)r=Uh(i[o],r);return r}(e,t,o,r)),e.length>80*r){a=l=e[0],c=u=e[1];for(let t=r;t<i;t+=r)h=e[t],p=e[t+1],h<a&&(a=h),p<c&&(c=p),h>l&&(l=h),p>u&&(u=p);d=Math.max(l-a,u-c),d=0!==d?32767/d:0}return Ch(o,s,r,a,c,d,0),s};function Ah(e,t,r,n,i){let o,s;if(i===function(e,t,r,n){let i=0;for(let o=t,s=r-n;o<r;o+=n)i+=(e[s]-e[o])*(e[o+1]+e[s+1]),s=o;return i}(e,t,r,n)>0)for(o=t;o<r;o+=n)s=qh(o,e[o],e[o+1],s);else for(o=r-n;o>=t;o-=n)s=qh(o,e[o],e[o+1],s);return s&&zh(s,s.next)&&(Jh(s),s=s.next),s}function Rh(e,t){if(!e)return e;t||(t=e);let r,n=e;do{if(r=!1,n.steiner||!zh(n,n.next)&&0!==Gh(n.prev,n,n.next))n=n.next;else{if(Jh(n),n=t=n.prev,n===n.next)break;r=!0}}while(r||n!==t);return t}function Ch(e,t,r,n,i,o,s){if(!e)return;!s&&o&&function(e,t,r,n){let i=e;do{0===i.z&&(i.z=Fh(i.x,i.y,t,r,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,function(e){let t,r,n,i,o,s,a,c,l=1;do{for(r=e,e=null,o=null,s=0;r;){for(s++,n=r,a=0,t=0;t<l&&(a++,n=n.nextZ,n);t++);for(c=l;a>0||c>0&&n;)0!==a&&(0===c||!n||r.z<=n.z)?(i=r,r=r.nextZ,a--):(i=n,n=n.nextZ,c--),o?o.nextZ=i:e=i,i.prevZ=o,o=i;r=n}o.nextZ=null,l*=2}while(s>1)}(i)}(e,n,i,o);let a,c,l=e;for(;e.prev!==e.next;)if(a=e.prev,c=e.next,o?Oh(e,n,i,o):Ih(e))t.push(a.i/r|0),t.push(e.i/r|0),t.push(c.i/r|0),Jh(e),e=c.next,l=c.next;else if((e=c)===l){s?1===s?Ch(e=Ph(Rh(e),t,r),t,r,n,i,o,2):2===s&&Nh(e,t,r,n,i,o):Ch(Rh(e),t,r,n,i,o,1);break}}function Ih(e){const t=e.prev,r=e,n=e.next;if(Gh(t,r,n)>=0)return!1;const i=t.x,o=r.x,s=n.x,a=t.y,c=r.y,l=n.y,u=i<o?i<s?i:s:o<s?o:s,h=a<c?a<l?a:l:c<l?c:l,p=i>o?i>s?i:s:o>s?o:s,d=a>c?a>l?a:l:c>l?c:l;let f=n.next;for(;f!==t;){if(f.x>=u&&f.x<=p&&f.y>=h&&f.y<=d&&kh(i,a,o,c,s,l,f.x,f.y)&&Gh(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function Oh(e,t,r,n){const i=e.prev,o=e,s=e.next;if(Gh(i,o,s)>=0)return!1;const a=i.x,c=o.x,l=s.x,u=i.y,h=o.y,p=s.y,d=a<c?a<l?a:l:c<l?c:l,f=u<h?u<p?u:p:h<p?h:p,m=a>c?a>l?a:l:c>l?c:l,g=u>h?u>p?u:p:h>p?h:p,y=Fh(d,f,t,r,n),v=Fh(m,g,t,r,n);let _=e.prevZ,b=e.nextZ;for(;_&&_.z>=y&&b&&b.z<=v;){if(_.x>=d&&_.x<=m&&_.y>=f&&_.y<=g&&_!==i&&_!==s&&kh(a,u,c,h,l,p,_.x,_.y)&&Gh(_.prev,_,_.next)>=0)return!1;if(_=_.prevZ,b.x>=d&&b.x<=m&&b.y>=f&&b.y<=g&&b!==i&&b!==s&&kh(a,u,c,h,l,p,b.x,b.y)&&Gh(b.prev,b,b.next)>=0)return!1;b=b.nextZ}for(;_&&_.z>=y;){if(_.x>=d&&_.x<=m&&_.y>=f&&_.y<=g&&_!==i&&_!==s&&kh(a,u,c,h,l,p,_.x,_.y)&&Gh(_.prev,_,_.next)>=0)return!1;_=_.prevZ}for(;b&&b.z<=v;){if(b.x>=d&&b.x<=m&&b.y>=f&&b.y<=g&&b!==i&&b!==s&&kh(a,u,c,h,l,p,b.x,b.y)&&Gh(b.prev,b,b.next)>=0)return!1;b=b.nextZ}return!0}function Ph(e,t,r){let n=e;do{const i=n.prev,o=n.next.next;!zh(i,o)&&Vh(i,n,n.next,o)&&Xh(i,o)&&Xh(o,i)&&(t.push(i.i/r|0),t.push(n.i/r|0),t.push(o.i/r|0),Jh(n),Jh(n.next),n=e=o),n=n.next}while(n!==e);return Rh(n)}function Nh(e,t,r,n,i,o){let s=e;do{let e=s.next.next;for(;e!==s.prev;){if(s.i!==e.i&&jh(s,e)){let a=Yh(s,e);return s=Rh(s,s.next),a=Rh(a,a.next),Ch(s,t,r,n,i,o,0),void Ch(a,t,r,n,i,o,0)}e=e.next}s=s.next}while(s!==e)}function Lh(e,t){return e.x-t.x}function Uh(e,t){const r=function(e,t){let r,n=t,i=-1/0;const o=e.x,s=e.y;do{if(s<=n.y&&s>=n.next.y&&n.next.y!==n.y){const e=n.x+(s-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(e<=o&&e>i&&(i=e,r=n.x<n.next.x?n:n.next,e===o))return r}n=n.next}while(n!==t);if(!r)return null;const a=r,c=r.x,l=r.y;let u,h=1/0;n=r;do{o>=n.x&&n.x>=c&&o!==n.x&&kh(s<l?o:i,s,c,l,s<l?i:o,s,n.x,n.y)&&(u=Math.abs(s-n.y)/(o-n.x),Xh(n,e)&&(u<h||u===h&&(n.x>r.x||n.x===r.x&&Dh(r,n)))&&(r=n,h=u)),n=n.next}while(n!==a);return r}(e,t);if(!r)return t;const n=Yh(r,e);return Rh(n,n.next),Rh(r,r.next)}function Dh(e,t){return Gh(e.prev,e,t.prev)<0&&Gh(t.next,e,e.next)<0}function Fh(e,t,r,n,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-r)*i|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-n)*i|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Bh(e){let t=e,r=e;do{(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next}while(t!==e);return r}function kh(e,t,r,n,i,o,s,a){return(i-s)*(t-a)>=(e-s)*(o-a)&&(e-s)*(n-a)>=(r-s)*(t-a)&&(r-s)*(o-a)>=(i-s)*(n-a)}function jh(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){let r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&Vh(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}(e,t)&&(Xh(e,t)&&Xh(t,e)&&function(e,t){let r=e,n=!1;const i=(e.x+t.x)/2,o=(e.y+t.y)/2;do{r.y>o!=r.next.y>o&&r.next.y!==r.y&&i<(r.next.x-r.x)*(o-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next}while(r!==e);return n}(e,t)&&(Gh(e.prev,e,t.prev)||Gh(e,t.prev,t))||zh(e,t)&&Gh(e.prev,e,e.next)>0&&Gh(t.prev,t,t.next)>0)}function Gh(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function zh(e,t){return e.x===t.x&&e.y===t.y}function Vh(e,t,r,n){const i=Wh(Gh(e,t,r)),o=Wh(Gh(e,t,n)),s=Wh(Gh(r,n,e)),a=Wh(Gh(r,n,t));return i!==o&&s!==a||(!(0!==i||!Hh(e,r,t))||(!(0!==o||!Hh(e,n,t))||(!(0!==s||!Hh(r,e,n))||!(0!==a||!Hh(r,t,n)))))}function Hh(e,t,r){return t.x<=Math.max(e.x,r.x)&&t.x>=Math.min(e.x,r.x)&&t.y<=Math.max(e.y,r.y)&&t.y>=Math.min(e.y,r.y)}function Wh(e){return e>0?1:e<0?-1:0}function Xh(e,t){return Gh(e.prev,e,e.next)<0?Gh(e,t,e.next)>=0&&Gh(e,e.prev,t)>=0:Gh(e,t,e.prev)<0||Gh(e,e.next,t)<0}function Yh(e,t){const r=new Kh(e.i,e.x,e.y),n=new Kh(t.i,t.x,t.y),i=e.next,o=t.prev;return e.next=t,t.prev=e,r.next=i,i.prev=r,n.next=r,r.prev=n,o.next=n,n.prev=o,n}function qh(e,t,r,n){const i=new Kh(e,t,r);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function Jh(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Kh(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}class Zh{static area(e){const t=e.length;let r=0;for(let n=t-1,i=0;i<t;n=i++)r+=e[n].x*e[i].y-e[i].x*e[n].y;return.5*r}static isClockWise(e){return Zh.area(e)<0}static triangulateShape(e,t){const r=[],n=[],i=[];Qh(e),$h(r,e);let o=e.length;t.forEach(Qh);for(let e=0;e<t.length;e++)n.push(o),o+=t[e].length,$h(r,t[e]);const s=Eh(r,n);for(let e=0;e<s.length;e+=3)i.push(s.slice(e,e+3));return i}}function Qh(e){const t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function $h(e,t){for(let r=0;r<t.length;r++)e.push(t[r].x),e.push(t[r].y)}class ep extends Ao{constructor(e=new Th([new $r(.5,.5),new $r(-.5,.5),new $r(-.5,-.5),new $r(.5,-.5)]),t={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const r=this,n=[],i=[];for(let t=0,r=e.length;t<r;t++){o(e[t])}function o(e){const o=[],s=void 0!==t.curveSegments?t.curveSegments:12,a=void 0!==t.steps?t.steps:1,c=void 0!==t.depth?t.depth:1;let l=void 0===t.bevelEnabled||t.bevelEnabled,u=void 0!==t.bevelThickness?t.bevelThickness:.2,h=void 0!==t.bevelSize?t.bevelSize:u-.1,p=void 0!==t.bevelOffset?t.bevelOffset:0,d=void 0!==t.bevelSegments?t.bevelSegments:3;const f=t.extrudePath,m=void 0!==t.UVGenerator?t.UVGenerator:tp;let g,y,v,_,b,x=!1;f&&(g=f.getSpacedPoints(a),x=!0,l=!1,y=f.computeFrenetFrames(a,!1),v=new Pn,_=new Pn,b=new Pn),l||(d=0,u=0,h=0,p=0);const w=e.extractPoints(s);let S=w.shape;const M=w.holes;if(!Zh.isClockWise(S)){S=S.reverse();for(let e=0,t=M.length;e<t;e++){const t=M[e];Zh.isClockWise(t)&&(M[e]=t.reverse())}}const T=Zh.triangulateShape(S,M),E=S;for(let e=0,t=M.length;e<t;e++){const t=M[e];S=S.concat(t)}function A(e,t,r){return t||console.error("THREE.ExtrudeGeometry: vec does not exist"),e.clone().addScaledVector(t,r)}const R=S.length,C=T.length;function I(e,t,r){let n,i,o;const s=e.x-t.x,a=e.y-t.y,c=r.x-e.x,l=r.y-e.y,u=s*s+a*a,h=s*l-a*c;if(Math.abs(h)>Number.EPSILON){const h=Math.sqrt(u),p=Math.sqrt(c*c+l*l),d=t.x-a/h,f=t.y+s/h,m=((r.x-l/p-d)*l-(r.y+c/p-f)*c)/(s*l-a*c);n=d+s*m-e.x,i=f+a*m-e.y;const g=n*n+i*i;if(g<=2)return new $r(n,i);o=Math.sqrt(g/2)}else{let e=!1;s>Number.EPSILON?c>Number.EPSILON&&(e=!0):s<-Number.EPSILON?c<-Number.EPSILON&&(e=!0):Math.sign(a)===Math.sign(l)&&(e=!0),e?(n=-a,i=s,o=Math.sqrt(u)):(n=s,i=a,o=Math.sqrt(u/2))}return new $r(n/o,i/o)}const O=[];for(let e=0,t=E.length,r=t-1,n=e+1;e<t;e++,r++,n++)r===t&&(r=0),n===t&&(n=0),O[e]=I(E[e],E[r],E[n]);const P=[];let N,L=O.concat();for(let e=0,t=M.length;e<t;e++){const t=M[e];N=[];for(let e=0,r=t.length,n=r-1,i=e+1;e<r;e++,n++,i++)n===r&&(n=0),i===r&&(i=0),N[e]=I(t[e],t[n],t[i]);P.push(N),L=L.concat(N)}for(let e=0;e<d;e++){const t=e/d,r=u*Math.cos(t*Math.PI/2),n=h*Math.sin(t*Math.PI/2)+p;for(let e=0,t=E.length;e<t;e++){const t=A(E[e],O[e],n);F(t.x,t.y,-r)}for(let e=0,t=M.length;e<t;e++){const t=M[e];N=P[e];for(let e=0,i=t.length;e<i;e++){const i=A(t[e],N[e],n);F(i.x,i.y,-r)}}}const U=h+p;for(let e=0;e<R;e++){const t=l?A(S[e],L[e],U):S[e];x?(_.copy(y.normals[0]).multiplyScalar(t.x),v.copy(y.binormals[0]).multiplyScalar(t.y),b.copy(g[0]).add(_).add(v),F(b.x,b.y,b.z)):F(t.x,t.y,0)}for(let e=1;e<=a;e++)for(let t=0;t<R;t++){const r=l?A(S[t],L[t],U):S[t];x?(_.copy(y.normals[e]).multiplyScalar(r.x),v.copy(y.binormals[e]).multiplyScalar(r.y),b.copy(g[e]).add(_).add(v),F(b.x,b.y,b.z)):F(r.x,r.y,c/a*e)}for(let e=d-1;e>=0;e--){const t=e/d,r=u*Math.cos(t*Math.PI/2),n=h*Math.sin(t*Math.PI/2)+p;for(let e=0,t=E.length;e<t;e++){const t=A(E[e],O[e],n);F(t.x,t.y,c+r)}for(let e=0,t=M.length;e<t;e++){const t=M[e];N=P[e];for(let e=0,i=t.length;e<i;e++){const i=A(t[e],N[e],n);x?F(i.x,i.y+g[a-1].y,g[a-1].x+r):F(i.x,i.y,c+r)}}}function D(e,t){let r=e.length;for(;--r>=0;){const n=r;let i=r-1;i<0&&(i=e.length-1);for(let e=0,r=a+2*d;e<r;e++){const r=R*e,o=R*(e+1);k(t+n+r,t+i+r,t+i+o,t+n+o)}}}function F(e,t,r){o.push(e),o.push(t),o.push(r)}function B(e,t,i){j(e),j(t),j(i);const o=n.length/3,s=m.generateTopUV(r,n,o-3,o-2,o-1);G(s[0]),G(s[1]),G(s[2])}function k(e,t,i,o){j(e),j(t),j(o),j(t),j(i),j(o);const s=n.length/3,a=m.generateSideWallUV(r,n,s-6,s-3,s-2,s-1);G(a[0]),G(a[1]),G(a[3]),G(a[1]),G(a[2]),G(a[3])}function j(e){n.push(o[3*e+0]),n.push(o[3*e+1]),n.push(o[3*e+2])}function G(e){i.push(e.x),i.push(e.y)}!function(){const e=n.length/3;if(l){let e=0,t=R*e;for(let e=0;e<C;e++){const r=T[e];B(r[2]+t,r[1]+t,r[0]+t)}e=a+2*d,t=R*e;for(let e=0;e<C;e++){const r=T[e];B(r[0]+t,r[1]+t,r[2]+t)}}else{for(let e=0;e<C;e++){const t=T[e];B(t[2],t[1],t[0])}for(let e=0;e<C;e++){const t=T[e];B(t[0]+R*a,t[1]+R*a,t[2]+R*a)}}r.addGroup(e,n.length/3-e,0)}(),function(){const e=n.length/3;let t=0;D(E,t),t+=E.length;for(let e=0,r=M.length;e<r;e++){const r=M[e];D(r,t),t+=r.length}r.addGroup(e,n.length/3-e,1)}()}this.setAttribute("position",new _o(n,3)),this.setAttribute("uv",new _o(i,2)),this.computeVertexNormals()}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return function(e,t,r){if(r.shapes=[],Array.isArray(e))for(let t=0,n=e.length;t<n;t++){const n=e[t];r.shapes.push(n.uuid)}else r.shapes.push(e.uuid);r.options=Object.assign({},t),void 0!==t.extrudePath&&(r.options.extrudePath=t.extrudePath.toJSON());return r}(this.parameters.shapes,this.parameters.options,e)}static fromJSON(e,t){const r=[];for(let n=0,i=e.shapes.length;n<i;n++){const i=t[e.shapes[n]];r.push(i)}const n=e.options.extrudePath;return void 0!==n&&(e.options.extrudePath=(new uh[n.type]).fromJSON(n)),new ep(r,e.options)}}const tp={generateTopUV:function(e,t,r,n,i){const o=t[3*r],s=t[3*r+1],a=t[3*n],c=t[3*n+1],l=t[3*i],u=t[3*i+1];return[new $r(o,s),new $r(a,c),new $r(l,u)]},generateSideWallUV:function(e,t,r,n,i,o){const s=t[3*r],a=t[3*r+1],c=t[3*r+2],l=t[3*n],u=t[3*n+1],h=t[3*n+2],p=t[3*i],d=t[3*i+1],f=t[3*i+2],m=t[3*o],g=t[3*o+1],y=t[3*o+2];return Math.abs(a-u)<Math.abs(s-l)?[new $r(s,1-c),new $r(l,1-h),new $r(p,1-f),new $r(m,1-y)]:[new $r(a,1-c),new $r(u,1-h),new $r(d,1-f),new $r(g,1-y)]}};class rp extends vh{constructor(e=1,t=0){const r=(1+Math.sqrt(5))/2;super([-1,r,0,1,r,0,-1,-r,0,1,-r,0,0,-1,r,0,1,r,0,-1,-r,0,1,-r,r,0,-1,r,0,1,-r,0,-1,-r,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new rp(e.radius,e.detail)}}class np extends vh{constructor(e=1,t=0){super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new np(e.radius,e.detail)}}class ip extends Ao{constructor(e=.5,t=1,r=32,n=1,i=0,o=2*Math.PI){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:r,phiSegments:n,thetaStart:i,thetaLength:o},r=Math.max(3,r);const s=[],a=[],c=[],l=[];let u=e;const h=(t-e)/(n=Math.max(1,n)),p=new Pn,d=new $r;for(let e=0;e<=n;e++){for(let e=0;e<=r;e++){const n=i+e/r*o;p.x=u*Math.cos(n),p.y=u*Math.sin(n),a.push(p.x,p.y,p.z),c.push(0,0,1),d.x=(p.x/t+1)/2,d.y=(p.y/t+1)/2,l.push(d.x,d.y)}u+=h}for(let e=0;e<n;e++){const t=e*(r+1);for(let e=0;e<r;e++){const n=e+t,i=n,o=n+r+1,a=n+r+2,c=n+1;s.push(i,o,c),s.push(o,a,c)}}this.setIndex(s),this.setAttribute("position",new _o(a,3)),this.setAttribute("normal",new _o(c,3)),this.setAttribute("uv",new _o(l,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new ip(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}class op extends Ao{constructor(e=new Th([new $r(0,.5),new $r(-.5,-.5),new $r(.5,-.5)]),t=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};const r=[],n=[],i=[],o=[];let s=0,a=0;if(!1===Array.isArray(e))c(e);else for(let t=0;t<e.length;t++)c(e[t]),this.addGroup(s,a,t),s+=a,a=0;function c(e){const s=n.length/3,c=e.extractPoints(t);let l=c.shape;const u=c.holes;!1===Zh.isClockWise(l)&&(l=l.reverse());for(let e=0,t=u.length;e<t;e++){const t=u[e];!0===Zh.isClockWise(t)&&(u[e]=t.reverse())}const h=Zh.triangulateShape(l,u);for(let e=0,t=u.length;e<t;e++){const t=u[e];l=l.concat(t)}for(let e=0,t=l.length;e<t;e++){const t=l[e];n.push(t.x,t.y,0),i.push(0,0,1),o.push(t.x,t.y)}for(let e=0,t=h.length;e<t;e++){const t=h[e],n=t[0]+s,i=t[1]+s,o=t[2]+s;r.push(n,i,o),a+=3}}this.setIndex(r),this.setAttribute("position",new _o(n,3)),this.setAttribute("normal",new _o(i,3)),this.setAttribute("uv",new _o(o,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return function(e,t){if(t.shapes=[],Array.isArray(e))for(let r=0,n=e.length;r<n;r++){const n=e[r];t.shapes.push(n.uuid)}else t.shapes.push(e.uuid);return t}(this.parameters.shapes,e)}static fromJSON(e,t){const r=[];for(let n=0,i=e.shapes.length;n<i;n++){const i=t[e.shapes[n]];r.push(i)}return new op(r,e.curveSegments)}}class sp extends Ao{constructor(e=1,t=32,r=16,n=0,i=2*Math.PI,o=0,s=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:r,phiStart:n,phiLength:i,thetaStart:o,thetaLength:s},t=Math.max(3,Math.floor(t)),r=Math.max(2,Math.floor(r));const a=Math.min(o+s,Math.PI);let c=0;const l=[],u=new Pn,h=new Pn,p=[],d=[],f=[],m=[];for(let p=0;p<=r;p++){const g=[],y=p/r;let v=0;0===p&&0===o?v=.5/t:p===r&&a===Math.PI&&(v=-.5/t);for(let r=0;r<=t;r++){const a=r/t;u.x=-e*Math.cos(n+a*i)*Math.sin(o+y*s),u.y=e*Math.cos(o+y*s),u.z=e*Math.sin(n+a*i)*Math.sin(o+y*s),d.push(u.x,u.y,u.z),h.copy(u).normalize(),f.push(h.x,h.y,h.z),m.push(a+v,1-y),g.push(c++)}l.push(g)}for(let e=0;e<r;e++)for(let n=0;n<t;n++){const t=l[e][n+1],i=l[e][n],s=l[e+1][n],c=l[e+1][n+1];(0!==e||o>0)&&p.push(t,i,c),(e!==r-1||a<Math.PI)&&p.push(i,s,c)}this.setIndex(p),this.setAttribute("position",new _o(d,3)),this.setAttribute("normal",new _o(f,3)),this.setAttribute("uv",new _o(m,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new sp(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class ap extends vh{constructor(e=1,t=0){super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new ap(e.radius,e.detail)}}class cp extends Ao{constructor(e=1,t=.4,r=12,n=48,i=2*Math.PI){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:r,tubularSegments:n,arc:i},r=Math.floor(r),n=Math.floor(n);const o=[],s=[],a=[],c=[],l=new Pn,u=new Pn,h=new Pn;for(let o=0;o<=r;o++)for(let p=0;p<=n;p++){const d=p/n*i,f=o/r*Math.PI*2;u.x=(e+t*Math.cos(f))*Math.cos(d),u.y=(e+t*Math.cos(f))*Math.sin(d),u.z=t*Math.sin(f),s.push(u.x,u.y,u.z),l.x=e*Math.cos(d),l.y=e*Math.sin(d),h.subVectors(u,l).normalize(),a.push(h.x,h.y,h.z),c.push(p/n),c.push(o/r)}for(let e=1;e<=r;e++)for(let t=1;t<=n;t++){const r=(n+1)*e+t-1,i=(n+1)*(e-1)+t-1,s=(n+1)*(e-1)+t,a=(n+1)*e+t;o.push(r,i,a),o.push(i,s,a)}this.setIndex(o),this.setAttribute("position",new _o(s,3)),this.setAttribute("normal",new _o(a,3)),this.setAttribute("uv",new _o(c,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new cp(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class lp extends Ao{constructor(e=1,t=.4,r=64,n=8,i=2,o=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:r,radialSegments:n,p:i,q:o},r=Math.floor(r),n=Math.floor(n);const s=[],a=[],c=[],l=[],u=new Pn,h=new Pn,p=new Pn,d=new Pn,f=new Pn,m=new Pn,g=new Pn;for(let s=0;s<=r;++s){const v=s/r*i*Math.PI*2;y(v,i,o,e,p),y(v+.01,i,o,e,d),m.subVectors(d,p),g.addVectors(d,p),f.crossVectors(m,g),g.crossVectors(f,m),f.normalize(),g.normalize();for(let e=0;e<=n;++e){const i=e/n*Math.PI*2,o=-t*Math.cos(i),d=t*Math.sin(i);u.x=p.x+(o*g.x+d*f.x),u.y=p.y+(o*g.y+d*f.y),u.z=p.z+(o*g.z+d*f.z),a.push(u.x,u.y,u.z),h.subVectors(u,p).normalize(),c.push(h.x,h.y,h.z),l.push(s/r),l.push(e/n)}}for(let e=1;e<=r;e++)for(let t=1;t<=n;t++){const r=(n+1)*(e-1)+(t-1),i=(n+1)*e+(t-1),o=(n+1)*e+t,a=(n+1)*(e-1)+t;s.push(r,i,a),s.push(i,o,a)}function y(e,t,r,n,i){const o=Math.cos(e),s=Math.sin(e),a=r/t*e,c=Math.cos(a);i.x=n*(2+c)*.5*o,i.y=n*(2+c)*s*.5,i.z=n*Math.sin(a)*.5}this.setIndex(s),this.setAttribute("position",new _o(a,3)),this.setAttribute("normal",new _o(c,3)),this.setAttribute("uv",new _o(l,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new lp(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}class up extends Ao{constructor(e=new ch(new Pn(-1,-1,0),new Pn(-1,1,0),new Pn(1,1,0)),t=64,r=1,n=8,i=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:r,radialSegments:n,closed:i};const o=e.computeFrenetFrames(t,i);this.tangents=o.tangents,this.normals=o.normals,this.binormals=o.binormals;const s=new Pn,a=new Pn,c=new $r;let l=new Pn;const u=[],h=[],p=[],d=[];function f(i){l=e.getPointAt(i/t,l);const c=o.normals[i],p=o.binormals[i];for(let e=0;e<=n;e++){const t=e/n*Math.PI*2,i=Math.sin(t),o=-Math.cos(t);a.x=o*c.x+i*p.x,a.y=o*c.y+i*p.y,a.z=o*c.z+i*p.z,a.normalize(),h.push(a.x,a.y,a.z),s.x=l.x+r*a.x,s.y=l.y+r*a.y,s.z=l.z+r*a.z,u.push(s.x,s.y,s.z)}}!function(){for(let e=0;e<t;e++)f(e);f(!1===i?t:0),function(){for(let e=0;e<=t;e++)for(let r=0;r<=n;r++)c.x=e/t,c.y=r/n,p.push(c.x,c.y)}(),function(){for(let e=1;e<=t;e++)for(let t=1;t<=n;t++){const r=(n+1)*(e-1)+(t-1),i=(n+1)*e+(t-1),o=(n+1)*e+t,s=(n+1)*(e-1)+t;d.push(r,i,s),d.push(i,o,s)}}()}(),this.setIndex(d),this.setAttribute("position",new _o(u,3)),this.setAttribute("normal",new _o(h,3)),this.setAttribute("uv",new _o(p,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new up((new uh[e.path.type]).fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class hp extends Ao{constructor(e=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:e},null!==e){const t=[],r=new Set,n=new Pn,i=new Pn;if(null!==e.index){const o=e.attributes.position,s=e.index;let a=e.groups;0===a.length&&(a=[{start:0,count:s.count,materialIndex:0}]);for(let e=0,c=a.length;e<c;++e){const c=a[e],l=c.start;for(let e=l,a=l+c.count;e<a;e+=3)for(let a=0;a<3;a++){const c=s.getX(e+a),l=s.getX(e+(a+1)%3);n.fromBufferAttribute(o,c),i.fromBufferAttribute(o,l),!0===pp(n,i,r)&&(t.push(n.x,n.y,n.z),t.push(i.x,i.y,i.z))}}}else{const o=e.attributes.position;for(let e=0,s=o.count/3;e<s;e++)for(let s=0;s<3;s++){const a=3*e+s,c=3*e+(s+1)%3;n.fromBufferAttribute(o,a),i.fromBufferAttribute(o,c),!0===pp(n,i,r)&&(t.push(n.x,n.y,n.z),t.push(i.x,i.y,i.z))}}this.setAttribute("position",new _o(t,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}function pp(e,t,r){const n=`${e.x},${e.y},${e.z}-${t.x},${t.y},${t.z}`,i=`${t.x},${t.y},${t.z}-${e.x},${e.y},${e.z}`;return!0!==r.has(n)&&!0!==r.has(i)&&(r.add(n),r.add(i),!0)}var dp=Object.freeze({__proto__:null,BoxGeometry:Yo,CapsuleGeometry:fh,CircleGeometry:mh,ConeGeometry:yh,CylinderGeometry:gh,DodecahedronGeometry:_h,EdgesGeometry:Mh,ExtrudeGeometry:ep,IcosahedronGeometry:rp,LatheGeometry:dh,OctahedronGeometry:np,PlaneGeometry:ys,PolyhedronGeometry:vh,RingGeometry:ip,ShapeGeometry:op,SphereGeometry:sp,TetrahedronGeometry:ap,TorusGeometry:cp,TorusKnotGeometry:lp,TubeGeometry:up,WireframeGeometry:hp});class fp extends eo{constructor(e){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new Zi(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}}class mp extends Qo{constructor(e){super(e),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class gp extends eo{constructor(e){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Zi(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Zi(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Yt,this.normalScale=new $r(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new vi,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class yp extends gp{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new $r(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return Yr(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(e){this.ior=(1+.4*e)/(1-.4*e)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new Zi(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new Zi(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new Zi(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!=e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get dispersion(){return this._dispersion}set dispersion(e){this._dispersion>0!=e>0&&this.version++,this._dispersion=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.dispersion=e.dispersion,this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class vp extends eo{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new Zi(16777215),this.specular=new Zi(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Zi(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Yt,this.normalScale=new $r(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new vi,this.combine=Z,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class _p extends eo{constructor(e){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Zi(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Zi(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Yt,this.normalScale=new $r(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}class bp extends eo{constructor(e){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Yt,this.normalScale=new $r(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}class xp extends eo{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new Zi(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Zi(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Yt,this.normalScale=new $r(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new vi,this.combine=Z,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class wp extends eo{constructor(e){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Zi(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Yt,this.normalScale=new $r(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this.fog=e.fog,this}}class Sp extends vu{constructor(e){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}function Mp(e,t,r){return!e||!r&&e.constructor===t?e:"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)}function Tp(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function Ep(e){const t=e.length,r=new Array(t);for(let e=0;e!==t;++e)r[e]=e;return r.sort((function(t,r){return e[t]-e[r]})),r}function Ap(e,t,r){const n=e.length,i=new e.constructor(n);for(let o=0,s=0;s!==n;++o){const n=r[o]*t;for(let r=0;r!==t;++r)i[s++]=e[n+r]}return i}function Rp(e,t,r,n){let i=1,o=e[0];for(;void 0!==o&&void 0===o[n];)o=e[i++];if(void 0===o)return;let s=o[n];if(void 0!==s)if(Array.isArray(s))do{s=o[n],void 0!==s&&(t.push(o.time),r.push.apply(r,s)),o=e[i++]}while(void 0!==o);else if(void 0!==s.toArray)do{s=o[n],void 0!==s&&(t.push(o.time),s.toArray(r,r.length)),o=e[i++]}while(void 0!==o);else do{s=o[n],void 0!==s&&(t.push(o.time),r.push(s)),o=e[i++]}while(void 0!==o)}const Cp={convertArray:Mp,isTypedArray:Tp,getKeyframeOrder:Ep,sortedArray:Ap,flattenJSON:Rp,subclip:function(e,t,r,n,i=30){const o=e.clone();o.name=t;const s=[];for(let e=0;e<o.tracks.length;++e){const t=o.tracks[e],a=t.getValueSize(),c=[],l=[];for(let e=0;e<t.times.length;++e){const o=t.times[e]*i;if(!(o<r||o>=n)){c.push(t.times[e]);for(let r=0;r<a;++r)l.push(t.values[e*a+r])}}0!==c.length&&(t.times=Mp(c,t.times.constructor),t.values=Mp(l,t.values.constructor),s.push(t))}o.tracks=s;let a=1/0;for(let e=0;e<o.tracks.length;++e)a>o.tracks[e].times[0]&&(a=o.tracks[e].times[0]);for(let e=0;e<o.tracks.length;++e)o.tracks[e].shift(-1*a);return o.resetDuration(),o},makeClipAdditive:function(e,t=0,r=e,n=30){n<=0&&(n=30);const i=r.tracks.length,o=t/n;for(let t=0;t<i;++t){const n=r.tracks[t],i=n.ValueTypeName;if("bool"===i||"string"===i)continue;const s=e.tracks.find((function(e){return e.name===n.name&&e.ValueTypeName===i}));if(void 0===s)continue;let a=0;const c=n.getValueSize();n.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(a=c/3);let l=0;const u=s.getValueSize();s.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(l=u/3);const h=n.times.length-1;let p;if(o<=n.times[0]){const e=a,t=c-a;p=n.values.slice(e,t)}else if(o>=n.times[h]){const e=h*c+a,t=e+c-a;p=n.values.slice(e,t)}else{const e=n.createInterpolant(),t=a,r=c-a;e.evaluate(o),p=e.resultBuffer.slice(t,r)}if("quaternion"===i){(new On).fromArray(p).normalize().conjugate().toArray(p)}const d=s.times.length;for(let e=0;e<d;++e){const t=e*u+l;if("quaternion"===i)On.multiplyQuaternionsFlat(s.values,t,p,0,s.values,t);else{const e=u-2*l;for(let r=0;r<e;++r)s.values[t+r]-=p[r]}}}return e.blendMode=Gt,e}};class Ip{constructor(e,t,r,n){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==n?n:new t.constructor(r),this.sampleValues=t,this.valueSize=r,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let r=this._cachedIndex,n=t[r],i=t[r-1];e:{t:{let o;r:{n:if(!(e<n)){for(let o=r+2;;){if(void 0===n){if(e<i)break n;return r=t.length,this._cachedIndex=r,this.copySampleValue_(r-1)}if(r===o)break;if(i=n,n=t[++r],e<n)break t}o=t.length;break r}if(e>=i)break e;{const s=t[1];e<s&&(r=2,i=s);for(let o=r-2;;){if(void 0===i)return this._cachedIndex=0,this.copySampleValue_(0);if(r===o)break;if(n=i,i=t[--r-1],e>=i)break t}o=r,r=0}}for(;r<o;){const n=r+o>>>1;e<t[n]?o=n:r=n+1}if(n=t[r],i=t[r-1],void 0===i)return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===n)return r=t.length,this._cachedIndex=r,this.copySampleValue_(r-1)}this._cachedIndex=r,this.intervalChanged_(r,i,n)}return this.interpolate_(r,i,e,n)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,r=this.sampleValues,n=this.valueSize,i=e*n;for(let e=0;e!==n;++e)t[e]=r[i+e];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class Op extends Ip{constructor(e,t,r,n){super(e,t,r,n),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Ft,endingEnd:Ft}}intervalChanged_(e,t,r){const n=this.parameterPositions;let i=e-2,o=e+1,s=n[i],a=n[o];if(void 0===s)switch(this.getSettings_().endingStart){case Bt:i=e,s=2*t-r;break;case kt:i=n.length-2,s=t+n[i]-n[i+1];break;default:i=e,s=r}if(void 0===a)switch(this.getSettings_().endingEnd){case Bt:o=e,a=2*r-t;break;case kt:o=1,a=r+n[1]-n[0];break;default:o=e-1,a=t}const c=.5*(r-t),l=this.valueSize;this._weightPrev=c/(t-s),this._weightNext=c/(a-r),this._offsetPrev=i*l,this._offsetNext=o*l}interpolate_(e,t,r,n){const i=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=e*s,c=a-s,l=this._offsetPrev,u=this._offsetNext,h=this._weightPrev,p=this._weightNext,d=(r-t)/(n-t),f=d*d,m=f*d,g=-h*m+2*h*f-h*d,y=(1+h)*m+(-1.5-2*h)*f+(-.5+h)*d+1,v=(-1-p)*m+(1.5+p)*f+.5*d,_=p*m-p*f;for(let e=0;e!==s;++e)i[e]=g*o[l+e]+y*o[c+e]+v*o[a+e]+_*o[u+e];return i}}class Pp extends Ip{constructor(e,t,r,n){super(e,t,r,n)}interpolate_(e,t,r,n){const i=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=e*s,c=a-s,l=(r-t)/(n-t),u=1-l;for(let e=0;e!==s;++e)i[e]=o[c+e]*u+o[a+e]*l;return i}}class Np extends Ip{constructor(e,t,r,n){super(e,t,r,n)}interpolate_(e){return this.copySampleValue_(e-1)}}class Lp{constructor(e,t,r,n){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=Mp(t,this.TimeBufferType),this.values=Mp(r,this.ValueBufferType),this.setInterpolation(n||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let r;if(t.toJSON!==this.toJSON)r=t.toJSON(e);else{r={name:e.name,times:Mp(e.times,Array),values:Mp(e.values,Array)};const t=e.getInterpolation();t!==e.DefaultInterpolation&&(r.interpolation=t)}return r.type=e.ValueTypeName,r}InterpolantFactoryMethodDiscrete(e){return new Np(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new Pp(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new Op(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case Lt:t=this.InterpolantFactoryMethodDiscrete;break;case Ut:t=this.InterpolantFactoryMethodLinear;break;case Dt:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){const t="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(t);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",t),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Lt;case this.InterpolantFactoryMethodLinear:return Ut;case this.InterpolantFactoryMethodSmooth:return Dt}}getValueSize(){return this.values.length/this.times.length}shift(e){if(0!==e){const t=this.times;for(let r=0,n=t.length;r!==n;++r)t[r]+=e}return this}scale(e){if(1!==e){const t=this.times;for(let r=0,n=t.length;r!==n;++r)t[r]*=e}return this}trim(e,t){const r=this.times,n=r.length;let i=0,o=n-1;for(;i!==n&&r[i]<e;)++i;for(;-1!==o&&r[o]>t;)--o;if(++o,0!==i||o!==n){i>=o&&(o=Math.max(o,1),i=o-1);const e=this.getValueSize();this.times=r.slice(i,o),this.values=this.values.slice(i*e,o*e)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const r=this.times,n=this.values,i=r.length;0===i&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let o=null;for(let t=0;t!==i;t++){const n=r[t];if("number"==typeof n&&isNaN(n)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,t,n),e=!1;break}if(null!==o&&o>n){console.error("THREE.KeyframeTrack: Out of order keys.",this,t,n,o),e=!1;break}o=n}if(void 0!==n&&Tp(n))for(let t=0,r=n.length;t!==r;++t){const r=n[t];if(isNaN(r)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,t,r),e=!1;break}}return e}optimize(){const e=this.times.slice(),t=this.values.slice(),r=this.getValueSize(),n=this.getInterpolation()===Dt,i=e.length-1;let o=1;for(let s=1;s<i;++s){let i=!1;const a=e[s];if(a!==e[s+1]&&(1!==s||a!==e[0]))if(n)i=!0;else{const e=s*r,n=e-r,o=e+r;for(let s=0;s!==r;++s){const r=t[e+s];if(r!==t[n+s]||r!==t[o+s]){i=!0;break}}}if(i){if(s!==o){e[o]=e[s];const n=s*r,i=o*r;for(let e=0;e!==r;++e)t[i+e]=t[n+e]}++o}}if(i>0){e[o]=e[i];for(let e=i*r,n=o*r,s=0;s!==r;++s)t[n+s]=t[e+s];++o}return o!==e.length?(this.times=e.slice(0,o),this.values=t.slice(0,o*r)):(this.times=e,this.values=t),this}clone(){const e=this.times.slice(),t=this.values.slice(),r=new(0,this.constructor)(this.name,e,t);return r.createInterpolant=this.createInterpolant,r}}Lp.prototype.TimeBufferType=Float32Array,Lp.prototype.ValueBufferType=Float32Array,Lp.prototype.DefaultInterpolation=Ut;class Up extends Lp{constructor(e,t,r){super(e,t,r)}}Up.prototype.ValueTypeName="bool",Up.prototype.ValueBufferType=Array,Up.prototype.DefaultInterpolation=Lt,Up.prototype.InterpolantFactoryMethodLinear=void 0,Up.prototype.InterpolantFactoryMethodSmooth=void 0;class Dp extends Lp{}Dp.prototype.ValueTypeName="color";class Fp extends Lp{}Fp.prototype.ValueTypeName="number";class Bp extends Ip{constructor(e,t,r,n){super(e,t,r,n)}interpolate_(e,t,r,n){const i=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=(r-t)/(n-t);let c=e*s;for(let e=c+s;c!==e;c+=4)On.slerpFlat(i,0,o,c-s,o,c,a);return i}}class kp extends Lp{InterpolantFactoryMethodLinear(e){return new Bp(this.times,this.values,this.getValueSize(),e)}}kp.prototype.ValueTypeName="quaternion",kp.prototype.InterpolantFactoryMethodSmooth=void 0;class jp extends Lp{constructor(e,t,r){super(e,t,r)}}jp.prototype.ValueTypeName="string",jp.prototype.ValueBufferType=Array,jp.prototype.DefaultInterpolation=Lt,jp.prototype.InterpolantFactoryMethodLinear=void 0,jp.prototype.InterpolantFactoryMethodSmooth=void 0;class Gp extends Lp{}Gp.prototype.ValueTypeName="vector";class zp{constructor(e="",t=-1,r=[],n=jt){this.name=e,this.tracks=r,this.duration=t,this.blendMode=n,this.uuid=Xr(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],r=e.tracks,n=1/(e.fps||1);for(let e=0,i=r.length;e!==i;++e)t.push(Vp(r[e]).scale(n));const i=new this(e.name,e.duration,t,e.blendMode);return i.uuid=e.uuid,i}static toJSON(e){const t=[],r=e.tracks,n={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let e=0,n=r.length;e!==n;++e)t.push(Lp.toJSON(r[e]));return n}static CreateFromMorphTargetSequence(e,t,r,n){const i=t.length,o=[];for(let e=0;e<i;e++){let s=[],a=[];s.push((e+i-1)%i,e,(e+1)%i),a.push(0,1,0);const c=Ep(s);s=Ap(s,1,c),a=Ap(a,1,c),n||0!==s[0]||(s.push(i),a.push(a[0])),o.push(new Fp(".morphTargetInfluences["+t[e].name+"]",s,a).scale(1/r))}return new this(e,-1,o)}static findByName(e,t){let r=e;if(!Array.isArray(e)){const t=e;r=t.geometry&&t.geometry.animations||t.animations}for(let e=0;e<r.length;e++)if(r[e].name===t)return r[e];return null}static CreateClipsFromMorphTargetSequences(e,t,r){const n={},i=/^([\w-]*?)([\d]+)$/;for(let t=0,r=e.length;t<r;t++){const r=e[t],o=r.name.match(i);if(o&&o.length>1){const e=o[1];let t=n[e];t||(n[e]=t=[]),t.push(r)}}const o=[];for(const e in n)o.push(this.CreateFromMorphTargetSequence(e,n[e],t,r));return o}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const r=function(e,t,r,n,i){if(0!==r.length){const o=[],s=[];Rp(r,o,s,n),0!==o.length&&i.push(new e(t,o,s))}},n=[],i=e.name||"default",o=e.fps||30,s=e.blendMode;let a=e.length||-1;const c=e.hierarchy||[];for(let e=0;e<c.length;e++){const i=c[e].keys;if(i&&0!==i.length)if(i[0].morphTargets){const e={};let t;for(t=0;t<i.length;t++)if(i[t].morphTargets)for(let r=0;r<i[t].morphTargets.length;r++)e[i[t].morphTargets[r]]=-1;for(const r in e){const e=[],o=[];for(let n=0;n!==i[t].morphTargets.length;++n){const n=i[t];e.push(n.time),o.push(n.morphTarget===r?1:0)}n.push(new Fp(".morphTargetInfluence["+r+"]",e,o))}a=e.length*o}else{const o=".bones["+t[e].name+"]";r(Gp,o+".position",i,"pos",n),r(kp,o+".quaternion",i,"rot",n),r(Gp,o+".scale",i,"scl",n)}}if(0===n.length)return null;return new this(i,a,n,s)}resetDuration(){let e=0;for(let t=0,r=this.tracks.length;t!==r;++t){const r=this.tracks[t];e=Math.max(e,r.times[r.times.length-1])}return this.duration=e,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function Vp(e){if(void 0===e.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const t=function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Fp;case"vector":case"vector2":case"vector3":case"vector4":return Gp;case"color":return Dp;case"quaternion":return kp;case"bool":case"boolean":return Up;case"string":return jp}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}(e.type);if(void 0===e.times){const t=[],r=[];Rp(e.keys,t,r,"value"),e.times=t,e.values=r}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}const Hp={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};class Wp{constructor(e,t,r){const n=this;let i,o=!1,s=0,a=0;const c=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=r,this.itemStart=function(e){a++,!1===o&&void 0!==n.onStart&&n.onStart(e,s,a),o=!0},this.itemEnd=function(e){s++,void 0!==n.onProgress&&n.onProgress(e,s,a),s===a&&(o=!1,void 0!==n.onLoad&&n.onLoad())},this.itemError=function(e){void 0!==n.onError&&n.onError(e)},this.resolveURL=function(e){return i?i(e):e},this.setURLModifier=function(e){return i=e,this},this.addHandler=function(e,t){return c.push(e,t),this},this.removeHandler=function(e){const t=c.indexOf(e);return-1!==t&&c.splice(t,2),this},this.getHandler=function(e){for(let t=0,r=c.length;t<r;t+=2){const r=c[t],n=c[t+1];if(r.global&&(r.lastIndex=0),r.test(e))return n}return null}}}const Xp=new Wp;class Yp{constructor(e){this.manager=void 0!==e?e:Xp,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const r=this;return new Promise((function(n,i){r.load(e,n,t,i)}))}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}Yp.DEFAULT_MATERIAL_NAME="__DEFAULT";const qp={};class Jp extends Error{constructor(e,t){super(e),this.response=t}}class Kp extends Yp{constructor(e){super(e)}load(e,t,r,n){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const i=Hp.get(e);if(void 0!==i)return this.manager.itemStart(e),setTimeout((()=>{t&&t(i),this.manager.itemEnd(e)}),0),i;if(void 0!==qp[e])return void qp[e].push({onLoad:t,onProgress:r,onError:n});qp[e]=[],qp[e].push({onLoad:t,onProgress:r,onError:n});const o=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),s=this.mimeType,a=this.responseType;fetch(o).then((t=>{if(200===t.status||0===t.status){if(0===t.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),"undefined"==typeof ReadableStream||void 0===t.body||void 0===t.body.getReader)return t;const r=qp[e],n=t.body.getReader(),i=t.headers.get("X-File-Size")||t.headers.get("Content-Length"),o=i?parseInt(i):0,s=0!==o;let a=0;const c=new ReadableStream({start(e){!function t(){n.read().then((({done:n,value:i})=>{if(n)e.close();else{a+=i.byteLength;const n=new ProgressEvent("progress",{lengthComputable:s,loaded:a,total:o});for(let e=0,t=r.length;e<t;e++){const t=r[e];t.onProgress&&t.onProgress(n)}e.enqueue(i),t()}}),(t=>{e.error(t)}))}()}});return new Response(c)}throw new Jp(`fetch for "${t.url}" responded with ${t.status}: ${t.statusText}`,t)})).then((e=>{switch(a){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"document":return e.text().then((e=>(new DOMParser).parseFromString(e,s)));case"json":return e.json();default:if(void 0===s)return e.text();{const t=/charset="?([^;"\s]*)"?/i.exec(s),r=t&&t[1]?t[1].toLowerCase():void 0,n=new TextDecoder(r);return e.arrayBuffer().then((e=>n.decode(e)))}}})).then((t=>{Hp.add(e,t);const r=qp[e];delete qp[e];for(let e=0,n=r.length;e<n;e++){const n=r[e];n.onLoad&&n.onLoad(t)}})).catch((t=>{const r=qp[e];if(void 0===r)throw this.manager.itemError(e),t;delete qp[e];for(let e=0,n=r.length;e<n;e++){const n=r[e];n.onError&&n.onError(t)}this.manager.itemError(e)})).finally((()=>{this.manager.itemEnd(e)})),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class Zp extends Yp{constructor(e){super(e)}load(e,t,r,n){const i=this,o=new Kp(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,(function(r){try{t(i.parse(JSON.parse(r)))}catch(t){n?n(t):console.error(t),i.manager.itemError(e)}}),r,n)}parse(e){const t=[];for(let r=0;r<e.length;r++){const n=zp.parse(e[r]);t.push(n)}return t}}class Qp extends Yp{constructor(e){super(e)}load(e,t,r,n){const i=this,o=[],s=new Gu,a=new Kp(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(i.withCredentials);let c=0;function l(l){a.load(e[l],(function(e){const r=i.parse(e,!0);o[l]={width:r.width,height:r.height,format:r.format,mipmaps:r.mipmaps},c+=1,6===c&&(1===r.mipmapCount&&(s.minFilter=Me),s.image=o,s.format=r.format,s.needsUpdate=!0,t&&t(s))}),r,n)}if(Array.isArray(e))for(let t=0,r=e.length;t<r;++t)l(t);else a.load(e,(function(e){const r=i.parse(e,!0);if(r.isCubemap){const e=r.mipmaps.length/r.mipmapCount;for(let t=0;t<e;t++){o[t]={mipmaps:[]};for(let e=0;e<r.mipmapCount;e++)o[t].mipmaps.push(r.mipmaps[t*r.mipmapCount+e]),o[t].format=r.format,o[t].width=r.width,o[t].height=r.height}s.image=o}else s.image.width=r.width,s.image.height=r.height,s.mipmaps=r.mipmaps;1===r.mipmapCount&&(s.minFilter=Me),s.format=r.format,s.needsUpdate=!0,t&&t(s)}),r,n);return s}}class $p extends Yp{constructor(e){super(e)}load(e,t,r,n){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const i=this,o=Hp.get(e);if(void 0!==o)return i.manager.itemStart(e),setTimeout((function(){t&&t(o),i.manager.itemEnd(e)}),0),o;const s=sn("img");function a(){l(),Hp.add(e,this),t&&t(this),i.manager.itemEnd(e)}function c(t){l(),n&&n(t),i.manager.itemError(e),i.manager.itemEnd(e)}function l(){s.removeEventListener("load",a,!1),s.removeEventListener("error",c,!1)}return s.addEventListener("load",a,!1),s.addEventListener("error",c,!1),"data:"!==e.slice(0,5)&&void 0!==this.crossOrigin&&(s.crossOrigin=this.crossOrigin),i.manager.itemStart(e),s.src=e,s}}class ed extends Yp{constructor(e){super(e)}load(e,t,r,n){const i=new ss;i.colorSpace=Kt;const o=new $p(this.manager);o.setCrossOrigin(this.crossOrigin),o.setPath(this.path);let s=0;function a(r){o.load(e[r],(function(e){i.images[r]=e,s++,6===s&&(i.needsUpdate=!0,t&&t(i))}),void 0,n)}for(let t=0;t<e.length;++t)a(t);return i}}class td extends Yp{constructor(e){super(e)}load(e,t,r,n){const i=this,o=new kl,s=new Kp(this.manager);return s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setPath(this.path),s.setWithCredentials(i.withCredentials),s.load(e,(function(e){let r;try{r=i.parse(e)}catch(e){if(void 0===n)return void console.error(e);n(e)}void 0!==r.image?o.image=r.image:void 0!==r.data&&(o.image.width=r.width,o.image.height=r.height,o.image.data=r.data),o.wrapS=void 0!==r.wrapS?r.wrapS:ye,o.wrapT=void 0!==r.wrapT?r.wrapT:ye,o.magFilter=void 0!==r.magFilter?r.magFilter:Me,o.minFilter=void 0!==r.minFilter?r.minFilter:Me,o.anisotropy=void 0!==r.anisotropy?r.anisotropy:1,void 0!==r.colorSpace&&(o.colorSpace=r.colorSpace),void 0!==r.flipY&&(o.flipY=r.flipY),void 0!==r.format&&(o.format=r.format),void 0!==r.type&&(o.type=r.type),void 0!==r.mipmaps&&(o.mipmaps=r.mipmaps,o.minFilter=Ae),1===r.mipmapCount&&(o.minFilter=Me),void 0!==r.generateMipmaps&&(o.generateMipmaps=r.generateMipmaps),o.needsUpdate=!0,t&&t(o,r)}),r,n),o}}class rd extends Yp{constructor(e){super(e)}load(e,t,r,n){const i=new Sn,o=new $p(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,(function(e){i.image=e,i.needsUpdate=!0,void 0!==t&&t(i)}),r,n),i}}class nd extends Ui{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new Zi(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}class id extends nd{constructor(e,t,r){super(e,r),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(Ui.DEFAULT_UP),this.updateMatrix(),this.groundColor=new Zi(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}}const od=new ci,sd=new Pn,ad=new Pn;class cd{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new $r(512,512),this.map=null,this.mapPass=null,this.matrix=new ci,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new fs,this._frameExtents=new $r(1,1),this._viewportCount=1,this._viewports=[new Mn(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,r=this.matrix;sd.setFromMatrixPosition(e.matrixWorld),t.position.copy(sd),ad.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(ad),t.updateMatrixWorld(),od.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(od),r.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),r.multiply(od)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const e={};return 0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class ld extends cd{constructor(){super(new ns(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){const t=this.camera,r=2*Wr*e.angle*this.focus,n=this.mapSize.width/this.mapSize.height,i=e.distance||t.far;r===t.fov&&n===t.aspect&&i===t.far||(t.fov=r,t.aspect=n,t.far=i,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class ud extends nd{constructor(e,t,r=0,n=Math.PI/3,i=0,o=2){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Ui.DEFAULT_UP),this.updateMatrix(),this.target=new Ui,this.distance=r,this.angle=n,this.penumbra=i,this.decay=o,this.map=null,this.shadow=new ld}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}const hd=new ci,pd=new Pn,dd=new Pn;class fd extends cd{constructor(){super(new ns(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new $r(4,2),this._viewportCount=6,this._viewports=[new Mn(2,1,1,1),new Mn(0,1,1,1),new Mn(3,1,1,1),new Mn(1,1,1,1),new Mn(3,0,1,1),new Mn(1,0,1,1)],this._cubeDirections=[new Pn(1,0,0),new Pn(-1,0,0),new Pn(0,0,1),new Pn(0,0,-1),new Pn(0,1,0),new Pn(0,-1,0)],this._cubeUps=[new Pn(0,1,0),new Pn(0,1,0),new Pn(0,1,0),new Pn(0,1,0),new Pn(0,0,1),new Pn(0,0,-1)]}updateMatrices(e,t=0){const r=this.camera,n=this.matrix,i=e.distance||r.far;i!==r.far&&(r.far=i,r.updateProjectionMatrix()),pd.setFromMatrixPosition(e.matrixWorld),r.position.copy(pd),dd.copy(r.position),dd.add(this._cubeDirections[t]),r.up.copy(this._cubeUps[t]),r.lookAt(dd),r.updateMatrixWorld(),n.makeTranslation(-pd.x,-pd.y,-pd.z),hd.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),this._frustum.setFromProjectionMatrix(hd)}}class md extends nd{constructor(e,t,r=0,n=2){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=r,this.decay=n,this.shadow=new fd}get power(){return 4*this.intensity*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class gd extends cd{constructor(){super(new Is(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class yd extends nd{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Ui.DEFAULT_UP),this.updateMatrix(),this.target=new Ui,this.shadow=new gd}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class vd extends nd{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}class _d extends nd{constructor(e,t,r=10,n=10){super(e,t),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=r,this.height=n}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}class bd{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new Pn)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const r=e.x,n=e.y,i=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.282095),t.addScaledVector(o[1],.488603*n),t.addScaledVector(o[2],.488603*i),t.addScaledVector(o[3],.488603*r),t.addScaledVector(o[4],r*n*1.092548),t.addScaledVector(o[5],n*i*1.092548),t.addScaledVector(o[6],.315392*(3*i*i-1)),t.addScaledVector(o[7],r*i*1.092548),t.addScaledVector(o[8],.546274*(r*r-n*n)),t}getIrradianceAt(e,t){const r=e.x,n=e.y,i=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.886227),t.addScaledVector(o[1],1.023328*n),t.addScaledVector(o[2],1.023328*i),t.addScaledVector(o[3],1.023328*r),t.addScaledVector(o[4],.858086*r*n),t.addScaledVector(o[5],.858086*n*i),t.addScaledVector(o[6],.743125*i*i-.247708),t.addScaledVector(o[7],.858086*r*i),t.addScaledVector(o[8],.429043*(r*r-n*n)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let r=0;r<9;r++)this.coefficients[r].addScaledVector(e.coefficients[r],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let r=0;r<9;r++)this.coefficients[r].lerp(e.coefficients[r],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(e,t=0){const r=this.coefficients;for(let n=0;n<9;n++)r[n].fromArray(e,t+3*n);return this}toArray(e=[],t=0){const r=this.coefficients;for(let n=0;n<9;n++)r[n].toArray(e,t+3*n);return e}static getBasisAt(e,t){const r=e.x,n=e.y,i=e.z;t[0]=.282095,t[1]=.488603*n,t[2]=.488603*i,t[3]=.488603*r,t[4]=1.092548*r*n,t[5]=1.092548*n*i,t[6]=.315392*(3*i*i-1),t[7]=1.092548*r*i,t[8]=.546274*(r*r-n*n)}}class xd extends nd{constructor(e=new bd,t=1){super(void 0,t),this.isLightProbe=!0,this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}class wd extends Yp{constructor(e){super(e),this.textures={}}load(e,t,r,n){const i=this,o=new Kp(i.manager);o.setPath(i.path),o.setRequestHeader(i.requestHeader),o.setWithCredentials(i.withCredentials),o.load(e,(function(r){try{t(i.parse(JSON.parse(r)))}catch(t){n?n(t):console.error(t),i.manager.itemError(e)}}),r,n)}parse(e){const t=this.textures;function r(e){return void 0===t[e]&&console.warn("THREE.MaterialLoader: Undefined texture",e),t[e]}const n=wd.createMaterialFromType(e.type);if(void 0!==e.uuid&&(n.uuid=e.uuid),void 0!==e.name&&(n.name=e.name),void 0!==e.color&&void 0!==n.color&&n.color.setHex(e.color),void 0!==e.roughness&&(n.roughness=e.roughness),void 0!==e.metalness&&(n.metalness=e.metalness),void 0!==e.sheen&&(n.sheen=e.sheen),void 0!==e.sheenColor&&(n.sheenColor=(new Zi).setHex(e.sheenColor)),void 0!==e.sheenRoughness&&(n.sheenRoughness=e.sheenRoughness),void 0!==e.emissive&&void 0!==n.emissive&&n.emissive.setHex(e.emissive),void 0!==e.specular&&void 0!==n.specular&&n.specular.setHex(e.specular),void 0!==e.specularIntensity&&(n.specularIntensity=e.specularIntensity),void 0!==e.specularColor&&void 0!==n.specularColor&&n.specularColor.setHex(e.specularColor),void 0!==e.shininess&&(n.shininess=e.shininess),void 0!==e.clearcoat&&(n.clearcoat=e.clearcoat),void 0!==e.clearcoatRoughness&&(n.clearcoatRoughness=e.clearcoatRoughness),void 0!==e.dispersion&&(n.dispersion=e.dispersion),void 0!==e.iridescence&&(n.iridescence=e.iridescence),void 0!==e.iridescenceIOR&&(n.iridescenceIOR=e.iridescenceIOR),void 0!==e.iridescenceThicknessRange&&(n.iridescenceThicknessRange=e.iridescenceThicknessRange),void 0!==e.transmission&&(n.transmission=e.transmission),void 0!==e.thickness&&(n.thickness=e.thickness),void 0!==e.attenuationDistance&&(n.attenuationDistance=e.attenuationDistance),void 0!==e.attenuationColor&&void 0!==n.attenuationColor&&n.attenuationColor.setHex(e.attenuationColor),void 0!==e.anisotropy&&(n.anisotropy=e.anisotropy),void 0!==e.anisotropyRotation&&(n.anisotropyRotation=e.anisotropyRotation),void 0!==e.fog&&(n.fog=e.fog),void 0!==e.flatShading&&(n.flatShading=e.flatShading),void 0!==e.blending&&(n.blending=e.blending),void 0!==e.combine&&(n.combine=e.combine),void 0!==e.side&&(n.side=e.side),void 0!==e.shadowSide&&(n.shadowSide=e.shadowSide),void 0!==e.opacity&&(n.opacity=e.opacity),void 0!==e.transparent&&(n.transparent=e.transparent),void 0!==e.alphaTest&&(n.alphaTest=e.alphaTest),void 0!==e.alphaHash&&(n.alphaHash=e.alphaHash),void 0!==e.depthFunc&&(n.depthFunc=e.depthFunc),void 0!==e.depthTest&&(n.depthTest=e.depthTest),void 0!==e.depthWrite&&(n.depthWrite=e.depthWrite),void 0!==e.colorWrite&&(n.colorWrite=e.colorWrite),void 0!==e.blendSrc&&(n.blendSrc=e.blendSrc),void 0!==e.blendDst&&(n.blendDst=e.blendDst),void 0!==e.blendEquation&&(n.blendEquation=e.blendEquation),void 0!==e.blendSrcAlpha&&(n.blendSrcAlpha=e.blendSrcAlpha),void 0!==e.blendDstAlpha&&(n.blendDstAlpha=e.blendDstAlpha),void 0!==e.blendEquationAlpha&&(n.blendEquationAlpha=e.blendEquationAlpha),void 0!==e.blendColor&&void 0!==n.blendColor&&n.blendColor.setHex(e.blendColor),void 0!==e.blendAlpha&&(n.blendAlpha=e.blendAlpha),void 0!==e.stencilWriteMask&&(n.stencilWriteMask=e.stencilWriteMask),void 0!==e.stencilFunc&&(n.stencilFunc=e.stencilFunc),void 0!==e.stencilRef&&(n.stencilRef=e.stencilRef),void 0!==e.stencilFuncMask&&(n.stencilFuncMask=e.stencilFuncMask),void 0!==e.stencilFail&&(n.stencilFail=e.stencilFail),void 0!==e.stencilZFail&&(n.stencilZFail=e.stencilZFail),void 0!==e.stencilZPass&&(n.stencilZPass=e.stencilZPass),void 0!==e.stencilWrite&&(n.stencilWrite=e.stencilWrite),void 0!==e.wireframe&&(n.wireframe=e.wireframe),void 0!==e.wireframeLinewidth&&(n.wireframeLinewidth=e.wireframeLinewidth),void 0!==e.wireframeLinecap&&(n.wireframeLinecap=e.wireframeLinecap),void 0!==e.wireframeLinejoin&&(n.wireframeLinejoin=e.wireframeLinejoin),void 0!==e.rotation&&(n.rotation=e.rotation),void 0!==e.linewidth&&(n.linewidth=e.linewidth),void 0!==e.dashSize&&(n.dashSize=e.dashSize),void 0!==e.gapSize&&(n.gapSize=e.gapSize),void 0!==e.scale&&(n.scale=e.scale),void 0!==e.polygonOffset&&(n.polygonOffset=e.polygonOffset),void 0!==e.polygonOffsetFactor&&(n.polygonOffsetFactor=e.polygonOffsetFactor),void 0!==e.polygonOffsetUnits&&(n.polygonOffsetUnits=e.polygonOffsetUnits),void 0!==e.dithering&&(n.dithering=e.dithering),void 0!==e.alphaToCoverage&&(n.alphaToCoverage=e.alphaToCoverage),void 0!==e.premultipliedAlpha&&(n.premultipliedAlpha=e.premultipliedAlpha),void 0!==e.forceSinglePass&&(n.forceSinglePass=e.forceSinglePass),void 0!==e.visible&&(n.visible=e.visible),void 0!==e.toneMapped&&(n.toneMapped=e.toneMapped),void 0!==e.userData&&(n.userData=e.userData),void 0!==e.vertexColors&&("number"==typeof e.vertexColors?n.vertexColors=e.vertexColors>0:n.vertexColors=e.vertexColors),void 0!==e.uniforms)for(const t in e.uniforms){const i=e.uniforms[t];switch(n.uniforms[t]={},i.type){case"t":n.uniforms[t].value=r(i.value);break;case"c":n.uniforms[t].value=(new Zi).setHex(i.value);break;case"v2":n.uniforms[t].value=(new $r).fromArray(i.value);break;case"v3":n.uniforms[t].value=(new Pn).fromArray(i.value);break;case"v4":n.uniforms[t].value=(new Mn).fromArray(i.value);break;case"m3":n.uniforms[t].value=(new en).fromArray(i.value);break;case"m4":n.uniforms[t].value=(new ci).fromArray(i.value);break;default:n.uniforms[t].value=i.value}}if(void 0!==e.defines&&(n.defines=e.defines),void 0!==e.vertexShader&&(n.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(n.fragmentShader=e.fragmentShader),void 0!==e.glslVersion&&(n.glslVersion=e.glslVersion),void 0!==e.extensions)for(const t in e.extensions)n.extensions[t]=e.extensions[t];if(void 0!==e.lights&&(n.lights=e.lights),void 0!==e.clipping&&(n.clipping=e.clipping),void 0!==e.size&&(n.size=e.size),void 0!==e.sizeAttenuation&&(n.sizeAttenuation=e.sizeAttenuation),void 0!==e.map&&(n.map=r(e.map)),void 0!==e.matcap&&(n.matcap=r(e.matcap)),void 0!==e.alphaMap&&(n.alphaMap=r(e.alphaMap)),void 0!==e.bumpMap&&(n.bumpMap=r(e.bumpMap)),void 0!==e.bumpScale&&(n.bumpScale=e.bumpScale),void 0!==e.normalMap&&(n.normalMap=r(e.normalMap)),void 0!==e.normalMapType&&(n.normalMapType=e.normalMapType),void 0!==e.normalScale){let t=e.normalScale;!1===Array.isArray(t)&&(t=[t,t]),n.normalScale=(new $r).fromArray(t)}return void 0!==e.displacementMap&&(n.displacementMap=r(e.displacementMap)),void 0!==e.displacementScale&&(n.displacementScale=e.displacementScale),void 0!==e.displacementBias&&(n.displacementBias=e.displacementBias),void 0!==e.roughnessMap&&(n.roughnessMap=r(e.roughnessMap)),void 0!==e.metalnessMap&&(n.metalnessMap=r(e.metalnessMap)),void 0!==e.emissiveMap&&(n.emissiveMap=r(e.emissiveMap)),void 0!==e.emissiveIntensity&&(n.emissiveIntensity=e.emissiveIntensity),void 0!==e.specularMap&&(n.specularMap=r(e.specularMap)),void 0!==e.specularIntensityMap&&(n.specularIntensityMap=r(e.specularIntensityMap)),void 0!==e.specularColorMap&&(n.specularColorMap=r(e.specularColorMap)),void 0!==e.envMap&&(n.envMap=r(e.envMap)),void 0!==e.envMapRotation&&n.envMapRotation.fromArray(e.envMapRotation),void 0!==e.envMapIntensity&&(n.envMapIntensity=e.envMapIntensity),void 0!==e.reflectivity&&(n.reflectivity=e.reflectivity),void 0!==e.refractionRatio&&(n.refractionRatio=e.refractionRatio),void 0!==e.lightMap&&(n.lightMap=r(e.lightMap)),void 0!==e.lightMapIntensity&&(n.lightMapIntensity=e.lightMapIntensity),void 0!==e.aoMap&&(n.aoMap=r(e.aoMap)),void 0!==e.aoMapIntensity&&(n.aoMapIntensity=e.aoMapIntensity),void 0!==e.gradientMap&&(n.gradientMap=r(e.gradientMap)),void 0!==e.clearcoatMap&&(n.clearcoatMap=r(e.clearcoatMap)),void 0!==e.clearcoatRoughnessMap&&(n.clearcoatRoughnessMap=r(e.clearcoatRoughnessMap)),void 0!==e.clearcoatNormalMap&&(n.clearcoatNormalMap=r(e.clearcoatNormalMap)),void 0!==e.clearcoatNormalScale&&(n.clearcoatNormalScale=(new $r).fromArray(e.clearcoatNormalScale)),void 0!==e.iridescenceMap&&(n.iridescenceMap=r(e.iridescenceMap)),void 0!==e.iridescenceThicknessMap&&(n.iridescenceThicknessMap=r(e.iridescenceThicknessMap)),void 0!==e.transmissionMap&&(n.transmissionMap=r(e.transmissionMap)),void 0!==e.thicknessMap&&(n.thicknessMap=r(e.thicknessMap)),void 0!==e.anisotropyMap&&(n.anisotropyMap=r(e.anisotropyMap)),void 0!==e.sheenColorMap&&(n.sheenColorMap=r(e.sheenColorMap)),void 0!==e.sheenRoughnessMap&&(n.sheenRoughnessMap=r(e.sheenRoughnessMap)),n}setTextures(e){return this.textures=e,this}static createMaterialFromType(e){return new{ShadowMaterial:fp,SpriteMaterial:ll,RawShaderMaterial:mp,ShaderMaterial:Qo,PointsMaterial:Pu,MeshPhysicalMaterial:yp,MeshStandardMaterial:gp,MeshPhongMaterial:vp,MeshToonMaterial:_p,MeshNormalMaterial:bp,MeshLambertMaterial:xp,MeshDepthMaterial:jc,MeshDistanceMaterial:Gc,MeshBasicMaterial:to,MeshMatcapMaterial:wp,LineDashedMaterial:Sp,LineBasicMaterial:vu,Material:eo}[e]}}class Sd{static decodeText(e){if(console.warn("THREE.LoaderUtils: decodeText() has been deprecated with r165 and will be removed with r175. Use TextDecoder instead."),"undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);let t="";for(let r=0,n=e.length;r<n;r++)t+=String.fromCharCode(e[r]);try{return decodeURIComponent(escape(t))}catch(e){return t}}static extractUrlBase(e){const t=e.lastIndexOf("/");return-1===t?"./":e.slice(0,t+1)}static resolveURL(e,t){return"string"!=typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}class Md extends Ao{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}toJSON(){const e=super.toJSON();return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}class Td extends Yp{constructor(e){super(e)}load(e,t,r,n){const i=this,o=new Kp(i.manager);o.setPath(i.path),o.setRequestHeader(i.requestHeader),o.setWithCredentials(i.withCredentials),o.load(e,(function(r){try{t(i.parse(JSON.parse(r)))}catch(t){n?n(t):console.error(t),i.manager.itemError(e)}}),r,n)}parse(e){const t={},r={};function n(e,n){if(void 0!==t[n])return t[n];const i=e.interleavedBuffers[n],o=function(e,t){if(void 0!==r[t])return r[t];const n=e.arrayBuffers,i=n[t],o=new Uint32Array(i).buffer;return r[t]=o,o}(e,i.buffer),s=on(i.type,o),a=new sl(s,i.stride);return a.uuid=i.uuid,t[n]=a,a}const i=e.isInstancedBufferGeometry?new Md:new Ao,o=e.data.index;if(void 0!==o){const e=on(o.type,o.array);i.setIndex(new lo(e,1))}const s=e.data.attributes;for(const t in s){const r=s[t];let o;if(r.isInterleavedBufferAttribute){const t=n(e.data,r.data);o=new cl(t,r.itemSize,r.offset,r.normalized)}else{const e=on(r.type,r.array);o=new(r.isInstancedBufferAttribute?Vl:lo)(e,r.itemSize,r.normalized)}void 0!==r.name&&(o.name=r.name),void 0!==r.usage&&o.setUsage(r.usage),i.setAttribute(t,o)}const a=e.data.morphAttributes;if(a)for(const t in a){const r=a[t],o=[];for(let t=0,i=r.length;t<i;t++){const i=r[t];let s;if(i.isInterleavedBufferAttribute){const t=n(e.data,i.data);s=new cl(t,i.itemSize,i.offset,i.normalized)}else{const e=on(i.type,i.array);s=new lo(e,i.itemSize,i.normalized)}void 0!==i.name&&(s.name=i.name),o.push(s)}i.morphAttributes[t]=o}e.data.morphTargetsRelative&&(i.morphTargetsRelative=!0);const c=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==c)for(let e=0,t=c.length;e!==t;++e){const t=c[e];i.addGroup(t.start,t.count,t.materialIndex)}const l=e.data.boundingSphere;if(void 0!==l){const e=new Pn;void 0!==l.center&&e.fromArray(l.center),i.boundingSphere=new $n(e,l.radius)}return e.name&&(i.name=e.name),e.userData&&(i.userData=e.userData),i}}class Ed extends Yp{constructor(e){super(e)}load(e,t,r,n){const i=this,o=""===this.path?Sd.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||o;const s=new Kp(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,(function(r){let o=null;try{o=JSON.parse(r)}catch(t){return void 0!==n&&n(t),void console.error("THREE:ObjectLoader: Can't parse "+e+".",t.message)}const s=o.metadata;if(void 0===s||void 0===s.type||"geometry"===s.type.toLowerCase())return void 0!==n&&n(new Error("THREE.ObjectLoader: Can't load "+e)),void console.error("THREE.ObjectLoader: Can't load "+e);i.parse(o,t)}),r,n)}async loadAsync(e,t){const r=""===this.path?Sd.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||r;const n=new Kp(this.manager);n.setPath(this.path),n.setRequestHeader(this.requestHeader),n.setWithCredentials(this.withCredentials);const i=await n.loadAsync(e,t),o=JSON.parse(i),s=o.metadata;if(void 0===s||void 0===s.type||"geometry"===s.type.toLowerCase())throw new Error("THREE.ObjectLoader: Can't load "+e);return await this.parseAsync(o)}parse(e,t){const r=this.parseAnimations(e.animations),n=this.parseShapes(e.shapes),i=this.parseGeometries(e.geometries,n),o=this.parseImages(e.images,(function(){void 0!==t&&t(c)})),s=this.parseTextures(e.textures,o),a=this.parseMaterials(e.materials,s),c=this.parseObject(e.object,i,a,s,r),l=this.parseSkeletons(e.skeletons,c);if(this.bindSkeletons(c,l),void 0!==t){let e=!1;for(const t in o)if(o[t].data instanceof HTMLImageElement){e=!0;break}!1===e&&t(c)}return c}async parseAsync(e){const t=this.parseAnimations(e.animations),r=this.parseShapes(e.shapes),n=this.parseGeometries(e.geometries,r),i=await this.parseImagesAsync(e.images),o=this.parseTextures(e.textures,i),s=this.parseMaterials(e.materials,o),a=this.parseObject(e.object,n,s,o,t),c=this.parseSkeletons(e.skeletons,a);return this.bindSkeletons(a,c),a}parseShapes(e){const t={};if(void 0!==e)for(let r=0,n=e.length;r<n;r++){const n=(new Th).fromJSON(e[r]);t[n.uuid]=n}return t}parseSkeletons(e,t){const r={},n={};if(t.traverse((function(e){e.isBone&&(n[e.uuid]=e)})),void 0!==e)for(let t=0,i=e.length;t<i;t++){const i=(new zl).fromJSON(e[t],n);r[i.uuid]=i}return r}parseGeometries(e,t){const r={};if(void 0!==e){const n=new Td;for(let i=0,o=e.length;i<o;i++){let o;const s=e[i];switch(s.type){case"BufferGeometry":case"InstancedBufferGeometry":o=n.parse(s);break;default:s.type in dp?o=dp[s.type].fromJSON(s,t):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${s.type}"`)}o.uuid=s.uuid,void 0!==s.name&&(o.name=s.name),void 0!==s.userData&&(o.userData=s.userData),r[s.uuid]=o}}return r}parseMaterials(e,t){const r={},n={};if(void 0!==e){const i=new wd;i.setTextures(t);for(let t=0,o=e.length;t<o;t++){const o=e[t];void 0===r[o.uuid]&&(r[o.uuid]=i.parse(o)),n[o.uuid]=r[o.uuid]}}return n}parseAnimations(e){const t={};if(void 0!==e)for(let r=0;r<e.length;r++){const n=e[r],i=zp.parse(n);t[i.uuid]=i}return t}parseImages(e,t){const r=this,n={};let i;function o(e){if("string"==typeof e){const t=e;return function(e){return r.manager.itemStart(e),i.load(e,(function(){r.manager.itemEnd(e)}),void 0,(function(){r.manager.itemError(e),r.manager.itemEnd(e)}))}(/^(\/\/)|([a-z]+:(\/\/)?)/i.test(t)?t:r.resourcePath+t)}return e.data?{data:on(e.type,e.data),width:e.width,height:e.height}:null}if(void 0!==e&&e.length>0){const r=new Wp(t);i=new $p(r),i.setCrossOrigin(this.crossOrigin);for(let t=0,r=e.length;t<r;t++){const r=e[t],i=r.url;if(Array.isArray(i)){const e=[];for(let t=0,r=i.length;t<r;t++){const r=o(i[t]);null!==r&&(r instanceof HTMLImageElement?e.push(r):e.push(new kl(r.data,r.width,r.height)))}n[r.uuid]=new bn(e)}else{const e=o(r.url);n[r.uuid]=new bn(e)}}}return n}async parseImagesAsync(e){const t=this,r={};let n;async function i(e){if("string"==typeof e){const r=e,i=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(r)?r:t.resourcePath+r;return await n.loadAsync(i)}return e.data?{data:on(e.type,e.data),width:e.width,height:e.height}:null}if(void 0!==e&&e.length>0){n=new $p(this.manager),n.setCrossOrigin(this.crossOrigin);for(let t=0,n=e.length;t<n;t++){const n=e[t],o=n.url;if(Array.isArray(o)){const e=[];for(let t=0,r=o.length;t<r;t++){const r=o[t],n=await i(r);null!==n&&(n instanceof HTMLImageElement?e.push(n):e.push(new kl(n.data,n.width,n.height)))}r[n.uuid]=new bn(e)}else{const e=await i(n.url);r[n.uuid]=new bn(e)}}}return r}parseTextures(e,t){function r(e,t){return"number"==typeof e?e:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",e),t[e])}const n={};if(void 0!==e)for(let i=0,o=e.length;i<o;i++){const o=e[i];void 0===o.image&&console.warn('THREE.ObjectLoader: No "image" specified for',o.uuid),void 0===t[o.image]&&console.warn("THREE.ObjectLoader: Undefined image",o.image);const s=t[o.image],a=s.data;let c;Array.isArray(a)?(c=new ss,6===a.length&&(c.needsUpdate=!0)):(c=a&&a.data?new kl:new Sn,a&&(c.needsUpdate=!0)),c.source=s,c.uuid=o.uuid,void 0!==o.name&&(c.name=o.name),void 0!==o.mapping&&(c.mapping=r(o.mapping,Ad)),void 0!==o.channel&&(c.channel=o.channel),void 0!==o.offset&&c.offset.fromArray(o.offset),void 0!==o.repeat&&c.repeat.fromArray(o.repeat),void 0!==o.center&&c.center.fromArray(o.center),void 0!==o.rotation&&(c.rotation=o.rotation),void 0!==o.wrap&&(c.wrapS=r(o.wrap[0],Rd),c.wrapT=r(o.wrap[1],Rd)),void 0!==o.format&&(c.format=o.format),void 0!==o.internalFormat&&(c.internalFormat=o.internalFormat),void 0!==o.type&&(c.type=o.type),void 0!==o.colorSpace&&(c.colorSpace=o.colorSpace),void 0!==o.minFilter&&(c.minFilter=r(o.minFilter,Cd)),void 0!==o.magFilter&&(c.magFilter=r(o.magFilter,Cd)),void 0!==o.anisotropy&&(c.anisotropy=o.anisotropy),void 0!==o.flipY&&(c.flipY=o.flipY),void 0!==o.generateMipmaps&&(c.generateMipmaps=o.generateMipmaps),void 0!==o.premultiplyAlpha&&(c.premultiplyAlpha=o.premultiplyAlpha),void 0!==o.unpackAlignment&&(c.unpackAlignment=o.unpackAlignment),void 0!==o.compareFunction&&(c.compareFunction=o.compareFunction),void 0!==o.userData&&(c.userData=o.userData),n[o.uuid]=c}return n}parseObject(e,t,r,n,i){let o,s,a;function c(e){return void 0===t[e]&&console.warn("THREE.ObjectLoader: Undefined geometry",e),t[e]}function l(e){if(void 0!==e){if(Array.isArray(e)){const t=[];for(let n=0,i=e.length;n<i;n++){const i=e[n];void 0===r[i]&&console.warn("THREE.ObjectLoader: Undefined material",i),t.push(r[i])}return t}return void 0===r[e]&&console.warn("THREE.ObjectLoader: Undefined material",e),r[e]}}function u(e){return void 0===n[e]&&console.warn("THREE.ObjectLoader: Undefined texture",e),n[e]}switch(e.type){case"Scene":o=new ol,void 0!==e.background&&(Number.isInteger(e.background)?o.background=new Zi(e.background):o.background=u(e.background)),void 0!==e.environment&&(o.environment=u(e.environment)),void 0!==e.fog&&("Fog"===e.fog.type?o.fog=new il(e.fog.color,e.fog.near,e.fog.far):"FogExp2"===e.fog.type&&(o.fog=new nl(e.fog.color,e.fog.density)),""!==e.fog.name&&(o.fog.name=e.fog.name)),void 0!==e.backgroundBlurriness&&(o.backgroundBlurriness=e.backgroundBlurriness),void 0!==e.backgroundIntensity&&(o.backgroundIntensity=e.backgroundIntensity),void 0!==e.backgroundRotation&&o.backgroundRotation.fromArray(e.backgroundRotation),void 0!==e.environmentIntensity&&(o.environmentIntensity=e.environmentIntensity),void 0!==e.environmentRotation&&o.environmentRotation.fromArray(e.environmentRotation);break;case"PerspectiveCamera":o=new ns(e.fov,e.aspect,e.near,e.far),void 0!==e.focus&&(o.focus=e.focus),void 0!==e.zoom&&(o.zoom=e.zoom),void 0!==e.filmGauge&&(o.filmGauge=e.filmGauge),void 0!==e.filmOffset&&(o.filmOffset=e.filmOffset),void 0!==e.view&&(o.view=Object.assign({},e.view));break;case"OrthographicCamera":o=new Is(e.left,e.right,e.top,e.bottom,e.near,e.far),void 0!==e.zoom&&(o.zoom=e.zoom),void 0!==e.view&&(o.view=Object.assign({},e.view));break;case"AmbientLight":o=new vd(e.color,e.intensity);break;case"DirectionalLight":o=new yd(e.color,e.intensity);break;case"PointLight":o=new md(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":o=new _d(e.color,e.intensity,e.width,e.height);break;case"SpotLight":o=new ud(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":o=new id(e.color,e.groundColor,e.intensity);break;case"LightProbe":o=(new xd).fromJSON(e);break;case"SkinnedMesh":s=c(e.geometry),a=l(e.material),o=new Fl(s,a),void 0!==e.bindMode&&(o.bindMode=e.bindMode),void 0!==e.bindMatrix&&o.bindMatrix.fromArray(e.bindMatrix),void 0!==e.skeleton&&(o.skeleton=e.skeleton);break;case"Mesh":s=c(e.geometry),a=l(e.material),o=new Wo(s,a);break;case"InstancedMesh":s=c(e.geometry),a=l(e.material);const t=e.count,r=e.instanceMatrix,n=e.instanceColor;o=new Zl(s,a,t),o.instanceMatrix=new Vl(new Float32Array(r.array),16),void 0!==n&&(o.instanceColor=new Vl(new Float32Array(n.array),n.itemSize));break;case"BatchedMesh":s=c(e.geometry),a=l(e.material),o=new yu(e.maxGeometryCount,e.maxVertexCount,e.maxIndexCount,a),o.geometry=s,o.perObjectFrustumCulled=e.perObjectFrustumCulled,o.sortObjects=e.sortObjects,o._drawRanges=e.drawRanges,o._reservedRanges=e.reservedRanges,o._visibility=e.visibility,o._active=e.active,o._bounds=e.bounds.map((e=>{const t=new Un;t.min.fromArray(e.boxMin),t.max.fromArray(e.boxMax);const r=new $n;return r.radius=e.sphereRadius,r.center.fromArray(e.sphereCenter),{boxInitialized:e.boxInitialized,box:t,sphereInitialized:e.sphereInitialized,sphere:r}})),o._maxGeometryCount=e.maxGeometryCount,o._maxVertexCount=e.maxVertexCount,o._maxIndexCount=e.maxIndexCount,o._geometryInitialized=e.geometryInitialized,o._geometryCount=e.geometryCount,o._matricesTexture=u(e.matricesTexture.uuid),void 0!==e.colorsTexture&&(o._colorsTexture=u(e.colorsTexture.uuid));break;case"LOD":o=new Al;break;case"Line":o=new Eu(c(e.geometry),l(e.material));break;case"LineLoop":o=new Ou(c(e.geometry),l(e.material));break;case"LineSegments":o=new Iu(c(e.geometry),l(e.material));break;case"PointCloud":case"Points":o=new Fu(c(e.geometry),l(e.material));break;case"Sprite":o=new Sl(l(e.material));break;case"Group":o=new Yc;break;case"Bone":o=new Bl;break;default:o=new Ui}if(o.uuid=e.uuid,void 0!==e.name&&(o.name=e.name),void 0!==e.matrix?(o.matrix.fromArray(e.matrix),void 0!==e.matrixAutoUpdate&&(o.matrixAutoUpdate=e.matrixAutoUpdate),o.matrixAutoUpdate&&o.matrix.decompose(o.position,o.quaternion,o.scale)):(void 0!==e.position&&o.position.fromArray(e.position),void 0!==e.rotation&&o.rotation.fromArray(e.rotation),void 0!==e.quaternion&&o.quaternion.fromArray(e.quaternion),void 0!==e.scale&&o.scale.fromArray(e.scale)),void 0!==e.up&&o.up.fromArray(e.up),void 0!==e.castShadow&&(o.castShadow=e.castShadow),void 0!==e.receiveShadow&&(o.receiveShadow=e.receiveShadow),e.shadow&&(void 0!==e.shadow.bias&&(o.shadow.bias=e.shadow.bias),void 0!==e.shadow.normalBias&&(o.shadow.normalBias=e.shadow.normalBias),void 0!==e.shadow.radius&&(o.shadow.radius=e.shadow.radius),void 0!==e.shadow.mapSize&&o.shadow.mapSize.fromArray(e.shadow.mapSize),void 0!==e.shadow.camera&&(o.shadow.camera=this.parseObject(e.shadow.camera))),void 0!==e.visible&&(o.visible=e.visible),void 0!==e.frustumCulled&&(o.frustumCulled=e.frustumCulled),void 0!==e.renderOrder&&(o.renderOrder=e.renderOrder),void 0!==e.userData&&(o.userData=e.userData),void 0!==e.layers&&(o.layers.mask=e.layers),void 0!==e.children){const s=e.children;for(let e=0;e<s.length;e++)o.add(this.parseObject(s[e],t,r,n,i))}if(void 0!==e.animations){const t=e.animations;for(let e=0;e<t.length;e++){const r=t[e];o.animations.push(i[r])}}if("LOD"===e.type){void 0!==e.autoUpdate&&(o.autoUpdate=e.autoUpdate);const t=e.levels;for(let e=0;e<t.length;e++){const r=t[e],n=o.getObjectByProperty("uuid",r.object);void 0!==n&&o.addLevel(n,r.distance,r.hysteresis)}}return o}bindSkeletons(e,t){0!==Object.keys(t).length&&e.traverse((function(e){if(!0===e.isSkinnedMesh&&void 0!==e.skeleton){const r=t[e.skeleton];void 0===r?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",e.skeleton):e.bind(r,e.bindMatrix)}}))}}const Ad={UVMapping:ue,CubeReflectionMapping:he,CubeRefractionMapping:pe,EquirectangularReflectionMapping:de,EquirectangularRefractionMapping:fe,CubeUVReflectionMapping:me},Rd={RepeatWrapping:ge,ClampToEdgeWrapping:ye,MirroredRepeatWrapping:ve},Cd={NearestFilter:_e,NearestMipmapNearestFilter:be,NearestMipmapLinearFilter:we,LinearFilter:Me,LinearMipmapNearestFilter:Te,LinearMipmapLinearFilter:Ae};class Id extends Yp{constructor(e){super(e),this.isImageBitmapLoader=!0,"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,r,n){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const i=this,o=Hp.get(e);if(void 0!==o)return i.manager.itemStart(e),o.then?void o.then((r=>{t&&t(r),i.manager.itemEnd(e)})).catch((e=>{n&&n(e)})):(setTimeout((function(){t&&t(o),i.manager.itemEnd(e)}),0),o);const s={};s.credentials="anonymous"===this.crossOrigin?"same-origin":"include",s.headers=this.requestHeader;const a=fetch(e,s).then((function(e){return e.blob()})).then((function(e){return createImageBitmap(e,Object.assign(i.options,{colorSpaceConversion:"none"}))})).then((function(r){return Hp.add(e,r),t&&t(r),i.manager.itemEnd(e),r})).catch((function(t){n&&n(t),Hp.remove(e),i.manager.itemError(e),i.manager.itemEnd(e)}));Hp.add(e,a),i.manager.itemStart(e)}}let Od;class Pd{static getContext(){return void 0===Od&&(Od=new(window.AudioContext||window.webkitAudioContext)),Od}static setContext(e){Od=e}}class Nd extends Yp{constructor(e){super(e)}load(e,t,r,n){const i=this,o=new Kp(this.manager);function s(t){n?n(t):console.error(t),i.manager.itemError(e)}o.setResponseType("arraybuffer"),o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,(function(e){try{const r=e.slice(0);Pd.getContext().decodeAudioData(r,(function(e){t(e)})).catch(s)}catch(e){s(e)}}),r,n)}}const Ld=new ci,Ud=new ci,Dd=new ci;class Fd{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new ns,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new ns,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){const t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep,Dd.copy(e.projectionMatrix);const r=t.eyeSep/2,n=r*t.near/t.focus,i=t.near*Math.tan(Hr*t.fov*.5)/t.zoom;let o,s;Ud.elements[12]=-r,Ld.elements[12]=r,o=-i*t.aspect+n,s=i*t.aspect+n,Dd.elements[0]=2*t.near/(s-o),Dd.elements[8]=(s+o)/(s-o),this.cameraL.projectionMatrix.copy(Dd),o=-i*t.aspect-n,s=i*t.aspect-n,Dd.elements[0]=2*t.near/(s-o),Dd.elements[8]=(s+o)/(s-o),this.cameraR.projectionMatrix.copy(Dd)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(Ud),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(Ld)}}class Bd{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=kd(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=kd();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}function kd(){return("undefined"==typeof performance?Date:performance).now()}const jd=new Pn,Gd=new On,zd=new Pn,Vd=new Pn;class Hd extends Ui{constructor(){super(),this.type="AudioListener",this.context=Pd.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new Bd}getInput(){return this.gain}removeFilter(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(e){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}updateMatrixWorld(e){super.updateMatrixWorld(e);const t=this.context.listener,r=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(jd,Gd,zd),Vd.set(0,0,-1).applyQuaternion(Gd),t.positionX){const e=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(jd.x,e),t.positionY.linearRampToValueAtTime(jd.y,e),t.positionZ.linearRampToValueAtTime(jd.z,e),t.forwardX.linearRampToValueAtTime(Vd.x,e),t.forwardY.linearRampToValueAtTime(Vd.y,e),t.forwardZ.linearRampToValueAtTime(Vd.z,e),t.upX.linearRampToValueAtTime(r.x,e),t.upY.linearRampToValueAtTime(r.y,e),t.upZ.linearRampToValueAtTime(r.z,e)}else t.setPosition(jd.x,jd.y,jd.z),t.setOrientation(Vd.x,Vd.y,Vd.z,r.x,r.y,r.z)}}class Wd extends Ui{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(!0===this.isPlaying)return void console.warn("THREE.Audio: Audio is already playing.");if(!1===this.hasPlaybackControl)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+e;const t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(){if(!1!==this.hasPlaybackControl)return this._progress=0,null!==this.source&&(this.source.stop(),this.source.onended=null),this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(!1!==this._connected){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}}getFilters(){return this.filters}setFilters(e){return e||(e=[]),!0===this._connected?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){return this.detune=e,!0===this.isPlaying&&void 0!==this.source.detune&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(!1!==this.hasPlaybackControl)return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(!1!==this.hasPlaybackControl)return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}const Xd=new Pn,Yd=new On,qd=new Pn,Jd=new Pn;class Kd extends Wd{constructor(e){super(e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}connect(){super.connect(),this.panner.connect(this.gain)}disconnect(){super.disconnect(),this.panner.disconnect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,t,r){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=r,this}updateMatrixWorld(e){if(super.updateMatrixWorld(e),!0===this.hasPlaybackControl&&!1===this.isPlaying)return;this.matrixWorld.decompose(Xd,Yd,qd),Jd.set(0,0,1).applyQuaternion(Yd);const t=this.panner;if(t.positionX){const e=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(Xd.x,e),t.positionY.linearRampToValueAtTime(Xd.y,e),t.positionZ.linearRampToValueAtTime(Xd.z,e),t.orientationX.linearRampToValueAtTime(Jd.x,e),t.orientationY.linearRampToValueAtTime(Jd.y,e),t.orientationZ.linearRampToValueAtTime(Jd.z,e)}else t.setPosition(Xd.x,Xd.y,Xd.z),t.setOrientation(Jd.x,Jd.y,Jd.z)}}class Zd{constructor(e,t=2048){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=t,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0;const t=this.getFrequencyData();for(let r=0;r<t.length;r++)e+=t[r];return e/t.length}}class Qd{constructor(e,t,r){let n,i,o;switch(this.binding=e,this.valueSize=r,t){case"quaternion":n=this._slerp,i=this._slerpAdditive,o=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*r),this._workIndex=5;break;case"string":case"bool":n=this._select,i=this._select,o=this._setAdditiveIdentityOther,this.buffer=new Array(5*r);break;default:n=this._lerp,i=this._lerpAdditive,o=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*r)}this._mixBufferRegion=n,this._mixBufferRegionAdditive=i,this._setIdentity=o,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){const r=this.buffer,n=this.valueSize,i=e*n+n;let o=this.cumulativeWeight;if(0===o){for(let e=0;e!==n;++e)r[i+e]=r[e];o=t}else{o+=t;const e=t/o;this._mixBufferRegion(r,i,0,e,n)}this.cumulativeWeight=o}accumulateAdditive(e){const t=this.buffer,r=this.valueSize,n=r*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(t,n,0,e,r),this.cumulativeWeightAdditive+=e}apply(e){const t=this.valueSize,r=this.buffer,n=e*t+t,i=this.cumulativeWeight,o=this.cumulativeWeightAdditive,s=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,i<1){const e=t*this._origIndex;this._mixBufferRegion(r,n,e,1-i,t)}o>0&&this._mixBufferRegionAdditive(r,n,this._addIndex*t,1,t);for(let e=t,i=t+t;e!==i;++e)if(r[e]!==r[e+t]){s.setValue(r,n);break}}saveOriginalState(){const e=this.binding,t=this.buffer,r=this.valueSize,n=r*this._origIndex;e.getValue(t,n);for(let e=r,i=n;e!==i;++e)t[e]=t[n+e%r];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=3*this.valueSize;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let r=e;r<t;r++)this.buffer[r]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let r=0;r<this.valueSize;r++)this.buffer[t+r]=this.buffer[e+r]}_select(e,t,r,n,i){if(n>=.5)for(let n=0;n!==i;++n)e[t+n]=e[r+n]}_slerp(e,t,r,n){On.slerpFlat(e,t,e,t,e,r,n)}_slerpAdditive(e,t,r,n,i){const o=this._workIndex*i;On.multiplyQuaternionsFlat(e,o,e,t,e,r),On.slerpFlat(e,t,e,t,e,o,n)}_lerp(e,t,r,n,i){const o=1-n;for(let s=0;s!==i;++s){const i=t+s;e[i]=e[i]*o+e[r+s]*n}}_lerpAdditive(e,t,r,n,i){for(let o=0;o!==i;++o){const i=t+o;e[i]=e[i]+e[r+o]*n}}}const $d="\\[\\]\\.:\\/",ef=new RegExp("["+$d+"]","g"),tf="[^"+$d+"]",rf="[^"+$d.replace("\\.","")+"]",nf=new RegExp("^"+/((?:WC+[\/:])*)/.source.replace("WC",tf)+/(WCOD+)?/.source.replace("WCOD",rf)+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",tf)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",tf)+"$"),of=["material","materials","bones","map"];class sf{constructor(e,t,r){this.path=t,this.parsedPath=r||sf.parseTrackName(t),this.node=sf.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,r){return e&&e.isAnimationObjectGroup?new sf.Composite(e,t,r):new sf(e,t,r)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(ef,"")}static parseTrackName(e){const t=nf.exec(e);if(null===t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const r={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},n=r.nodeName&&r.nodeName.lastIndexOf(".");if(void 0!==n&&-1!==n){const e=r.nodeName.substring(n+1);-1!==of.indexOf(e)&&(r.nodeName=r.nodeName.substring(0,n),r.objectName=e)}if(null===r.propertyName||0===r.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return r}static findNode(e,t){if(void 0===t||""===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){const r=e.skeleton.getBoneByName(t);if(void 0!==r)return r}if(e.children){const r=function(e){for(let n=0;n<e.length;n++){const i=e[n];if(i.name===t||i.uuid===t)return i;const o=r(i.children);if(o)return o}return null},n=r(e.children);if(n)return n}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const r=this.resolvedProperty;for(let n=0,i=r.length;n!==i;++n)e[t++]=r[n]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const r=this.resolvedProperty;for(let n=0,i=r.length;n!==i;++n)r[n]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const r=this.resolvedProperty;for(let n=0,i=r.length;n!==i;++n)r[n]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const r=this.resolvedProperty;for(let n=0,i=r.length;n!==i;++n)r[n]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,r=t.objectName,n=t.propertyName;let i=t.propertyIndex;if(e||(e=sf.findNode(this.rootNode,t.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e)return void console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");if(r){let n=t.objectIndex;switch(r){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(let t=0;t<e.length;t++)if(e[t].name===n){n=t;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.map)return void console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);e=e.material.map;break;default:if(void 0===e[r])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[r]}if(void 0!==n){if(void 0===e[n])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[n]}}const o=e[n];if(void 0===o){const r=t.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+r+"."+n+" but it wasn't found.",e)}let s=this.Versioning.None;this.targetObject=e,void 0!==e.needsUpdate?s=this.Versioning.NeedsUpdate:void 0!==e.matrixWorldNeedsUpdate&&(s=this.Versioning.MatrixWorldNeedsUpdate);let a=this.BindingType.Direct;if(void 0!==i){if("morphTargetInfluences"===n){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==e.morphTargetDictionary[i]&&(i=e.morphTargetDictionary[i])}a=this.BindingType.ArrayElement,this.resolvedProperty=o,this.propertyIndex=i}else void 0!==o.fromArray&&void 0!==o.toArray?(a=this.BindingType.HasFromToArray,this.resolvedProperty=o):Array.isArray(o)?(a=this.BindingType.EntireArray,this.resolvedProperty=o):this.propertyName=n;this.getValue=this.GetterByBindingType[a],this.setValue=this.SetterByBindingTypeAndVersioning[a][s]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}sf.Composite=class{constructor(e,t,r){const n=r||sf.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,n)}getValue(e,t){this.bind();const r=this._targetGroup.nCachedObjects_,n=this._bindings[r];void 0!==n&&n.getValue(e,t)}setValue(e,t){const r=this._bindings;for(let n=this._targetGroup.nCachedObjects_,i=r.length;n!==i;++n)r[n].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,r=e.length;t!==r;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,r=e.length;t!==r;++t)e[t].unbind()}},sf.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},sf.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},sf.prototype.GetterByBindingType=[sf.prototype._getValue_direct,sf.prototype._getValue_array,sf.prototype._getValue_arrayElement,sf.prototype._getValue_toArray],sf.prototype.SetterByBindingTypeAndVersioning=[[sf.prototype._setValue_direct,sf.prototype._setValue_direct_setNeedsUpdate,sf.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[sf.prototype._setValue_array,sf.prototype._setValue_array_setNeedsUpdate,sf.prototype._setValue_array_setMatrixWorldNeedsUpdate],[sf.prototype._setValue_arrayElement,sf.prototype._setValue_arrayElement_setNeedsUpdate,sf.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[sf.prototype._setValue_fromArray,sf.prototype._setValue_fromArray_setNeedsUpdate,sf.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class af{constructor(){this.isAnimationObjectGroup=!0,this.uuid=Xr(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const e={};this._indicesByUUID=e;for(let t=0,r=arguments.length;t!==r;++t)e[arguments[t].uuid]=t;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const t=this;this.stats={objects:{get total(){return t._objects.length},get inUse(){return this.total-t.nCachedObjects_}},get bindingsPerObject(){return t._bindings.length}}}add(){const e=this._objects,t=this._indicesByUUID,r=this._paths,n=this._parsedPaths,i=this._bindings,o=i.length;let s,a=e.length,c=this.nCachedObjects_;for(let l=0,u=arguments.length;l!==u;++l){const u=arguments[l],h=u.uuid;let p=t[h];if(void 0===p){p=a++,t[h]=p,e.push(u);for(let e=0,t=o;e!==t;++e)i[e].push(new sf(u,r[e],n[e]))}else if(p<c){s=e[p];const a=--c,l=e[a];t[l.uuid]=p,e[p]=l,t[h]=a,e[a]=u;for(let e=0,t=o;e!==t;++e){const t=i[e],o=t[a];let s=t[p];t[p]=o,void 0===s&&(s=new sf(u,r[e],n[e])),t[a]=s}}else e[p]!==s&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=c}remove(){const e=this._objects,t=this._indicesByUUID,r=this._bindings,n=r.length;let i=this.nCachedObjects_;for(let o=0,s=arguments.length;o!==s;++o){const s=arguments[o],a=s.uuid,c=t[a];if(void 0!==c&&c>=i){const o=i++,l=e[o];t[l.uuid]=c,e[c]=l,t[a]=o,e[o]=s;for(let e=0,t=n;e!==t;++e){const t=r[e],n=t[o],i=t[c];t[c]=n,t[o]=i}}}this.nCachedObjects_=i}uncache(){const e=this._objects,t=this._indicesByUUID,r=this._bindings,n=r.length;let i=this.nCachedObjects_,o=e.length;for(let s=0,a=arguments.length;s!==a;++s){const a=arguments[s].uuid,c=t[a];if(void 0!==c)if(delete t[a],c<i){const s=--i,a=e[s],l=--o,u=e[l];t[a.uuid]=c,e[c]=a,t[u.uuid]=s,e[s]=u,e.pop();for(let e=0,t=n;e!==t;++e){const t=r[e],n=t[s],i=t[l];t[c]=n,t[s]=i,t.pop()}}else{const i=--o,s=e[i];i>0&&(t[s.uuid]=c),e[c]=s,e.pop();for(let e=0,t=n;e!==t;++e){const t=r[e];t[c]=t[i],t.pop()}}}this.nCachedObjects_=i}subscribe_(e,t){const r=this._bindingsIndicesByPath;let n=r[e];const i=this._bindings;if(void 0!==n)return i[n];const o=this._paths,s=this._parsedPaths,a=this._objects,c=a.length,l=this.nCachedObjects_,u=new Array(c);n=i.length,r[e]=n,o.push(e),s.push(t),i.push(u);for(let r=l,n=a.length;r!==n;++r){const n=a[r];u[r]=new sf(n,e,t)}return u}unsubscribe_(e){const t=this._bindingsIndicesByPath,r=t[e];if(void 0!==r){const n=this._paths,i=this._parsedPaths,o=this._bindings,s=o.length-1,a=o[s];t[e[s]]=r,o[r]=a,o.pop(),i[r]=i[s],i.pop(),n[r]=n[s],n.pop()}}}class cf{constructor(e,t,r=null,n=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=r,this.blendMode=n;const i=t.tracks,o=i.length,s=new Array(o),a={endingStart:Ft,endingEnd:Ft};for(let e=0;e!==o;++e){const t=i[e].createInterpolant(null);s[e]=t,t.settings=a}this._interpolantSettings=a,this._interpolants=s,this._propertyBindings=new Array(o),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=Pt,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,r){if(e.fadeOut(t),this.fadeIn(t),r){const r=this._clip.duration,n=e._clip.duration,i=n/r,o=r/n;e.warp(1,i,t),this.warp(o,1,t)}return this}crossFadeTo(e,t,r){return e.crossFadeFrom(this,t,r)}stopFading(){const e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,r){const n=this._mixer,i=n.time,o=this.timeScale;let s=this._timeScaleInterpolant;null===s&&(s=n._lendControlInterpolant(),this._timeScaleInterpolant=s);const a=s.parameterPositions,c=s.sampleValues;return a[0]=i,a[1]=i+r,c[0]=e/o,c[1]=t/o,this}stopWarping(){const e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,r,n){if(!this.enabled)return void this._updateWeight(e);const i=this._startTime;if(null!==i){const n=(e-i)*r;n<0||0===r?t=0:(this._startTime=null,t=r*n)}t*=this._updateTimeScale(e);const o=this._updateTime(t),s=this._updateWeight(e);if(s>0){const e=this._interpolants,t=this._propertyBindings;if(this.blendMode===Gt)for(let r=0,n=e.length;r!==n;++r)e[r].evaluate(o),t[r].accumulateAdditive(s);else for(let r=0,i=e.length;r!==i;++r)e[r].evaluate(o),t[r].accumulate(n,s)}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const r=this._weightInterpolant;if(null!==r){const n=r.evaluate(e)[0];t*=n,e>r.parameterPositions[1]&&(this.stopFading(),0===n&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const r=this._timeScaleInterpolant;if(null!==r){t*=r.evaluate(e)[0],e>r.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t)}}return this._effectiveTimeScale=t,t}_updateTime(e){const t=this._clip.duration,r=this.loop;let n=this.time+e,i=this._loopCount;const o=r===Nt;if(0===e)return-1===i?n:o&&1==(1&i)?t-n:n;if(r===Ot){-1===i&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(n>=t)n=t;else{if(!(n<0)){this.time=n;break e}n=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(-1===i&&(e>=0?(i=0,this._setEndings(!0,0===this.repetitions,o)):this._setEndings(0===this.repetitions,!0,o)),n>=t||n<0){const r=Math.floor(n/t);n-=t*r,i+=Math.abs(r);const s=this.repetitions-i;if(s<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,n=e>0?t:0,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(1===s){const t=e<0;this._setEndings(t,!t,o)}else this._setEndings(!1,!1,o);this._loopCount=i,this.time=n,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:r})}}else this.time=n;if(o&&1==(1&i))return t-n}return n}_setEndings(e,t,r){const n=this._interpolantSettings;r?(n.endingStart=Bt,n.endingEnd=Bt):(n.endingStart=e?this.zeroSlopeAtStart?Bt:Ft:kt,n.endingEnd=t?this.zeroSlopeAtEnd?Bt:Ft:kt)}_scheduleFading(e,t,r){const n=this._mixer,i=n.time;let o=this._weightInterpolant;null===o&&(o=n._lendControlInterpolant(),this._weightInterpolant=o);const s=o.parameterPositions,a=o.sampleValues;return s[0]=i,a[0]=t,s[1]=i+e,a[1]=r,this}}const lf=new Float32Array(1);class uf extends Gr{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){const r=e._localRoot||this._root,n=e._clip.tracks,i=n.length,o=e._propertyBindings,s=e._interpolants,a=r.uuid,c=this._bindingsByRootAndName;let l=c[a];void 0===l&&(l={},c[a]=l);for(let e=0;e!==i;++e){const i=n[e],c=i.name;let u=l[c];if(void 0!==u)++u.referenceCount,o[e]=u;else{if(u=o[e],void 0!==u){null===u._cacheIndex&&(++u.referenceCount,this._addInactiveBinding(u,a,c));continue}const n=t&&t._propertyBindings[e].binding.parsedPath;u=new Qd(sf.create(r,c,n),i.ValueTypeName,i.getValueSize()),++u.referenceCount,this._addInactiveBinding(u,a,c),o[e]=u}s[e].resultBuffer=u.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){const t=(e._localRoot||this._root).uuid,r=e._clip.uuid,n=this._actionsByClip[r];this._bindAction(e,n&&n.knownActions[0]),this._addInactiveAction(e,r,t)}const t=e._propertyBindings;for(let e=0,r=t.length;e!==r;++e){const r=t[e];0==r.useCount++&&(this._lendBinding(r),r.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let e=0,r=t.length;e!==r;++e){const r=t[e];0==--r.useCount&&(r.restoreOriginalState(),this._takeBackBinding(r))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const t=e._cacheIndex;return null!==t&&t<this._nActiveActions}_addInactiveAction(e,t,r){const n=this._actions,i=this._actionsByClip;let o=i[t];if(void 0===o)o={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,i[t]=o;else{const t=o.knownActions;e._byClipCacheIndex=t.length,t.push(e)}e._cacheIndex=n.length,n.push(e),o.actionByRoot[r]=e}_removeInactiveAction(e){const t=this._actions,r=t[t.length-1],n=e._cacheIndex;r._cacheIndex=n,t[n]=r,t.pop(),e._cacheIndex=null;const i=e._clip.uuid,o=this._actionsByClip,s=o[i],a=s.knownActions,c=a[a.length-1],l=e._byClipCacheIndex;c._byClipCacheIndex=l,a[l]=c,a.pop(),e._byClipCacheIndex=null;delete s.actionByRoot[(e._localRoot||this._root).uuid],0===a.length&&delete o[i],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const t=e._propertyBindings;for(let e=0,r=t.length;e!==r;++e){const r=t[e];0==--r.referenceCount&&this._removeInactiveBinding(r)}}_lendAction(e){const t=this._actions,r=e._cacheIndex,n=this._nActiveActions++,i=t[n];e._cacheIndex=n,t[n]=e,i._cacheIndex=r,t[r]=i}_takeBackAction(e){const t=this._actions,r=e._cacheIndex,n=--this._nActiveActions,i=t[n];e._cacheIndex=n,t[n]=e,i._cacheIndex=r,t[r]=i}_addInactiveBinding(e,t,r){const n=this._bindingsByRootAndName,i=this._bindings;let o=n[t];void 0===o&&(o={},n[t]=o),o[r]=e,e._cacheIndex=i.length,i.push(e)}_removeInactiveBinding(e){const t=this._bindings,r=e.binding,n=r.rootNode.uuid,i=r.path,o=this._bindingsByRootAndName,s=o[n],a=t[t.length-1],c=e._cacheIndex;a._cacheIndex=c,t[c]=a,t.pop(),delete s[i],0===Object.keys(s).length&&delete o[n]}_lendBinding(e){const t=this._bindings,r=e._cacheIndex,n=this._nActiveBindings++,i=t[n];e._cacheIndex=n,t[n]=e,i._cacheIndex=r,t[r]=i}_takeBackBinding(e){const t=this._bindings,r=e._cacheIndex,n=--this._nActiveBindings,i=t[n];e._cacheIndex=n,t[n]=e,i._cacheIndex=r,t[r]=i}_lendControlInterpolant(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let r=e[t];return void 0===r&&(r=new Pp(new Float32Array(2),new Float32Array(2),1,lf),r.__cacheIndex=t,e[t]=r),r}_takeBackControlInterpolant(e){const t=this._controlInterpolants,r=e.__cacheIndex,n=--this._nActiveControlInterpolants,i=t[n];e.__cacheIndex=n,t[n]=e,i.__cacheIndex=r,t[r]=i}clipAction(e,t,r){const n=t||this._root,i=n.uuid;let o="string"==typeof e?zp.findByName(n,e):e;const s=null!==o?o.uuid:e,a=this._actionsByClip[s];let c=null;if(void 0===r&&(r=null!==o?o.blendMode:jt),void 0!==a){const e=a.actionByRoot[i];if(void 0!==e&&e.blendMode===r)return e;c=a.knownActions[0],null===o&&(o=c._clip)}if(null===o)return null;const l=new cf(this,o,t,r);return this._bindAction(l,c),this._addInactiveAction(l,s,i),l}existingAction(e,t){const r=t||this._root,n=r.uuid,i="string"==typeof e?zp.findByName(r,e):e,o=i?i.uuid:e,s=this._actionsByClip[o];return void 0!==s&&s.actionByRoot[n]||null}stopAllAction(){const e=this._actions;for(let t=this._nActiveActions-1;t>=0;--t)e[t].stop();return this}update(e){e*=this.timeScale;const t=this._actions,r=this._nActiveActions,n=this.time+=e,i=Math.sign(e),o=this._accuIndex^=1;for(let s=0;s!==r;++s){t[s]._update(n,e,i,o)}const s=this._bindings,a=this._nActiveBindings;for(let e=0;e!==a;++e)s[e].apply(o);return this}setTime(e){this.time=0;for(let e=0;e<this._actions.length;e++)this._actions[e].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const t=this._actions,r=e.uuid,n=this._actionsByClip,i=n[r];if(void 0!==i){const e=i.knownActions;for(let r=0,n=e.length;r!==n;++r){const n=e[r];this._deactivateAction(n);const i=n._cacheIndex,o=t[t.length-1];n._cacheIndex=null,n._byClipCacheIndex=null,o._cacheIndex=i,t[i]=o,t.pop(),this._removeInactiveBindingsForAction(n)}delete n[r]}}uncacheRoot(e){const t=e.uuid,r=this._actionsByClip;for(const e in r){const n=r[e].actionByRoot[t];void 0!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}const n=this._bindingsByRootAndName[t];if(void 0!==n)for(const e in n){const t=n[e];t.restoreOriginalState(),this._removeInactiveBinding(t)}}uncacheAction(e,t){const r=this.existingAction(e,t);null!==r&&(this._deactivateAction(r),this._removeInactiveAction(r))}}class hf{constructor(e){this.value=e}clone(){return new hf(void 0===this.value.clone?this.value:this.value.clone())}}let pf=0;class df extends Gr{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:pf++}),this.name="",this.usage=Rr,this.uniforms=[]}add(e){return this.uniforms.push(e),this}remove(e){const t=this.uniforms.indexOf(e);return-1!==t&&this.uniforms.splice(t,1),this}setName(e){return this.name=e,this}setUsage(e){return this.usage=e,this}dispose(){return this.dispatchEvent({type:"dispose"}),this}copy(e){this.name=e.name,this.usage=e.usage;const t=e.uniforms;this.uniforms.length=0;for(let e=0,r=t.length;e<r;e++){const r=Array.isArray(t[e])?t[e]:[t[e]];for(let e=0;e<r.length;e++)this.uniforms.push(r[e].clone())}return this}clone(){return(new this.constructor).copy(this)}}class ff extends sl{constructor(e,t,r=1){super(e,t),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=r}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}class mf{constructor(e,t,r,n,i){this.isGLBufferAttribute=!0,this.name="",this.buffer=e,this.type=t,this.itemSize=r,this.elementSize=n,this.count=i,this.version=0}set needsUpdate(e){!0===e&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,t){return this.type=e,this.elementSize=t,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}}const gf=new ci;class yf{constructor(e,t,r=0,n=1/0){this.ray=new ai(e,t),this.near=r,this.far=n,this.camera=null,this.layers=new _i,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}setFromXRController(e){return gf.identity().extractRotation(e.matrixWorld),this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(gf),this}intersectObject(e,t=!0,r=[]){return _f(e,this,r,t),r.sort(vf),r}intersectObjects(e,t=!0,r=[]){for(let n=0,i=e.length;n<i;n++)_f(e[n],this,r,t);return r.sort(vf),r}}function vf(e,t){return e.distance-t.distance}function _f(e,t,r,n){let i=!0;if(e.layers.test(t.layers)){!1===e.raycast(t,r)&&(i=!1)}if(!0===i&&!0===n){const n=e.children;for(let e=0,i=n.length;e<i;e++)_f(n[e],t,r,!0)}}class bf{constructor(e=1,t=0,r=0){return this.radius=e,this.phi=t,this.theta=r,this}set(e,t,r){return this.radius=e,this.phi=t,this.theta=r,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){const e=1e-6;return this.phi=Math.max(e,Math.min(Math.PI-e,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,r){return this.radius=Math.sqrt(e*e+t*t+r*r),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,r),this.phi=Math.acos(Yr(t/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}}class xf{constructor(e=1,t=0,r=0){return this.radius=e,this.theta=t,this.y=r,this}set(e,t,r){return this.radius=e,this.theta=t,this.y=r,this}copy(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,r){return this.radius=Math.sqrt(e*e+r*r),this.theta=Math.atan2(e,r),this.y=t,this}clone(){return(new this.constructor).copy(this)}}const wf=new $r;class Sf{constructor(e=new $r(1/0,1/0),t=new $r(-1/0,-1/0)){this.isBox2=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,r=e.length;t<r;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const r=wf.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,wf).distanceTo(e)}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const Mf=new Pn,Tf=new Pn;class Ef{constructor(e=new Pn,t=new Pn){this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){Mf.subVectors(e,this.start),Tf.subVectors(this.end,this.start);const r=Tf.dot(Tf);let n=Tf.dot(Mf)/r;return t&&(n=Yr(n,0,1)),n}closestPointToPoint(e,t,r){const n=this.closestPointToPointParameter(e,t);return this.delta(r).multiplyScalar(n).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return(new this.constructor).copy(this)}}const Af=new Pn;class Rf extends Ui{constructor(e,t){super(),this.light=e,this.matrixAutoUpdate=!1,this.color=t,this.type="SpotLightHelper";const r=new Ao,n=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let e=0,t=1,r=32;e<r;e++,t++){const i=e/r*Math.PI*2,o=t/r*Math.PI*2;n.push(Math.cos(i),Math.sin(i),1,Math.cos(o),Math.sin(o),1)}r.setAttribute("position",new _o(n,3));const i=new vu({fog:!1,toneMapped:!1});this.cone=new Iu(r,i),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),this.parent?(this.parent.updateWorldMatrix(!0),this.matrix.copy(this.parent.matrixWorld).invert().multiply(this.light.matrixWorld)):this.matrix.copy(this.light.matrixWorld),this.matrixWorld.copy(this.light.matrixWorld);const e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),Af.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(Af),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const Cf=new Pn,If=new ci,Of=new ci;class Pf extends Iu{constructor(e){const t=Nf(e),r=new Ao,n=[],i=[],o=new Zi(0,0,1),s=new Zi(0,1,0);for(let e=0;e<t.length;e++){const r=t[e];r.parent&&r.parent.isBone&&(n.push(0,0,0),n.push(0,0,0),i.push(o.r,o.g,o.b),i.push(s.r,s.g,s.b))}r.setAttribute("position",new _o(n,3)),r.setAttribute("color",new _o(i,3));super(r,new vu({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){const t=this.bones,r=this.geometry,n=r.getAttribute("position");Of.copy(this.root.matrixWorld).invert();for(let e=0,r=0;e<t.length;e++){const i=t[e];i.parent&&i.parent.isBone&&(If.multiplyMatrices(Of,i.matrixWorld),Cf.setFromMatrixPosition(If),n.setXYZ(r,Cf.x,Cf.y,Cf.z),If.multiplyMatrices(Of,i.parent.matrixWorld),Cf.setFromMatrixPosition(If),n.setXYZ(r+1,Cf.x,Cf.y,Cf.z),r+=2)}r.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose()}}function Nf(e){const t=[];!0===e.isBone&&t.push(e);for(let r=0;r<e.children.length;r++)t.push.apply(t,Nf(e.children[r]));return t}class Lf extends Wo{constructor(e,t,r){super(new sp(t,4,2),new to({wireframe:!0,fog:!1,toneMapped:!1})),this.light=e,this.color=r,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const Uf=new Pn,Df=new Zi,Ff=new Zi;class Bf extends Ui{constructor(e,t,r){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=r,this.type="HemisphereLightHelper";const n=new np(t);n.rotateY(.5*Math.PI),this.material=new to({wireframe:!0,fog:!1,toneMapped:!1}),void 0===this.color&&(this.material.vertexColors=!0);const i=n.getAttribute("position"),o=new Float32Array(3*i.count);n.setAttribute("color",new lo(o,3)),this.add(new Wo(n,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const e=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{const t=e.geometry.getAttribute("color");Df.copy(this.light.color),Ff.copy(this.light.groundColor);for(let e=0,r=t.count;e<r;e++){const n=e<r/2?Df:Ff;t.setXYZ(e,n.r,n.g,n.b)}t.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),e.lookAt(Uf.setFromMatrixPosition(this.light.matrixWorld).negate())}}class kf extends Iu{constructor(e=10,t=10,r=4473924,n=8947848){r=new Zi(r),n=new Zi(n);const i=t/2,o=e/t,s=e/2,a=[],c=[];for(let e=0,l=0,u=-s;e<=t;e++,u+=o){a.push(-s,0,u,s,0,u),a.push(u,0,-s,u,0,s);const t=e===i?r:n;t.toArray(c,l),l+=3,t.toArray(c,l),l+=3,t.toArray(c,l),l+=3,t.toArray(c,l),l+=3}const l=new Ao;l.setAttribute("position",new _o(a,3)),l.setAttribute("color",new _o(c,3));super(l,new vu({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}class jf extends Iu{constructor(e=10,t=16,r=8,n=64,i=4473924,o=8947848){i=new Zi(i),o=new Zi(o);const s=[],a=[];if(t>1)for(let r=0;r<t;r++){const n=r/t*(2*Math.PI),c=Math.sin(n)*e,l=Math.cos(n)*e;s.push(0,0,0),s.push(c,0,l);const u=1&r?i:o;a.push(u.r,u.g,u.b),a.push(u.r,u.g,u.b)}for(let t=0;t<r;t++){const c=1&t?i:o,l=e-e/r*t;for(let e=0;e<n;e++){let t=e/n*(2*Math.PI),r=Math.sin(t)*l,i=Math.cos(t)*l;s.push(r,0,i),a.push(c.r,c.g,c.b),t=(e+1)/n*(2*Math.PI),r=Math.sin(t)*l,i=Math.cos(t)*l,s.push(r,0,i),a.push(c.r,c.g,c.b)}}const c=new Ao;c.setAttribute("position",new _o(s,3)),c.setAttribute("color",new _o(a,3));super(c,new vu({vertexColors:!0,toneMapped:!1})),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const Gf=new Pn,zf=new Pn,Vf=new Pn;class Hf extends Ui{constructor(e,t,r){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=r,this.type="DirectionalLightHelper",void 0===t&&(t=1);let n=new Ao;n.setAttribute("position",new _o([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));const i=new vu({fog:!1,toneMapped:!1});this.lightPlane=new Eu(n,i),this.add(this.lightPlane),n=new Ao,n.setAttribute("position",new _o([0,0,0,0,0,1],3)),this.targetLine=new Eu(n,i),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),Gf.setFromMatrixPosition(this.light.matrixWorld),zf.setFromMatrixPosition(this.light.target.matrixWorld),Vf.subVectors(zf,Gf),this.lightPlane.lookAt(zf),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(zf),this.targetLine.scale.z=Vf.length()}}const Wf=new Pn,Xf=new $o;class Yf extends Iu{constructor(e){const t=new Ao,r=new vu({color:16777215,vertexColors:!0,toneMapped:!1}),n=[],i=[],o={};function s(e,t){a(e),a(t)}function a(e){n.push(0,0,0),i.push(0,0,0),void 0===o[e]&&(o[e]=[]),o[e].push(n.length/3-1)}s("n1","n2"),s("n2","n4"),s("n4","n3"),s("n3","n1"),s("f1","f2"),s("f2","f4"),s("f4","f3"),s("f3","f1"),s("n1","f1"),s("n2","f2"),s("n3","f3"),s("n4","f4"),s("p","n1"),s("p","n2"),s("p","n3"),s("p","n4"),s("u1","u2"),s("u2","u3"),s("u3","u1"),s("c","t"),s("p","c"),s("cn1","cn2"),s("cn3","cn4"),s("cf1","cf2"),s("cf3","cf4"),t.setAttribute("position",new _o(n,3)),t.setAttribute("color",new _o(i,3)),super(t,r),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=o,this.update();const c=new Zi(16755200),l=new Zi(16711680),u=new Zi(43775),h=new Zi(16777215),p=new Zi(3355443);this.setColors(c,l,u,h,p)}setColors(e,t,r,n,i){const o=this.geometry.getAttribute("color");o.setXYZ(0,e.r,e.g,e.b),o.setXYZ(1,e.r,e.g,e.b),o.setXYZ(2,e.r,e.g,e.b),o.setXYZ(3,e.r,e.g,e.b),o.setXYZ(4,e.r,e.g,e.b),o.setXYZ(5,e.r,e.g,e.b),o.setXYZ(6,e.r,e.g,e.b),o.setXYZ(7,e.r,e.g,e.b),o.setXYZ(8,e.r,e.g,e.b),o.setXYZ(9,e.r,e.g,e.b),o.setXYZ(10,e.r,e.g,e.b),o.setXYZ(11,e.r,e.g,e.b),o.setXYZ(12,e.r,e.g,e.b),o.setXYZ(13,e.r,e.g,e.b),o.setXYZ(14,e.r,e.g,e.b),o.setXYZ(15,e.r,e.g,e.b),o.setXYZ(16,e.r,e.g,e.b),o.setXYZ(17,e.r,e.g,e.b),o.setXYZ(18,e.r,e.g,e.b),o.setXYZ(19,e.r,e.g,e.b),o.setXYZ(20,e.r,e.g,e.b),o.setXYZ(21,e.r,e.g,e.b),o.setXYZ(22,e.r,e.g,e.b),o.setXYZ(23,e.r,e.g,e.b),o.setXYZ(24,t.r,t.g,t.b),o.setXYZ(25,t.r,t.g,t.b),o.setXYZ(26,t.r,t.g,t.b),o.setXYZ(27,t.r,t.g,t.b),o.setXYZ(28,t.r,t.g,t.b),o.setXYZ(29,t.r,t.g,t.b),o.setXYZ(30,t.r,t.g,t.b),o.setXYZ(31,t.r,t.g,t.b),o.setXYZ(32,r.r,r.g,r.b),o.setXYZ(33,r.r,r.g,r.b),o.setXYZ(34,r.r,r.g,r.b),o.setXYZ(35,r.r,r.g,r.b),o.setXYZ(36,r.r,r.g,r.b),o.setXYZ(37,r.r,r.g,r.b),o.setXYZ(38,n.r,n.g,n.b),o.setXYZ(39,n.r,n.g,n.b),o.setXYZ(40,i.r,i.g,i.b),o.setXYZ(41,i.r,i.g,i.b),o.setXYZ(42,i.r,i.g,i.b),o.setXYZ(43,i.r,i.g,i.b),o.setXYZ(44,i.r,i.g,i.b),o.setXYZ(45,i.r,i.g,i.b),o.setXYZ(46,i.r,i.g,i.b),o.setXYZ(47,i.r,i.g,i.b),o.setXYZ(48,i.r,i.g,i.b),o.setXYZ(49,i.r,i.g,i.b),o.needsUpdate=!0}update(){const e=this.geometry,t=this.pointMap;Xf.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),qf("c",t,e,Xf,0,0,-1),qf("t",t,e,Xf,0,0,1),qf("n1",t,e,Xf,-1,-1,-1),qf("n2",t,e,Xf,1,-1,-1),qf("n3",t,e,Xf,-1,1,-1),qf("n4",t,e,Xf,1,1,-1),qf("f1",t,e,Xf,-1,-1,1),qf("f2",t,e,Xf,1,-1,1),qf("f3",t,e,Xf,-1,1,1),qf("f4",t,e,Xf,1,1,1),qf("u1",t,e,Xf,.7,1.1,-1),qf("u2",t,e,Xf,-.7,1.1,-1),qf("u3",t,e,Xf,0,2,-1),qf("cf1",t,e,Xf,-1,0,1),qf("cf2",t,e,Xf,1,0,1),qf("cf3",t,e,Xf,0,-1,1),qf("cf4",t,e,Xf,0,1,1),qf("cn1",t,e,Xf,-1,0,-1),qf("cn2",t,e,Xf,1,0,-1),qf("cn3",t,e,Xf,0,-1,-1),qf("cn4",t,e,Xf,0,1,-1),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function qf(e,t,r,n,i,o,s){Wf.set(i,o,s).unproject(n);const a=t[e];if(void 0!==a){const e=r.getAttribute("position");for(let t=0,r=a.length;t<r;t++)e.setXYZ(a[t],Wf.x,Wf.y,Wf.z)}}const Jf=new Un;class Kf extends Iu{constructor(e,t=16776960){const r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new Float32Array(24),i=new Ao;i.setIndex(new lo(r,1)),i.setAttribute("position",new lo(n,3)),super(i,new vu({color:t,toneMapped:!1})),this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(e){if(void 0!==e&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&Jf.setFromObject(this.object),Jf.isEmpty())return;const t=Jf.min,r=Jf.max,n=this.geometry.attributes.position,i=n.array;i[0]=r.x,i[1]=r.y,i[2]=r.z,i[3]=t.x,i[4]=r.y,i[5]=r.z,i[6]=t.x,i[7]=t.y,i[8]=r.z,i[9]=r.x,i[10]=t.y,i[11]=r.z,i[12]=r.x,i[13]=r.y,i[14]=t.z,i[15]=t.x,i[16]=r.y,i[17]=t.z,i[18]=t.x,i[19]=t.y,i[20]=t.z,i[21]=r.x,i[22]=t.y,i[23]=t.z,n.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(e){return this.object=e,this.update(),this}copy(e,t){return super.copy(e,t),this.object=e.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class Zf extends Iu{constructor(e,t=16776960){const r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new Ao;n.setIndex(new lo(r,1)),n.setAttribute("position",new _o([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(n,new vu({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){const t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}dispose(){this.geometry.dispose(),this.material.dispose()}}class Qf extends Eu{constructor(e,t=1,r=16776960){const n=r,i=new Ao;i.setAttribute("position",new _o([1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],3)),i.computeBoundingSphere(),super(i,new vu({color:n,toneMapped:!1})),this.type="PlaneHelper",this.plane=e,this.size=t;const o=new Ao;o.setAttribute("position",new _o([1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],3)),o.computeBoundingSphere(),this.add(new Wo(o,new to({color:n,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const $f=new Pn;let em,tm;class rm extends Ui{constructor(e=new Pn(0,0,1),t=new Pn(0,0,0),r=1,n=16776960,i=.2*r,o=.2*i){super(),this.type="ArrowHelper",void 0===em&&(em=new Ao,em.setAttribute("position",new _o([0,0,0,0,1,0],3)),tm=new gh(0,.5,1,5,1),tm.translate(0,-.5,0)),this.position.copy(t),this.line=new Eu(em,new vu({color:n,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Wo(tm,new to({color:n,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(r,i,o)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{$f.set(e.z,0,-e.x).normalize();const t=Math.acos(e.y);this.quaternion.setFromAxisAngle($f,t)}}setLength(e,t=.2*e,r=.2*t){this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(r,t,r),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}class nm extends Iu{constructor(e=1){const t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],r=new Ao;r.setAttribute("position",new _o(t,3)),r.setAttribute("color",new _o([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));super(r,new vu({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}setColors(e,t,r){const n=new Zi,i=this.geometry.attributes.color.array;return n.set(e),n.toArray(i,0),n.toArray(i,3),n.set(t),n.toArray(i,6),n.toArray(i,9),n.set(r),n.toArray(i,12),n.toArray(i,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class im{constructor(){this.type="ShapePath",this.color=new Zi,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new ph,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){return this.currentPath.lineTo(e,t),this}quadraticCurveTo(e,t,r,n){return this.currentPath.quadraticCurveTo(e,t,r,n),this}bezierCurveTo(e,t,r,n,i,o){return this.currentPath.bezierCurveTo(e,t,r,n,i,o),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e){function t(e,t){const r=t.length;let n=!1;for(let i=r-1,o=0;o<r;i=o++){let r=t[i],s=t[o],a=s.x-r.x,c=s.y-r.y;if(Math.abs(c)>Number.EPSILON){if(c<0&&(r=t[o],a=-a,s=t[i],c=-c),e.y<r.y||e.y>s.y)continue;if(e.y===r.y){if(e.x===r.x)return!0}else{const t=c*(e.x-r.x)-a*(e.y-r.y);if(0===t)return!0;if(t<0)continue;n=!n}}else{if(e.y!==r.y)continue;if(s.x<=e.x&&e.x<=r.x||r.x<=e.x&&e.x<=s.x)return!0}}return n}const r=Zh.isClockWise,n=this.subPaths;if(0===n.length)return[];let i,o,s;const a=[];if(1===n.length)return o=n[0],s=new Th,s.curves=o.curves,a.push(s),a;let c=!r(n[0].getPoints());c=e?!c:c;const l=[],u=[];let h,p,d=[],f=0;u[f]=void 0,d[f]=[];for(let t=0,s=n.length;t<s;t++)o=n[t],h=o.getPoints(),i=r(h),i=e?!i:i,i?(!c&&u[f]&&f++,u[f]={s:new Th,p:h},u[f].s.curves=o.curves,c&&f++,d[f]=[]):d[f].push({h:o,p:h[0]});if(!u[0])return function(e){const t=[];for(let r=0,n=e.length;r<n;r++){const n=e[r],i=new Th;i.curves=n.curves,t.push(i)}return t}(n);if(u.length>1){let e=!1,r=0;for(let e=0,t=u.length;e<t;e++)l[e]=[];for(let n=0,i=u.length;n<i;n++){const i=d[n];for(let o=0;o<i.length;o++){const s=i[o];let a=!0;for(let i=0;i<u.length;i++)t(s.p,u[i].p)&&(n!==i&&r++,a?(a=!1,l[i].push(s)):e=!0);a&&l[n].push(s)}}r>0&&!1===e&&(d=l)}for(let e=0,t=u.length;e<t;e++){s=u[e].s,a.push(s),p=d[e];for(let e=0,t=p.length;e<t;e++)s.holes.push(p[e].h)}return a}}class om extends En{constructor(e=1,t=1,r=1,n={}){console.warn('THREE.WebGLMultipleRenderTargets has been deprecated and will be removed in r172. Use THREE.WebGLRenderTarget and set the "count" parameter to enable MRT.'),super(e,t,{...n,count:r}),this.isWebGLMultipleRenderTargets=!0}get texture(){return this.textures}}"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:n}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=n)},922:(e,t,r)=>{"use strict";r.d(t,{GZ:()=>H,HT:()=>F,T8:()=>j});var n=Uint8Array,i=Uint16Array,o=Int32Array,s=new n([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),a=new n([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),c=new n([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),l=function(e,t){for(var r=new i(31),n=0;n<31;++n)r[n]=t+=1<<e[n-1];var s=new o(r[30]);for(n=1;n<30;++n)for(var a=r[n];a<r[n+1];++a)s[a]=a-r[n]<<5|n;return{b:r,r:s}},u=l(s,2),h=u.b,p=u.r;h[28]=258,p[258]=28;for(var d=l(a,0),f=d.b,m=(d.r,new i(32768)),g=0;g<32768;++g){var y=(43690&g)>>1|(21845&g)<<1;y=(61680&(y=(52428&y)>>2|(13107&y)<<2))>>4|(3855&y)<<4,m[g]=((65280&y)>>8|(255&y)<<8)>>1}var v=function(e,t,r){for(var n=e.length,o=0,s=new i(t);o<n;++o)e[o]&&++s[e[o]-1];var a,c=new i(t);for(o=1;o<t;++o)c[o]=c[o-1]+s[o-1]<<1;if(r){a=new i(1<<t);var l=15-t;for(o=0;o<n;++o)if(e[o])for(var u=o<<4|e[o],h=t-e[o],p=c[e[o]-1]++<<h,d=p|(1<<h)-1;p<=d;++p)a[m[p]>>l]=u}else for(a=new i(n),o=0;o<n;++o)e[o]&&(a[o]=m[c[e[o]-1]++]>>15-e[o]);return a},_=new n(288);for(g=0;g<144;++g)_[g]=8;for(g=144;g<256;++g)_[g]=9;for(g=256;g<280;++g)_[g]=7;for(g=280;g<288;++g)_[g]=8;var b=new n(32);for(g=0;g<32;++g)b[g]=5;var x=v(_,9,1),w=v(b,5,1),S=function(e){for(var t=e[0],r=1;r<e.length;++r)e[r]>t&&(t=e[r]);return t},M=function(e,t,r){var n=t/8|0;return(e[n]|e[n+1]<<8)>>(7&t)&r},T=function(e,t){var r=t/8|0;return(e[r]|e[r+1]<<8|e[r+2]<<16)>>(7&t)},E=function(e){return(e+7)/8|0},A=function(e,t,r){return(null==t||t<0)&&(t=0),(null==r||r>e.length)&&(r=e.length),new n(e.subarray(t,r))},R=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],C=function(e,t,r){var n=new Error(t||R[e]);if(n.code=e,Error.captureStackTrace&&Error.captureStackTrace(n,C),!r)throw n;return n},I=function(e,t,r,i){var o=e.length,l=i?i.length:0;if(!o||t.f&&!t.l)return r||new n(0);var u=!r,p=u||2!=t.i,d=t.i;u&&(r=new n(3*o));var m=function(e){var t=r.length;if(e>t){var i=new n(Math.max(2*t,e));i.set(r),r=i}},g=t.f||0,y=t.p||0,_=t.b||0,b=t.l,R=t.d,I=t.m,O=t.n,P=8*o;do{if(!b){g=M(e,y,1);var N=M(e,y+1,3);if(y+=3,!N){var L=e[(W=E(y)+4)-4]|e[W-3]<<8,U=W+L;if(U>o){d&&C(0);break}p&&m(_+L),r.set(e.subarray(W,U),_),t.b=_+=L,t.p=y=8*U,t.f=g;continue}if(1==N)b=x,R=w,I=9,O=5;else if(2==N){var D=M(e,y,31)+257,F=M(e,y+10,15)+4,B=D+M(e,y+5,31)+1;y+=14;for(var k=new n(B),j=new n(19),G=0;G<F;++G)j[c[G]]=M(e,y+3*G,7);y+=3*F;var z=S(j),V=(1<<z)-1,H=v(j,z,1);for(G=0;G<B;){var W,X=H[M(e,y,V)];if(y+=15&X,(W=X>>4)<16)k[G++]=W;else{var Y=0,q=0;for(16==W?(q=3+M(e,y,3),y+=2,Y=k[G-1]):17==W?(q=3+M(e,y,7),y+=3):18==W&&(q=11+M(e,y,127),y+=7);q--;)k[G++]=Y}}var J=k.subarray(0,D),K=k.subarray(D);I=S(J),O=S(K),b=v(J,I,1),R=v(K,O,1)}else C(1);if(y>P){d&&C(0);break}}p&&m(_+131072);for(var Z=(1<<I)-1,Q=(1<<O)-1,$=y;;$=y){var ee=(Y=b[T(e,y)&Z])>>4;if((y+=15&Y)>P){d&&C(0);break}if(Y||C(2),ee<256)r[_++]=ee;else{if(256==ee){$=y,b=null;break}var te=ee-254;if(ee>264){var re=s[G=ee-257];te=M(e,y,(1<<re)-1)+h[G],y+=re}var ne=R[T(e,y)&Q],ie=ne>>4;ne||C(3),y+=15&ne;K=f[ie];if(ie>3){re=a[ie];K+=T(e,y)&(1<<re)-1,y+=re}if(y>P){d&&C(0);break}p&&m(_+131072);var oe=_+te;if(_<K){var se=l-K,ae=Math.min(K,oe);for(se+_<0&&C(3);_<ae;++_)r[_]=i[se+_]}for(;_<oe;++_)r[_]=r[_-K]}}t.l=b,t.p=$,t.b=_,t.f=g,b&&(g=1,t.m=I,t.d=R,t.n=O)}while(!g);return _!=r.length&&u?A(r,0,_):r.subarray(0,_)},O=new n(0),P=function(e,t){return e[t]|e[t+1]<<8},N=function(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0},L=function(e,t){return N(e,t)+4294967296*N(e,t+4)},U=function(e,t){return(8!=(15&e[0])||e[0]>>4>7||(e[0]<<8|e[1])%31)&&C(6,"invalid zlib data"),(e[1]>>5&1)==+!t&&C(6,"invalid zlib data: "+(32&e[1]?"need":"unexpected")+" dictionary"),2+(e[1]>>3&4)};function D(e,t){return I(e,{i:2},t&&t.out,t&&t.dictionary)}function F(e,t){return I(e.subarray(U(e,t&&t.dictionary),-4),{i:2},t&&t.out,t&&t.dictionary)}var B="undefined"!=typeof TextDecoder&&new TextDecoder;try{B.decode(O,{stream:!0}),1}catch(e){}var k=function(e){for(var t="",r=0;;){var n=e[r++],i=(n>127)+(n>223)+(n>239);if(r+i>e.length)return{s:t,r:A(e,r-1)};i?3==i?(n=((15&n)<<18|(63&e[r++])<<12|(63&e[r++])<<6|63&e[r++])-65536,t+=String.fromCharCode(55296|n>>10,56320|1023&n)):t+=1&i?String.fromCharCode((31&n)<<6|63&e[r++]):String.fromCharCode((15&n)<<12|(63&e[r++])<<6|63&e[r++]):t+=String.fromCharCode(n)}};function j(e,t){if(t){for(var r="",n=0;n<e.length;n+=16384)r+=String.fromCharCode.apply(null,e.subarray(n,n+16384));return r}if(B)return B.decode(e);var i=k(e),o=i.s;return(r=i.r).length&&C(8),o}var G=function(e,t){return t+30+P(e,t+26)+P(e,t+28)},z=function(e,t,r){var n=P(e,t+28),i=j(e.subarray(t+46,t+46+n),!(2048&P(e,t+8))),o=t+46+n,s=N(e,t+20),a=r&&4294967295==s?V(e,o):[s,N(e,t+24),N(e,t+42)],c=a[0],l=a[1],u=a[2];return[P(e,t+10),c,l,i,o+P(e,t+30)+P(e,t+32),u]},V=function(e,t){for(;1!=P(e,t);t+=4+P(e,t+2));return[L(e,t+12),L(e,t+4),L(e,t+20)]};"function"==typeof queueMicrotask?queueMicrotask:"function"==typeof setTimeout&&setTimeout;function H(e,t){for(var r={},i=e.length-22;101010256!=N(e,i);--i)(!i||e.length-i>65558)&&C(13);var o=P(e,i+8);if(!o)return{};var s=N(e,i+16),a=4294967295==s||65535==o;if(a){var c=N(e,i-12);(a=101075792==N(e,c))&&(o=N(e,c+32),s=N(e,c+48))}for(var l=t&&t.filter,u=0;u<o;++u){var h=z(e,s,a),p=h[0],d=h[1],f=h[2],m=h[3],g=h[4],y=h[5],v=G(e,y);s=g,l&&!l({name:m,size:d,originalSize:f,compression:p})||(p?8==p?r[m]=D(e.subarray(v,v+d),{out:new n(f)}):C(14,"unknown compression type "+p):r[m]=A(e,v,v+d))}return r}},27:(e,t,r)=>{"use strict";r.d(t,{U:()=>i});var n=r(24);class i extends n.DataTextureLoader{constructor(e){super(e)}parse(e){const t=0,r=1,i=2,o=3,s=9,a=10,c=11,l=48,u=4,h=0,p=1,d=2,f=3;if(e.length<19)throw new Error("THREE.TGALoader: Not enough data to contain header.");let m=0;const g=new Uint8Array(e),y={id_length:g[m++],colormap_type:g[m++],image_type:g[m++],colormap_index:g[m++]|g[m++]<<8,colormap_length:g[m++]|g[m++]<<8,colormap_size:g[m++],origin:[g[m++]|g[m++]<<8,g[m++]|g[m++]<<8],width:g[m++]|g[m++]<<8,height:g[m++]|g[m++]<<8,pixel_size:g[m++],flags:g[m++]};if(function(e){switch(e.image_type){case r:case s:if(e.colormap_length>256||24!==e.colormap_size||1!==e.colormap_type)throw new Error("THREE.TGALoader: Invalid type colormap data for indexed type.");break;case i:case o:case a:case c:if(e.colormap_type)throw new Error("THREE.TGALoader: Invalid type colormap data for colormap type.");break;case t:throw new Error("THREE.TGALoader: No data.");default:throw new Error("THREE.TGALoader: Invalid type "+e.image_type)}if(e.width<=0||e.height<=0)throw new Error("THREE.TGALoader: Invalid image size.");if(8!==e.pixel_size&&16!==e.pixel_size&&24!==e.pixel_size&&32!==e.pixel_size)throw new Error("THREE.TGALoader: Invalid pixel size "+e.pixel_size)}(y),y.id_length+m>e.length)throw new Error("THREE.TGALoader: No data.");m+=y.id_length;let v=!1,_=!1,b=!1;switch(y.image_type){case s:v=!0,_=!0;break;case r:_=!0;break;case a:v=!0;break;case i:break;case c:v=!0,b=!0;break;case o:b=!0}const x=new Uint8Array(y.width*y.height*4),w=function(e,t,r,n,i){let o,s;const a=r.pixel_size>>3,c=r.width*r.height*a;if(t&&(s=i.subarray(n,n+=r.colormap_length*(r.colormap_size>>3))),e){let e,t,r;o=new Uint8Array(c);let s=0;const l=new Uint8Array(a);for(;s<c;)if(e=i[n++],t=1+(127&e),128&e){for(r=0;r<a;++r)l[r]=i[n++];for(r=0;r<t;++r)o.set(l,s+r*a);s+=a*t}else{for(t*=a,r=0;r<t;++r)o[s+r]=i[n++];s+=t}}else o=i.subarray(n,n+=t?r.width*r.height:c);return{pixel_data:o,palettes:s}}(v,_,y,m,g);return function(e,t,r,n,i){let o,s,a,c,m,g;switch((y.flags&l)>>u){default:case d:o=0,a=1,m=t,s=0,c=1,g=r;break;case h:o=0,a=1,m=t,s=r-1,c=-1,g=-1;break;case f:o=t-1,a=-1,m=-1,s=0,c=1,g=r;break;case p:o=t-1,a=-1,m=-1,s=r-1,c=-1,g=-1}if(b)switch(y.pixel_size){case 8:!function(e,t,r,n,i,o,s,a){let c,l,u,h=0;const p=y.width;for(u=t;u!==n;u+=r)for(l=i;l!==s;l+=o,h++)c=a[h],e[4*(l+p*u)+0]=c,e[4*(l+p*u)+1]=c,e[4*(l+p*u)+2]=c,e[4*(l+p*u)+3]=255}(e,s,c,g,o,a,m,n);break;case 16:!function(e,t,r,n,i,o,s,a){let c,l,u=0;const h=y.width;for(l=t;l!==n;l+=r)for(c=i;c!==s;c+=o,u+=2)e[4*(c+h*l)+0]=a[u+0],e[4*(c+h*l)+1]=a[u+0],e[4*(c+h*l)+2]=a[u+0],e[4*(c+h*l)+3]=a[u+1]}(e,s,c,g,o,a,m,n);break;default:throw new Error("THREE.TGALoader: Format not supported.")}else switch(y.pixel_size){case 8:!function(e,t,r,n,i,o,s,a,c){const l=c;let u,h,p,d=0;const f=y.width;for(p=t;p!==n;p+=r)for(h=i;h!==s;h+=o,d++)u=a[d],e[4*(h+f*p)+3]=255,e[4*(h+f*p)+2]=l[3*u+0],e[4*(h+f*p)+1]=l[3*u+1],e[4*(h+f*p)+0]=l[3*u+2]}(e,s,c,g,o,a,m,n,i);break;case 16:!function(e,t,r,n,i,o,s,a){let c,l,u,h=0;const p=y.width;for(u=t;u!==n;u+=r)for(l=i;l!==s;l+=o,h+=2)c=a[h+0]+(a[h+1]<<8),e[4*(l+p*u)+0]=(31744&c)>>7,e[4*(l+p*u)+1]=(992&c)>>2,e[4*(l+p*u)+2]=(31&c)<<3,e[4*(l+p*u)+3]=32768&c?0:255}(e,s,c,g,o,a,m,n);break;case 24:!function(e,t,r,n,i,o,s,a){let c,l,u=0;const h=y.width;for(l=t;l!==n;l+=r)for(c=i;c!==s;c+=o,u+=3)e[4*(c+h*l)+3]=255,e[4*(c+h*l)+2]=a[u+0],e[4*(c+h*l)+1]=a[u+1],e[4*(c+h*l)+0]=a[u+2]}(e,s,c,g,o,a,m,n);break;case 32:!function(e,t,r,n,i,o,s,a){let c,l,u=0;const h=y.width;for(l=t;l!==n;l+=r)for(c=i;c!==s;c+=o,u+=4)e[4*(c+h*l)+2]=a[u+0],e[4*(c+h*l)+1]=a[u+1],e[4*(c+h*l)+0]=a[u+2],e[4*(c+h*l)+3]=a[u+3]}(e,s,c,g,o,a,m,n);break;default:throw new Error("THREE.TGALoader: Format not supported.")}}(x,y.width,y.height,w.pixel_data,w.palettes),{data:x,width:y.width,height:y.height,flipY:!0,generateMipmaps:!0,minFilter:n.LinearMipmapLinearFilter}}}},48:(e,t,r)=>{"use strict";r.d(t,{Vs:()=>i});var n=r(24);function i(e,t){if(t===n.TrianglesDrawMode)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),e;if(t===n.TriangleFanDrawMode||t===n.TriangleStripDrawMode){let r=e.getIndex();if(null===r){const t=[],n=e.getAttribute("position");if(void 0===n)return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(let e=0;e<n.count;e++)t.push(e);e.setIndex(t),r=e.getIndex()}const i=r.count-2,o=[];if(t===n.TriangleFanDrawMode)for(let e=1;e<=i;e++)o.push(r.getX(0)),o.push(r.getX(e)),o.push(r.getX(e+1));else for(let e=0;e<i;e++)e%2==0?(o.push(r.getX(e)),o.push(r.getX(e+1)),o.push(r.getX(e+2))):(o.push(r.getX(e+2)),o.push(r.getX(e+1)),o.push(r.getX(e)));o.length/3!==i&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const s=e.clone();return s.setIndex(o),s.clearGroups(),s}return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",t),e}},327:(e,t,r)=>{"use strict";r.d(t,{Pp:()=>A,WC:()=>Pe});class n{constructor(){this._listeners={}}addEventListener(e,t){const r=this._listeners;return void 0===r[e]&&(r[e]=[]),-1===r[e].indexOf(t)&&r[e].push(t),this}removeEventListener(e,t){if(void 0===this._listeners)return this;const r=this._listeners[e];if(void 0!==r){const e=r.indexOf(t);-1!==e&&r.splice(e,1)}return this}dispatchEvent(e){if(void 0===this._listeners)return this;const t=this._listeners[e.type];if(void 0!==t){const r=t.slice(0);for(let t=0,n=r.length;t<n;t++)r[t].call(this,e)}return this}dispose(){for(const e in this._listeners)delete this._listeners[e]}}class i extends n{constructor(e,t,r,n={}){if(super(),this._name=void 0,this._parent=void 0,this._child=void 0,this._attributes=void 0,this._disposed=!1,this._name=e,this._parent=t,this._child=r,this._attributes=n,!t.isOnGraph(r))throw new Error("Cannot connect disconnected graphs.")}getName(){return this._name}getParent(){return this._parent}getChild(){return this._child}setChild(e){return this._child=e,this}getAttributes(){return this._attributes}dispose(){this._disposed||(this._disposed=!0,this.dispatchEvent({type:"dispose",target:this}),super.dispose())}isDisposed(){return this._disposed}}class o extends n{constructor(...e){super(...e),this._emptySet=new Set,this._edges=new Set,this._parentEdges=new Map,this._childEdges=new Map}listEdges(){return Array.from(this._edges)}listParentEdges(e){return Array.from(this._childEdges.get(e)||this._emptySet)}listParents(e){return this.listParentEdges(e).map((e=>e.getParent()))}listChildEdges(e){return Array.from(this._parentEdges.get(e)||this._emptySet)}listChildren(e){return this.listChildEdges(e).map((e=>e.getChild()))}disconnectParents(e,t){let r=this.listParentEdges(e);return t&&(r=r.filter((e=>t(e.getParent())))),r.forEach((e=>e.dispose())),this}createEdge(e,t,r,n){return this._registerEdge(new i(e,t,r,n))}_registerEdge(e){this._edges.add(e);const t=e.getParent();this._parentEdges.has(t)||this._parentEdges.set(t,new Set),this._parentEdges.get(t).add(e);const r=e.getChild();return this._childEdges.has(r)||this._childEdges.set(r,new Set),this._childEdges.get(r).add(e),e.addEventListener("dispose",(()=>this._removeEdge(e))),e}_removeEdge(e){return this._edges.delete(e),this._parentEdges.get(e.getParent()).delete(e),this._childEdges.get(e.getChild()).delete(e),this}}function s(){return s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},s.apply(this,arguments)}function a(e){return e instanceof i}function c(e){return Array.isArray(e)&&e[0]instanceof i}function l(e){return!!(function(e){return Boolean(e)&&Object.getPrototypeOf(e)===Object.prototype}(e)&&function(e){for(const t in e)return e[t]}(e)instanceof i)}const u=Symbol("attributes"),h=Symbol("immutableKeys");class p extends n{constructor(e){super(),this._disposed=!1,this.graph=void 0,this[u]=void 0,this[h]=void 0,this.graph=e,this[h]=new Set,this[u]=this._createAttributes()}getDefaults(){return{}}_createAttributes(){const e=this.getDefaults(),t={};for(const r in e){const n=e[r];if(n instanceof p){const e=this.graph.createEdge(r,this,n);e.addEventListener("dispose",(()=>n.dispose())),this[h].add(r),t[r]=e}else t[r]=n}return t}isOnGraph(e){return this.graph===e.graph}isDisposed(){return this._disposed}dispose(){this._disposed||(this.graph.listChildEdges(this).forEach((e=>e.dispose())),this.graph.disconnectParents(this),this._disposed=!0,this.dispatchEvent({type:"dispose"}))}detach(){return this.graph.disconnectParents(this),this}swap(e,t){for(const r in this[u]){const n=this[u][r];if(a(n)){const i=n;i.getChild()===e&&this.setRef(r,t,i.getAttributes())}else if(c(n)){const i=n.find((t=>t.getChild()===e));if(i){const n=i.getAttributes();this.removeRef(r,e).addRef(r,t,n)}}else if(l(n)){const i=n;for(const n in i){const o=i[n];o.getChild()===e&&this.setRefMap(r,n,t,o.getAttributes())}}}return this}get(e){return this[u][e]}set(e,t){return this[u][e]=t,this.dispatchEvent({type:"change",attribute:e})}getRef(e){const t=this[u][e];return t?t.getChild():null}setRef(e,t,r){if(this[h].has(e))throw new Error(`Cannot overwrite immutable attribute, "${e}".`);const n=this[u][e];if(n&&n.dispose(),!t)return this;const i=this.graph.createEdge(e,this,t,r);return i.addEventListener("dispose",(()=>{delete this[u][e],this.dispatchEvent({type:"change",attribute:e})})),this[u][e]=i,this.dispatchEvent({type:"change",attribute:e})}listRefs(e){return this[u][e].map((e=>e.getChild()))}addRef(e,t,r){const n=this.graph.createEdge(e,this,t,r),i=this[u][e];return i.push(n),n.addEventListener("dispose",(()=>{let t;for(;-1!==(t=i.indexOf(n));)i.splice(t,1);this.dispatchEvent({type:"change",attribute:e})})),this.dispatchEvent({type:"change",attribute:e})}removeRef(e,t){return this[u][e].filter((e=>e.getChild()===t)).forEach((e=>e.dispose())),this}listRefMapKeys(e){return Object.keys(this[u][e])}listRefMapValues(e){return Object.values(this[u][e]).map((e=>e.getChild()))}getRefMap(e,t){const r=this[u][e];return r[t]?r[t].getChild():null}setRefMap(e,t,r,n){const i=this[u][e],o=i[t];if(o&&o.dispose(),!r)return this;n=Object.assign(n||{},{key:t});const a=this.graph.createEdge(e,this,r,s({},n,{key:t}));return a.addEventListener("dispose",(()=>{delete i[t],this.dispatchEvent({type:"change",attribute:e,key:t})})),i[t]=a,this.dispatchEvent({type:"change",attribute:e,key:t})}dispatchEvent(e){return super.dispatchEvent(s({},e,{target:this})),this.graph.dispatchEvent(s({},e,{target:this,type:`node:${e.type}`})),this}}const d="v3.0.0-alpha.5",f="@glb.bin";var m,g,y,v,_;!function(e){e.ACCESSOR="Accessor",e.ANIMATION="Animation",e.ANIMATION_CHANNEL="AnimationChannel",e.ANIMATION_SAMPLER="AnimationSampler",e.BUFFER="Buffer",e.CAMERA="Camera",e.MATERIAL="Material",e.MESH="Mesh",e.PRIMITIVE="Primitive",e.PRIMITIVE_TARGET="PrimitiveTarget",e.NODE="Node",e.ROOT="Root",e.SCENE="Scene",e.SKIN="Skin",e.TEXTURE="Texture",e.TEXTURE_INFO="TextureInfo"}(m||(m={})),function(e){e.INTERLEAVED="interleaved",e.SEPARATE="separate"}(g||(g={})),function(e){e.ARRAY_BUFFER="ARRAY_BUFFER",e.ELEMENT_ARRAY_BUFFER="ELEMENT_ARRAY_BUFFER",e.INVERSE_BIND_MATRICES="INVERSE_BIND_MATRICES",e.OTHER="OTHER",e.SPARSE="SPARSE"}(y||(y={})),function(e){e[e.R=4096]="R",e[e.G=256]="G",e[e.B=16]="B",e[e.A=1]="A"}(v||(v={})),function(e){e.GLTF="GLTF",e.GLB="GLB"}(_||(_={}));const b={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};var x,w="undefined"!=typeof Float32Array?Float32Array:Array;function S(e){return Math.hypot(e[0],e[1],e[2])}Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)}),x=new w(3),w!=Float32Array&&(x[0]=0,x[1]=0,x[2]=0);class M{static createBufferFromDataURI(e){if("undefined"==typeof Buffer){const t=atob(e.split(",")[1]),r=new Uint8Array(t.length);for(let e=0;e<t.length;e++)r[e]=t.charCodeAt(e);return r}{const t=e.split(",")[1],r=e.indexOf("base64")>=0;return Buffer.from(t,r?"base64":"utf8")}}static encodeText(e){return"undefined"!=typeof TextEncoder?(new TextEncoder).encode(e):Buffer.from(e)}static decodeText(e){return"undefined"!=typeof TextDecoder?(new TextDecoder).decode(e):Buffer.from(e).toString("utf8")}static concat(e){let t=0;for(const r of e)t+=r.byteLength;const r=new Uint8Array(t);let n=0;for(const t of e)r.set(t,n),n+=t.byteLength;return r}static pad(e,t=0){const r=this.padNumber(e.byteLength);if(r===e.byteLength)return e;const n=new Uint8Array(r);if(n.set(e),0!==t)for(let i=e.byteLength;i<r;i++)n[i]=t;return n}static padNumber(e){return 4*Math.ceil(e/4)}static equals(e,t){if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;let r=e.byteLength;for(;r--;)if(e[r]!==t[r])return!1;return!0}static toView(e,t=0,r=1/0){return new Uint8Array(e.buffer,e.byteOffset+t,Math.min(e.byteLength,r))}static assertView(e){if(e&&!ArrayBuffer.isView(e))throw new Error(`Method requires Uint8Array parameter; received "${typeof e}".`);return e}}class T{static hexToFactor(e,t){e=Math.floor(e);const r=t;return r[0]=(e>>16&255)/255,r[1]=(e>>8&255)/255,r[2]=(255&e)/255,this.convertSRGBToLinear(t,t)}static factorToHex(e){const t=[...e],[r,n,i]=this.convertLinearToSRGB(e,t);return 255*r<<16^255*n<<8^255*i<<0}static convertSRGBToLinear(e,t){const r=e,n=t;for(let e=0;e<3;e++)n[e]=r[e]<.04045?.0773993808*r[e]:Math.pow(.9478672986*r[e]+.0521327014,2.4);return t}static convertLinearToSRGB(e,t){const r=e,n=t;for(let e=0;e<3;e++)n[e]=r[e]<.0031308?12.92*r[e]:1.055*Math.pow(r[e],.41666)-.055;return t}}class E{match(e){return e.length>=8&&137===e[0]&&80===e[1]&&78===e[2]&&71===e[3]&&13===e[4]&&10===e[5]&&26===e[6]&&10===e[7]}getSize(e){const t=new DataView(e.buffer,e.byteOffset);return M.decodeText(e.slice(12,16))===E.PNG_FRIED_CHUNK_NAME?[t.getUint32(32,!1),t.getUint32(36,!1)]:[t.getUint32(16,!1),t.getUint32(20,!1)]}getChannels(e){return 4}}E.PNG_FRIED_CHUNK_NAME="CgBI";class A{static registerFormat(e,t){this.impls[e]=t}static getMimeType(e){for(const t in this.impls)if(this.impls[t].match(e))return t;return null}static getSize(e,t){return this.impls[t]?this.impls[t].getSize(e):null}static getChannels(e,t){return this.impls[t]?this.impls[t].getChannels(e):null}static getGPUByteLength(e,t){if(!this.impls[t])return null;if(this.impls[t].getGPUByteLength)return this.impls[t].getGPUByteLength(e);let r=0;const n=this.getSize(e,t);if(!n)return null;for(;n[0]>1||n[1]>1;)r+=n[0]*n[1]*4,n[0]=Math.max(Math.floor(n[0]/2),1),n[1]=Math.max(Math.floor(n[1]/2),1);return r+=4,r}static mimeTypeToExtension(e){return"image/jpeg"===e?"jpg":e.split("/").pop()}static extensionToMimeType(e){return"jpg"===e?"image/jpeg":e?`image/${e}`:""}}function R(e,t){if(t>e.byteLength)throw new TypeError("Corrupt JPG, exceeded buffer limits");if(255!==e.getUint8(t))throw new TypeError("Invalid JPG, marker table corrupted");return e}A.impls={"image/jpeg":new class{match(e){return e.length>=3&&255===e[0]&&216===e[1]&&255===e[2]}getSize(e){let t,r,n=new DataView(e.buffer,e.byteOffset+4);for(;n.byteLength;){if(t=n.getUint16(0,!1),R(n,t),r=n.getUint8(t+1),192===r||193===r||194===r)return[n.getUint16(t+7,!1),n.getUint16(t+5,!1)];n=new DataView(e.buffer,n.byteOffset+t+2)}throw new TypeError("Invalid JPG, no size found")}getChannels(e){return 3}},"image/png":new E};class C{static basename(e){const t=e.split(/[\\/]/).pop();return t.substring(0,t.lastIndexOf("."))}static extension(e){if(e.startsWith("data:image/")){const t=e.match(/data:(image\/\w+)/)[1];return A.mimeTypeToExtension(t)}return e.startsWith("data:model/gltf+json")?"gltf":e.startsWith("data:model/gltf-binary")?"glb":e.startsWith("data:application/")?"bin":e.split(/[\\/]/).pop().split(/[.]/).pop()}}function I(e){return"[object Object]"===Object.prototype.toString.call(e)}function O(e){if(!1===I(e))return!1;const t=e.constructor;if(void 0===t)return!0;const r=t.prototype;return!1!==I(r)&&!1!==Object.prototype.hasOwnProperty.call(r,"isPrototypeOf")}var P;!function(e){e[e.SILENT=4]="SILENT",e[e.ERROR=3]="ERROR",e[e.WARN=2]="WARN",e[e.INFO=1]="INFO",e[e.DEBUG=0]="DEBUG"}(P||(P={}));class N{constructor(e){this.verbosity=e}debug(e){this.verbosity<=N.Verbosity.DEBUG&&console.debug(e)}info(e){this.verbosity<=N.Verbosity.INFO&&console.info(e)}warn(e){this.verbosity<=N.Verbosity.WARN&&console.warn(e)}error(e){this.verbosity<=N.Verbosity.ERROR&&console.error(e)}}function L(e,t,r){var n=t[0],i=t[1],o=t[2],s=t[3],a=t[4],c=t[5],l=t[6],u=t[7],h=t[8],p=t[9],d=t[10],f=t[11],m=t[12],g=t[13],y=t[14],v=t[15],_=r[0],b=r[1],x=r[2],w=r[3];return e[0]=_*n+b*a+x*h+w*m,e[1]=_*i+b*c+x*p+w*g,e[2]=_*o+b*l+x*d+w*y,e[3]=_*s+b*u+x*f+w*v,e[4]=(_=r[4])*n+(b=r[5])*a+(x=r[6])*h+(w=r[7])*m,e[5]=_*i+b*c+x*p+w*g,e[6]=_*o+b*l+x*d+w*y,e[7]=_*s+b*u+x*f+w*v,e[8]=(_=r[8])*n+(b=r[9])*a+(x=r[10])*h+(w=r[11])*m,e[9]=_*i+b*c+x*p+w*g,e[10]=_*o+b*l+x*d+w*y,e[11]=_*s+b*u+x*f+w*v,e[12]=(_=r[12])*n+(b=r[13])*a+(x=r[14])*h+(w=r[15])*m,e[13]=_*i+b*c+x*p+w*g,e[14]=_*o+b*l+x*d+w*y,e[15]=_*s+b*u+x*f+w*v,e}N.Verbosity=P,N.DEFAULT_INSTANCE=new N(N.Verbosity.INFO);class U{static identity(e){return e}static eq(e,t,r=1e-5){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(Math.abs(e[n]-t[n])>r)return!1;return!0}static decodeNormalizedInt(e,t){switch(t){case 5126:return e;case 5123:return e/65535;case 5121:return e/255;case 5122:return Math.max(e/32767,-1);case 5120:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}static denormalize(e,t){return U.decodeNormalizedInt(e,t)}static encodeNormalizedInt(e,t){switch(t){case 5126:return e;case 5123:return Math.round(65535*e);case 5121:return Math.round(255*e);case 5122:return Math.round(32767*e);case 5120:return Math.round(127*e);default:throw new Error("Invalid component type.")}}static normalize(e,t){return U.encodeNormalizedInt(e,t)}static decompose(e,t,r,n){let i=S([e[0],e[1],e[2]]);const o=S([e[4],e[5],e[6]]),s=S([e[8],e[9],e[10]]);var a,c,l,u,h,p,d,f,m,g,y,v,_,b,x,M,T;((c=(a=e)[0])*(d=a[5])-(l=a[1])*(p=a[4]))*((v=a[10])*(T=a[15])-(_=a[11])*(M=a[14]))-(c*(f=a[6])-(u=a[2])*p)*((y=a[9])*T-_*(x=a[13]))+(c*(m=a[7])-(h=a[3])*p)*(y*M-v*x)+(l*f-u*d)*((g=a[8])*T-_*(b=a[12]))-(l*m-h*d)*(g*M-v*b)+(u*m-h*f)*(g*x-y*b)<0&&(i=-i),t[0]=e[12],t[1]=e[13],t[2]=e[14];const E=e.slice(),A=1/i,R=1/o,C=1/s;E[0]*=A,E[1]*=A,E[2]*=A,E[4]*=R,E[5]*=R,E[6]*=R,E[8]*=C,E[9]*=C,E[10]*=C,function(e,t){var r=new w(3);!function(e,t){var r=t[4],n=t[5],i=t[6],o=t[8],s=t[9],a=t[10];e[0]=Math.hypot(t[0],t[1],t[2]),e[1]=Math.hypot(r,n,i),e[2]=Math.hypot(o,s,a)}(r,t);var n=1/r[0],i=1/r[1],o=1/r[2],s=t[0]*n,a=t[1]*i,c=t[2]*o,l=t[4]*n,u=t[5]*i,h=t[6]*o,p=t[8]*n,d=t[9]*i,f=t[10]*o,m=s+u+f,g=0;m>0?(g=2*Math.sqrt(m+1),e[3]=.25*g,e[0]=(h-d)/g,e[1]=(p-c)/g,e[2]=(a-l)/g):s>u&&s>f?(g=2*Math.sqrt(1+s-u-f),e[3]=(h-d)/g,e[0]=.25*g,e[1]=(a+l)/g,e[2]=(p+c)/g):u>f?(g=2*Math.sqrt(1+u-s-f),e[3]=(p-c)/g,e[0]=(a+l)/g,e[1]=.25*g,e[2]=(h+d)/g):(g=2*Math.sqrt(1+f-s-u),e[3]=(a-l)/g,e[0]=(p+c)/g,e[1]=(h+d)/g,e[2]=.25*g)}(r,E),n[0]=i,n[1]=o,n[2]=s}static compose(e,t,r,n){const i=n,o=t[0],s=t[1],a=t[2],c=t[3],l=o+o,u=s+s,h=a+a,p=o*l,d=o*u,f=o*h,m=s*u,g=s*h,y=a*h,v=c*l,_=c*u,b=c*h,x=r[0],w=r[1],S=r[2];return i[0]=(1-(m+y))*x,i[1]=(d+b)*x,i[2]=(f-_)*x,i[3]=0,i[4]=(d-b)*w,i[5]=(1-(p+y))*w,i[6]=(g+v)*w,i[7]=0,i[8]=(f+_)*S,i[9]=(g-v)*S,i[10]=(1-(p+m))*S,i[11]=0,i[12]=e[0],i[13]=e[1],i[14]=e[2],i[15]=1,i}}function D(e,t){if(!!e!=!!t)return!1;const r=e.getChild(),n=t.getChild();return r===n||r.equals(n)}function F(e,t){if(!!e!=!!t)return!1;if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++){const n=e[r],i=t[r];if(n.getChild()!==i.getChild()&&!n.getChild().equals(i.getChild()))return!1}return!0}function B(e,t){if(!!e!=!!t)return!1;const r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;for(const r in e){const n=e[r],i=t[r];if(!!n!=!!i)return!1;const o=n.getChild(),s=i.getChild();if(o!==s&&!o.equals(s))return!1}return!0}function k(e,t){if(e===t)return!0;if(!!e!=!!t||!e||!t)return!1;if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}function j(e,t){if(e===t)return!0;if(!!e!=!!t)return!1;if(!O(e)||!O(t))return e===t;const r=e,n=t;let i,o=0,s=0;for(i in r)o++;for(i in n)s++;if(o!==s)return!1;for(i in r){const e=r[i],t=n[i];if(G(e)&&G(t)){if(!k(e,t))return!1}else if(O(e)&&O(t)){if(!j(e,t))return!1}else if(e!==t)return!1}return!0}function G(e){return Array.isArray(e)||ArrayBuffer.isView(e)}const z=new Set,V=function(){let e="";for(let t=0;t<6;t++)e+="23456789abdegjkmnpqrvwxyzABDEGJKMNPQRVWXYZ".charAt(Math.floor(42*Math.random()));return e},H="https://null.example";class W{static dirname(e){const t=e.lastIndexOf("/");return-1===t?"./":e.substring(0,t+1)}static basename(e){return C.basename(new URL(e,H).pathname)}static extension(e){return C.extension(new URL(e,H).pathname)}static resolve(e,t){if(!this.isRelativePath(t))return t;const r=e.split("/"),n=t.split("/");r.pop();for(let e=0;e<n.length;e++)"."!==n[e]&&(".."===n[e]?r.pop():r.push(n[e]));return r.join("/")}static isAbsoluteURL(e){return this.PROTOCOL_REGEXP.test(e)}static isRelativePath(e){return!/^(?:[a-zA-Z]+:)?\//.test(e)}}W.DEFAULT_INIT={},W.PROTOCOL_REGEXP=/^[a-zA-Z]+:\/\//;const X=e=>e,Y=new Set;class q extends p{constructor(e,t=""){super(e),this[u].name=t,this.init(),this.dispatchEvent({type:"create"})}getGraph(){return this.graph}getDefaults(){return Object.assign(super.getDefaults(),{name:"",extras:{}})}set(e,t){return Array.isArray(t)&&(t=t.slice()),super.set(e,t)}getName(){return this.get("name")}setName(e){return this.set("name",e)}getExtras(){return this.get("extras")}setExtras(e){return this.set("extras",e)}clone(){return new(0,this.constructor)(this.graph).copy(this,X)}copy(e,t=X){for(const e in this[u]){const t=this[u][e];if(t instanceof i)this[h].has(e)||t.dispose();else if(c(t))for(const e of t)e.dispose();else if(l(t))for(const e in t)t[e].dispose()}for(const r in e[u]){const n=this[u][r],o=e[u][r];if(o instanceof i)this[h].has(r)?n.getChild().copy(t(o.getChild()),t):this.setRef(r,t(o.getChild()),o.getAttributes());else if(c(o))for(const e of o)this.addRef(r,t(e.getChild()),e.getAttributes());else if(l(o))for(const e in o){const n=o[e];this.setRefMap(r,e,t(n.getChild()),n.getAttributes())}else this[u][r]=O(o)?JSON.parse(JSON.stringify(o)):Array.isArray(o)||o instanceof ArrayBuffer||ArrayBuffer.isView(o)?o.slice():o}return this}equals(e,t=Y){if(this===e)return!0;if(this.propertyType!==e.propertyType)return!1;for(const r in this[u]){if(t.has(r))continue;const n=this[u][r],i=e[u][r];if(a(n)||a(i)){if(!D(n,i))return!1}else if(c(n)||c(i)){if(!F(n,i))return!1}else if(l(n)||l(i)){if(!B(n,i))return!1}else if(O(n)||O(i)){if(!j(n,i))return!1}else if(G(n)||G(i)){if(!k(n,i))return!1}else if(n!==i)return!1}return!0}detach(){return this.graph.disconnectParents(this,(e=>"Root"!==e.propertyType)),this}listParents(){return this.graph.listParents(this)}}class J extends q{getDefaults(){return Object.assign(super.getDefaults(),{extensions:{}})}getExtension(e){return this.getRefMap("extensions",e)}setExtension(e,t){return t&&t.t(this),this.setRefMap("extensions",e,t)}listExtensions(){return this.listRefMapValues("extensions")}}class K extends J{constructor(){super(...arguments),this.i=U.identity,this.o=U.identity}init(){this.propertyType=m.ACCESSOR}getDefaults(){return Object.assign(super.getDefaults(),{array:null,type:K.Type.SCALAR,componentType:K.ComponentType.FLOAT,normalized:!1,sparse:!1,buffer:null})}copy(e,t=X){return super.copy(e,t),this.i=e.i,this.o=e.o,this}static getElementSize(e){switch(e){case K.Type.SCALAR:return 1;case K.Type.VEC2:return 2;case K.Type.VEC3:return 3;case K.Type.VEC4:case K.Type.MAT2:return 4;case K.Type.MAT3:return 9;case K.Type.MAT4:return 16;default:throw new Error("Unexpected type: "+e)}}static getComponentSize(e){switch(e){case K.ComponentType.BYTE:case K.ComponentType.UNSIGNED_BYTE:return 1;case K.ComponentType.SHORT:case K.ComponentType.UNSIGNED_SHORT:return 2;case K.ComponentType.UNSIGNED_INT:case K.ComponentType.FLOAT:return 4;default:throw new Error("Unexpected component type: "+e)}}getMinNormalized(e){const t=this.getElementSize();this.getMin(e);for(let r=0;r<t;r++)e[r]=this.o(e[r]);return e}getMin(e){const t=this.get("array"),r=this.getCount(),n=this.getElementSize();for(let t=0;t<n;t++)e[t]=1/0;for(let i=0;i<r*n;i+=n)for(let r=0;r<n;r++){const n=t[i+r];Number.isFinite(n)&&(e[r]=Math.min(e[r],n))}return e}getMaxNormalized(e){const t=this.getElementSize();this.getMax(e);for(let r=0;r<t;r++)e[r]=this.o(e[r]);return e}getMax(e){const t=this.get("array"),r=this.getCount(),n=this.getElementSize();for(let t=0;t<n;t++)e[t]=-1/0;for(let i=0;i<r*n;i+=n)for(let r=0;r<n;r++){const n=t[i+r];Number.isFinite(n)&&(e[r]=Math.max(e[r],n))}return e}getCount(){const e=this.get("array");return e?e.length/this.getElementSize():0}getType(){return this.get("type")}setType(e){return this.set("type",e)}getElementSize(){return K.getElementSize(this.get("type"))}getComponentSize(){return this.get("array").BYTES_PER_ELEMENT}getComponentType(){return this.get("componentType")}getNormalized(){return this.get("normalized")}setNormalized(e){return this.set("normalized",e),e?(this.o=e=>U.decodeNormalizedInt(e,this.get("componentType")),this.i=e=>U.encodeNormalizedInt(e,this.get("componentType"))):(this.o=U.identity,this.i=U.identity),this}getScalar(e){const t=this.getElementSize();return this.o(this.get("array")[e*t])}setScalar(e,t){return this.get("array")[e*this.getElementSize()]=this.i(t),this}getElement(e,t){const r=this.getElementSize(),n=this.get("array");for(let i=0;i<r;i++)t[i]=this.o(n[e*r+i]);return t}setElement(e,t){const r=this.getElementSize(),n=this.get("array");for(let i=0;i<r;i++)n[e*r+i]=this.i(t[i]);return this}getSparse(){return this.get("sparse")}setSparse(e){return this.set("sparse",e)}getBuffer(){return this.getRef("buffer")}setBuffer(e){return this.setRef("buffer",e)}getArray(){return this.get("array")}setArray(e){return this.set("componentType",e?function(e){switch(e.constructor){case Float32Array:return K.ComponentType.FLOAT;case Uint32Array:return K.ComponentType.UNSIGNED_INT;case Uint16Array:return K.ComponentType.UNSIGNED_SHORT;case Uint8Array:return K.ComponentType.UNSIGNED_BYTE;case Int16Array:return K.ComponentType.SHORT;case Int8Array:return K.ComponentType.BYTE;default:throw new Error("Unknown accessor componentType.")}}(e):K.ComponentType.FLOAT),this.set("array",e),this}getByteLength(){const e=this.get("array");return e?e.byteLength:0}}K.Type={SCALAR:"SCALAR",VEC2:"VEC2",VEC3:"VEC3",VEC4:"VEC4",MAT2:"MAT2",MAT3:"MAT3",MAT4:"MAT4"},K.ComponentType={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,UNSIGNED_INT:5125,FLOAT:5126};class Z extends J{init(){this.propertyType=m.ANIMATION}getDefaults(){return Object.assign(super.getDefaults(),{channels:[],samplers:[],uuid:null})}addChannel(e){return this.addRef("channels",e)}removeChannel(e){return this.removeRef("channels",e)}listChannels(){return this.listRefs("channels")}addSampler(e){return this.addRef("samplers",e)}removeSampler(e){return this.removeRef("samplers",e)}listSamplers(){return this.listRefs("samplers")}getUuid(){return this.get("uuid")}setUuid(e){return this.set("uuid",e)}}class Q extends J{init(){this.propertyType=m.ANIMATION_CHANNEL}getDefaults(){return Object.assign(super.getDefaults(),{targetPath:null,targetNode:null,sampler:null})}getTargetPath(){return this.get("targetPath")}setTargetPath(e){return this.set("targetPath",e)}getTargetNode(){return this.getRef("targetNode")}setTargetNode(e){return this.setRef("targetNode",e)}getSampler(){return this.getRef("sampler")}setSampler(e){return this.setRef("sampler",e)}}Q.TargetPath={TRANSLATION:"translation",ROTATION:"rotation",SCALE:"scale",WEIGHTS:"weights"};class $ extends J{init(){this.propertyType=m.ANIMATION_SAMPLER}getDefaultAttributes(){return Object.assign(super.getDefaults(),{interpolation:$.Interpolation.LINEAR,input:null,output:null})}getInterpolation(){return this.get("interpolation")}setInterpolation(e){return this.set("interpolation",e)}getInput(){return this.getRef("input")}setInput(e){return this.setRef("input",e,{usage:y.OTHER})}getOutput(){return this.getRef("output")}setOutput(e){return this.setRef("output",e,{usage:y.OTHER})}}$.Interpolation={LINEAR:"LINEAR",STEP:"STEP",CUBICSPLINE:"CUBICSPLINE"};class ee extends J{init(){this.propertyType=m.BUFFER}getDefaults(){return Object.assign(super.getDefaults(),{uri:""})}getURI(){return this.get("uri")}setURI(e){return this.set("uri",e)}}class te extends J{init(){this.propertyType=m.CAMERA}getDefaults(){return Object.assign(super.getDefaults(),{type:te.Type.PERSPECTIVE,znear:.1,zfar:100,aspectRatio:null,yfov:2*Math.PI*50/360,xmag:1,ymag:1,uuid:null})}getType(){return this.get("type")}setType(e){return this.set("type",e)}getZNear(){return this.get("znear")}setZNear(e){return this.set("znear",e)}getZFar(){return this.get("zfar")}setZFar(e){return this.set("zfar",e)}getAspectRatio(){return this.get("aspectRatio")}setAspectRatio(e){return this.set("aspectRatio",e)}getYFov(){return this.get("yfov")}setYFov(e){return this.set("yfov",e)}getXMag(){return this.get("xmag")}setXMag(e){return this.set("xmag",e)}getYMag(){return this.get("ymag")}setYMag(e){return this.set("ymag",e)}getUuid(){return this.get("uuid")}setUuid(e){return this.set("uuid",e)}}te.Type={PERSPECTIVE:"perspective",ORTHOGRAPHIC:"orthographic"};class re extends J{init(){this.propertyType=m.TEXTURE_INFO}getDefaults(){return Object.assign(super.getDefaults(),{texCoord:0,magFilter:null,minFilter:null,wrapS:re.WrapMode.REPEAT,wrapT:re.WrapMode.REPEAT,uuid:null})}getTexCoord(){return this.get("texCoord")}setTexCoord(e){return this.set("texCoord",e)}getMagFilter(){return this.get("magFilter")}setMagFilter(e){return this.set("magFilter",e)}getMinFilter(){return this.get("minFilter")}setMinFilter(e){return this.set("minFilter",e)}getWrapS(){return this.get("wrapS")}setWrapS(e){return this.set("wrapS",e)}getWrapT(){return this.get("wrapT")}setWrapT(e){return this.set("wrapT",e)}getUuid(){return this.get("uuid")}setUuid(e){return this.set("uuid",e)}}re.WrapMode={CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497},re.MagFilter={NEAREST:9728,LINEAR:9729},re.MinFilter={NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987};const{R:ne,G:ie,B:oe,A:se}=v;class ae extends J{init(){this.propertyType=m.MATERIAL}getDefaults(){return Object.assign(super.getDefaults(),{alphaMode:ae.AlphaMode.OPAQUE,alphaCutoff:.5,doubleSided:!1,baseColorFactor:[1,1,1,1],baseColorTexture:null,baseColorTextureInfo:new re(this.graph,"baseColorTextureInfo"),emissiveFactor:[0,0,0],emissiveTexture:null,emissiveTextureInfo:new re(this.graph,"emissiveTextureInfo"),normalScale:1,normalTexture:null,normalTextureInfo:new re(this.graph,"normalTextureInfo"),occlusionStrength:1,occlusionTexture:null,occlusionTextureInfo:new re(this.graph,"occlusionTextureInfo"),roughnessFactor:1,metallicFactor:1,metallicRoughnessTexture:null,metallicRoughnessTextureInfo:new re(this.graph,"metallicRoughnessTextureInfo"),uuid:null})}getDoubleSided(){return this.get("doubleSided")}setDoubleSided(e){return this.set("doubleSided",e)}getAlpha(){return this.get("baseColorFactor")[3]}setAlpha(e){const t=this.get("baseColorFactor").slice();return t[3]=e,this.set("baseColorFactor",t)}getAlphaMode(){return this.get("alphaMode")}setAlphaMode(e){return this.set("alphaMode",e)}getAlphaCutoff(){return this.get("alphaCutoff")}setAlphaCutoff(e){return this.set("alphaCutoff",e)}getBaseColorFactor(){return this.get("baseColorFactor")}setBaseColorFactor(e){return this.set("baseColorFactor",e)}getBaseColorHex(){return T.factorToHex(this.get("baseColorFactor"))}setBaseColorHex(e){const t=this.get("baseColorFactor").slice();return this.set("baseColorFactor",T.hexToFactor(e,t))}getBaseColorTexture(){return this.getRef("baseColorTexture")}getBaseColorTextureInfo(){return this.getRef("baseColorTexture")?this.getRef("baseColorTextureInfo"):null}setBaseColorTexture(e){return this.setRef("baseColorTexture",e,{channels:ne|ie|oe|se})}getEmissiveFactor(){return this.get("emissiveFactor")}setEmissiveFactor(e){return this.set("emissiveFactor",e)}getEmissiveHex(){return T.factorToHex(this.get("emissiveFactor"))}setEmissiveHex(e){const t=this.get("emissiveFactor").slice();return this.set("emissiveFactor",T.hexToFactor(e,t))}getEmissiveTexture(){return this.getRef("emissiveTexture")}getEmissiveTextureInfo(){return this.getRef("emissiveTexture")?this.getRef("emissiveTextureInfo"):null}setEmissiveTexture(e){return this.setRef("emissiveTexture",e,{channels:ne|ie|oe})}getNormalScale(){return this.get("normalScale")}setNormalScale(e){return this.set("normalScale",e)}getNormalTexture(){return this.getRef("normalTexture")}getNormalTextureInfo(){return this.getRef("normalTexture")?this.getRef("normalTextureInfo"):null}setNormalTexture(e){return this.setRef("normalTexture",e,{channels:ne|ie|oe})}getOcclusionStrength(){return this.get("occlusionStrength")}setOcclusionStrength(e){return this.set("occlusionStrength",e)}getOcclusionTexture(){return this.getRef("occlusionTexture")}getOcclusionTextureInfo(){return this.getRef("occlusionTexture")?this.getRef("occlusionTextureInfo"):null}setOcclusionTexture(e){return this.setRef("occlusionTexture",e,{channels:ne})}getRoughnessFactor(){return this.get("roughnessFactor")}setRoughnessFactor(e){return this.set("roughnessFactor",e)}getMetallicFactor(){return this.get("metallicFactor")}setMetallicFactor(e){return this.set("metallicFactor",e)}getMetallicRoughnessTexture(){return this.getRef("metallicRoughnessTexture")}getMetallicRoughnessTextureInfo(){return this.getRef("metallicRoughnessTexture")?this.getRef("metallicRoughnessTextureInfo"):null}setMetallicRoughnessTexture(e){return this.setRef("metallicRoughnessTexture",e,{channels:ie|oe})}getUuid(){return this.get("uuid")}setUuid(e){return this.set("uuid",e)}}ae.AlphaMode={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};class ce extends J{init(){this.propertyType=m.MESH}getDefaults(){return Object.assign(super.getDefaults(),{weights:[],primitives:[],uuid:null})}addPrimitive(e){return this.addRef("primitives",e)}removePrimitive(e){return this.removeRef("primitives",e)}listPrimitives(){return this.listRefs("primitives")}getWeights(){return this.get("weights")}setWeights(e){return this.set("weights",e)}getUuid(){return this.get("uuid")}setUuid(e){return this.set("uuid",e)}}class le extends J{constructor(){super(...arguments),this.u=null}init(){this.propertyType=m.NODE}getDefaults(){return Object.assign(super.getDefaults(),{translation:[0,0,0],rotation:[0,0,0,1],scale:[1,1,1],weights:[],camera:null,mesh:null,skin:null,children:[],uuid:null})}copy(e,t=X){if(t===X)throw new Error("Node cannot be copied.");return super.copy(e,t)}getTranslation(){return this.get("translation")}getRotation(){return this.get("rotation")}getScale(){return this.get("scale")}setTranslation(e){return this.set("translation",e)}setRotation(e){return this.set("rotation",e)}setScale(e){return this.set("scale",e)}getMatrix(){return U.compose(this.get("translation"),this.get("rotation"),this.get("scale"),[])}setMatrix(e){const t=this.get("translation").slice(),r=this.get("rotation").slice(),n=this.get("scale").slice();return U.decompose(e,t,r,n),this.set("translation",t).set("rotation",r).set("scale",n)}getWorldTranslation(){const e=[0,0,0];return U.decompose(this.getWorldMatrix(),e,[0,0,0,1],[1,1,1]),e}getWorldRotation(){const e=[0,0,0,1];return U.decompose(this.getWorldMatrix(),[0,0,0],e,[1,1,1]),e}getWorldScale(){const e=[1,1,1];return U.decompose(this.getWorldMatrix(),[0,0,0],[0,0,0,1],e),e}getWorldMatrix(){const e=[];for(let t=this;t instanceof le;t=t.u)e.push(t);let t;const r=e.pop().getMatrix();for(;t=e.pop();)L(r,r,t.getMatrix());return r}addChild(e){e.u&&e.u.removeChild(e),this.addRef("children",e),e.u=this;const t=this[u].children;return t[t.length-1].addEventListener("dispose",(()=>e.u=null)),this}removeChild(e){return this.removeRef("children",e)}listChildren(){return this.listRefs("children")}getParent(){return this.u}getMesh(){return this.getRef("mesh")}setMesh(e){return this.setRef("mesh",e)}getCamera(){return this.getRef("camera")}setCamera(e){return this.setRef("camera",e)}getSkin(){return this.getRef("skin")}setSkin(e){return this.setRef("skin",e)}getWeights(){return this.get("weights")}setWeights(e){return this.set("weights",e)}getUuid(){return this.get("uuid")}setUuid(e){return this.set("uuid",e)}traverse(e){e(this);for(const t of this.listChildren())t.traverse(e);return this}}class ue extends J{init(){this.propertyType=m.PRIMITIVE}getDefaults(){return Object.assign(super.getDefaults(),{mode:ue.Mode.TRIANGLES,material:null,indices:null,attributes:{},targets:[],uuid:null})}getIndices(){return this.getRef("indices")}setIndices(e){return this.setRef("indices",e,{usage:y.ELEMENT_ARRAY_BUFFER})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,t){return this.setRefMap("attributes",e,t,{usage:y.ARRAY_BUFFER})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}getMaterial(){return this.getRef("material")}setMaterial(e){return this.setRef("material",e)}getMode(){return this.get("mode")}setMode(e){return this.set("mode",e)}listTargets(){return this.listRefs("targets")}addTarget(e){return this.addRef("targets",e)}removeTarget(e){return this.removeRef("targets",e)}getUuid(){return this.get("uuid")}setUuid(e){return this.set("uuid",e)}}ue.Mode={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};class he extends q{init(){this.propertyType=m.PRIMITIVE_TARGET}getDefaults(){return Object.assign(super.getDefaults(),{attributes:{}})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,t){return this.setRefMap("attributes",e,t,{usage:y.ARRAY_BUFFER})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}}function pe(){return pe=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},pe.apply(this,arguments)}class de extends J{init(){this.propertyType=m.SCENE}getDefaults(){return Object.assign(super.getDefaults(),{children:[],uuid:null})}copy(e,t=X){if(t===X)throw new Error("Scene cannot be copied.");return super.copy(e,t)}addChild(e){e.u&&e.u.removeChild(e),this.addRef("children",e),e.u=this;const t=this[u].children;return t[t.length-1].addEventListener("dispose",(()=>e.u=null)),this}removeChild(e){return this.removeRef("children",e)}listChildren(){return this.listRefs("children")}traverse(e){for(const t of this.listChildren())t.traverse(e);return this}getUuid(){return this.get("uuid")}setUuid(e){return this.set("uuid",e)}}class fe extends J{init(){this.propertyType=m.SKIN}getDefaults(){return Object.assign(super.getDefaults(),{skeleton:null,inverseBindMatrices:null,joints:[],uuid:null})}getSkeleton(){return this.getRef("skeleton")}setSkeleton(e){return this.setRef("skeleton",e)}getInverseBindMatrices(){return this.getRef("inverseBindMatrices")}setInverseBindMatrices(e){return this.setRef("inverseBindMatrices",e,{usage:y.INVERSE_BIND_MATRICES})}addJoint(e){return this.addRef("joints",e)}removeJoint(e){return this.removeRef("joints",e)}listJoints(){return this.listRefs("joints")}getUuid(){return this.get("uuid")}setUuid(e){return this.set("uuid",e)}}class me extends J{init(){this.propertyType=m.TEXTURE}getDefaults(){return Object.assign(super.getDefaults(),{image:null,mimeType:"",uri:"",uuid:null,isSeparated:!1})}getMimeType(){return this.get("mimeType")||A.extensionToMimeType(C.extension(this.get("uri")))}setMimeType(e){return this.set("mimeType",e)}getURI(){return this.get("uri")}setURI(e){this.set("uri",e);const t=A.extensionToMimeType(C.extension(e));return t&&this.set("mimeType",t),this}getImage(){return this.get("image")}setImage(e){return this.set("image",M.assertView(e))}getSize(){const e=this.get("image");return e?A.getSize(e,this.getMimeType()):null}getUuid(){return this.get("uuid")}setUuid(e){return this.set("uuid",e)}getIsSeparated(){return this.get("isSeparated")}setIsSeparated(e){return this.set("isSeparated",e)}}class ge extends J{init(){this.propertyType=m.ROOT}getDefaults(){return Object.assign(super.getDefaults(),{asset:{generator:`glTF-Transform ${d}`,version:"2.0"},defaultScene:null,accessors:[],animations:[],buffers:[],cameras:[],materials:[],meshes:[],nodes:[],scenes:[],skins:[],textures:[]})}constructor(e){super(e),this.h=new Set,e.addEventListener("node:create",(e=>{this.l(e.target)}))}clone(){throw new Error("Root cannot be cloned.")}copy(e,t=X){if(t===X)throw new Error("Root cannot be copied.");this.set("asset",pe({},e.get("asset"))),this.setName(e.getName()),this.setExtras(pe({},e.getExtras())),this.setDefaultScene(e.getDefaultScene()?t(e.getDefaultScene()):null);for(const r of e.listRefMapKeys("extensions")){const n=e.getExtension(r);this.setExtension(r,t(n))}return this}l(e){return e instanceof de?this.addRef("scenes",e):e instanceof le?this.addRef("nodes",e):e instanceof te?this.addRef("cameras",e):e instanceof fe?this.addRef("skins",e):e instanceof ce?this.addRef("meshes",e):e instanceof ae?this.addRef("materials",e):e instanceof me?this.addRef("textures",e):e instanceof Z?this.addRef("animations",e):e instanceof K?this.addRef("accessors",e):e instanceof ee&&this.addRef("buffers",e),this}getAsset(){return this.get("asset")}listExtensionsUsed(){return Array.from(this.h)}listExtensionsRequired(){return this.listExtensionsUsed().filter((e=>e.isRequired()))}g(e){return this.h.add(e),this}p(e){return this.h.delete(e),this}listScenes(){return this.listRefs("scenes")}setDefaultScene(e){return this.setRef("defaultScene",e)}getDefaultScene(){return this.getRef("defaultScene")}listNodes(){return this.listRefs("nodes")}listCameras(){return this.listRefs("cameras")}listSkins(){return this.listRefs("skins")}listMeshes(){return this.listRefs("meshes")}listMaterials(){return this.listRefs("materials")}listTextures(){return this.listRefs("textures")}listAnimations(){return this.listRefs("animations")}listAccessors(){return this.listRefs("accessors")}listBuffers(){return this.listRefs("buffers")}}class ye{static fromGraph(e){return ye.m.get(e)||null}constructor(){this.T=new o,this.v=new ge(this.T),this.S=N.DEFAULT_INSTANCE,ye.m.set(this.T,this)}getRoot(){return this.v}getGraph(){return this.T}getLogger(){return this.S}setLogger(e){return this.S=e,this}clone(){return(new ye).setLogger(this.S).merge(this)}merge(e){for(const t of e.getRoot().listExtensionsUsed()){const e=this.createExtension(t.constructor);t.isRequired()&&e.setRequired(!0)}const t=new Set,r=new Map;t.add(e.v),r.set(e.v,this.v);for(const n of e.T.listEdges())for(const e of[n.getParent(),n.getChild()]){if(t.has(e))continue;let n;n=e.propertyType===m.TEXTURE_INFO?e:new(0,e.constructor)(this.T),r.set(e,n),t.add(e)}const n=e=>{const t=r.get(e);if(!t)throw new Error("Could resolve property.");return t};for(const e of t){const t=r.get(e);if(!t)throw new Error("Could resolve property.");t.propertyType!==m.TEXTURE_INFO&&t.copy(e,n)}return this}async transform(...e){const t=e.map((e=>e.name));for(const r of e)await r(this,{stack:t});return this}createExtension(e){const t=e.EXTENSION_NAME;return this.getRoot().listExtensionsUsed().find((e=>e.extensionName===t))||new e(this)}createScene(e=""){return new de(this.T,e)}createNode(e=""){return new le(this.T,e)}createCamera(e=""){return new te(this.T,e)}createSkin(e=""){return new fe(this.T,e)}createMesh(e=""){return new ce(this.T,e)}createPrimitive(){return new ue(this.T)}createPrimitiveTarget(e=""){return new he(this.T,e)}createMaterial(e=""){return new ae(this.T,e)}createTexture(e=""){return new me(this.T,e)}createAnimation(e=""){return new Z(this.T,e)}createAnimationChannel(e=""){return new Q(this.T,e)}createAnimationSampler(e=""){return new $(this.T,e)}createAccessor(e="",t=null){return t||(t=this.getRoot().listBuffers()[0]),new K(this.T,e).setBuffer(t)}createBuffer(e=""){return new ee(this.T,e)}}ye.m=new WeakMap;class ve{constructor(e){this.jsonDoc=e,this.buffers=[],this.bufferViews=[],this.bufferViewBuffers=[],this.accessors=[],this.textures=[],this.textureInfos=new Map,this.materials=[],this.meshes=[],this.cameras=[],this.nodes=[],this.skins=[],this.animations=[],this.scenes=[]}setTextureInfo(e,t){this.textureInfos.set(e,t),void 0!==t.texCoord&&e.setTexCoord(t.texCoord),void 0!==t.extras&&e.setExtras(t.extras),null!=t.uuid&&e.setUuid(t.uuid);const r=this.jsonDoc.json.textures[t.index];if(void 0===r.sampler)return;const n=this.jsonDoc.json.samplers[r.sampler];void 0!==n.magFilter&&e.setMagFilter(n.magFilter),void 0!==n.minFilter&&e.setMinFilter(n.minFilter),void 0!==n.wrapS&&e.setWrapS(n.wrapS),void 0!==n.wrapT&&e.setWrapT(n.wrapT)}}const _e={logger:N.DEFAULT_INSTANCE,extensions:[],dependencies:{}};class be{static read(e,t=_e){const r=pe({},_e,t),{json:n}=e,i=(new ye).setLogger(r.logger);this.validate(e,r);const o=new ve(e),s=n.asset,a=i.getRoot().getAsset();s.copyright&&(a.copyright=s.copyright),s.extras&&(a.extras=s.extras),void 0!==n.extras&&i.getRoot().setExtras(pe({},n.extras));const c=n.extensionsUsed||[],l=n.extensionsRequired||[];for(const e of r.extensions)if(c.includes(e.EXTENSION_NAME)){const t=i.createExtension(e).setRequired(l.includes(e.EXTENSION_NAME));for(const e of t.readDependencies)t.install(e,r.dependencies[e])}const u=n.buffers||[];i.getRoot().listExtensionsUsed().filter((e=>e.prereadTypes.includes(m.BUFFER))).forEach((e=>e.preread(o,m.BUFFER))),o.buffers=u.map((e=>{const t=i.createBuffer(e.name);return e.extras&&t.setExtras(e.extras),e.uri&&0!==e.uri.indexOf("__")&&t.setURI(e.uri),t})),o.bufferViewBuffers=(n.bufferViews||[]).map(((t,r)=>{if(!o.bufferViews[r]){const n=e.json.buffers[t.buffer];o.bufferViews[r]=M.toView(n.uri?e.resources[n.uri]:e.resources[f],t.byteOffset||0,t.byteLength)}return o.buffers[t.buffer]}));const h=n.accessors||[];o.accessors=h.map((e=>{const t=i.createAccessor(e.name,o.bufferViewBuffers[e.bufferView]).setType(e.type);return e.extras&&t.setExtras(e.extras),void 0!==e.normalized&&t.setNormalized(e.normalized),void 0===e.bufferView||t.setArray(xe(e,o)),t}));const p=n.images||[],d=n.textures||[];i.getRoot().listExtensionsUsed().filter((e=>e.prereadTypes.includes(m.TEXTURE))).forEach((e=>e.preread(o,m.TEXTURE))),o.textures=p.map((t=>{const r=i.createTexture(t.name);if(t.extras&&r.setExtras(t.extras),void 0!==t.bufferView){const i=n.bufferViews[t.bufferView],o=e.json.buffers[i.buffer],s=i.byteOffset||0,a=(o.uri?e.resources[o.uri]:e.resources[f]).slice(s,s+i.byteLength);r.setImage(a)}else void 0!==t.uri&&(r.setImage(e.resources[t.uri]),0!==t.uri.indexOf("__")&&r.setURI(t.uri));if(void 0!==t.mimeType)r.setMimeType(t.mimeType);else if(t.uri){const e=C.extension(t.uri);r.setMimeType(A.extensionToMimeType(e))}return void 0!==t.uuid&&r.setUuid(t.uuid),r})),o.materials=(n.materials||[]).map((e=>{const t=i.createMaterial(e.name);e.extras&&t.setExtras(e.extras),void 0!==e.alphaMode&&t.setAlphaMode(e.alphaMode),void 0!==e.alphaCutoff&&t.setAlphaCutoff(e.alphaCutoff),void 0!==e.doubleSided&&t.setDoubleSided(e.doubleSided);const r=e.pbrMetallicRoughness||{};if(void 0!==r.baseColorFactor&&t.setBaseColorFactor(r.baseColorFactor),void 0!==e.emissiveFactor&&t.setEmissiveFactor(e.emissiveFactor),void 0!==r.metallicFactor&&t.setMetallicFactor(r.metallicFactor),void 0!==r.roughnessFactor&&t.setRoughnessFactor(r.roughnessFactor),void 0!==r.baseColorTexture){const e=r.baseColorTexture;t.setBaseColorTexture(o.textures[d[e.index].source]),e.uuid=d[e.index].uuid,o.setTextureInfo(t.getBaseColorTextureInfo(),e)}if(void 0!==e.emissiveTexture){const r=e.emissiveTexture;t.setEmissiveTexture(o.textures[d[r.index].source]),r.uuid=d[r.index].uuid,o.setTextureInfo(t.getEmissiveTextureInfo(),r)}if(void 0!==e.normalTexture){const r=e.normalTexture;t.setNormalTexture(o.textures[d[r.index].source]),r.uuid=d[r.index].uuid,o.setTextureInfo(t.getNormalTextureInfo(),r),void 0!==e.normalTexture.scale&&t.setNormalScale(e.normalTexture.scale)}if(void 0!==e.occlusionTexture){const r=e.occlusionTexture;t.setOcclusionTexture(o.textures[d[r.index].source]),r.uuid=d[r.index].uuid,o.setTextureInfo(t.getOcclusionTextureInfo(),r),void 0!==e.occlusionTexture.strength&&t.setOcclusionStrength(e.occlusionTexture.strength)}if(void 0!==r.metallicRoughnessTexture){const e=r.metallicRoughnessTexture;t.setMetallicRoughnessTexture(o.textures[d[e.index].source]),e.uuid=d[e.index].uuid,o.setTextureInfo(t.getMetallicRoughnessTextureInfo(),e)}return void 0!==e.uuid&&t.setUuid(e.uuid),t}));const g=n.meshes||[];i.getRoot().listExtensionsUsed().filter((e=>e.prereadTypes.includes(m.PRIMITIVE))).forEach((e=>e.preread(o,m.PRIMITIVE))),o.meshes=g.map((e=>{const t=i.createMesh(e.name);return e.extras&&t.setExtras(e.extras),void 0!==e.weights&&t.setWeights(e.weights),(e.primitives||[]).forEach((r=>{const n=i.createPrimitive();r.extras&&n.setExtras(r.extras),void 0!==r.material&&n.setMaterial(o.materials[r.material]),void 0!==r.mode&&n.setMode(r.mode);for(const[e,t]of Object.entries(r.attributes||{}))n.setAttribute(e,o.accessors[t]);void 0!==r.indices&&n.setIndices(o.accessors[r.indices]),void 0!==r.uuid&&n.setUuid(r.uuid);const s=e.extras&&e.extras.targetNames||[];(r.targets||[]).forEach(((e,t)=>{const r=s[t]||t.toString(),a=i.createPrimitiveTarget(r);for(const[t,r]of Object.entries(e))a.setAttribute(t,o.accessors[r]);n.addTarget(a)})),t.addPrimitive(n)})),void 0!==e.uuid&&t.setUuid(e.uuid),t})),o.cameras=(n.cameras||[]).map((e=>{const t=i.createCamera(e.name).setType(e.type);if(e.extras&&t.setExtras(e.extras),e.type===te.Type.PERSPECTIVE){const r=e.perspective;t.setYFov(r.yfov),t.setZNear(r.znear),void 0!==r.zfar&&t.setZFar(r.zfar),void 0!==r.aspectRatio&&t.setAspectRatio(r.aspectRatio)}else{const r=e.orthographic;t.setZNear(r.znear).setZFar(r.zfar).setXMag(r.xmag).setYMag(r.ymag)}return void 0!==e.uuid&&t.setUuid(e.uuid),t}));const y=n.nodes||[];i.getRoot().listExtensionsUsed().filter((e=>e.prereadTypes.includes(m.NODE))).forEach((e=>e.preread(o,m.NODE))),o.nodes=y.map((e=>{const t=i.createNode(e.name);if(e.extras&&t.setExtras(e.extras),void 0!==e.translation&&t.setTranslation(e.translation),void 0!==e.rotation&&t.setRotation(e.rotation),void 0!==e.scale&&t.setScale(e.scale),void 0!==e.matrix){const r=[0,0,0],n=[0,0,0,1],i=[1,1,1];U.decompose(e.matrix,r,n,i),t.setTranslation(r),t.setRotation(n),t.setScale(i)}return void 0!==e.weights&&t.setWeights(e.weights),void 0!==e.uuid&&t.setUuid(e.uuid),t})),o.skins=(n.skins||[]).map((e=>{const t=i.createSkin(e.name);e.extras&&t.setExtras(e.extras),void 0!==e.inverseBindMatrices&&t.setInverseBindMatrices(o.accessors[e.inverseBindMatrices]),void 0!==e.skeleton&&t.setSkeleton(o.nodes[e.skeleton]);for(const r of e.joints)t.addJoint(o.nodes[r]);return void 0!==e.uuid&&t.setUuid(e.uuid),t})),y.map(((e,t)=>{const r=o.nodes[t];(e.children||[]).forEach((e=>r.addChild(o.nodes[e]))),void 0!==e.mesh&&r.setMesh(o.meshes[e.mesh]),void 0!==e.camera&&r.setCamera(o.cameras[e.camera]),void 0!==e.skin&&r.setSkin(o.skins[e.skin])})),o.animations=(n.animations||[]).map((e=>{const t=i.createAnimation(e.name);e.extras&&t.setExtras(e.extras);const r=(e.samplers||[]).map((e=>{const r=i.createAnimationSampler().setInput(o.accessors[e.input]).setOutput(o.accessors[e.output]).setInterpolation(e.interpolation||$.Interpolation.LINEAR);return e.extras&&r.setExtras(e.extras),t.addSampler(r),r}));return(e.channels||[]).forEach((e=>{const n=i.createAnimationChannel().setSampler(r[e.sampler]).setTargetPath(e.target.path);void 0!==e.target.node&&n.setTargetNode(o.nodes[e.target.node]),e.extras&&n.setExtras(e.extras),t.addChannel(n)})),void 0!==e.uuid&&t.setUuid(e.uuid),t}));const v=n.scenes||[];return i.getRoot().listExtensionsUsed().filter((e=>e.prereadTypes.includes(m.SCENE))).forEach((e=>e.preread(o,m.SCENE))),o.scenes=v.map((e=>{const t=i.createScene(e.name);return e.extras&&t.setExtras(e.extras),(e.nodes||[]).map((e=>o.nodes[e])).forEach((e=>t.addChild(e))),void 0!==e.uuid&&t.setUuid(e.uuid),t})),void 0!==n.scene&&i.getRoot().setDefaultScene(o.scenes[n.scene]),i.getRoot().listExtensionsUsed().forEach((e=>e.read(o))),h.forEach(((e,t)=>{const r=o.accessors[t],n=!!e.sparse,i=!e.bufferView&&!r.getArray();(n||i)&&r.setSparse(!0).setArray(function(e,t){const r=b[e.componentType],n=K.getElementSize(e.type);let i;i=void 0!==e.bufferView?xe(e,t):new r(e.count*n);const o=e.sparse;if(!o)return i;const s=o.count,a=pe({},e,o.indices,{count:s,type:"SCALAR"}),c=pe({},e,o.values,{count:s}),l=xe(a,t),u=xe(c,t);for(let e=0;e<a.count;e++)for(let t=0;t<n;t++)i[l[e]*n+t]=u[e*n+t];return i}(e,o))})),i}static validate(e,t){const r=e.json;if("2.0"!==r.asset.version)throw new Error(`Unsupported glTF version, "${r.asset.version}".`);if(r.extensionsRequired)for(const e of r.extensionsRequired)if(!t.extensions.find((t=>t.EXTENSION_NAME===e)))throw new Error(`Missing required extension, "${e}".`);if(r.extensionsUsed)for(const e of r.extensionsUsed)t.extensions.find((t=>t.EXTENSION_NAME===e))||t.logger.warn(`Missing optional extension, "${e}".`)}}function xe(e,t){const r=t.bufferViews[e.bufferView],n=t.jsonDoc.json.bufferViews[e.bufferView],i=b[e.componentType],o=K.getElementSize(e.type),s=i.BYTES_PER_ELEMENT;if(void 0!==n.byteStride&&n.byteStride!==o*s)return function(e,t){const r=t.bufferViews[e.bufferView],n=t.jsonDoc.json.bufferViews[e.bufferView],i=b[e.componentType],o=K.getElementSize(e.type),s=i.BYTES_PER_ELEMENT,a=e.byteOffset||0,c=new i(e.count*o),l=new DataView(r.buffer,r.byteOffset,r.byteLength),u=n.byteStride;for(let t=0;t<e.count;t++)for(let r=0;r<o;r++){const n=a+t*u+r*s;let i;switch(e.componentType){case K.ComponentType.FLOAT:i=l.getFloat32(n,!0);break;case K.ComponentType.UNSIGNED_INT:i=l.getUint32(n,!0);break;case K.ComponentType.UNSIGNED_SHORT:i=l.getUint16(n,!0);break;case K.ComponentType.UNSIGNED_BYTE:i=l.getUint8(n);break;case K.ComponentType.SHORT:i=l.getInt16(n,!0);break;case K.ComponentType.BYTE:i=l.getInt8(n);break;default:throw new Error(`Unexpected componentType "${e.componentType}".`)}c[t*o+r]=i}return c}(e,t);const a=r.byteOffset+(e.byteOffset||0);return new i(r.buffer.slice(a,a+e.count*o*s))}var we;!function(e){e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"}(we||(we={}));class Se{constructor(e,t,r){this.O=e,this.jsonDoc=t,this.options=r,this.accessorIndexMap=new Map,this.animationIndexMap=new Map,this.bufferIndexMap=new Map,this.cameraIndexMap=new Map,this.skinIndexMap=new Map,this.materialIndexMap=new Map,this.meshIndexMap=new Map,this.nodeIndexMap=new Map,this.imageIndexMap=new Map,this.textureDefIndexMap=new Map,this.textureInfoDefMap=new Map,this.samplerDefIndexMap=new Map,this.sceneIndexMap=new Map,this.imageBufferViews=[],this.otherBufferViews=new Map,this.otherBufferViewsIndexMap=new Map,this.extensionData={},this.U=new Map,this.accessorUsageGroupedByParent=new Set(["ARRAY_BUFFER"]),this.accessorParents=new Map;const n=e.getRoot(),i=n.listBuffers().length,o=n.listTextures().length;this.bufferURIGenerator=new Me(i>1,(()=>r.basename||"buffer")),this.imageURIGenerator=new Me(o>1,(t=>function(e,t){const r=e.getGraph().listParentEdges(t).find((t=>t.getParent()!==e.getRoot()));return r?r.getName().replace(/texture$/i,""):""}(e,t)||r.basename||"texture")),this.logger=e.getLogger()}createTextureInfoDef(e,t){const r={magFilter:t.getMagFilter()||void 0,minFilter:t.getMinFilter()||void 0,wrapS:t.getWrapS(),wrapT:t.getWrapT()},n=JSON.stringify(r);this.samplerDefIndexMap.has(n)||(this.samplerDefIndexMap.set(n,this.jsonDoc.json.samplers.length),this.jsonDoc.json.samplers.push(r));const i={source:this.imageIndexMap.get(e),sampler:this.samplerDefIndexMap.get(n),uuid:t.getUuid()},o=JSON.stringify(i);this.textureDefIndexMap.has(o)||(this.textureDefIndexMap.set(o,this.jsonDoc.json.textures.length),this.jsonDoc.json.textures.push(i));const s={index:this.textureDefIndexMap.get(o)};return 0!==t.getTexCoord()&&(s.texCoord=t.getTexCoord()),Object.keys(t.getExtras()).length>0&&(s.extras=t.getExtras()),this.textureInfoDefMap.set(t,s),s}createPropertyDef(e){const t={};return e.getName()&&(t.name=e.getName()),Object.keys(e.getExtras()).length>0&&(t.extras=e.getExtras()),t}createAccessorDef(e){const t=this.createPropertyDef(e);return t.type=e.getType(),t.componentType=e.getComponentType(),t.count=e.getCount(),this.O.getGraph().listParentEdges(e).some((e=>"attributes"===e.getName()&&"POSITION"===e.getAttributes().key||"input"===e.getName()))&&(t.max=e.getMax([]).map(Math.fround),t.min=e.getMin([]).map(Math.fround)),e.getNormalized()&&(t.normalized=e.getNormalized()),t}createImageData(e,t,r){if(r.getIsSeparated()){const t=A.mimeTypeToExtension(r.getMimeType());e.uri=this.imageURIGenerator.createURI(r,t)}else if(this.options.format===_.GLB)this.imageBufferViews.push(t),e.bufferView=this.jsonDoc.json.bufferViews.length,this.jsonDoc.json.bufferViews.push({buffer:0,byteOffset:-1,byteLength:t.byteLength});else{const n=A.mimeTypeToExtension(r.getMimeType());e.uri=this.imageURIGenerator.createURI(r,n),this.jsonDoc.resources[e.uri]=t}}getAccessorUsage(e){const t=this.U.get(e);if(t)return t;if(e.getSparse())return y.SPARSE;for(const t of this.O.getGraph().listParentEdges(e)){const{usage:e}=t.getAttributes();if(e)return e;t.getParent().propertyType!==m.ROOT&&this.logger.warn(`Missing attribute ".usage" on edge, "${t.getName()}".`)}return y.OTHER}addAccessorToUsageGroup(e,t){const r=this.U.get(e);if(r&&r!==t)throw new Error(`Accessor with usage "${r}" cannot be reused as "${t}".`);return this.U.set(e,t),this}listAccessorUsageGroups(){const e={};for(const[t,r]of Array.from(this.U.entries()))e[r]=e[r]||[],e[r].push(t);return e}}Se.BufferViewTarget=we,Se.BufferViewUsage=y,Se.USAGE_TO_TARGET={[y.ARRAY_BUFFER]:we.ARRAY_BUFFER,[y.ELEMENT_ARRAY_BUFFER]:we.ELEMENT_ARRAY_BUFFER};class Me{constructor(e,t){this.multiple=e,this.basename=t,this.counter={}}createURI(e,t){if(e.getURI())return e.getURI();if(this.multiple){const r=this.basename(e);return this.counter[r]=this.counter[r]||1,`${r}_${this.counter[r]++}.${t}`}return`${this.basename(e)}.${t}`}}const{BufferViewUsage:Te}=Se,{UNSIGNED_INT:Ee,UNSIGNED_SHORT:Ae,UNSIGNED_BYTE:Re}=K.ComponentType;class Ce{static write(e,t){const r=e.getRoot(),n={asset:pe({generator:`glTF-Transform ${d}`},r.getAsset()),extras:pe({},r.getExtras())},i={json:n,resources:{}},o=new Se(e,i,t),s=t.logger||N.DEFAULT_INSTANCE,a=new Set(t.extensions.map((e=>e.EXTENSION_NAME))),c=e.getRoot().listExtensionsUsed().filter((e=>a.has(e.extensionName))),l=e.getRoot().listExtensionsRequired().filter((e=>a.has(e.extensionName)));c.length<e.getRoot().listExtensionsUsed().length&&s.warn("Some extensions were not registered for I/O, and will not be written.");for(const e of c)for(const r of e.writeDependencies)e.install(r,t.dependencies[r]);function u(e,t,r,i){const s=[];let a=0;for(const t of e){const e=o.createAccessorDef(t);e.bufferView=n.bufferViews.length;const r=t.getArray(),i=M.pad(M.toView(r));e.byteOffset=a,a+=i.byteLength,s.push(i),o.accessorIndexMap.set(t,n.accessors.length),n.accessors.push(e)}const c={buffer:t,byteOffset:r,byteLength:M.concat(s).byteLength};return i&&(c.target=i),n.bufferViews.push(c),{buffers:s,byteLength:a}}function h(e,t,r){const i=e[0].getCount();let s=0;for(const t of e){const e=o.createAccessorDef(t);e.bufferView=n.bufferViews.length,e.byteOffset=s;const r=t.getElementSize(),i=t.getComponentSize();s+=M.padNumber(r*i),o.accessorIndexMap.set(t,n.accessors.length),n.accessors.push(e)}const a=i*s,c=new ArrayBuffer(a),l=new DataView(c);for(let t=0;t<i;t++){let r=0;for(const n of e){const e=n.getElementSize(),i=n.getComponentSize(),o=n.getComponentType(),a=n.getArray();for(let n=0;n<e;n++){const c=t*s+r+n*i,u=a[t*e+n];switch(o){case K.ComponentType.FLOAT:l.setFloat32(c,u,!0);break;case K.ComponentType.BYTE:l.setInt8(c,u);break;case K.ComponentType.SHORT:l.setInt16(c,u,!0);break;case K.ComponentType.UNSIGNED_BYTE:l.setUint8(c,u);break;case K.ComponentType.UNSIGNED_SHORT:l.setUint16(c,u,!0);break;case K.ComponentType.UNSIGNED_INT:l.setUint32(c,u,!0);break;default:throw new Error("Unexpected component type: "+o)}}r+=M.padNumber(e*i)}}return n.bufferViews.push({buffer:t,byteOffset:r,byteLength:a,byteStride:s,target:Se.BufferViewTarget.ARRAY_BUFFER}),{byteLength:a,buffers:[new Uint8Array(c)]}}function p(e,t,r){const i=[];let a=0;const c=new Map;let l=-1/0;for(const t of e){const e=o.createAccessorDef(t);n.accessors.push(e),o.accessorIndexMap.set(t,n.accessors.length-1);const r=[],i=[],a=[],u=new Array(t.getElementSize()).fill(0);for(let e=0,n=t.getCount();e<n;e++)if(t.getElement(e,a),!U.eq(a,u,0)){l=Math.max(e,l),r.push(e);for(let e=0;e<a.length;e++)i.push(a[e])}const h=r.length,p={accessorDef:e,count:h};if(c.set(t,p),0===h)continue;if(h>t.getCount()/3){const e=(100*r.length/t.getCount()).toFixed(1);s.warn(`Sparse accessor with many non-zero elements (${e}%) may increase file size.`)}const d=b[t.getComponentType()];p.indices=r,p.values=new d(i)}if(!Number.isFinite(l))return{buffers:i,byteLength:a};const u=l<255?Uint8Array:l<65535?Uint16Array:Uint32Array,h=l<255?Re:l<65535?Ae:Ee,p={buffer:t,byteOffset:r+a,byteLength:0};for(const t of e){const e=c.get(t);if(0===e.count)continue;e.indicesByteOffset=p.byteLength;const r=M.pad(M.toView(new u(e.indices)));i.push(r),a+=r.byteLength,p.byteLength+=r.byteLength}n.bufferViews.push(p);const d=n.bufferViews.length-1,f={buffer:t,byteOffset:r+a,byteLength:0};for(const t of e){const e=c.get(t);if(0===e.count)continue;e.valuesByteOffset=f.byteLength;const r=M.pad(M.toView(e.values));i.push(r),a+=r.byteLength,f.byteLength+=r.byteLength}n.bufferViews.push(f);const m=n.bufferViews.length-1;for(const t of e){const e=c.get(t);0!==e.count&&(e.accessorDef.sparse={count:e.count,indices:{bufferView:d,byteOffset:e.indicesByteOffset,componentType:h},values:{bufferView:m,byteOffset:e.valuesByteOffset}})}return{buffers:i,byteLength:a}}const y=new Map;for(const t of e.getGraph().listEdges()){if(t.getParent()===r)continue;const e=t.getChild();if(e instanceof K){const r=y.get(e)||[];r.push(t),y.set(e,r)}}if(n.accessors=[],n.bufferViews=[],n.samplers=[],n.textures=[],n.images=r.listTextures().map(((e,t)=>{const r=o.createPropertyDef(e);e.getMimeType()&&(r.mimeType=e.getMimeType());const n=e.getImage();return n&&o.createImageData(r,n,e),e.getUuid()&&(r.uuid=e.getUuid()),o.imageIndexMap.set(e,t),r})),c.filter((e=>e.prewriteTypes.includes(m.ACCESSOR))).forEach((e=>e.prewrite(o,m.ACCESSOR))),r.listAccessors().forEach((e=>{const t=o.accessorUsageGroupedByParent,r=o.accessorParents;if(o.accessorIndexMap.has(e))return;const n=y.get(e)||[],i=o.getAccessorUsage(e);if(o.addAccessorToUsageGroup(e,i),t.has(i)){const t=n[0].getParent(),i=r.get(t)||new Set;i.add(e),r.set(t,i)}})),c.filter((e=>e.prewriteTypes.includes(m.BUFFER))).forEach((e=>e.prewrite(o,m.BUFFER))),(r.listAccessors().length>0||r.listTextures().length>0||o.otherBufferViews.size>0)&&0===r.listBuffers().length)throw new Error("Buffer required for Document resources, but none was found.");n.buffers=[],r.listBuffers().forEach(((e,r)=>{const s=o.createPropertyDef(e),a=o.accessorUsageGroupedByParent,c=o.accessorParents,l=e.listParents().filter((e=>e instanceof K)),d=new Set(l),m=[],y=n.buffers.length;let v=0;const b=o.listAccessorUsageGroups();for(const e in b)if(a.has(e))for(const r of Array.from(c.values())){const n=Array.from(r).filter((e=>d.has(e))).filter((t=>o.getAccessorUsage(t)===e));if(n.length)if(e!==Te.ARRAY_BUFFER||t.vertexLayout===g.INTERLEAVED){const t=e===Te.ARRAY_BUFFER?h(n,y,v):u(n,y,v);v+=t.byteLength,m.push(...t.buffers)}else for(const e of n){const t=h([e],y,v);v+=t.byteLength,m.push(...t.buffers)}}else{const t=b[e].filter((e=>d.has(e)));if(!t.length)continue;const r=e===Te.ELEMENT_ARRAY_BUFFER?Se.BufferViewTarget.ELEMENT_ARRAY_BUFFER:void 0,n=e===Te.SPARSE?p(t,y,v):u(t,y,v,r);v+=n.byteLength,m.push(...n.buffers)}if(o.imageBufferViews.length&&0===r)for(let e=0;e<o.imageBufferViews.length;e++)if(n.bufferViews[n.images[e].bufferView].byteOffset=v,v+=o.imageBufferViews[e].byteLength,m.push(o.imageBufferViews[e]),v%8){const e=8-v%8;v+=e,m.push(new Uint8Array(e))}if(o.otherBufferViews.has(e))for(const t of o.otherBufferViews.get(e))n.bufferViews.push({buffer:y,byteOffset:v,byteLength:t.byteLength}),o.otherBufferViewsIndexMap.set(t,n.bufferViews.length-1),v+=t.byteLength,m.push(t);if(v){let r;t.format===_.GLB?r=f:(r=o.bufferURIGenerator.createURI(e,"bin"),s.uri=r),s.byteLength=v,i.resources[r]=M.concat(m)}n.buffers.push(s),o.bufferIndexMap.set(e,r)})),r.listAccessors().find((e=>!e.getBuffer()))&&s.warn("Skipped writing one or more Accessors: no Buffer assigned."),n.materials=r.listMaterials().map(((e,t)=>{const r=o.createPropertyDef(e);if(e.getAlphaMode()!==ae.AlphaMode.OPAQUE&&(r.alphaMode=e.getAlphaMode()),e.getAlphaMode()===ae.AlphaMode.MASK&&(r.alphaCutoff=e.getAlphaCutoff()),e.getDoubleSided()&&(r.doubleSided=!0),r.pbrMetallicRoughness={},U.eq(e.getBaseColorFactor(),[1,1,1,1])||(r.pbrMetallicRoughness.baseColorFactor=e.getBaseColorFactor()),U.eq(e.getEmissiveFactor(),[0,0,0])||(r.emissiveFactor=e.getEmissiveFactor()),1!==e.getRoughnessFactor()&&(r.pbrMetallicRoughness.roughnessFactor=e.getRoughnessFactor()),1!==e.getMetallicFactor()&&(r.pbrMetallicRoughness.metallicFactor=e.getMetallicFactor()),e.getBaseColorTexture()){const t=e.getBaseColorTexture(),n=e.getBaseColorTextureInfo();r.pbrMetallicRoughness.baseColorTexture=o.createTextureInfoDef(t,n)}if(e.getEmissiveTexture()){const t=e.getEmissiveTexture(),n=e.getEmissiveTextureInfo();r.emissiveTexture=o.createTextureInfoDef(t,n)}if(e.getNormalTexture()){const t=e.getNormalTexture(),n=e.getNormalTextureInfo(),i=o.createTextureInfoDef(t,n);1!==e.getNormalScale()&&(i.scale=e.getNormalScale()),r.normalTexture=i}if(e.getOcclusionTexture()){const t=e.getOcclusionTexture(),n=e.getOcclusionTextureInfo(),i=o.createTextureInfoDef(t,n);1!==e.getOcclusionStrength()&&(i.strength=e.getOcclusionStrength()),r.occlusionTexture=i}if(e.getMetallicRoughnessTexture()){const t=e.getMetallicRoughnessTexture(),n=e.getMetallicRoughnessTextureInfo();r.pbrMetallicRoughness.metallicRoughnessTexture=o.createTextureInfoDef(t,n)}return e.getUuid()&&(r.uuid=e.getUuid()),o.materialIndexMap.set(e,t),r})),n.meshes=r.listMeshes().map(((e,t)=>{const r=o.createPropertyDef(e);let n=null;return r.primitives=e.listPrimitives().map((e=>{const t={attributes:{},uuid:null};t.mode=e.getMode();const r=e.getMaterial();r&&(t.material=o.materialIndexMap.get(r)),Object.keys(e.getExtras()).length&&(t.extras=e.getExtras());const i=e.getIndices();i&&(t.indices=o.accessorIndexMap.get(i));for(const r of e.listSemantics())t.attributes[r]=o.accessorIndexMap.get(e.getAttribute(r));for(const r of e.listTargets()){const e={};for(const t of r.listSemantics())e[t]=o.accessorIndexMap.get(r.getAttribute(t));t.targets=t.targets||[],t.targets.push(e)}return e.listTargets().length&&!n&&(n=e.listTargets().map((e=>e.getName()))),e.getUuid()&&(t.uuid=e.getUuid()),t})),e.getWeights().length&&(r.weights=e.getWeights()),n&&(r.extras=r.extras||{},r.extras.targetNames=n),e.getUuid()&&(r.uuid=e.getUuid()),o.meshIndexMap.set(e,t),r})),n.cameras=r.listCameras().map(((e,t)=>{const r=o.createPropertyDef(e);if(r.type=e.getType(),r.type===te.Type.PERSPECTIVE){r.perspective={znear:e.getZNear(),zfar:e.getZFar(),yfov:e.getYFov()};const t=e.getAspectRatio();null!==t&&(r.perspective.aspectRatio=t)}else r.orthographic={znear:e.getZNear(),zfar:e.getZFar(),xmag:e.getXMag(),ymag:e.getYMag()};return e.getUuid()&&(r.uuid=e.getUuid()),o.cameraIndexMap.set(e,t),r})),n.nodes=r.listNodes().map(((e,t)=>{const r=o.createPropertyDef(e);return U.eq(e.getTranslation(),[0,0,0])||(r.translation=e.getTranslation()),U.eq(e.getRotation(),[0,0,0,1])||(r.rotation=e.getRotation()),U.eq(e.getScale(),[1,1,1])||(r.scale=e.getScale()),e.getWeights().length&&(r.weights=e.getWeights()),e.getUuid()&&(r.uuid=e.getUuid()),o.nodeIndexMap.set(e,t),r})),n.skins=r.listSkins().map(((e,t)=>{const r=o.createPropertyDef(e),n=e.getInverseBindMatrices();n&&(r.inverseBindMatrices=o.accessorIndexMap.get(n));const i=e.getSkeleton();return i&&(r.skeleton=o.nodeIndexMap.get(i)),r.joints=e.listJoints().map((e=>o.nodeIndexMap.get(e))),e.getUuid()&&(r.uuid=e.getUuid()),o.skinIndexMap.set(e,t),r})),r.listNodes().forEach(((e,t)=>{const r=n.nodes[t],i=e.getMesh();i&&(r.mesh=o.meshIndexMap.get(i));const s=e.getCamera();s&&(r.camera=o.cameraIndexMap.get(s));const a=e.getSkin();a&&(r.skin=o.skinIndexMap.get(a)),e.listChildren().length>0&&(r.children=e.listChildren().map((e=>o.nodeIndexMap.get(e))))})),n.animations=r.listAnimations().map(((e,t)=>{const r=o.createPropertyDef(e),n=new Map;return r.samplers=e.listSamplers().map(((e,t)=>{const r=o.createPropertyDef(e);return r.input=o.accessorIndexMap.get(e.getInput()),r.output=o.accessorIndexMap.get(e.getOutput()),r.interpolation=e.getInterpolation(),n.set(e,t),r})),r.channels=e.listChannels().map((e=>{const t=o.createPropertyDef(e);return t.sampler=n.get(e.getSampler()),t.target={node:o.nodeIndexMap.get(e.getTargetNode()),path:e.getTargetPath()},t})),e.getUuid()&&(r.uuid=e.getUuid()),o.animationIndexMap.set(e,t),r})),n.scenes=r.listScenes().map(((e,t)=>{const r=o.createPropertyDef(e);return r.nodes=e.listChildren().map((e=>o.nodeIndexMap.get(e))),e.getUuid()&&(r.uuid=e.getUuid()),o.sceneIndexMap.set(e,t),r}));const v=r.getDefaultScene();return v&&(n.scene=r.listScenes().indexOf(v)),n.extensionsUsed=c.map((e=>e.extensionName)),n.extensionsRequired=l.map((e=>e.extensionName)),c.forEach((e=>e.write(o))),function(e){const t=[];for(const r in e){const n=e[r];(Array.isArray(n)&&0===n.length||null===n||""===n||n&&"object"==typeof n&&0===Object.keys(n).length)&&t.push(r)}for(const r of t)delete e[r]}(n),i}}var Ie;!function(e){e[e.JSON=1313821514]="JSON",e[e.BIN=5130562]="BIN"}(Ie||(Ie={}));class Oe{constructor(){this.S=N.DEFAULT_INSTANCE,this.h=new Set,this.C={},this.F=g.INTERLEAVED,this.lastReadBytes=0,this.lastWriteBytes=0}setLogger(e){return this.S=e,this}registerExtensions(e){for(const t of e)this.h.add(t),t.register();return this}registerDependencies(e){return Object.assign(this.C,e),this}setVertexLayout(e){return this.F=e,this}async read(e){return await this.readJSON(await this.readAsJSON(e))}async readAsJSON(e){return e.match(/^data:application\/octet-stream;/)||this.detectFormat(e)===_.GLB?this.P(e):this.L(e)}async readJSON(e){return e=this.j(e),this._(e),be.read(e,{extensions:Array.from(this.h),dependencies:this.C,logger:this.S})}async binaryToJSON(e){const t=this.D(M.assertView(e));this._(t);const r=t.json;if(r.buffers&&r.buffers.some((e=>function(e,t){return void 0!==t.uri&&!(t.uri in e.resources)}(t,e))))throw new Error("Cannot resolve external buffers with binaryToJSON().");if(r.images&&r.images.some((e=>function(e,t){return void 0!==t.uri&&!(t.uri in e.resources)&&void 0===t.bufferView}(t,e))))throw new Error("Cannot resolve external images with binaryToJSON().");return t}async readBinary(e){return this.readJSON(await this.binaryToJSON(M.assertView(e)))}async writeJSON(e,t={}){if(t.format===_.GLB&&e.getRoot().listBuffers().length>1)throw new Error("GLB must have 0–1 buffers.");return Ce.write(e,{format:t.format||_.GLTF,basename:t.basename||"",logger:this.S,vertexLayout:this.F,dependencies:pe({},this.C),extensions:Array.from(this.h)})}async writeBinary(e){const{json:t,resources:r}=await this.writeJSON(e,{format:_.GLB}),n=new Uint32Array([1179937895,2,12]),i=JSON.stringify(t),o=M.pad(M.encodeText(i),32),s=M.toView(new Uint32Array([o.byteLength,1313821514])),a=M.concat([s,o]);n[n.length-1]+=a.byteLength;const c=Object.values(r)[0];if(!c||!c.byteLength)return M.concat([M.toView(n),a]);const l=M.pad(c,0),u=M.toView(new Uint32Array([l.byteLength,5130562])),h=M.concat([u,l]);return n[n.length-1]+=h.byteLength,M.concat([M.toView(n),a,h])}detectFormat(e){return"glb"===(W.isAbsoluteURL(e)?W.extension(e):C.extension(e))?_.GLB:_.GLTF}async L(e){this.lastReadBytes=0;const t=await this.readURI(e,"text");this.lastReadBytes+=t.length;const r={json:JSON.parse(t),resources:{}};return await this.k(r,this.dirname(e)),this._(r),r}async P(e){const t=await this.readURI(e,"view");this.lastReadBytes=t.byteLength;const r=this.D(t);return await this.k(r,this.dirname(e)),this._(r),r}async k(e,t){var r=this;const n=[...e.json.images||[],...e.json.buffers||[]].map((async function(n){const i=n.uri;if(!i||i.match(/data:/))return Promise.resolve();e.resources[i]=await r.readURI(r.resolve(t,i),"view"),r.lastReadBytes+=e.resources[i].byteLength}));await Promise.all(n)}_(e){function t(t){if(t.uri)if(t.uri in e.resources)M.assertView(e.resources[t.uri]);else if(t.uri.match(/data:/)){const r=`__${function(){for(let e=0;e<999;e++){const e=V();if(!z.has(e))return z.add(e),e}return""}()}.${C.extension(t.uri)}`;e.resources[r]=M.createBufferFromDataURI(t.uri),t.uri=r}}(e.json.images||[]).forEach((e=>{if(void 0===e.bufferView&&void 0===e.uri)throw new Error("Missing resource URI or buffer view.");t(e)})),(e.json.buffers||[]).forEach(t)}j(e){const{images:t,buffers:r}=e.json;return e={json:pe({},e.json),resources:pe({},e.resources)},t&&(e.json.images=t.map((e=>pe({},e)))),r&&(e.json.buffers=r.map((e=>pe({},e)))),e}D(e){const t=new Uint32Array(e.buffer,e.byteOffset,3);if(1179937895!==t[0])throw new Error("Invalid glTF asset.");if(2!==t[1])throw new Error(`Unsupported glTF binary version, "${t[1]}".`);const r=new Uint32Array(e.buffer,e.byteOffset+12,2);if(r[1]!==Ie.JSON)throw new Error("Missing required GLB JSON chunk.");const n=r[0],i=M.decodeText(M.toView(e,20,n)),o=JSON.parse(i),s=20+n;if(e.byteLength<=s)return{json:o,resources:{}};const a=new Uint32Array(e.buffer,e.byteOffset+s,2);if(a[1]!==Ie.BIN)throw new Error("Expected GLB BIN in second chunk.");const c=M.toView(e,s+8,a[0]);return{json:o,resources:{[f]:c}}}}class Pe extends Oe{constructor(e=W.DEFAULT_INIT){super(),this.V=e}async readURI(e,t){const r=await fetch(e,this.V);switch(t){case"view":return new Uint8Array(await r.arrayBuffer());case"text":return r.text()}}resolve(e,t){return W.resolve(e,t)}dirname(e){return W.dirname(e)}detectFormat(e){return"glb"===W.extension(e)?_.GLB:_.GLTF}}}},o={};function s(e){var t=o[e];if(void 0!==t)return t.exports;var r=o[e]={exports:{}};return i[e].call(r.exports,r,r.exports,s),r.exports}s.m=i,s.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return s.d(t,{a:t}),t},t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,s.t=function(r,n){if(1&n&&(r=this(r)),8&n)return r;if("object"==typeof r&&r){if(4&n&&r.__esModule)return r;if(16&n&&"function"==typeof r.then)return r}var i=Object.create(null);s.r(i);var o={};e=e||[null,t({}),t([]),t(t)];for(var a=2&n&&r;"object"==typeof a&&!~e.indexOf(a);a=t(a))Object.getOwnPropertyNames(a).forEach((e=>o[e]=()=>r[e]));return o.default=()=>r,s.d(i,o),i},s.d=(e,t)=>{for(var r in t)s.o(t,r)&&!s.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},s.f={},s.e=e=>Promise.all(Object.keys(s.f).reduce(((t,r)=>(s.f[r](e,t),t)),[])),s.u=e=>"chunk.bundle.js",s.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r={},n="editor:",s.l=(e,t,i,o)=>{if(r[e])r[e].push(t);else{var a,c;if(void 0!==i)for(var l=document.getElementsByTagName("script"),u=0;u<l.length;u++){var h=l[u];if(h.getAttribute("src")==e||h.getAttribute("data-webpack")==n+i){a=h;break}}a||(c=!0,(a=document.createElement("script")).charset="utf-8",a.timeout=120,s.nc&&a.setAttribute("nonce",s.nc),a.setAttribute("data-webpack",n+i),a.src=e),r[e]=[t];var p=(t,n)=>{a.onerror=a.onload=null,clearTimeout(d);var i=r[e];if(delete r[e],a.parentNode&&a.parentNode.removeChild(a),i&&i.forEach((e=>e(n))),t)return t(n)},d=setTimeout(p.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=p.bind(null,a.onerror),a.onload=p.bind(null,a.onload),c&&document.head.appendChild(a)}},s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;s.g.importScripts&&(e=s.g.location+"");var t=s.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var r=t.getElementsByTagName("script");if(r.length)for(var n=r.length-1;n>-1&&!e;)e=r[n--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),s.p=e})(),(()=>{var e={74:0,151:0};s.f.j=(t,r)=>{var n=s.o(e,t)?e[t]:void 0;if(0!==n)if(n)r.push(n[2]);else{var i=new Promise(((r,i)=>n=e[t]=[r,i]));r.push(n[2]=i);var o=s.p+s.u(t),a=new Error;s.l(o,(r=>{if(s.o(e,t)&&(0!==(n=e[t])&&(e[t]=void 0),n)){var i=r&&("load"===r.type?"missing":r.type),o=r&&r.target&&r.target.src;a.message="Loading chunk "+t+" failed.\n("+i+": "+o+")",a.name="ChunkLoadError",a.type=i,a.request=o,n[1](a)}}),"chunk-"+t,t)}};var t=(t,r)=>{var n,i,[o,a,c]=r,l=0;if(o.some((t=>0!==e[t]))){for(n in a)s.o(a,n)&&(s.m[n]=a[n]);if(c)c(s)}for(t&&t(r);l<o.length;l++)i=o[l],s.o(e,i)&&e[i]&&e[i][0](),e[i]=0},r=self.webpackChunkeditor=self.webpackChunkeditor||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})(),(()=>{"use strict";var e={};s.r(e),s.d(e,{AddObjectCommand:()=>C,AddScriptCommand:()=>Rt,MoveObjectCommand:()=>Ut,MultiCmdsCommand:()=>zt,RemoveObjectCommand:()=>Jt,RemoveScriptCommand:()=>rr,SetColorCommand:()=>lr,SetGeometryCommand:()=>gr,SetGeometryValueCommand:()=>Sr,SetMaterialColorCommand:()=>Ir,SetMaterialCommand:()=>Fr,SetMaterialMapCommand:()=>Hr,SetMaterialValueCommand:()=>Zr,SetMaterialVectorCommand:()=>on,SetPositionCommand:()=>pn,SetRotationCommand:()=>_n,SetScaleCommand:()=>En,SetSceneCommand:()=>D,SetScriptValueCommand:()=>Nn,SetUuidCommand:()=>m,SetValueCommand:()=>w});var t=s(24),r=s(614);function n(){return{getKey:function(e){},setKey:function(){},clear:function(){}}}var i=s(27);function o(e){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o(e)}function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(i=n.key,s=void 0,s=function(e,t){if("object"!==o(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==o(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(i,"string"),"symbol"===o(s)?s:String(s)),n)}var i,s}var c=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=-1,this.inMemory=!1,this.updatable=!1,this.type="",this.name="",this.editor=t}var t,r,n;return t=e,(r=[{key:"toJSON",value:function(){var e={};return e.type=this.type,e.id=this.id,e.name=this.name,e}},{key:"fromJSON",value:function(e){this.inMemory=!0,this.type=e.type,this.id=e.id,this.name=e.name}}])&&a(t.prototype,r),n&&a(t,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function l(e){return l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l(e)}function u(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(i=n.key,o=void 0,o=function(e,t){if("object"!==l(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==l(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(i,"string"),"symbol"===l(o)?o:String(o)),n)}var i,o}function h(){return h="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=f(e)););return e}(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(arguments.length<3?e:r):i.value}},h.apply(this,arguments)}function p(e,t){return p=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},p(e,t)}function d(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=f(e);if(t){var i=f(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return function(e,t){if(t&&("object"===l(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,r)}}function f(e){return f=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},f(e)}var m=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&p(e,t)}(o,e);var t,r,n,i=d(o);function o(e,t,r){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(n=i.call(this,e)).type="SetUuidCommand",n.name="Update UUID",n.object=t,n.oldUuid=void 0!==t?t.uuid:void 0,n.newUuid=r,n}return t=o,(r=[{key:"execute",value:function(){this.object.uuid=this.newUuid,this.editor.signals.objectChanged.dispatch(this.object),this.editor.signals.sceneGraphChanged.dispatch()}},{key:"undo",value:function(){this.object.uuid=this.oldUuid,this.editor.signals.objectChanged.dispatch(this.object),this.editor.signals.sceneGraphChanged.dispatch()}},{key:"toJSON",value:function(){var e=h(f(o.prototype),"toJSON",this).call(this,this);return e.oldUuid=this.oldUuid,e.newUuid=this.newUuid,e}},{key:"fromJSON",value:function(e){h(f(o.prototype),"fromJSON",this).call(this,e),this.oldUuid=e.oldUuid,this.newUuid=e.newUuid,this.object=this.editor.objectByUuid(e.oldUuid),void 0===this.object&&(this.object=this.editor.objectByUuid(e.newUuid))}}])&&u(t.prototype,r),n&&u(t,n),Object.defineProperty(t,"prototype",{writable:!1}),o}(c);function g(e){return g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},g(e)}function y(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(i=n.key,o=void 0,o=function(e,t){if("object"!==g(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==g(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(i,"string"),"symbol"===g(o)?o:String(o)),n)}var i,o}function v(){return v="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=x(e)););return e}(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(arguments.length<3?e:r):i.value}},v.apply(this,arguments)}function _(e,t){return _=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},_(e,t)}function b(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=x(e);if(t){var i=x(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return function(e,t){if(t&&("object"===g(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,r)}}function x(e){return x=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},x(e)}var w=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_(e,t)}(o,e);var t,r,n,i=b(o);function o(e,t,r,n){var s;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(s=i.call(this,e)).type="SetValueCommand",s.name="Set ".concat(r),s.updatable=!0,s.object=t,s.attributeName=r,s.oldValue=void 0!==t?t[r]:void 0,s.newValue=n,s}return t=o,(r=[{key:"execute",value:function(){this.object[this.attributeName]=this.newValue,this.editor.signals.objectChanged.dispatch(this.object)}},{key:"undo",value:function(){this.object[this.attributeName]=this.oldValue,this.editor.signals.objectChanged.dispatch(this.object)}},{key:"update",value:function(e){this.newValue=e.newValue}},{key:"toJSON",value:function(){var e=v(x(o.prototype),"toJSON",this).call(this,this);return e.objectUuid=this.object.uuid,e.attributeName=this.attributeName,e.oldValue=this.oldValue,e.newValue=this.newValue,e}},{key:"fromJSON",value:function(e){v(x(o.prototype),"fromJSON",this).call(this,e),this.attributeName=e.attributeName,this.oldValue=e.oldValue,this.newValue=e.newValue,this.object=this.editor.objectByUuid(e.objectUuid)}}])&&y(t.prototype,r),n&&y(t,n),Object.defineProperty(t,"prototype",{writable:!1}),o}(c);function S(e){return S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},S(e)}function M(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(i=n.key,o=void 0,o=function(e,t){if("object"!==S(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==S(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(i,"string"),"symbol"===S(o)?o:String(o)),n)}var i,o}function T(){return T="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=R(e)););return e}(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(arguments.length<3?e:r):i.value}},T.apply(this,arguments)}function E(e,t){return E=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},E(e,t)}function A(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=R(e);if(t){var i=R(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return function(e,t){if(t&&("object"===S(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,r)}}function R(e){return R=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},R(e)}var C=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&E(e,t)}(s,e);var r,n,i,o=A(s);function s(e,t){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(r=o.call(this,e)).type="AddObjectCommand",r.object=t,void 0!==t&&(r.name="Add Object: ".concat(t.name)),r}return r=s,(n=[{key:"execute",value:function(){this.editor.addObject(this.object),this.editor.select(this.object)}},{key:"undo",value:function(){this.editor.removeObject(this.object),this.editor.deselect()}},{key:"toJSON",value:function(){var e=T(R(s.prototype),"toJSON",this).call(this,this);return e.object=this.object.toJSON(),e}},{key:"fromJSON",value:function(e){if(T(R(s.prototype),"fromJSON",this).call(this,e),this.object=this.editor.objectByUuid(e.object.object.uuid),void 0===this.object){var r=new t.ObjectLoader;this.object=r.parse(e.object)}}}])&&M(r.prototype,n),i&&M(r,i),Object.defineProperty(r,"prototype",{writable:!1}),s}(c);function I(e){return I="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},I(e)}function O(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(i=n.key,o=void 0,o=function(e,t){if("object"!==I(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==I(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(i,"string"),"symbol"===I(o)?o:String(o)),n)}var i,o}function P(){return P="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=U(e)););return e}(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(arguments.length<3?e:r):i.value}},P.apply(this,arguments)}function N(e,t){return N=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},N(e,t)}function L(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=U(e);if(t){var i=U(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return function(e,t){if(t&&("object"===I(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,r)}}function U(e){return U=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},U(e)}var D=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&N(e,t)}(o,e);var t,r,n,i=L(o);function o(e,t){var r;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(r=i.call(this,e)).type="SetSceneCommand",r.name="Set Scene",r.cmdArray=[],void 0!==t)for(r.cmdArray.push(new m(r.editor,r.editor.scene,t.uuid)),r.cmdArray.push(new w(r.editor,r.editor.scene,"name",t.name)),r.cmdArray.push(new w(r.editor,r.editor.scene,"userData",JSON.parse(JSON.stringify(t.userData))));t.children.length>0;){var n=t.children.pop();r.cmdArray.push(new C(r.editor,n))}return r}return t=o,(r=[{key:"execute",value:function(){this.editor.signals.sceneGraphChanged.active=!1;for(var e=0;e<this.cmdArray.length;e++)this.cmdArray[e].execute();this.editor.signals.sceneGraphChanged.active=!0,this.editor.signals.sceneGraphChanged.dispatch()}},{key:"undo",value:function(){this.editor.signals.sceneGraphChanged.active=!1;for(var e=this.cmdArray.length-1;e>=0;e--)this.cmdArray[e].undo();this.editor.signals.sceneGraphChanged.active=!0,this.editor.signals.sceneGraphChanged.dispatch()}},{key:"toJSON",value:function(){for(var e=P(U(o.prototype),"toJSON",this).call(this,this),t=[],r=0;r<this.cmdArray.length;r++)t.push(this.cmdArray[r].toJSON());return e.cmds=t,e}},{key:"fromJSON",value:function(e){P(U(o.prototype),"fromJSON",this).call(this,e);for(var t=e.cmds,r=0;r<t.length;r++){var n=new window[t[r].type];n.fromJSON(t[r]),this.cmdArray.push(n)}}}])&&O(t.prototype,r),n&&O(t,n),Object.defineProperty(t,"prototype",{writable:!1}),o}(c),F={createFilesMap:function(e){for(var t={},r=0;r<e.length;r++){var n=e[r];t[n.name]=n}return t},getFilesFromItemList:function(e,t){var r=0,n=0,i=[],o={};function s(){++r===n&&t(i,o)}function a(e){e.isDirectory?e.createReader().readEntries((function(e){for(var t=0;t<e.length;t++)a(e[t]);s()})):e.isFile&&e.file((function(t){i.push(t),o[e.fullPath.slice(1)]=t,s()}));n++}for(var c=0;c<e.length;c++){var l=e[c];"file"===l.kind&&a(l.webkitGetAsEntry())}}},B=s(922);function k(e){return k="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},k(e)}function j(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(i=n.key,o=void 0,o=function(e,t){if("object"!==k(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==k(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(i,"string"),"symbol"===k(o)?o:String(o)),n)}var i,o}function G(e,t){return G=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},G(e,t)}function z(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=V(e);if(t){var i=V(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return function(e,t){if(t&&("object"===k(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,r)}}function V(e){return V=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},V(e)}var H=new WeakMap,W=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&G(e,t)}(s,e);var r,n,i,o=z(s);function s(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(t=o.call(this,e)).decoderPath="",t.decoderConfig={},t.decoderBinary=null,t.decoderPending=null,t.workerLimit=4,t.workerPool=[],t.workerNextTaskID=1,t.workerSourceURL="",t.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},t.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"},t}return r=s,n=[{key:"setDecoderPath",value:function(e){return this.decoderPath=e,this}},{key:"setDecoderConfig",value:function(e){return this.decoderConfig=e,this}},{key:"setWorkerLimit",value:function(e){return this.workerLimit=e,this}},{key:"load",value:function(e,r,n,i){var o=this,s=new t.FileLoader(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,(function(e){o.parse(e,r,i)}),n,i)}},{key:"parse",value:function(e,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};this.decodeDracoFile(e,r,null,null,t.SRGBColorSpace,n).catch(n)}},{key:"decodeDracoFile",value:function(e,r,n,i){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:t.LinearSRGBColorSpace,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:function(){},a={attributeIDs:n||this.defaultAttributeIDs,attributeTypes:i||this.defaultAttributeTypes,useUniqueIDs:!!n,vertexColorSpace:o};return this.decodeGeometry(e,a).then(r).catch(s)}},{key:"decodeGeometry",value:function(e,t){var r,n=this,i=JSON.stringify(t);if(H.has(e)){var o=H.get(e);if(o.key===i)return o.promise;if(0===e.byteLength)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}var s=this.workerNextTaskID++,a=e.byteLength,c=this._getWorker(s,a).then((function(n){return r=n,new Promise((function(n,i){r._callbacks[s]={resolve:n,reject:i},r.postMessage({type:"decode",id:s,taskConfig:t,buffer:e},[e])}))})).then((function(e){return n._createGeometry(e.geometry)}));return c.catch((function(){return!0})).then((function(){r&&s&&n._releaseTask(r,s)})),H.set(e,{key:i,promise:c}),c}},{key:"_createGeometry",value:function(e){var r=new t.BufferGeometry;e.index&&r.setIndex(new t.BufferAttribute(e.index.array,1));for(var n=0;n<e.attributes.length;n++){var i=e.attributes[n],o=i.name,s=i.array,a=i.itemSize,c=new t.BufferAttribute(s,a);"color"===o&&(this._assignVertexColorSpace(c,i.vertexColorSpace),c.normalized=s instanceof Float32Array==0),r.setAttribute(o,c)}return r}},{key:"_assignVertexColorSpace",value:function(e,r){if(r===t.SRGBColorSpace)for(var n=new t.Color,i=0,o=e.count;i<o;i++)n.fromBufferAttribute(e,i).convertSRGBToLinear(),e.setXYZ(i,n.r,n.g,n.b)}},{key:"_loadLibrary",value:function(e,r){var n=new t.FileLoader(this.manager);return n.setPath(this.decoderPath),n.setResponseType(r),n.setWithCredentials(this.withCredentials),new Promise((function(t,r){n.load(e,t,void 0,r)}))}},{key:"preload",value:function(){return this._initDecoder(),this}},{key:"_initDecoder",value:function(){var e=this;if(this.decoderPending)return this.decoderPending;var t="object"!==("undefined"==typeof WebAssembly?"undefined":k(WebAssembly))||"js"===this.decoderConfig.type,r=[];return t?r.push(this._loadLibrary("draco_decoder.js","text")):(r.push(this._loadLibrary("draco_decoder_nodejs.js","text")),r.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(r).then((function(r){var n=r[0];t||(e.decoderConfig.wasmBinary=r[1]);var i=X.toString(),o=["/* draco decoder */",n,"","/* worker */",i.substring(i.indexOf("{")+1,i.lastIndexOf("}"))].join("\n");e.workerSourceURL=URL.createObjectURL(new Blob([o]))})),this.decoderPending}},{key:"_getWorker",value:function(e,t){var r=this;return this._initDecoder().then((function(){if(r.workerPool.length<r.workerLimit){var n=new Worker(r.workerSourceURL);n._callbacks={},n._taskCosts={},n._taskLoad=0,n.postMessage({type:"init",decoderConfig:r.decoderConfig}),n.onmessage=function(e){var t=e.data;switch(t.type){case"decode":n._callbacks[t.id].resolve(t);break;case"error":n._callbacks[t.id].reject(t);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+t.type+'"')}},r.workerPool.push(n)}else r.workerPool.sort((function(e,t){return e._taskLoad>t._taskLoad?-1:1}));var i=r.workerPool[r.workerPool.length-1];return i._taskCosts[e]=t,i._taskLoad+=t,i}))}},{key:"_releaseTask",value:function(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}},{key:"debug",value:function(){console.log("Task load: ",this.workerPool.map((function(e){return e._taskLoad})))}},{key:"dispose",value:function(){for(var e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,""!==this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),this}}],n&&j(r.prototype,n),i&&j(r,i),Object.defineProperty(r,"prototype",{writable:!1}),s}(t.Loader);function X(){var e,t;function r(e,t,r,n,i,o){var s=o.num_components(),a=r.num_points()*s,c=a*i.BYTES_PER_ELEMENT,l=function(e,t){switch(t){case Float32Array:return e.DT_FLOAT32;case Int8Array:return e.DT_INT8;case Int16Array:return e.DT_INT16;case Int32Array:return e.DT_INT32;case Uint8Array:return e.DT_UINT8;case Uint16Array:return e.DT_UINT16;case Uint32Array:return e.DT_UINT32}}(e,i),u=e._malloc(c);t.GetAttributeDataArrayForAllPoints(r,o,l,c,u);var h=new i(e.HEAPF32.buffer,u,a).slice();return e._free(u),{name:n,array:h,itemSize:s}}onmessage=function(n){var i=n.data;switch(i.type){case"init":e=i.decoderConfig,t=new Promise((function(t){e.onModuleLoaded=function(e){t({draco:e})},DracoDecoderModule(e)}));break;case"decode":var o=i.buffer,s=i.taskConfig;t.then((function(e){var t=e.draco,n=new t.Decoder;try{var a=function(e,t,n,i){var o,s,a=i.attributeIDs,c=i.attributeTypes,l=t.GetEncodedGeometryType(n);if(l===e.TRIANGULAR_MESH)o=new e.Mesh,s=t.DecodeArrayToMesh(n,n.byteLength,o);else{if(l!==e.POINT_CLOUD)throw new Error("THREE.DRACOLoader: Unexpected geometry type.");o=new e.PointCloud,s=t.DecodeArrayToPointCloud(n,n.byteLength,o)}if(!s.ok()||0===o.ptr)throw new Error("THREE.DRACOLoader: Decoding failed: "+s.error_msg());var u={index:null,attributes:[]};for(var h in a){var p=self[c[h]],d=void 0,f=void 0;if(i.useUniqueIDs)f=a[h],d=t.GetAttributeByUniqueId(o,f);else{if(-1===(f=t.GetAttributeId(o,e[a[h]])))continue;d=t.GetAttribute(o,f)}var m=r(e,t,o,h,p,d);"color"===h&&(m.vertexColorSpace=i.vertexColorSpace),u.attributes.push(m)}l===e.TRIANGULAR_MESH&&(u.index=function(e,t,r){var n=r.num_faces(),i=3*n,o=4*i,s=e._malloc(o);t.GetTrianglesUInt32Array(r,o,s);var a=new Uint32Array(e.HEAPF32.buffer,s,i).slice();return e._free(s),{array:a,itemSize:1}}(e,t,o));return e.destroy(o),u}(t,n,new Int8Array(o),s),c=a.attributes.map((function(e){return e.array.buffer}));a.index&&c.push(a.index.array.buffer),self.postMessage({type:"decode",id:i.id,geometry:a},c)}catch(e){console.error(e),self.postMessage({type:"error",id:i.id,error:e.message})}finally{t.destroy(n)}}))}}}var Y=s(48);function q(e){return q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},q(e)}function J(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function K(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(i=n.key,o=void 0,o=function(e,t){if("object"!==q(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==q(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(i,"string"),"symbol"===q(o)?o:String(o)),n)}var i,o}function Z(e,t,r){return t&&K(e.prototype,t),r&&K(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function Q(){return Q="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=re(e)););return e}(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(arguments.length<3?e:r):i.value}},Q.apply(this,arguments)}function $(e,t){return $=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},$(e,t)}function ee(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=re(e);if(t){var i=re(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return function(e,t){if(t&&("object"===q(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return te(e)}(this,r)}}function te(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function re(e){return re=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},re(e)}var ne=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&$(e,t)}(n,e);var r=ee(n);function n(e){var i;J(this,n),(i=r.call(this)).isGLTFSpecularGlossinessMaterial=!0;var o=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),s=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),a=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec3 texelSpecular = texture2D( specularMap, vUv ).rgb;","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular;","#endif"].join("\n"),c=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),l=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.roughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.specularColor = specularFactor;"].join("\n"),u={specular:{value:(new t.Color).setHex(16777215)},glossiness:{value:1},specularMap:{value:null},specularMapTransform:{value:new t.Matrix3},glossinessMap:{value:null}};return i._extraUniforms=u,i.onBeforeCompile=function(e){for(var t in u)e.uniforms[t]=u[t];e.fragmentShader=e.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",o).replace("#include <metalnessmap_pars_fragment>",s).replace("#include <roughnessmap_fragment>",a).replace("#include <metalnessmap_fragment>",c).replace("#include <lights_physical_fragment>",l)},Object.defineProperties(te(i),{specular:{get:function(){return u.specular.value},set:function(e){u.specular.value=e}},specularMap:{get:function(){return u.specularMap.value},set:function(e){u.specularMap.value=e,e?(this.defines.USE_SPECULARMAP="",this.defines.USE_UV=""):(delete this.defines.USE_SPECULARMAP,delete this.defines.USE_UV)}},glossiness:{get:function(){return u.glossiness.value},set:function(e){u.glossiness.value=e}},glossinessMap:{get:function(){return u.glossinessMap.value},set:function(e){u.glossinessMap.value=e,e?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete i.metalness,delete i.roughness,delete i.metalnessMap,delete i.roughnessMap,i.setValues(e),i}return Z(n,[{key:"copy",value:function(e){return Q(re(n.prototype),"copy",this).call(this,e),this.specularMap=e.specularMap,this.specular.copy(e.specular),this.glossinessMap=e.glossinessMap,this.glossiness=e.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this}},{key:"toJSON",value:function(e){var t=Q(re(n.prototype),"toJSON",this).call(this,e);return t.isGLTFSpecularGlossinessMaterial=!0,t}}]),n}(t.MeshStandardMaterial),ie=function(){function e(){J(this,e),this.name="KHR_materials_pbrSpecularGlossiness",this.specularGlossinessParams=["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity"]}return Z(e,[{key:"getMaterialType",value:function(){return ne}},{key:"extendParams",value:function(e,r,n){var i=r.extensions[this.name];e.color=new t.Color(1,1,1),e.opacity=1;var o=[];if(Array.isArray(i.diffuseFactor)){var s=i.diffuseFactor;e.color.fromArray(s),e.opacity=s[3]}if(void 0!==i.diffuseTexture&&o.push(n.assignTexture(e,"map",i.diffuseTexture,t.SRGBColorSpace)),e.emissive=new t.Color(0,0,0),e.glossiness=void 0!==i.glossinessFactor?i.glossinessFactor:1,e.specular=new t.Color(1,1,1),Array.isArray(i.specularFactor)&&e.specular.fromArray(i.specularFactor),void 0!==i.specularGlossinessTexture){var a=i.specularGlossinessTexture;o.push(n.assignTexture(e,"glossinessMap",a)),o.push(n.assignTexture(e,"specularMap",a,t.SRGBColorSpace))}return Promise.all(o)}},{key:"createMaterial",value:function(e){var r=new ne(e);return r.fog=!0,r.color=e.color,r.map=void 0===e.map?null:e.map,r.lightMap=null,r.lightMapIntensity=1,r.aoMap=void 0===e.aoMap?null:e.aoMap,r.aoMapIntensity=1,r.emissive=e.emissive,r.emissiveIntensity=void 0===e.emissiveIntensity?1:e.emissiveIntensity,r.emissiveMap=void 0===e.emissiveMap?null:e.emissiveMap,r.bumpMap=void 0===e.bumpMap?null:e.bumpMap,r.bumpScale=1,r.normalMap=void 0===e.normalMap?null:e.normalMap,r.normalMapType=t.TangentSpaceNormalMap,e.normalScale&&(r.normalScale=e.normalScale),r.displacementMap=null,r.displacementScale=1,r.displacementBias=0,r.specularMap=void 0===e.specularMap?null:e.specularMap,r.specular=e.specular,r.glossinessMap=void 0===e.glossinessMap?null:e.glossinessMap,r.glossiness=e.glossiness,r.alphaMap=null,r.envMap=void 0===e.envMap?null:e.envMap,r.envMapIntensity=1,r}}]),e}();function oe(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,o,s,a=[],c=!0,l=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=o.call(r)).done)&&(a.push(n.value),a.length!==t);c=!0);}catch(e){l=!0,i=e}finally{try{if(!c&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(l)throw i}}return a}}(e,t)||le(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function se(e){return se="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},se(e)}function ae(){return ae="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=ye(e)););return e}(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(arguments.length<3?e:r):i.value}},ae.apply(this,arguments)}function ce(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=le(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,a=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){a=!0,o=e},f:function(){try{s||null==r.return||r.return()}finally{if(a)throw o}}}}function le(e,t){if(e){if("string"==typeof e)return ue(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?ue(e,t):void 0}}function ue(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function he(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function pe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(i=n.key,o=void 0,o=function(e,t){if("object"!==se(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==se(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(i,"string"),"symbol"===se(o)?o:String(o)),n)}var i,o}function de(e,t,r){return t&&pe(e.prototype,t),r&&pe(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function fe(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&me(e,t)}function me(e,t){return me=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},me(e,t)}function ge(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=ye(e);if(t){var i=ye(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return function(e,t){if(t&&("object"===se(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,r)}}function ye(e){return ye=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},ye(e)}var ve=function(e){fe(n,e);var r=ge(n);function n(e){var t;return he(this,n),(t=r.call(this,e)).dracoLoader=null,t.ktx2Loader=null,t.meshoptDecoder=null,t.pluginCallbacks=[],t.register((function(e){return new Me(e)})),t.register((function(e){return new Te(e)})),t.register((function(e){return new Le(e)})),t.register((function(e){return new Ue(e)})),t.register((function(e){return new De(e)})),t.register((function(e){return new Ae(e)})),t.register((function(e){return new Re(e)})),t.register((function(e){return new Ce(e)})),t.register((function(e){return new Ie(e)})),t.register((function(e){return new Se(e)})),t.register((function(e){return new Oe(e)})),t.register((function(e){return new Ee(e)})),t.register((function(e){return new Ne(e)})),t.register((function(e){return new Pe(e)})),t.register((function(e){return new xe(e)})),t.register((function(e){return new Fe(e)})),t.register((function(e){return new Be(e)})),t}return de(n,[{key:"load",value:function(e,r,n,i){var o,s=this;if(""!==this.resourcePath)o=this.resourcePath;else if(""!==this.path){var a=t.LoaderUtils.extractUrlBase(e);o=t.LoaderUtils.resolveURL(a,this.path)}else o=t.LoaderUtils.extractUrlBase(e);this.manager.itemStart(e);var c=function(t){i?i(t):console.error(t),s.manager.itemError(e),s.manager.itemEnd(e)},l=new t.FileLoader(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(e,(function(t){try{s.parse(t,o,(function(t){r(t),s.manager.itemEnd(e)}),c)}catch(e){c(e)}}),n,c)}},{key:"setDRACOLoader",value:function(e){return this.dracoLoader=e,this}},{key:"setDDSLoader",value:function(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}},{key:"setKTX2Loader",value:function(e){return this.ktx2Loader=e,this}},{key:"setMeshoptDecoder",value:function(e){return this.meshoptDecoder=e,this}},{key:"register",value:function(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}},{key:"unregister",value:function(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}},{key:"parse",value:function(e,t,r,n){var i,o={},s={},a=new TextDecoder;if("string"==typeof e)i=JSON.parse(e);else if(e instanceof ArrayBuffer){if(a.decode(new Uint8Array(e,0,4))===ke){try{o[be.KHR_BINARY_GLTF]=new ze(e)}catch(e){return void(n&&n(e))}i=JSON.parse(o[be.KHR_BINARY_GLTF].content)}else i=JSON.parse(a.decode(e))}else i=e;if(void 0===i.asset||i.asset.version[0]<2)n&&n(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));else{var c=new dt(i,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});c.fileLoader.setRequestHeader(this.requestHeader);for(var l=0;l<this.pluginCallbacks.length;l++){var u=this.pluginCallbacks[l](c);u.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),s[u.name]=u,o[u.name]=!0}if(i.extensionsUsed)for(var h=0;h<i.extensionsUsed.length;++h){var p=i.extensionsUsed[h],d=i.extensionsRequired||[];switch(p){case be.KHR_MATERIALS_UNLIT:o[p]=new we;break;case be.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:o[p]=new ie;break;case be.KHR_DRACO_MESH_COMPRESSION:o[p]=new Ve(i,this.dracoLoader);break;case be.KHR_TEXTURE_TRANSFORM:o[p]=new He;break;case be.KHR_MESH_QUANTIZATION:o[p]=new We;break;default:d.indexOf(p)>=0&&void 0===s[p]&&console.warn('THREE.GLTFLoader: Unknown extension "'+p+'".')}}c.setExtensions(o),c.setPlugins(s),c.parse(r,n)}}},{key:"parseAsync",value:function(e,t){var r=this;return new Promise((function(n,i){r.parse(e,t,n,i)}))}}]),n}(t.Loader);function _e(){var e={};return{get:function(t){return e[t]},add:function(t,r){e[t]=r},remove:function(t){delete e[t]},removeAll:function(){e={}}}}var be={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"},xe=function(){function e(t){he(this,e),this.parser=t,this.name=be.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}return de(e,[{key:"_markDefs",value:function(){for(var e=this.parser,t=this.parser.json.nodes||[],r=0,n=t.length;r<n;r++){var i=t[r];i.extensions&&i.extensions[this.name]&&void 0!==i.extensions[this.name].light&&e._addNodeRef(this.cache,i.extensions[this.name].light)}}},{key:"_loadLight",value:function(e){var r=this.parser,n="light:"+e,i=r.cache.get(n);if(i)return i;var o,s=r.json,a=((s.extensions&&s.extensions[this.name]||{}).lights||[])[e],c=new t.Color(16777215);void 0!==a.color&&c.setRGB(a.color[0],a.color[1],a.color[2],t.LinearSRGBColorSpace);var l=void 0!==a.range?a.range:0;switch(a.type){case"directional":(o=new t.DirectionalLight(c)).target.position.set(0,0,-1),o.add(o.target);break;case"point":(o=new t.PointLight(c)).distance=l;break;case"spot":(o=new t.SpotLight(c)).distance=l,a.spot=a.spot||{},a.spot.innerConeAngle=void 0!==a.spot.innerConeAngle?a.spot.innerConeAngle:0,a.spot.outerConeAngle=void 0!==a.spot.outerConeAngle?a.spot.outerConeAngle:Math.PI/4,o.angle=a.spot.outerConeAngle,o.penumbra=1-a.spot.innerConeAngle/a.spot.outerConeAngle,o.target.position.set(0,0,-1),o.add(o.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+a.type)}return o.position.set(0,0,0),o.decay=2,at(o,a),void 0!==a.intensity&&(o.intensity=a.intensity),o.name=r.createUniqueName(a.name||"light_"+e),i=Promise.resolve(o),r.cache.add(n,i),i}},{key:"getDependency",value:function(e,t){if("light"===e)return this._loadLight(t)}},{key:"createNodeAttachment",value:function(e){var t=this,r=this.parser,n=r.json.nodes[e],i=(n.extensions&&n.extensions[this.name]||{}).light;return void 0===i?null:this._loadLight(i).then((function(e){return r._getNodeRef(t.cache,i,e)}))}}]),e}(),we=function(){function e(){he(this,e),this.name=be.KHR_MATERIALS_UNLIT}return de(e,[{key:"getMaterialType",value:function(){return t.MeshBasicMaterial}},{key:"extendParams",value:function(e,r,n){var i=[];e.color=new t.Color(1,1,1),e.opacity=1;var o=r.pbrMetallicRoughness;if(o){if(Array.isArray(o.baseColorFactor)){var s=o.baseColorFactor;e.color.setRGB(s[0],s[1],s[2],t.LinearSRGBColorSpace),e.opacity=s[3]}void 0!==o.baseColorTexture&&i.push(n.assignTexture(e,"map",o.baseColorTexture,t.SRGBColorSpace))}return Promise.all(i)}}]),e}(),Se=function(){function e(t){he(this,e),this.parser=t,this.name=be.KHR_MATERIALS_EMISSIVE_STRENGTH}return de(e,[{key:"extendMaterialParams",value:function(e,t){var r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();var n=r.extensions[this.name].emissiveStrength;return void 0!==n&&(t.emissiveIntensity=n),Promise.resolve()}}]),e}(),Me=function(){function e(t){he(this,e),this.parser=t,this.name=be.KHR_MATERIALS_CLEARCOAT}return de(e,[{key:"getMaterialType",value:function(e){var r=this.parser.json.materials[e];return r.extensions&&r.extensions[this.name]?t.MeshPhysicalMaterial:null}},{key:"extendMaterialParams",value:function(e,r){var n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();var o=[],s=i.extensions[this.name];if(void 0!==s.clearcoatFactor&&(r.clearcoat=s.clearcoatFactor),void 0!==s.clearcoatTexture&&o.push(n.assignTexture(r,"clearcoatMap",s.clearcoatTexture)),void 0!==s.clearcoatRoughnessFactor&&(r.clearcoatRoughness=s.clearcoatRoughnessFactor),void 0!==s.clearcoatRoughnessTexture&&o.push(n.assignTexture(r,"clearcoatRoughnessMap",s.clearcoatRoughnessTexture)),void 0!==s.clearcoatNormalTexture&&(o.push(n.assignTexture(r,"clearcoatNormalMap",s.clearcoatNormalTexture)),void 0!==s.clearcoatNormalTexture.scale)){var a=s.clearcoatNormalTexture.scale;r.clearcoatNormalScale=new t.Vector2(a,a)}return Promise.all(o)}}]),e}(),Te=function(){function e(t){he(this,e),this.parser=t,this.name=be.KHR_MATERIALS_DISPERSION}return de(e,[{key:"getMaterialType",value:function(e){var r=this.parser.json.materials[e];return r.extensions&&r.extensions[this.name]?t.MeshPhysicalMaterial:null}},{key:"extendMaterialParams",value:function(e,t){var r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();var n=r.extensions[this.name];return t.dispersion=void 0!==n.dispersion?n.dispersion:0,Promise.resolve()}}]),e}(),Ee=function(){function e(t){he(this,e),this.parser=t,this.name=be.KHR_MATERIALS_IRIDESCENCE}return de(e,[{key:"getMaterialType",value:function(e){var r=this.parser.json.materials[e];return r.extensions&&r.extensions[this.name]?t.MeshPhysicalMaterial:null}},{key:"extendMaterialParams",value:function(e,t){var r=this.parser,n=r.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();var i=[],o=n.extensions[this.name];return void 0!==o.iridescenceFactor&&(t.iridescence=o.iridescenceFactor),void 0!==o.iridescenceTexture&&i.push(r.assignTexture(t,"iridescenceMap",o.iridescenceTexture)),void 0!==o.iridescenceIor&&(t.iridescenceIOR=o.iridescenceIor),void 0===t.iridescenceThicknessRange&&(t.iridescenceThicknessRange=[100,400]),void 0!==o.iridescenceThicknessMinimum&&(t.iridescenceThicknessRange[0]=o.iridescenceThicknessMinimum),void 0!==o.iridescenceThicknessMaximum&&(t.iridescenceThicknessRange[1]=o.iridescenceThicknessMaximum),void 0!==o.iridescenceThicknessTexture&&i.push(r.assignTexture(t,"iridescenceThicknessMap",o.iridescenceThicknessTexture)),Promise.all(i)}}]),e}(),Ae=function(){function e(t){he(this,e),this.parser=t,this.name=be.KHR_MATERIALS_SHEEN}return de(e,[{key:"getMaterialType",value:function(e){var r=this.parser.json.materials[e];return r.extensions&&r.extensions[this.name]?t.MeshPhysicalMaterial:null}},{key:"extendMaterialParams",value:function(e,r){var n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();var o=[];r.sheenColor=new t.Color(0,0,0),r.sheenRoughness=0,r.sheen=1;var s=i.extensions[this.name];if(void 0!==s.sheenColorFactor){var a=s.sheenColorFactor;r.sheenColor.setRGB(a[0],a[1],a[2],t.LinearSRGBColorSpace)}return void 0!==s.sheenRoughnessFactor&&(r.sheenRoughness=s.sheenRoughnessFactor),void 0!==s.sheenColorTexture&&o.push(n.assignTexture(r,"sheenColorMap",s.sheenColorTexture,t.SRGBColorSpace)),void 0!==s.sheenRoughnessTexture&&o.push(n.assignTexture(r,"sheenRoughnessMap",s.sheenRoughnessTexture)),Promise.all(o)}}]),e}(),Re=function(){function e(t){he(this,e),this.parser=t,this.name=be.KHR_MATERIALS_TRANSMISSION}return de(e,[{key:"getMaterialType",value:function(e){var r=this.parser.json.materials[e];return r.extensions&&r.extensions[this.name]?t.MeshPhysicalMaterial:null}},{key:"extendMaterialParams",value:function(e,t){var r=this.parser,n=r.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();var i=[],o=n.extensions[this.name];return void 0!==o.transmissionFactor&&(t.transmission=o.transmissionFactor),void 0!==o.transmissionTexture&&i.push(r.assignTexture(t,"transmissionMap",o.transmissionTexture)),Promise.all(i)}}]),e}(),Ce=function(){function e(t){he(this,e),this.parser=t,this.name=be.KHR_MATERIALS_VOLUME}return de(e,[{key:"getMaterialType",value:function(e){var r=this.parser.json.materials[e];return r.extensions&&r.extensions[this.name]?t.MeshPhysicalMaterial:null}},{key:"extendMaterialParams",value:function(e,r){var n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();var o=[],s=i.extensions[this.name];r.thickness=void 0!==s.thicknessFactor?s.thicknessFactor:0,void 0!==s.thicknessTexture&&o.push(n.assignTexture(r,"thicknessMap",s.thicknessTexture)),r.attenuationDistance=s.attenuationDistance||1/0;var a=s.attenuationColor||[1,1,1];return r.attenuationColor=(new t.Color).setRGB(a[0],a[1],a[2],t.LinearSRGBColorSpace),Promise.all(o)}}]),e}(),Ie=function(){function e(t){he(this,e),this.parser=t,this.name=be.KHR_MATERIALS_IOR}return de(e,[{key:"getMaterialType",value:function(e){var r=this.parser.json.materials[e];return r.extensions&&r.extensions[this.name]?t.MeshPhysicalMaterial:null}},{key:"extendMaterialParams",value:function(e,t){var r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();var n=r.extensions[this.name];return t.ior=void 0!==n.ior?n.ior:1.5,Promise.resolve()}}]),e}(),Oe=function(){function e(t){he(this,e),this.parser=t,this.name=be.KHR_MATERIALS_SPECULAR}return de(e,[{key:"getMaterialType",value:function(e){var r=this.parser.json.materials[e];return r.extensions&&r.extensions[this.name]?t.MeshPhysicalMaterial:null}},{key:"extendMaterialParams",value:function(e,r){var n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();var o=[],s=i.extensions[this.name];r.specularIntensity=void 0!==s.specularFactor?s.specularFactor:1,void 0!==s.specularTexture&&o.push(n.assignTexture(r,"specularIntensityMap",s.specularTexture));var a=s.specularColorFactor||[1,1,1];return r.specularColor=(new t.Color).setRGB(a[0],a[1],a[2],t.LinearSRGBColorSpace),void 0!==s.specularColorTexture&&o.push(n.assignTexture(r,"specularColorMap",s.specularColorTexture,t.SRGBColorSpace)),Promise.all(o)}}]),e}(),Pe=function(){function e(t){he(this,e),this.parser=t,this.name=be.EXT_MATERIALS_BUMP}return de(e,[{key:"getMaterialType",value:function(e){var r=this.parser.json.materials[e];return r.extensions&&r.extensions[this.name]?t.MeshPhysicalMaterial:null}},{key:"extendMaterialParams",value:function(e,t){var r=this.parser,n=r.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();var i=[],o=n.extensions[this.name];return t.bumpScale=void 0!==o.bumpFactor?o.bumpFactor:1,void 0!==o.bumpTexture&&i.push(r.assignTexture(t,"bumpMap",o.bumpTexture)),Promise.all(i)}}]),e}(),Ne=function(){function e(t){he(this,e),this.parser=t,this.name=be.KHR_MATERIALS_ANISOTROPY}return de(e,[{key:"getMaterialType",value:function(e){var r=this.parser.json.materials[e];return r.extensions&&r.extensions[this.name]?t.MeshPhysicalMaterial:null}},{key:"extendMaterialParams",value:function(e,t){var r=this.parser,n=r.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();var i=[],o=n.extensions[this.name];return void 0!==o.anisotropyStrength&&(t.anisotropy=o.anisotropyStrength),void 0!==o.anisotropyRotation&&(t.anisotropyRotation=o.anisotropyRotation),void 0!==o.anisotropyTexture&&i.push(r.assignTexture(t,"anisotropyMap",o.anisotropyTexture)),Promise.all(i)}}]),e}(),Le=function(){function e(t){he(this,e),this.parser=t,this.name=be.KHR_TEXTURE_BASISU}return de(e,[{key:"loadTexture",value:function(e){var t=this.parser,r=t.json,n=r.textures[e];if(!n.extensions||!n.extensions[this.name])return null;var i=n.extensions[this.name],o=t.options.ktx2Loader;if(!o){if(r.extensionsRequired&&r.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,i.source,o)}}]),e}(),Ue=function(){function e(t){he(this,e),this.parser=t,this.name=be.EXT_TEXTURE_WEBP,this.isSupported=null}return de(e,[{key:"loadTexture",value:function(e){var t=this.name,r=this.parser,n=r.json,i=n.textures[e];if(!i.extensions||!i.extensions[t])return null;var o=i.extensions[t],s=n.images[o.source],a=r.textureLoader;if(s.uri){var c=r.options.manager.getHandler(s.uri);null!==c&&(a=c)}return this.detectSupport().then((function(i){if(i)return r.loadTextureImage(e,o.source,a);if(n.extensionsRequired&&n.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return r.loadTexture(e)}))}},{key:"detectSupport",value:function(){return this.isSupported||(this.isSupported=new Promise((function(e){var t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(1===t.height)}}))),this.isSupported}}]),e}(),De=function(){function e(t){he(this,e),this.parser=t,this.name=be.EXT_TEXTURE_AVIF,this.isSupported=null}return de(e,[{key:"loadTexture",value:function(e){var t=this.name,r=this.parser,n=r.json,i=n.textures[e];if(!i.extensions||!i.extensions[t])return null;var o=i.extensions[t],s=n.images[o.source],a=r.textureLoader;if(s.uri){var c=r.options.manager.getHandler(s.uri);null!==c&&(a=c)}return this.detectSupport().then((function(i){if(i)return r.loadTextureImage(e,o.source,a);if(n.extensionsRequired&&n.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return r.loadTexture(e)}))}},{key:"detectSupport",value:function(){return this.isSupported||(this.isSupported=new Promise((function(e){var t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(1===t.height)}}))),this.isSupported}}]),e}(),Fe=function(){function e(t){he(this,e),this.name=be.EXT_MESHOPT_COMPRESSION,this.parser=t}return de(e,[{key:"loadBufferView",value:function(e){var t=this.parser.json,r=t.bufferViews[e];if(r.extensions&&r.extensions[this.name]){var n=r.extensions[this.name],i=this.parser.getDependency("buffer",n.buffer),o=this.parser.options.meshoptDecoder;if(!o||!o.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return i.then((function(e){var t=n.byteOffset||0,r=n.byteLength||0,i=n.count,s=n.byteStride,a=new Uint8Array(e,t,r);return o.decodeGltfBufferAsync?o.decodeGltfBufferAsync(i,s,a,n.mode,n.filter).then((function(e){return e.buffer})):o.ready.then((function(){var e=new ArrayBuffer(i*s);return o.decodeGltfBuffer(new Uint8Array(e),i,s,a,n.mode,n.filter),e}))}))}return null}}]),e}(),Be=function(){function e(t){he(this,e),this.name=be.EXT_MESH_GPU_INSTANCING,this.parser=t}return de(e,[{key:"createNodeMesh",value:function(e){var r=this,n=this.parser.json,i=n.nodes[e];if(!i.extensions||!i.extensions[this.name]||void 0===i.mesh)return null;var o,s=ce(n.meshes[i.mesh].primitives);try{for(s.s();!(o=s.n()).done;){var a=o.value;if(a.mode!==Je.TRIANGLES&&a.mode!==Je.TRIANGLE_STRIP&&a.mode!==Je.TRIANGLE_FAN&&void 0!==a.mode)return null}}catch(e){s.e(e)}finally{s.f()}var c=i.extensions[this.name].attributes,l=[],u={},h=function(e){l.push(r.parser.getDependency("accessor",c[e]).then((function(t){return u[e]=t,u[e]})))};for(var p in c)h(p);return l.length<1?null:(l.push(this.parser.createNodeMesh(e)),Promise.all(l).then((function(e){var n,i=e.pop(),o=i.isGroup?i.children:[i],s=e[0].count,a=[],c=ce(o);try{for(c.s();!(n=c.n()).done;){for(var l=n.value,h=new t.Matrix4,p=new t.Vector3,d=new t.Quaternion,f=new t.Vector3(1,1,1),m=new t.InstancedMesh(l.geometry,l.material,s),g=0;g<s;g++)u.TRANSLATION&&p.fromBufferAttribute(u.TRANSLATION,g),u.ROTATION&&d.fromBufferAttribute(u.ROTATION,g),u.SCALE&&f.fromBufferAttribute(u.SCALE,g),m.setMatrixAt(g,h.compose(p,d,f));for(var y in u)if("_COLOR_0"===y){var v=u[y];m.instanceColor=new t.InstancedBufferAttribute(v.array,v.itemSize,v.normalized)}else"TRANSLATION"!==y&&"ROTATION"!==y&&"SCALE"!==y&&l.geometry.setAttribute(y,u[y]);t.Object3D.prototype.copy.call(m,l),r.parser.assignFinalMaterial(m),a.push(m)}}catch(e){c.e(e)}finally{c.f()}return i.isGroup?(i.clear(),i.add.apply(i,a),i):a[0]})))}}]),e}(),ke="glTF",je=1313821514,Ge=5130562,ze=de((function e(t){he(this,e),this.name=be.KHR_BINARY_GLTF,this.content=null,this.body=null;var r=new DataView(t,0,12),n=new TextDecoder;if(this.header={magic:n.decode(new Uint8Array(t.slice(0,4))),version:r.getUint32(4,!0),length:r.getUint32(8,!0)},this.header.magic!==ke)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");for(var i=this.header.length-12,o=new DataView(t,12),s=0;s<i;){var a=o.getUint32(s,!0);s+=4;var c=o.getUint32(s,!0);if(s+=4,c===je){var l=new Uint8Array(t,12+s,a);this.content=n.decode(l)}else if(c===Ge){var u=12+s;this.body=t.slice(u,u+a)}s+=a}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")})),Ve=function(){function e(t,r){if(he(this,e),!r)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=be.KHR_DRACO_MESH_COMPRESSION,this.json=t,this.dracoLoader=r,this.dracoLoader.preload()}return de(e,[{key:"decodePrimitive",value:function(e,r){var n=this.json,i=this.dracoLoader,o=e.extensions[this.name].bufferView,s=e.extensions[this.name].attributes,a={},c={},l={};for(var u in s){var h=et[u]||u.toLowerCase();a[h]=s[u]}for(var p in e.attributes){var d=et[p]||p.toLowerCase();if(void 0!==s[p]){var f=n.accessors[e.attributes[p]],m=Ke[f.componentType];l[d]=m.name,c[d]=!0===f.normalized}}return r.getDependency("bufferView",o).then((function(e){return new Promise((function(r,n){i.decodeDracoFile(e,(function(e){for(var t in e.attributes){var n=e.attributes[t],i=c[t];void 0!==i&&(n.normalized=i)}r(e)}),a,l,t.LinearSRGBColorSpace,n)}))}))}}]),e}(),He=function(){function e(){he(this,e),this.name=be.KHR_TEXTURE_TRANSFORM}return de(e,[{key:"extendTexture",value:function(e,t){return void 0!==t.texCoord&&t.texCoord!==e.channel||void 0!==t.offset||void 0!==t.rotation||void 0!==t.scale?(e=e.clone(),void 0!==t.texCoord&&(e.channel=t.texCoord),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),e.needsUpdate=!0,e):e}}]),e}(),We=de((function e(){he(this,e),this.name=be.KHR_MESH_QUANTIZATION})),Xe=function(e){fe(r,e);var t=ge(r);function r(e,n,i,o){return he(this,r),t.call(this,e,n,i,o)}return de(r,[{key:"copySampleValue_",value:function(e){for(var t=this.resultBuffer,r=this.sampleValues,n=this.valueSize,i=e*n*3+n,o=0;o!==n;o++)t[o]=r[i+o];return t}},{key:"interpolate_",value:function(e,t,r,n){for(var i=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=2*s,c=3*s,l=n-t,u=(r-t)/l,h=u*u,p=h*u,d=e*c,f=d-c,m=-2*p+3*h,g=p-h,y=1-m,v=g-h+u,_=0;_!==s;_++){var b=o[f+_+s],x=o[f+_+a]*l,w=o[d+_+s],S=o[d+_]*l;i[_]=y*b+v*x+m*w+g*S}return i}}]),r}(t.Interpolant),Ye=new t.Quaternion,qe=function(e){fe(r,e);var t=ge(r);function r(){return he(this,r),t.apply(this,arguments)}return de(r,[{key:"interpolate_",value:function(e,t,n,i){var o=ae(ye(r.prototype),"interpolate_",this).call(this,e,t,n,i);return Ye.fromArray(o).normalize().toArray(o),o}}]),r}(Xe),Je={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},Ke={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Ze={9728:t.NearestFilter,9729:t.LinearFilter,9984:t.NearestMipmapNearestFilter,9985:t.LinearMipmapNearestFilter,9986:t.NearestMipmapLinearFilter,9987:t.LinearMipmapLinearFilter},Qe={33071:t.ClampToEdgeWrapping,33648:t.MirroredRepeatWrapping,10497:t.RepeatWrapping},$e={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},et={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},tt={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},rt={CUBICSPLINE:void 0,LINEAR:t.InterpolateLinear,STEP:t.InterpolateDiscrete},nt="OPAQUE",it="MASK",ot="BLEND";function st(e,t,r){for(var n in r.extensions)void 0===e[n]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[n]=r.extensions[n])}function at(e,t){void 0!==t.extras&&("object"===se(t.extras)?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function ct(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(var r=0,n=t.weights.length;r<n;r++)e.morphTargetInfluences[r]=t.weights[r];if(t.extras&&Array.isArray(t.extras.targetNames)){var i=t.extras.targetNames;if(e.morphTargetInfluences.length===i.length){e.morphTargetDictionary={};for(var o=0,s=i.length;o<s;o++)e.morphTargetDictionary[i[o]]=o}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function lt(e){var t,r=e.extensions&&e.extensions[be.KHR_DRACO_MESH_COMPRESSION];if(t=r?"draco:"+r.bufferView+":"+r.indices+":"+ut(r.attributes):e.indices+":"+ut(e.attributes)+":"+e.mode,void 0!==e.targets)for(var n=0,i=e.targets.length;n<i;n++)t+=":"+ut(e.targets[n]);return t}function ut(e){for(var t="",r=Object.keys(e).sort(),n=0,i=r.length;n<i;n++)t+=r[n]+":"+e[r[n]]+";";return t}function ht(e){switch(e){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}var pt=new t.Matrix4,dt=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};he(this,e),this.json=r,this.extensions={},this.plugins={},this.options=n,this.cache=new _e,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};var i=!1,o=!1,s=-1;"undefined"!=typeof navigator&&(i=!0===/^((?!chrome|android).)*safari/i.test(navigator.userAgent),s=(o=navigator.userAgent.indexOf("Firefox")>-1)?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),"undefined"==typeof createImageBitmap||i||o&&s<98?this.textureLoader=new t.TextureLoader(this.options.manager):this.textureLoader=new t.ImageBitmapLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new t.FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}return de(e,[{key:"setExtensions",value:function(e){this.extensions=e}},{key:"setPlugins",value:function(e){this.plugins=e}},{key:"parse",value:function(e,t){var r=this,n=this.json,i=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll((function(e){return e._markDefs&&e._markDefs()})),Promise.all(this._invokeAll((function(e){return e.beforeRoot&&e.beforeRoot()}))).then((function(){return Promise.all([r.getDependencies("scene"),r.getDependencies("animation"),r.getDependencies("camera")])})).then((function(t){var o={scene:t[0][n.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:n.asset,parser:r,userData:{}};return st(i,o,n),at(o,n),Promise.all(r._invokeAll((function(e){return e.afterRoot&&e.afterRoot(o)}))).then((function(){var t,r=ce(o.scenes);try{for(r.s();!(t=r.n()).done;){t.value.updateMatrixWorld()}}catch(e){r.e(e)}finally{r.f()}e(o)}))})).catch(t)}},{key:"_markDefs",value:function(){for(var e=this.json.nodes||[],t=this.json.skins||[],r=this.json.meshes||[],n=0,i=t.length;n<i;n++)for(var o=t[n].joints,s=0,a=o.length;s<a;s++)e[o[s]].isBone=!0;for(var c=0,l=e.length;c<l;c++){var u=e[c];void 0!==u.mesh&&(this._addNodeRef(this.meshCache,u.mesh),void 0!==u.skin&&(r[u.mesh].isSkinnedMesh=!0)),void 0!==u.camera&&this._addNodeRef(this.cameraCache,u.camera)}}},{key:"_addNodeRef",value:function(e,t){void 0!==t&&(void 0===e.refs[t]&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}},{key:"_getNodeRef",value:function(e,t,r){var n=this;if(e.refs[t]<=1)return r;var i=r.clone();return function e(t,r){var i=n.associations.get(t);null!=i&&n.associations.set(r,i);var o,s=ce(t.children.entries());try{for(s.s();!(o=s.n()).done;){var a=oe(o.value,2),c=a[0];e(a[1],r.children[c])}}catch(e){s.e(e)}finally{s.f()}}(r,i),i.name+="_instance_"+e.uses[t]++,i}},{key:"_invokeOne",value:function(e){var t=Object.values(this.plugins);t.push(this);for(var r=0;r<t.length;r++){var n=e(t[r]);if(n)return n}return null}},{key:"_invokeAll",value:function(e){var t=Object.values(this.plugins);t.unshift(this);for(var r=[],n=0;n<t.length;n++){var i=e(t[n]);i&&r.push(i)}return r}},{key:"getDependency",value:function(e,t){var r=e+":"+t,n=this.cache.get(r);if(!n){switch(e){case"scene":n=this.loadScene(t);break;case"node":n=this._invokeOne((function(e){return e.loadNode&&e.loadNode(t)}));break;case"mesh":n=this._invokeOne((function(e){return e.loadMesh&&e.loadMesh(t)}));break;case"accessor":n=this.loadAccessor(t);break;case"bufferView":n=this._invokeOne((function(e){return e.loadBufferView&&e.loadBufferView(t)}));break;case"buffer":n=this.loadBuffer(t);break;case"material":n=this._invokeOne((function(e){return e.loadMaterial&&e.loadMaterial(t)}));break;case"texture":n=this._invokeOne((function(e){return e.loadTexture&&e.loadTexture(t)}));break;case"skin":n=this.loadSkin(t);break;case"animation":n=this._invokeOne((function(e){return e.loadAnimation&&e.loadAnimation(t)}));break;case"camera":n=this.loadCamera(t);break;default:if(!(n=this._invokeOne((function(r){return r!=this&&r.getDependency&&r.getDependency(e,t)}))))throw new Error("Unknown type: "+e)}this.cache.add(r,n)}return n}},{key:"getDependencies",value:function(e){var t=this.cache.get(e);if(!t){var r=this,n=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(n.map((function(t,n){return r.getDependency(e,n)}))),this.cache.add(e,t)}return t}},{key:"loadBuffer",value:function(e){var r=this.json.buffers[e],n=this.fileLoader;if(r.type&&"arraybuffer"!==r.type)throw new Error("THREE.GLTFLoader: "+r.type+" buffer type is not supported.");if(void 0===r.uri&&0===e)return Promise.resolve(this.extensions[be.KHR_BINARY_GLTF].body);var i=this.options;return new Promise((function(e,o){n.load(t.LoaderUtils.resolveURL(r.uri,i.path),e,void 0,(function(){o(new Error('THREE.GLTFLoader: Failed to load buffer "'+r.uri+'".'))}))}))}},{key:"loadBufferView",value:function(e){var t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then((function(e){var r=t.byteLength||0,n=t.byteOffset||0;return e.slice(n,n+r)}))}},{key:"loadAccessor",value:function(e){var r=this,n=this.json,i=this.json.accessors[e];if(void 0===i.bufferView&&void 0===i.sparse){var o=$e[i.type],s=Ke[i.componentType],a=!0===i.normalized,c=new s(i.count*o);return Promise.resolve(new t.BufferAttribute(c,o,a))}var l=[];return void 0!==i.bufferView?l.push(this.getDependency("bufferView",i.bufferView)):l.push(null),void 0!==i.sparse&&(l.push(this.getDependency("bufferView",i.sparse.indices.bufferView)),l.push(this.getDependency("bufferView",i.sparse.values.bufferView))),Promise.all(l).then((function(e){var o,s,a=e[0],c=$e[i.type],l=Ke[i.componentType],u=l.BYTES_PER_ELEMENT,h=u*c,p=i.byteOffset||0,d=void 0!==i.bufferView?n.bufferViews[i.bufferView].byteStride:void 0,f=!0===i.normalized;if(d&&d!==h){var m=Math.floor(p/d),g="InterleavedBuffer:"+i.bufferView+":"+i.componentType+":"+m+":"+i.count,y=r.cache.get(g);y||(o=new l(a,m*d,i.count*d/u),y=new t.InterleavedBuffer(o,d/u),r.cache.add(g,y)),s=new t.InterleavedBufferAttribute(y,c,p%d/u,f)}else o=null===a?new l(i.count*c):new l(a,p,i.count*c),s=new t.BufferAttribute(o,c,f);if(void 0!==i.sparse){var v=$e.SCALAR,_=Ke[i.sparse.indices.componentType],b=i.sparse.indices.byteOffset||0,x=i.sparse.values.byteOffset||0,w=new _(e[1],b,i.sparse.count*v),S=new l(e[2],x,i.sparse.count*c);null!==a&&(s=new t.BufferAttribute(s.array.slice(),s.itemSize,s.normalized));for(var M=0,T=w.length;M<T;M++){var E=w[M];if(s.setX(E,S[M*c]),c>=2&&s.setY(E,S[M*c+1]),c>=3&&s.setZ(E,S[M*c+2]),c>=4&&s.setW(E,S[M*c+3]),c>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return s}))}},{key:"loadTexture",value:function(e){var t=this.json,r=this.options,n=t.textures[e].source,i=t.images[n],o=this.textureLoader;if(i.uri){var s=r.manager.getHandler(i.uri);null!==s&&(o=s)}return this.loadTextureImage(e,n,o)}},{key:"loadTextureImage",value:function(e,r,n){var i=this,o=this.json,s=o.textures[e],a=o.images[r],c=(a.uri||a.bufferView)+":"+s.sampler;if(this.textureCache[c])return this.textureCache[c];var l=this.loadImageSource(r,n).then((function(r){r.flipY=!1,r.name=s.name||a.name||"",""===r.name&&"string"==typeof a.uri&&!1===a.uri.startsWith("data:image/")&&(r.name=a.uri);var n=(o.samplers||{})[s.sampler]||{};return r.magFilter=Ze[n.magFilter]||t.LinearFilter,r.minFilter=Ze[n.minFilter]||t.LinearMipmapLinearFilter,r.wrapS=Qe[n.wrapS]||t.RepeatWrapping,r.wrapT=Qe[n.wrapT]||t.RepeatWrapping,s.uuid&&(r.uuid=s.uuid),i.associations.set(r,{textures:e}),r})).catch((function(){return null}));return this.textureCache[c]=l,l}},{key:"loadImageSource",value:function(e,r){var n=this.json,i=this.options;if(void 0!==this.sourceCache[e])return this.sourceCache[e].then((function(e){return e.clone()}));var o=n.images[e],s=self.URL||self.webkitURL,a=o.uri||"",c=!1;if(void 0!==o.bufferView)a=this.getDependency("bufferView",o.bufferView).then((function(e){c=!0;var t=new Blob([e],{type:o.mimeType});return a=s.createObjectURL(t)}));else if(void 0===o.uri)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");var l=Promise.resolve(a).then((function(e){return new Promise((function(n,s){var a=n;!0===r.isImageBitmapLoader&&(a=function(e){var r=new t.Texture(e);r.needsUpdate=!0,o.uuid&&(r.source.uuid=o.uuid),n(r)}),r.load(t.LoaderUtils.resolveURL(e,i.path),a,void 0,s)}))})).then((function(e){var t;return!0===c&&s.revokeObjectURL(a),at(e,o),e.userData.mimeType=o.mimeType||((t=o.uri).search(/\.jpe?g($|\?)/i)>0||0===t.search(/^data\:image\/jpeg/)?"image/jpeg":t.search(/\.webp($|\?)/i)>0||0===t.search(/^data\:image\/webp/)?"image/webp":"image/png"),e})).catch((function(e){throw console.error("THREE.GLTFLoader: Couldn't load texture",a),e}));return this.sourceCache[e]=l,l}},{key:"assignTexture",value:function(e,t,r,n){var i=this;return this.getDependency("texture",r.index).then((function(o){if(!o)return null;if(void 0!==r.texCoord&&r.texCoord>0&&((o=o.clone()).channel=r.texCoord),i.extensions[be.KHR_TEXTURE_TRANSFORM]){var s=void 0!==r.extensions?r.extensions[be.KHR_TEXTURE_TRANSFORM]:void 0;if(s){var a=i.associations.get(o);o=i.extensions[be.KHR_TEXTURE_TRANSFORM].extendTexture(o,s),i.associations.set(o,a)}}return void 0!==n&&(o.colorSpace=n),e[t]=o,o}))}},{key:"assignFinalMaterial",value:function(e){var r=e.geometry,n=e.material,i=n.uuid,o=void 0===r.attributes.tangent,s=void 0!==r.attributes.color,a=void 0===r.attributes.normal;if(e.isPoints){var c="PointsMaterial:"+n.uuid,l=this.cache.get(c);l||(l=new t.PointsMaterial,t.Material.prototype.copy.call(l,n),l.color.copy(n.color),l.map=n.map,l.sizeAttenuation=!1,this.cache.add(c,l)),n=l}else if(e.isLine){var u="LineBasicMaterial:"+n.uuid,h=this.cache.get(u);h||(h=new t.LineBasicMaterial,t.Material.prototype.copy.call(h,n),h.color.copy(n.color),h.map=n.map,this.cache.add(u,h)),n=h}if(o||s||a){var p="ClonedMaterial:"+n.uuid+":";n.isGLTFSpecularGlossinessMaterial&&(p+="specular-glossiness:"),o&&(p+="derivative-tangents:"),s&&(p+="vertex-colors:"),a&&(p+="flat-shading:");var d=this.cache.get(p);d||(d=n.clone(),s&&(d.vertexColors=!0),a&&(d.flatShading=!0),o&&(d.normalScale&&(d.normalScale.y*=-1),d.clearcoatNormalScale&&(d.clearcoatNormalScale.y*=-1)),this.cache.add(p,d),this.associations.set(d,this.associations.get(n))),n=d}n.uuid=i,e.material=n}},{key:"getMaterialType",value:function(){return t.MeshStandardMaterial}},{key:"loadMaterial",value:function(e){var r,n=this,i=this.json,o=this.extensions,s=i.materials[e],a={},c=s.extensions||{},l=[];if(c[be.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){var u=o[be.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];r=u.getMaterialType(),l.push(u.extendParams(a,s,n))}else if(c[be.KHR_MATERIALS_UNLIT]){var h=o[be.KHR_MATERIALS_UNLIT];r=h.getMaterialType(),l.push(h.extendParams(a,s,n))}else{var p=s.pbrMetallicRoughness||{};if(a.color=new t.Color(1,1,1),a.opacity=1,Array.isArray(p.baseColorFactor)){var d=p.baseColorFactor;a.color.setRGB(d[0],d[1],d[2],t.LinearSRGBColorSpace),a.opacity=d[3]}void 0!==p.baseColorTexture&&l.push(n.assignTexture(a,"map",p.baseColorTexture,t.SRGBColorSpace)),a.metalness=void 0!==p.metallicFactor?p.metallicFactor:1,a.roughness=void 0!==p.roughnessFactor?p.roughnessFactor:1,void 0!==p.metallicRoughnessTexture&&(l.push(n.assignTexture(a,"metalnessMap",p.metallicRoughnessTexture)),l.push(n.assignTexture(a,"roughnessMap",p.metallicRoughnessTexture))),r=this._invokeOne((function(t){return t.getMaterialType&&t.getMaterialType(e)})),l.push(Promise.all(this._invokeAll((function(t){return t.extendMaterialParams&&t.extendMaterialParams(e,a)}))))}!0===s.doubleSided&&(a.side=t.DoubleSide);var f=s.alphaMode||nt;if(f===ot?(a.transparent=!0,a.depthWrite=!1):(a.transparent=!1,f===it&&(a.alphaTest=void 0!==s.alphaCutoff?s.alphaCutoff:.5)),void 0!==s.normalTexture&&r!==t.MeshBasicMaterial&&(l.push(n.assignTexture(a,"normalMap",s.normalTexture)),a.normalScale=new t.Vector2(1,1),void 0!==s.normalTexture.scale)){var m=s.normalTexture.scale;a.normalScale.set(m,m)}if(void 0!==s.occlusionTexture&&r!==t.MeshBasicMaterial&&(l.push(n.assignTexture(a,"aoMap",s.occlusionTexture)),void 0!==s.occlusionTexture.strength&&(a.aoMapIntensity=s.occlusionTexture.strength)),void 0!==s.emissiveFactor&&r!==t.MeshBasicMaterial){var g=s.emissiveFactor;a.emissive=(new t.Color).setRGB(g[0],g[1],g[2],t.LinearSRGBColorSpace)}return void 0!==s.emissiveTexture&&r!==t.MeshBasicMaterial&&l.push(n.assignTexture(a,"emissiveMap",s.emissiveTexture,t.SRGBColorSpace)),Promise.all(l).then((function(){var t;return t=r===ne?o[be.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(a):new r(a),s.name&&(t.name=s.name),at(t,s),n.associations.set(t,{materials:e}),s.extensions&&st(o,t,s),s.uuid&&(t.uuid=s.uuid),t}))}},{key:"createUniqueName",value:function(e){var r=t.PropertyBinding.sanitizeNodeName(e||"");return r in this.nodeNamesUsed?r+"_"+ ++this.nodeNamesUsed[r]:(this.nodeNamesUsed[r]=0,r)}},{key:"loadGeometries",value:function(e){var r=this,n=this.extensions,i=this.primitiveCache;function o(e){return n[be.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,r).then((function(t){return ft(t,e,r)}))}for(var s=[],a=0,c=e.length;a<c;a++){var l=e[a],u=lt(l),h=i[u];if(h)s.push(h.promise);else{var p=void 0;p=l.extensions&&l.extensions[be.KHR_DRACO_MESH_COMPRESSION]?o(l):ft(new t.BufferGeometry,l,r),i[u]={primitive:l,promise:p},s.push(p)}}return Promise.all(s)}},{key:"loadMesh",value:function(e){for(var r,n=this,i=this.json,o=this.extensions,s=i.meshes[e],a=s.primitives,c=[],l=0,u=a.length;l<u;l++){var h=void 0===a[l].material?(void 0===(r=this.cache).DefaultMaterial&&(r.DefaultMaterial=new t.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:t.FrontSide})),r.DefaultMaterial):this.getDependency("material",a[l].material);c.push(h)}return c.push(n.loadGeometries(a)),Promise.all(c).then((function(r){for(var i=r.slice(0,r.length-1),c=r[r.length-1],l=[],u=0,h=c.length;u<h;u++){var p=c[u],d=a[u],f=void 0,m=i[u];if(d.mode===Je.TRIANGLES||d.mode===Je.TRIANGLE_STRIP||d.mode===Je.TRIANGLE_FAN||void 0===d.mode)!0===(f=!0===s.isSkinnedMesh?new t.SkinnedMesh(p,m):new t.Mesh(p,m)).isSkinnedMesh&&f.normalizeSkinWeights(),d.mode===Je.TRIANGLE_STRIP?f.geometry=(0,Y.Vs)(f.geometry,t.TriangleStripDrawMode):d.mode===Je.TRIANGLE_FAN&&(f.geometry=(0,Y.Vs)(f.geometry,t.TriangleFanDrawMode));else if(d.mode===Je.LINES)f=new t.LineSegments(p,m);else if(d.mode===Je.LINE_STRIP)f=new t.Line(p,m);else if(d.mode===Je.LINE_LOOP)f=new t.LineLoop(p,m);else{if(d.mode!==Je.POINTS)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+d.mode);f=new t.Points(p,m)}Object.keys(f.geometry.morphAttributes).length>0&&ct(f,s),f.name=n.createUniqueName(s.name||"mesh_"+e),at(f,s),d.extensions&&st(o,f,d),n.assignFinalMaterial(f),l.push(f)}for(var g=0,y=l.length;g<y;g++)n.associations.set(l[g],{meshes:e,primitives:g});if(1===l.length)return s.extensions&&st(o,l[0],s),l[0];var v=new t.Group;s.extensions&&st(o,v,s),n.associations.set(v,{meshes:e});for(var _=0,b=l.length;_<b;_++)v.add(l[_]);return v}))}},{key:"loadCamera",value:function(e){var r,n=this.json.cameras[e],i=n[n.type];if(i)return"perspective"===n.type?r=new t.PerspectiveCamera(t.MathUtils.radToDeg(i.yfov),i.aspectRatio||1,i.znear||1,i.zfar||2e6):"orthographic"===n.type&&(r=new t.OrthographicCamera(-i.xmag,i.xmag,i.ymag,-i.ymag,i.znear,i.zfar)),n.name&&(r.name=this.createUniqueName(n.name)),at(r,n),Promise.resolve(r);console.warn("THREE.GLTFLoader: Missing camera parameters.")}},{key:"loadSkin",value:function(e){for(var r=this.json.skins[e],n=[],i=0,o=r.joints.length;i<o;i++)n.push(this._loadNodeShallow(r.joints[i]));return void 0!==r.inverseBindMatrices?n.push(this.getDependency("accessor",r.inverseBindMatrices)):n.push(null),Promise.all(n).then((function(e){for(var n=e.pop(),i=e,o=[],s=[],a=0,c=i.length;a<c;a++){var l=i[a];if(l){o.push(l);var u=new t.Matrix4;null!==n&&u.fromArray(n.array,16*a),s.push(u)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',r.joints[a])}var h=new t.Skeleton(o,s);return r.uuid&&(h.uuid=r.uuid),h}))}},{key:"loadAnimation",value:function(e){for(var r=this.json,n=this,i=r.animations[e],o=i.name?i.name:"animation_"+e,s=[],a=[],c=[],l=[],u=[],h=0,p=i.channels.length;h<p;h++){var d=i.channels[h],f=i.samplers[d.sampler],m=d.target,g=m.node,y=void 0!==i.parameters?i.parameters[f.input]:f.input,v=void 0!==i.parameters?i.parameters[f.output]:f.output;void 0!==m.node&&(s.push(this.getDependency("node",g)),a.push(this.getDependency("accessor",y)),c.push(this.getDependency("accessor",v)),l.push(f),u.push(m))}return Promise.all([Promise.all(s),Promise.all(a),Promise.all(c),Promise.all(l),Promise.all(u)]).then((function(e){for(var r=e[0],s=e[1],a=e[2],c=e[3],l=e[4],u=[],h=0,p=r.length;h<p;h++){var d=r[h],f=s[h],m=a[h],g=c[h],y=l[h];if(void 0!==d){d.updateMatrix&&d.updateMatrix();var v=n._createAnimationTracks(d,f,m,g,y);if(v)for(var _=0;_<v.length;_++)u.push(v[_])}}var b=new t.AnimationClip(o,void 0,u);return i.uuid&&(b.uuid=i.uuid),b}))}},{key:"createNodeMesh",value:function(e){var t=this.json,r=this,n=t.nodes[e];return void 0===n.mesh?null:r.getDependency("mesh",n.mesh).then((function(e){var t=r._getNodeRef(r.meshCache,n.mesh,e);return void 0!==n.weights&&t.traverse((function(e){if(e.isMesh)for(var t=0,r=n.weights.length;t<r;t++)e.morphTargetInfluences[t]=n.weights[t]})),t}))}},{key:"loadNode",value:function(e){for(var t=this,r=this.json.nodes[e],n=t._loadNodeShallow(e),i=[],o=r.children||[],s=0,a=o.length;s<a;s++)i.push(t.getDependency("node",o[s]));var c=void 0===r.skin?Promise.resolve(null):t.getDependency("skin",r.skin);return Promise.all([n,Promise.all(i),c]).then((function(e){var t=e[0],n=e[1],i=e[2];null!==i&&t.traverse((function(e){e.isSkinnedMesh&&e.bind(i,pt)}));for(var o=0,s=n.length;o<s;o++)t.add(n[o]);return r.uuid&&(t.uuid=r.uuid),t}))}},{key:"_loadNodeShallow",value:function(e){var r=this.json,n=this.extensions,i=this;if(void 0!==this.nodeCache[e])return this.nodeCache[e];var o=r.nodes[e],s=o.name?i.createUniqueName(o.name):"",a=[],c=i._invokeOne((function(t){return t.createNodeMesh&&t.createNodeMesh(e)}));return c&&a.push(c),void 0!==o.camera&&a.push(i.getDependency("camera",o.camera).then((function(e){return i._getNodeRef(i.cameraCache,o.camera,e)}))),i._invokeAll((function(t){return t.createNodeAttachment&&t.createNodeAttachment(e)})).forEach((function(e){a.push(e)})),this.nodeCache[e]=Promise.all(a).then((function(r){var a;if((a=!0===o.isBone?new t.Bone:r.length>1?new t.Group:1===r.length?r[0]:new t.Object3D)!==r[0])for(var c=0,l=r.length;c<l;c++)a.add(r[c]);if(o.name&&(a.userData.name=o.name,a.name=s),at(a,o),o.extensions&&st(n,a,o),void 0!==o.matrix){var u=new t.Matrix4;u.fromArray(o.matrix),a.applyMatrix4(u)}else void 0!==o.translation&&a.position.fromArray(o.translation),void 0!==o.rotation&&a.quaternion.fromArray(o.rotation),void 0!==o.scale&&a.scale.fromArray(o.scale);return i.associations.has(a)||i.associations.set(a,{}),i.associations.get(a).nodes=e,a})),this.nodeCache[e]}},{key:"loadScene",value:function(e){var r=this.extensions,n=this.json.scenes[e],i=this,o=new t.Group;n.name&&(o.name=i.createUniqueName(n.name)),at(o,n),n.extensions&&st(r,o,n);for(var s=n.nodes||[],a=[],c=0,l=s.length;c<l;c++)a.push(i.getDependency("node",s[c]));return Promise.all(a).then((function(e){for(var r=0,n=e.length;r<n;r++)o.add(e[r]);return i.associations=function(e){var r,n=new Map,o=ce(i.associations);try{for(o.s();!(r=o.n()).done;){var s=oe(r.value,2),a=s[0],c=s[1];(a instanceof t.Material||a instanceof t.Texture)&&n.set(a,c)}}catch(e){o.e(e)}finally{o.f()}return e.traverse((function(e){var t=i.associations.get(e);null!=t&&n.set(e,t)})),n}(o),o}))}},{key:"_createAnimationTracks",value:function(e,r,n,i,o){var s,a=[],c=e.name?e.name:e.uuid,l=[];switch(tt[o.path]===tt.weights?e.traverse((function(e){e.morphTargetInfluences&&l.push(e.name?e.name:e.uuid)})):l.push(c),tt[o.path]){case tt.weights:s=t.NumberKeyframeTrack;break;case tt.rotation:s=t.QuaternionKeyframeTrack;break;case tt.position:case tt.scale:s=t.VectorKeyframeTrack;break;default:if(1===n.itemSize)s=t.NumberKeyframeTrack;else s=t.VectorKeyframeTrack}for(var u=void 0!==i.interpolation?rt[i.interpolation]:t.InterpolateLinear,h=this._getArrayFromAccessor(n),p=0,d=l.length;p<d;p++){var f=new s(l[p]+"."+tt[o.path],r.array,h,u);"CUBICSPLINE"===i.interpolation&&this._createCubicSplineTrackInterpolant(f),a.push(f)}return a}},{key:"_getArrayFromAccessor",value:function(e){var t=e.array;if(e.normalized){for(var r=ht(t.constructor),n=new Float32Array(t.length),i=0,o=t.length;i<o;i++)n[i]=t[i]*r;t=n}return t}},{key:"_createCubicSplineTrackInterpolant",value:function(e){e.createInterpolant=function(e){return new(this instanceof t.QuaternionKeyframeTrack?qe:Xe)(this.times,this.values,this.getValueSize()/3,e)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}]),e}();function ft(e,r,n){var i=r.attributes,o=[];function s(t,r){return n.getDependency("accessor",t).then((function(t){e.setAttribute(r,t)}))}for(var a in i){var c=et[a]||a.toLowerCase();c in e.attributes||o.push(s(i[a],c))}if(void 0!==r.indices&&!e.index){var l=n.getDependency("accessor",r.indices).then((function(t){e.setIndex(t)}));o.push(l)}return t.ColorManagement.workingColorSpace!==t.LinearSRGBColorSpace&&"COLOR_0"in i&&console.warn('THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "'.concat(t.ColorManagement.workingColorSpace,'" not supported.')),at(e,r),function(e,r,n){var i=r.attributes,o=new t.Box3;if(void 0!==i.POSITION){var s=n.json.accessors[i.POSITION],a=s.min,c=s.max;if(void 0!==a&&void 0!==c){if(o.set(new t.Vector3(a[0],a[1],a[2]),new t.Vector3(c[0],c[1],c[2])),s.normalized){var l=ht(Ke[s.componentType]);o.min.multiplyScalar(l),o.max.multiplyScalar(l)}var u=r.targets;if(void 0!==u){for(var h=new t.Vector3,p=new t.Vector3,d=0,f=u.length;d<f;d++){var m=u[d];if(void 0!==m.POSITION){var g=n.json.accessors[m.POSITION],y=g.min,v=g.max;if(void 0!==y&&void 0!==v){if(p.setX(Math.max(Math.abs(y[0]),Math.abs(v[0]))),p.setY(Math.max(Math.abs(y[1]),Math.abs(v[1]))),p.setZ(Math.max(Math.abs(y[2]),Math.abs(v[2]))),g.normalized){var _=ht(Ke[g.componentType]);p.multiplyScalar(_)}h.max(p)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}o.expandByVector(h)}e.boundingBox=o;var b=new t.Sphere;o.getCenter(b.center),b.radius=o.min.distanceTo(o.max)/2,e.boundingSphere=b}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}(e,r,n),r.uuid&&(e.uuid=r.uuid),Promise.all(o).then((function(){return void 0!==r.targets?function(e,t,r){for(var n=!1,i=!1,o=!1,s=0,a=t.length;s<a;s++){var c=t[s];if(void 0!==c.POSITION&&(n=!0),void 0!==c.NORMAL&&(i=!0),void 0!==c.COLOR_0&&(o=!0),n&&i&&o)break}if(!n&&!i&&!o)return Promise.resolve(e);for(var l=[],u=[],h=[],p=0,d=t.length;p<d;p++){var f=t[p];if(n){var m=void 0!==f.POSITION?r.getDependency("accessor",f.POSITION):e.attributes.position;l.push(m)}if(i){var g=void 0!==f.NORMAL?r.getDependency("accessor",f.NORMAL):e.attributes.normal;u.push(g)}if(o){var y=void 0!==f.COLOR_0?r.getDependency("accessor",f.COLOR_0):e.attributes.color;h.push(y)}}return Promise.all([Promise.all(l),Promise.all(u),Promise.all(h)]).then((function(t){var r=t[0],s=t[1],a=t[2];return n&&(e.morphAttributes.position=r),i&&(e.morphAttributes.normal=s),o&&(e.morphAttributes.color=a),e.morphTargetsRelative=!0,e}))}(e,r.targets,n):e}))}function mt(e){return mt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},mt(e)}function gt(e){return function(e){if(Array.isArray(e))return yt(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return yt(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return yt(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function yt(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function vt(){vt=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,i=Object.defineProperty||function(e,t,r){e[t]=r.value},o="function"==typeof Symbol?Symbol:{},s=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function u(e,t,r,n){var o=t&&t.prototype instanceof y?t:y,s=Object.create(o.prototype),a=new I(n||[]);return i(s,"_invoke",{value:E(e,r,a)}),s}function h(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=u;var p="suspendedStart",d="suspendedYield",f="executing",m="completed",g={};function y(){}function v(){}function _(){}var b={};l(b,s,(function(){return this}));var x=Object.getPrototypeOf,w=x&&x(x(O([])));w&&w!==r&&n.call(w,s)&&(b=w);var S=_.prototype=y.prototype=Object.create(b);function M(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function T(e,t){function r(i,o,s,a){var c=h(e[i],e,o);if("throw"!==c.type){var l=c.arg,u=l.value;return u&&"object"==mt(u)&&n.call(u,"__await")?t.resolve(u.__await).then((function(e){r("next",e,s,a)}),(function(e){r("throw",e,s,a)})):t.resolve(u).then((function(e){l.value=e,s(l)}),(function(e){return r("throw",e,s,a)}))}a(c.arg)}var o;i(this,"_invoke",{value:function(e,n){function i(){return new t((function(t,i){r(e,n,t,i)}))}return o=o?o.then(i,i):i()}})}function E(t,r,n){var i=p;return function(o,s){if(i===f)throw new Error("Generator is already running");if(i===m){if("throw"===o)throw s;return{value:e,done:!0}}for(n.method=o,n.arg=s;;){var a=n.delegate;if(a){var c=A(a,n);if(c){if(c===g)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===p)throw i=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=f;var l=h(t,r,n);if("normal"===l.type){if(i=n.done?m:d,l.arg===g)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(i=m,n.method="throw",n.arg=l.arg)}}}function A(t,r){var n=r.method,i=t.iterator[n];if(i===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,A(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),g;var o=h(i,t.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,g;var s=o.arg;return s?s.done?(r[t.resultName]=s.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,g):s:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,g)}function R(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function C(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function I(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(R,this),this.reset(!0)}function O(t){if(t||""===t){var r=t[s];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,o=function r(){for(;++i<t.length;)if(n.call(t,i))return r.value=t[i],r.done=!1,r;return r.value=e,r.done=!0,r};return o.next=o}}throw new TypeError(mt(t)+" is not iterable")}return v.prototype=_,i(S,"constructor",{value:_,configurable:!0}),i(_,"constructor",{value:v,configurable:!0}),v.displayName=l(_,c,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===v||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,_):(e.__proto__=_,l(e,c,"GeneratorFunction")),e.prototype=Object.create(S),e},t.awrap=function(e){return{__await:e}},M(T.prototype),l(T.prototype,a,(function(){return this})),t.AsyncIterator=T,t.async=function(e,r,n,i,o){void 0===o&&(o=Promise);var s=new T(u(e,r,n,i),o);return t.isGeneratorFunction(r)?s:s.next().then((function(e){return e.done?e.value:s.next()}))},M(S),l(S,c,"Generator"),l(S,s,(function(){return this})),l(S,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=O,I.prototype={constructor:I,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(C),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function i(n,i){return a.type="throw",a.arg=t,r.next=n,i&&(r.method="next",r.arg=e),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var s=this.tryEntries[o],a=s.completion;if("root"===s.tryLoc)return i("end");if(s.tryLoc<=this.prev){var c=n.call(s,"catchLoc"),l=n.call(s,"finallyLoc");if(c&&l){if(this.prev<s.catchLoc)return i(s.catchLoc,!0);if(this.prev<s.finallyLoc)return i(s.finallyLoc)}else if(c){if(this.prev<s.catchLoc)return i(s.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return i(s.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var s=o?o.completion:{};return s.type=e,s.arg=t,o?(this.method="next",this.next=o.finallyLoc,g):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),C(r),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;C(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:O(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),g}},t}function _t(e,t,r,n,i,o,s){try{var a=e[o](s),c=a.value}catch(e){return void r(e)}a.done?t(c):Promise.resolve(c).then(n,i)}function bt(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function s(e){_t(o,n,i,s,a,"next",e)}function a(e){_t(o,n,i,s,a,"throw",e)}s(void 0)}))}}function xt(e){var r=this;function n(n,i){switch(void 0===n.metadata&&(n.metadata={type:"Geometry"}),void 0===n.metadata.type&&(n.metadata.type="Geometry"),void 0!==n.metadata.formatVersion&&(n.metadata.version=n.metadata.formatVersion),n.metadata.type.toLowerCase()){case"buffergeometry":var o=(new t.BufferGeometryLoader).parse(n),s=new t.Mesh(o);s.modelFileSize=i,r.loadSuccess(s);break;case"geometry":console.error('Loader: "Geometry" is no longer supported.');break;case"object":var a=new t.ObjectLoader;a.setResourcePath(r.texturePath),a.parse(n,(function(t){t.isScene?e.execute(new D(e,t)):(t.modelFileSize=i,r.loadSuccess(t))}));break;case"app":e.fromJSON(n)}}function o(){return(o=bt(vt().mark((function e(n,i){var o,a,c,l,u,h,p,d,f,m,g,y,v,_,b,x,w,S,M,T,E,A,R,C,I,O,P;return vt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(o=(0,B.GZ)(new Uint8Array(n)))["model.obj"]||!o["materials.mtl"]){e.next=14;break}return e.next=4,s.e(323).then(s.bind(s,145));case 4:return a=e.sent,c=a.MTLLoader,e.next=8,s.e(323).then(s.bind(s,856));case 8:l=e.sent,u=l.OBJLoader,h=(new c).parse((0,B.T8)(o["materials.mtl"])),(p=(new u).setMaterials(h).parse((0,B.T8)(o["model.obj"]))).modelFileSize=i,r.loadSuccess(p);case 14:e.t0=vt().keys(o);case 15:if((e.t1=e.t0()).done){e.next=63;break}d=e.t1.value,f=o[d],(m=new t.LoadingManager).setURLModifier((function(e){var t=o[e];if(t){var r=new Blob([t.buffer],{type:"application/octet-stream"});return URL.createObjectURL(r)}return e})),g=d.split(".").pop().toLowerCase(),e.t2=g,e.next="fbx"===e.t2?24:"glb"===e.t2?33:"gltf"===e.t2?47:61;break;case 24:return e.next=26,s.e(323).then(s.bind(s,96));case 26:return y=e.sent,v=y.FBXLoader,_=new v(m),(b=_.parse(f.buffer)).modelFileSize=i,r.loadSuccess(b),e.abrupt("break",61);case 33:return e.next=35,s.e(323).then(s.bind(s,135));case 35:return x=e.sent,w=x.DRACOLoader,e.next=39,s.e(323).then(s.bind(s,390));case 39:return S=e.sent,M=S.GLTFLoader,(T=new w).setDecoderPath("https://"+lu+"/draco3d@1.5.5/"),(E=new M).setDRACOLoader(T),E.parse(f.buffer,"",(function(e){var t,n=e.scene;(t=n.animations).push.apply(t,gt(e.animations)),n.modelFileSize=i,r.loadSuccess(n)})),e.abrupt("break",61);case 47:return e.next=49,s.e(323).then(s.bind(s,135));case 49:return A=e.sent,R=A.DRACOLoader,e.next=53,s.e(323).then(s.bind(s,390));case 53:return C=e.sent,I=C.GLTFLoader,(O=new R).setDecoderPath("https://"+lu+"/draco3d@1.5.5/"),(P=new I(m)).setDRACOLoader(O),P.parse((0,B.T8)(f),"",(function(e){var t,n=e.scene;(t=n.animations).push.apply(t,gt(e.animations)),n.modelFileSize=i,r.loadSuccess(n)})),e.abrupt("break",61);case 61:e.next=15;break;case 63:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function a(e){var r;if("string"==typeof e)r=e;else{if("glTF"===t.LoaderUtils.decodeText(new Uint8Array(e,0,4)))return new DataView(e).getUint32(4,!0)<2;r=t.LoaderUtils.decodeText(new Uint8Array(e))}var n=JSON.parse(r);return null!=n.asset&&n.asset.version[0]<2}this.texturePath="",this.loadItemList=function(e){F.getFilesFromItemList(e,(function(e,t){r.loadFiles(e,t)}))},this.loadSuccess=function(t){e.app.importModelSuccess(t)},this.loadFiles=function(e,n){if(e.length>0){n=n||F.createFilesMap(e);var o=new t.LoadingManager;o.setURLModifier((function(e){e=e.replace(/^(\.?\/)/,"");var t=n[e];return t?URL.createObjectURL(t):e})),o.addHandler(/\.tga$/i,new i.U);for(var s=0;s<e.length;s++)r.loadFile(e[s],o)}},this.loadFile=function(i,c){var l=i.name,u=l.split(".").pop().toLowerCase(),h=i.size,p=new FileReader;switch(p.addEventListener("progress",(function(e){Math.floor(e.total/1e3),Math.floor(e.loaded/e.total*100)})),u){case"3dm":p.addEventListener("load",function(){var e=bt(vt().mark((function e(t){var n,i,o,a;return vt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.target.result,e.next=3,s.e(323).then(s.bind(s,5));case 3:i=e.sent,o=i.Rhino3dmLoader,(a=new o).setLibraryPath("three/addons/libs/rhino3dm/"),a.parse(n,(function(e){e.modelFileSize=h,r.loadSuccess(e)}));case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),!1),p.readAsArrayBuffer(i);break;case"3ds":p.addEventListener("load",function(){var e=bt(vt().mark((function e(t){var n,i,o,a;return vt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.e(323).then(s.bind(s,825));case 2:n=e.sent,i=n.TDSLoader,o=new i,(a=o.parse(t.target.result)).modelFileSize=h,r.loadSuccess(a);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),!1),p.readAsArrayBuffer(i);break;case"3mf":p.addEventListener("load",function(){var e=bt(vt().mark((function e(t){var n,i,o,a;return vt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.e(323).then(s.bind(s,41));case 2:n=e.sent,i=n.ThreeMFLoader,o=new i,(a=o.parse(t.target.result)).modelFileSize=h,r.loadSuccess(a);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),!1),p.readAsArrayBuffer(i);break;case"amf":p.addEventListener("load",function(){var e=bt(vt().mark((function e(t){var n,i,o,a;return vt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.e(323).then(s.bind(s,303));case 2:n=e.sent,i=n.AMFLoader,o=new i,a=o.parse(t.target.result),object.modelFileSize=h,r.loadSuccess(a);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),!1),p.readAsArrayBuffer(i);break;case"dae":p.addEventListener("load",function(){var e=bt(vt().mark((function e(t){var n,i,o,a,u;return vt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.target.result,e.next=3,s.e(323).then(s.bind(s,68));case 3:i=e.sent,o=i.ColladaLoader,a=new o(c),(u=a.parse(n)).scene.name=l,object.modelFileSize=h,r.loadSuccess(u.scene);case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),!1),p.readAsText(i);break;case"drc":p.addEventListener("load",function(){var e=bt(vt().mark((function e(n){var i,o,a,c;return vt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=n.target.result,e.next=3,s.e(323).then(s.bind(s,135));case 3:o=e.sent,a=o.DRACOLoader,(c=new a).setDecoderPath("https://"+lu+"/draco3d@1.5.5/"),c.decodeDracoFile(i,(function(e){var n;if(null!==e.index){var i=new t.MeshStandardMaterial;(n=new t.Mesh(e,i)).name=l}else{var o=new t.PointsMaterial({size:.01});o.vertexColors=e.hasAttribute("color"),(n=new t.Points(e,o)).name=l}c.dispose(),n.modelFileSize=h,r.loadSuccess(n)}));case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),!1),p.readAsArrayBuffer(i);break;case"fbx":p.addEventListener("load",function(){var e=bt(vt().mark((function e(t){var n,i,o,a,l;return vt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.target.result,e.next=3,s.e(323).then(s.bind(s,96));case 3:i=e.sent,o=i.FBXLoader,a=new o(c),(l=a.parse(n)).modelFileSize=h,r.loadSuccess(l);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),!1),p.readAsArrayBuffer(i);break;case"glb":p.addEventListener("load",function(){var e=bt(vt().mark((function e(t){var n,i,o;return vt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.target.result,(i=new W).setDecoderPath("https://"+lu+"/draco3d@1.5.5/"),(o=new ve).setDRACOLoader(i),o.parse(n,"",(function(e){var t,n=e.scene;n.name=l,(t=n.animations).push.apply(t,gt(e.animations)),n.modelFileSize=h,r.loadSuccess(n)}));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),!1),p.readAsArrayBuffer(i);break;case"gltf":p.addEventListener("load",function(){var e=bt(vt().mark((function e(t){var n,i,o;return vt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a(n=t.target.result)?alert("Import of glTF asset not possible. Only versions >= 2.0 are supported. Please try to upgrade the file to glTF 2.0 using glTF-Pipeline."):((o=new W).setDecoderPath("https://"+lu+"/draco3d@1.5.5/"),(i=new ve(c)).setDRACOLoader(o)),i.parse(n,"",(function(e){var t,n=e.scene;n.name=l,(t=n.animations).push.apply(t,gt(e.animations)),n.modelFileSize=h,r.loadSuccess(n)}));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),!1),p.readAsArrayBuffer(i);break;case"js":case"json":p.addEventListener("load",(function(e){var t,r=e.target.result;if(-1!==r.indexOf("postMessage")){var i=new Blob([r],{type:"text/javascript"}),o=URL.createObjectURL(i),s=new Worker(o);return s.onmessage=function(e){e.data.metadata={version:2},n(e.data,h)},void s.postMessage(Date.now())}try{t=JSON.parse(r)}catch(e){return void alert(e)}n(t,h)}),!1),p.readAsText(i);break;case"kmz":p.addEventListener("load",function(){var e=bt(vt().mark((function e(t){var n,i,o,a;return vt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.e(323).then(s.bind(s,335));case 2:n=e.sent,i=n.KMZLoader,o=new i,(a=o.parse(t.target.result)).scene.name=l,a.scene.modelFileSize=h,r.loadSuccess(a.scene);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),!1),p.readAsArrayBuffer(i);break;case"ldr":case"mpd":p.addEventListener("load",function(){var e=bt(vt().mark((function e(t){var n,i,o;return vt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.e(323).then(s.bind(s,44));case 2:n=e.sent,i=n.LDrawLoader,(o=new i).setPath("../libs/officialLibrary/"),o.parse(t.target.result,void 0,(function(e){e.name=l,e.rotation.x=Math.PI,e.modelFileSize=h,r.loadSuccess(e)}));case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),!1),p.readAsText(i);break;case"md2":p.addEventListener("load",function(){var e=bt(vt().mark((function e(n){var i,o,a,c,u,p,d;return vt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=n.target.result,e.next=3,s.e(323).then(s.bind(s,431));case 3:a=e.sent,c=a.MD2Loader,u=(new c).parse(o),p=new t.MeshStandardMaterial,(d=new t.Mesh(u,p)).mixer=new t.AnimationMixer(d),d.name=l,(i=d.animations).push.apply(i,gt(u.animations)),d.modelFileSize=h,r.loadSuccess(d);case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),!1),p.readAsArrayBuffer(i);break;case"obj":p.addEventListener("load",function(){var e=bt(vt().mark((function e(t){var n,i,o,a;return vt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.target.result,e.next=3,s.e(323).then(s.bind(s,856));case 3:i=e.sent,o=i.OBJLoader,(a=(new o).parse(n)).name=l,a.modelFileSize=h,r.loadSuccess(a);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),!1),p.readAsText(i);break;case"pcd":p.addEventListener("load",function(){var e=bt(vt().mark((function e(t){var n,i,o,a;return vt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.target.result,e.next=3,s.e(323).then(s.bind(s,273));case 3:i=e.sent,o=i.PCDLoader,(a=(new o).parse(n)).name=l,a.modelFileSize=h,r.loadSuccess(a);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),!1),p.readAsArrayBuffer(i);break;case"ply":p.addEventListener("load",function(){var e=bt(vt().mark((function e(n){var i,o,a,c,u,p,d;return vt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=n.target.result,e.next=3,s.e(323).then(s.bind(s,99));case 3:o=e.sent,a=o.PLYLoader,null!==(c=(new a).parse(i)).index?(p=new t.MeshStandardMaterial,(u=new t.Mesh(c,p)).name=l):((d=new t.PointsMaterial({size:.01})).vertexColors=c.hasAttribute("color"),(u=new t.Points(c,d)).name=l),u.modelFileSize=h,r.loadSuccess(u);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),!1),p.readAsArrayBuffer(i);break;case"stl":p.addEventListener("load",function(){var e=bt(vt().mark((function e(n){var i,o,a,c,u,p;return vt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=n.target.result,e.next=3,s.e(323).then(s.bind(s,222));case 3:o=e.sent,a=o.STLLoader,c=(new a).parse(i),u=new t.MeshStandardMaterial,(p=new t.Mesh(c,u)).name=l,p.modelFileSize=h,r.loadSuccess(p);case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),!1),void 0!==p.readAsBinaryString?p.readAsBinaryString(i):p.readAsArrayBuffer(i);break;case"svg":p.addEventListener("load",function(){var e=bt(vt().mark((function e(n){var i,o,a,c,l,u,p,d,f,m,g,y,v,_;return vt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=n.target.result,e.next=3,s.e(323).then(s.bind(s,763));case 3:for(o=e.sent,a=o.SVGLoader,c=new a,l=c.parse(i).paths,(u=new t.Group).scale.multiplyScalar(.1),u.scale.y*=-1,p=0;p<l.length;p++)for(d=l[p],f=new t.MeshBasicMaterial({color:d.color,depthWrite:!1}),m=a.createShapes(d),g=0;g<m.length;g++)y=m[g],v=new t.ShapeGeometry(y),_=new t.Mesh(v,f),u.add(_);u.modelFileSize=h,r.loadSuccess(u);case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),!1),p.readAsText(i);break;case"usdz":p.addEventListener("load",function(){var e=bt(vt().mark((function e(t){var n,i,o,a;return vt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.target.result,e.next=3,s.e(323).then(s.bind(s,662));case 3:i=e.sent,o=i.USDZLoader,(a=(new o).parse(n)).name=l,a.modelFileSize=h,r.loadSuccess(a);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),!1),p.readAsArrayBuffer(i);break;case"vox":p.addEventListener("load",function(){var e=bt(vt().mark((function e(n){var i,o,a,c,u,p,d,f,m;return vt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=n.target.result,e.next=3,s.e(323).then(s.bind(s,802));case 3:for(o=e.sent,a=o.VOXLoader,c=o.VOXMesh,u=(new a).parse(i),(p=new t.Group).name=l,d=0;d<u.length;d++)f=u[d],m=new c(f),p.add(m);p.modelFileSize=h,r.loadSuccess(p);case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),!1),p.readAsArrayBuffer(i);break;case"vtk":case"vtp":p.addEventListener("load",function(){var e=bt(vt().mark((function e(n){var i,o,a,c,u,p;return vt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=n.target.result,e.next=3,s.e(323).then(s.bind(s,709));case 3:o=e.sent,a=o.VTKLoader,c=(new a).parse(i),u=new t.MeshStandardMaterial,(p=new t.Mesh(c,u)).name=l,p.modelFileSize=h,r.loadSuccess(p);case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),!1),p.readAsArrayBuffer(i);break;case"wrl":p.addEventListener("load",function(){var t=bt(vt().mark((function t(r){var n,i,o,a;return vt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=r.target.result,t.next=3,s.e(323).then(s.bind(s,374));case 3:i=t.sent,o=i.VRMLLoader,a=(new o).parse(n),e.execute(new D(e,a));case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),!1),p.readAsText(i);break;case"xyz":p.addEventListener("load",function(){var e=bt(vt().mark((function e(n){var i,o,a,c,u,p;return vt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=n.target.result,e.next=3,s.e(323).then(s.bind(s,524));case 3:o=e.sent,a=o.XYZLoader,c=(new a).parse(i),(u=new t.PointsMaterial).vertexColors=c.hasAttribute("color"),(p=new t.Points(c,u)).name=l,p.modelFileSize=h,r.loadSuccess(p);case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),!1),p.readAsText(i);break;case"zip":p.addEventListener("load",(function(e){!function(e,t){o.apply(this,arguments)}(e.target.result,h)}),!1),p.readAsArrayBuffer(i);break;default:console.error("Unsupported file format ("+u+").")}}}function wt(e){return wt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},wt(e)}function St(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(i=n.key,o=void 0,o=function(e,t){if("object"!==wt(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==wt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(i,"string"),"symbol"===wt(o)?o:String(o)),n)}var i,o}function Mt(){return Mt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=At(e)););return e}(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(arguments.length<3?e:r):i.value}},Mt.apply(this,arguments)}function Tt(e,t){return Tt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Tt(e,t)}function Et(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=At(e);if(t){var i=At(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return function(e,t){if(t&&("object"===wt(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,r)}}function At(e){return At=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},At(e)}var Rt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Tt(e,t)}(o,e);var t,r,n,i=Et(o);function o(e,t,r){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(n=i.call(this,e)).type="AddScriptCommand",n.name="Add Script",n.object=t,n.script=r,n}return t=o,(r=[{key:"execute",value:function(){void 0===this.editor.scripts[this.object.uuid]&&(this.editor.scripts[this.object.uuid]=[]),this.editor.scripts[this.object.uuid].push(this.script),this.editor.signals.scriptAdded.dispatch(this.script)}},{key:"undo",value:function(){if(void 0!==this.editor.scripts[this.object.uuid]){var e=this.editor.scripts[this.object.uuid].indexOf(this.script);-1!==e&&this.editor.scripts[this.object.uuid].splice(e,1),this.editor.signals.scriptRemoved.dispatch(this.script)}}},{key:"toJSON",value:function(){var e=Mt(At(o.prototype),"toJSON",this).call(this,this);return e.objectUuid=this.object.uuid,e.script=this.script,e}},{key:"fromJSON",value:function(e){Mt(At(o.prototype),"fromJSON",this).call(this,e),this.script=e.script,this.object=this.editor.objectByUuid(e.objectUuid)}}])&&St(t.prototype,r),n&&St(t,n),Object.defineProperty(t,"prototype",{writable:!1}),o}(c);function Ct(e){return Ct="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ct(e)}function It(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(i=n.key,o=void 0,o=function(e,t){if("object"!==Ct(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==Ct(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(i,"string"),"symbol"===Ct(o)?o:String(o)),n)}var i,o}function Ot(){return Ot="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Lt(e)););return e}(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(arguments.length<3?e:r):i.value}},Ot.apply(this,arguments)}function Pt(e,t){return Pt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Pt(e,t)}function Nt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Lt(e);if(t){var i=Lt(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return function(e,t){if(t&&("object"===Ct(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,r)}}function Lt(e){return Lt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Lt(e)}var Ut=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Pt(e,t)}(o,e);var t,r,n,i=Nt(o);function o(e,t,r,n){var s;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(s=i.call(this,e)).type="MoveObjectCommand",s.name="Move Object",s.object=t,s.oldParent=void 0!==t?t.parent:void 0,s.oldIndex=void 0!==s.oldParent?s.oldParent.children.indexOf(s.object):void 0,s.newParent=r,s.newIndex=void 0!==n?void 0!==r?r.children.indexOf(n):void 0:void 0!==r?r.children.length:void 0,s.oldParent===s.newParent&&s.newIndex>s.oldIndex&&s.newIndex--,s.newBefore=n,s}return t=o,(r=[{key:"execute",value:function(){this.oldParent.remove(this.object),this.newParent.children.splice(this.newIndex,0,this.object),this.object.parent=this.newParent,this.object.dispatchEvent({type:"added"}),this.editor.signals.sceneGraphChanged.dispatch()}},{key:"undo",value:function(){this.newParent.remove(this.object),this.oldParent.children.splice(this.oldIndex,0,this.object),this.object.parent=this.oldParent,this.object.dispatchEvent({type:"added"}),this.editor.signals.sceneGraphChanged.dispatch()}},{key:"toJSON",value:function(){var e=Ot(Lt(o.prototype),"toJSON",this).call(this,this);return e.objectUuid=this.object.uuid,e.newParentUuid=this.newParent.uuid,e.oldParentUuid=this.oldParent.uuid,e.newIndex=this.newIndex,e.oldIndex=this.oldIndex,e}},{key:"fromJSON",value:function(e){Ot(Lt(o.prototype),"fromJSON",this).call(this,e),this.object=this.editor.objectByUuid(e.objectUuid),this.oldParent=this.editor.objectByUuid(e.oldParentUuid),void 0===this.oldParent&&(this.oldParent=this.editor.scene),this.newParent=this.editor.objectByUuid(e.newParentUuid),void 0===this.newParent&&(this.newParent=this.editor.scene),this.newIndex=e.newIndex,this.oldIndex=e.oldIndex}}])&&It(t.prototype,r),n&&It(t,n),Object.defineProperty(t,"prototype",{writable:!1}),o}(c);function Dt(e){return Dt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Dt(e)}function Ft(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(i=n.key,o=void 0,o=function(e,t){if("object"!==Dt(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==Dt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(i,"string"),"symbol"===Dt(o)?o:String(o)),n)}var i,o}function Bt(){return Bt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Gt(e)););return e}(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(arguments.length<3?e:r):i.value}},Bt.apply(this,arguments)}function kt(e,t){return kt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},kt(e,t)}function jt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Gt(e);if(t){var i=Gt(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return function(e,t){if(t&&("object"===Dt(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,r)}}function Gt(e){return Gt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Gt(e)}var zt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&kt(e,t)}(o,e);var t,r,n,i=jt(o);function o(e,t){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(r=i.call(this,e)).type="MultiCmdsCommand",r.name="Multiple Changes",r.cmdArray=void 0!==t?t:[],r}return t=o,(r=[{key:"execute",value:function(){this.editor.signals.sceneGraphChanged.active=!1;for(var e=0;e<this.cmdArray.length;e++)this.cmdArray[e].execute();this.editor.signals.sceneGraphChanged.active=!0,this.editor.signals.sceneGraphChanged.dispatch()}},{key:"undo",value:function(){this.editor.signals.sceneGraphChanged.active=!1;for(var e=this.cmdArray.length-1;e>=0;e--)this.cmdArray[e].undo();this.editor.signals.sceneGraphChanged.active=!0,this.editor.signals.sceneGraphChanged.dispatch()}},{key:"toJSON",value:function(){for(var e=Bt(Gt(o.prototype),"toJSON",this).call(this,this),t=[],r=0;r<this.cmdArray.length;r++)t.push(this.cmdArray[r].toJSON());return e.cmds=t,e}},{key:"fromJSON",value:function(e){Bt(Gt(o.prototype),"fromJSON",this).call(this,e);for(var t=e.cmds,r=0;r<t.length;r++){var n=new window[t[r].type];n.fromJSON(t[r]),this.cmdArray.push(n)}}}])&&Ft(t.prototype,r),n&&Ft(t,n),Object.defineProperty(t,"prototype",{writable:!1}),o}(c);function Vt(e){return Vt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Vt(e)}function Ht(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(i=n.key,o=void 0,o=function(e,t){if("object"!==Vt(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==Vt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(i,"string"),"symbol"===Vt(o)?o:String(o)),n)}var i,o}function Wt(){return Wt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=qt(e)););return e}(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(arguments.length<3?e:r):i.value}},Wt.apply(this,arguments)}function Xt(e,t){return Xt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Xt(e,t)}function Yt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=qt(e);if(t){var i=qt(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return function(e,t){if(t&&("object"===Vt(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,r)}}function qt(e){return qt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},qt(e)}var Jt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Xt(e,t)}(s,e);var r,n,i,o=Yt(s);function s(e,t){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(r=o.call(this,e)).type="RemoveObjectCommand",r.name="Remove Object",r.object=t,r.parent=void 0!==t?t.parent:void 0,void 0!==r.parent&&(r.index=r.parent.children.indexOf(r.object)),r}return r=s,(n=[{key:"execute",value:function(){this.editor.removeObject(this.object),this.editor.deselect()}},{key:"undo",value:function(){this.editor.addObject(this.object,this.parent,this.index),this.editor.select(this.object)}},{key:"toJSON",value:function(){var e=Wt(qt(s.prototype),"toJSON",this).call(this,this);return e.object=this.object.toJSON(),e.index=this.index,e.parentUuid=this.parent.uuid,e}},{key:"fromJSON",value:function(e){if(Wt(qt(s.prototype),"fromJSON",this).call(this,e),this.parent=this.editor.objectByUuid(e.parentUuid),void 0===this.parent&&(this.parent=this.editor.scene),this.index=e.index,this.object=this.editor.objectByUuid(e.object.object.uuid),void 0===this.object){var r=new t.ObjectLoader;this.object=r.parse(e.object)}}}])&&Ht(r.prototype,n),i&&Ht(r,i),Object.defineProperty(r,"prototype",{writable:!1}),s}(c);function Kt(e){return Kt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Kt(e)}function Zt(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(i=n.key,o=void 0,o=function(e,t){if("object"!==Kt(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==Kt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(i,"string"),"symbol"===Kt(o)?o:String(o)),n)}var i,o}function Qt(){return Qt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=tr(e)););return e}(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(arguments.length<3?e:r):i.value}},Qt.apply(this,arguments)}function $t(e,t){return $t=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},$t(e,t)}function er(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=tr(e);if(t){var i=tr(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return function(e,t){if(t&&("object"===Kt(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,r)}}function tr(e){return tr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},tr(e)}var rr=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&$t(e,t)}(o,e);var t,r,n,i=er(o);function o(e,t,r){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(n=i.call(this,e)).type="RemoveScriptCommand",n.name="Remove Script",n.object=t,n.script=r,n.object&&n.script&&(n.index=n.editor.scripts[n.object.uuid].indexOf(n.script)),n}return t=o,(r=[{key:"execute",value:function(){void 0!==this.editor.scripts[this.object.uuid]&&(-1!==this.index&&this.editor.scripts[this.object.uuid].splice(this.index,1),this.editor.signals.scriptRemoved.dispatch(this.script))}},{key:"undo",value:function(){void 0===this.editor.scripts[this.object.uuid]&&(this.editor.scripts[this.object.uuid]=[]),this.editor.scripts[this.object.uuid].splice(this.index,0,this.script),this.editor.signals.scriptAdded.dispatch(this.script)}},{key:"toJSON",value:function(){var e=Qt(tr(o.prototype),"toJSON",this).call(this,this);return e.objectUuid=this.object.uuid,e.script=this.script,e.index=this.index,e}},{key:"fromJSON",value:function(e){Qt(tr(o.prototype),"fromJSON",this).call(this,e),this.script=e.script,this.index=e.index,this.object=this.editor.objectByUuid(e.objectUuid)}}])&&Zt(t.prototype,r),n&&Zt(t,n),Object.defineProperty(t,"prototype",{writable:!1}),o}(c);function nr(e){return nr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},nr(e)}function ir(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(i=n.key,o=void 0,o=function(e,t){if("object"!==nr(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==nr(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(i,"string"),"symbol"===nr(o)?o:String(o)),n)}var i,o}function or(){return or="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=cr(e)););return e}(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(arguments.length<3?e:r):i.value}},or.apply(this,arguments)}function sr(e,t){return sr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},sr(e,t)}function ar(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=cr(e);if(t){var i=cr(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return function(e,t){if(t&&("object"===nr(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,r)}}function cr(e){return cr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},cr(e)}var lr=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&sr(e,t)}(o,e);var t,r,n,i=ar(o);function o(e,t,r,n){var s;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(s=i.call(this,e)).type="SetColorCommand",s.name="Set ".concat(r),s.updatable=!0,s.object=t,s.attributeName=r,s.oldValue=void 0!==t?s.object[s.attributeName].getHex():void 0,s.newValue=n,s}return t=o,(r=[{key:"execute",value:function(){this.object[this.attributeName].setHex(this.newValue),this.editor.signals.objectChanged.dispatch(this.object)}},{key:"undo",value:function(){this.object[this.attributeName].setHex(this.oldValue),this.editor.signals.objectChanged.dispatch(this.object)}},{key:"update",value:function(e){this.newValue=e.newValue}},{key:"toJSON",value:function(){var e=or(cr(o.prototype),"toJSON",this).call(this,this);return e.objectUuid=this.object.uuid,e.attributeName=this.attributeName,e.oldValue=this.oldValue,e.newValue=this.newValue,e}},{key:"fromJSON",value:function(e){or(cr(o.prototype),"fromJSON",this).call(this,e),this.object=this.editor.objectByUuid(e.objectUuid),this.attributeName=e.attributeName,this.oldValue=e.oldValue,this.newValue=e.newValue}}])&&ir(t.prototype,r),n&&ir(t,n),Object.defineProperty(t,"prototype",{writable:!1}),o}(c);function ur(e){return ur="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ur(e)}function hr(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(i=n.key,o=void 0,o=function(e,t){if("object"!==ur(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==ur(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(i,"string"),"symbol"===ur(o)?o:String(o)),n)}var i,o}function pr(){return pr="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=mr(e)););return e}(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(arguments.length<3?e:r):i.value}},pr.apply(this,arguments)}function dr(e,t){return dr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},dr(e,t)}function fr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=mr(e);if(t){var i=mr(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return function(e,t){if(t&&("object"===ur(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,r)}}function mr(e){return mr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},mr(e)}var gr=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&dr(e,t)}(s,e);var r,n,i,o=fr(s);function s(e,t,r){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(n=o.call(this,e)).type="SetGeometryCommand",n.name="Set Geometry",n.updatable=!0,n.object=t,n.oldGeometry=void 0!==t?t.geometry:void 0,n.newGeometry=r,n}return r=s,(n=[{key:"execute",value:function(){this.object.geometry.dispose(),this.object.geometry=this.newGeometry,this.object.geometry.computeBoundingSphere(),this.editor.signals.geometryChanged.dispatch(this.object),this.editor.signals.sceneGraphChanged.dispatch()}},{key:"undo",value:function(){this.object.geometry.dispose(),this.object.geometry=this.oldGeometry,this.object.geometry.computeBoundingSphere(),this.editor.signals.geometryChanged.dispatch(this.object),this.editor.signals.sceneGraphChanged.dispatch()}},{key:"update",value:function(e){this.newGeometry=e.newGeometry}},{key:"toJSON",value:function(){var e=pr(mr(s.prototype),"toJSON",this).call(this,this);return e.objectUuid=this.object.uuid,e.oldGeometry=this.object.geometry.toJSON(),e.newGeometry=this.newGeometry.toJSON(),e}},{key:"fromJSON",value:function(e){function r(e){return(new t.ObjectLoader).parseGeometries([e])[e.uuid]}pr(mr(s.prototype),"fromJSON",this).call(this,e),this.object=this.editor.objectByUuid(e.objectUuid),this.oldGeometry=r(e.oldGeometry),this.newGeometry=r(e.newGeometry)}}])&&hr(r.prototype,n),i&&hr(r,i),Object.defineProperty(r,"prototype",{writable:!1}),s}(c);function yr(e){return yr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},yr(e)}function vr(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(i=n.key,o=void 0,o=function(e,t){if("object"!==yr(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==yr(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(i,"string"),"symbol"===yr(o)?o:String(o)),n)}var i,o}function _r(){return _r="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=wr(e)););return e}(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(arguments.length<3?e:r):i.value}},_r.apply(this,arguments)}function br(e,t){return br=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},br(e,t)}function xr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=wr(e);if(t){var i=wr(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return function(e,t){if(t&&("object"===yr(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,r)}}function wr(e){return wr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},wr(e)}var Sr=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&br(e,t)}(o,e);var t,r,n,i=xr(o);function o(e,t,r,n){var s;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(s=i.call(this,e)).type="SetGeometryValueCommand",s.name="Set Geometry.".concat(r),s.object=t,s.attributeName=r,s.oldValue=void 0!==t?t.geometry[r]:void 0,s.newValue=n,s}return t=o,(r=[{key:"execute",value:function(){this.object.geometry[this.attributeName]=this.newValue,this.editor.signals.objectChanged.dispatch(this.object),this.editor.signals.geometryChanged.dispatch(),this.editor.signals.sceneGraphChanged.dispatch()}},{key:"undo",value:function(){this.object.geometry[this.attributeName]=this.oldValue,this.editor.signals.objectChanged.dispatch(this.object),this.editor.signals.geometryChanged.dispatch(),this.editor.signals.sceneGraphChanged.dispatch()}},{key:"toJSON",value:function(){var e=_r(wr(o.prototype),"toJSON",this).call(this,this);return e.objectUuid=this.object.uuid,e.attributeName=this.attributeName,e.oldValue=this.oldValue,e.newValue=this.newValue,e}},{key:"fromJSON",value:function(e){_r(wr(o.prototype),"fromJSON",this).call(this,e),this.object=this.editor.objectByUuid(e.objectUuid),this.attributeName=e.attributeName,this.oldValue=e.oldValue,this.newValue=e.newValue}}])&&vr(t.prototype,r),n&&vr(t,n),Object.defineProperty(t,"prototype",{writable:!1}),o}(c);function Mr(e){return Mr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Mr(e)}function Tr(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(i=n.key,o=void 0,o=function(e,t){if("object"!==Mr(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==Mr(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(i,"string"),"symbol"===Mr(o)?o:String(o)),n)}var i,o}function Er(){return Er="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Cr(e)););return e}(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(arguments.length<3?e:r):i.value}},Er.apply(this,arguments)}function Ar(e,t){return Ar=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Ar(e,t)}function Rr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Cr(e);if(t){var i=Cr(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return function(e,t){if(t&&("object"===Mr(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,r)}}function Cr(e){return Cr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Cr(e)}var Ir=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Ar(e,t)}(o,e);var t,r,n,i=Rr(o);function o(e,t,r,n,s){var a;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(a=i.call(this,e)).type="SetMaterialColorCommand",a.name="Set Material.".concat(r),a.updatable=!0,a.object=t,a.material=void 0!==a.object?a.editor.getObjectMaterial(t,s):void 0,a.oldValue=void 0!==a.material?a.material[r].getHex():void 0,a.newValue=n,a.attributeName=r,a}return t=o,(r=[{key:"execute",value:function(){this.material[this.attributeName].setHex(this.newValue),this.editor.signals.materialChanged.dispatch(this.material)}},{key:"undo",value:function(){this.material[this.attributeName].setHex(this.oldValue),this.editor.signals.materialChanged.dispatch(this.material)}},{key:"update",value:function(e){this.newValue=e.newValue}},{key:"toJSON",value:function(){var e=Er(Cr(o.prototype),"toJSON",this).call(this,this);return e.objectUuid=this.object.uuid,e.attributeName=this.attributeName,e.oldValue=this.oldValue,e.newValue=this.newValue,e}},{key:"fromJSON",value:function(e){Er(Cr(o.prototype),"fromJSON",this).call(this,e),this.object=this.editor.objectByUuid(e.objectUuid),this.attributeName=e.attributeName,this.oldValue=e.oldValue,this.newValue=e.newValue}}])&&Tr(t.prototype,r),n&&Tr(t,n),Object.defineProperty(t,"prototype",{writable:!1}),o}(c);function Or(e){return Or="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Or(e)}function Pr(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(i=n.key,o=void 0,o=function(e,t){if("object"!==Or(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==Or(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(i,"string"),"symbol"===Or(o)?o:String(o)),n)}var i,o}function Nr(){return Nr="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Dr(e)););return e}(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(arguments.length<3?e:r):i.value}},Nr.apply(this,arguments)}function Lr(e,t){return Lr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Lr(e,t)}function Ur(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Dr(e);if(t){var i=Dr(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return function(e,t){if(t&&("object"===Or(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,r)}}function Dr(e){return Dr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Dr(e)}var Fr=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Lr(e,t)}(s,e);var r,n,i,o=Ur(s);function s(e,t,r,n){var i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(i=o.call(this,e)).type="SetMaterialCommand",i.name="New Material",i.object=t,i.materialSlot=n,i.oldMaterial=i.editor.getObjectMaterial(t,n),i.newMaterial=r,i}return r=s,(n=[{key:"execute",value:function(){this.editor.setObjectMaterial(this.object,this.materialSlot,this.newMaterial),this.editor.signals.materialChanged.dispatch(this.newMaterial)}},{key:"undo",value:function(){this.editor.setObjectMaterial(this.object,this.materialSlot,this.oldMaterial),this.editor.signals.materialChanged.dispatch(this.oldMaterial)}},{key:"toJSON",value:function(){var e=Nr(Dr(s.prototype),"toJSON",this).call(this,this);return e.objectUuid=this.object.uuid,e.oldMaterial=this.oldMaterial.toJSON(),e.newMaterial=this.newMaterial.toJSON(),e}},{key:"fromJSON",value:function(e){function r(e){var r=new t.ObjectLoader,n=r.parseImages(e.images),i=r.parseTextures(e.textures,n);return r.parseMaterials([e],i)[e.uuid]}Nr(Dr(s.prototype),"fromJSON",this).call(this,e),this.object=this.editor.objectByUuid(e.objectUuid),this.oldMaterial=r(e.oldMaterial),this.newMaterial=r(e.newMaterial)}}])&&Pr(r.prototype,n),i&&Pr(r,i),Object.defineProperty(r,"prototype",{writable:!1}),s}(c);function Br(e){return Br="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Br(e)}function kr(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(i=n.key,o=void 0,o=function(e,t){if("object"!==Br(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==Br(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(i,"string"),"symbol"===Br(o)?o:String(o)),n)}var i,o}function jr(){return jr="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Vr(e)););return e}(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(arguments.length<3?e:r):i.value}},jr.apply(this,arguments)}function Gr(e,t){return Gr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Gr(e,t)}function zr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Vr(e);if(t){var i=Vr(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return function(e,t){if(t&&("object"===Br(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,r)}}function Vr(e){return Vr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Vr(e)}var Hr=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Gr(e,t)}(s,e);var r,n,i,o=zr(s);function s(e,t,r,n,i){var a;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(a=o.call(this,e)).type="SetMaterialMapCommand",a.name="Set Material.".concat(r),a.object=t,a.material=a.editor.getObjectMaterial(t,i),a.oldMap=void 0!==t?a.material[r]:void 0,a.newMap=n,a.mapName=r,a}return r=s,(n=[{key:"execute",value:function(){null!==this.oldMap&&void 0!==this.oldMap&&this.oldMap.dispose(),this.material[this.mapName]=this.newMap,this.material.needsUpdate=!0,this.editor.signals.materialChanged.dispatch(this.material)}},{key:"undo",value:function(){this.material[this.mapName]=this.oldMap,this.material.needsUpdate=!0,this.editor.signals.materialChanged.dispatch(this.material)}},{key:"toJSON",value:function(){var e=jr(Vr(s.prototype),"toJSON",this).call(this,this);return e.objectUuid=this.object.uuid,e.mapName=this.mapName,e.newMap=t(this.newMap),e.oldMap=t(this.oldMap),e;function t(e){if(null==e)return null;var t={geometries:{},materials:{},textures:{},images:{}},r=e.toJSON(t),n=function(e){var t=[];for(var r in e){var n=e[r];delete n.metadata,t.push(n)}return t}(t.images);return n.length>0&&(r.images=n),r.sourceFile=e.sourceFile,r}}},{key:"fromJSON",value:function(e){function r(e){var r=null;if(null!==e){var n=new t.ObjectLoader,i=n.parseImages(e.images);(r=n.parseTextures([e],i)[e.uuid]).sourceFile=e.sourceFile}return r}jr(Vr(s.prototype),"fromJSON",this).call(this,e),this.object=this.editor.objectByUuid(e.objectUuid),this.mapName=e.mapName,this.oldMap=r(e.oldMap),this.newMap=r(e.newMap)}}])&&kr(r.prototype,n),i&&kr(r,i),Object.defineProperty(r,"prototype",{writable:!1}),s}(c);function Wr(e){return Wr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Wr(e)}function Xr(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(i=n.key,o=void 0,o=function(e,t){if("object"!==Wr(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==Wr(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(i,"string"),"symbol"===Wr(o)?o:String(o)),n)}var i,o}function Yr(){return Yr="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Kr(e)););return e}(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(arguments.length<3?e:r):i.value}},Yr.apply(this,arguments)}function qr(e,t){return qr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},qr(e,t)}function Jr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Kr(e);if(t){var i=Kr(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return function(e,t){if(t&&("object"===Wr(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,r)}}function Kr(e){return Kr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Kr(e)}var Zr=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&qr(e,t)}(o,e);var t,r,n,i=Jr(o);function o(e,t,r,n,s){var a;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(a=i.call(this,e)).type="SetMaterialValueCommand",a.name="Set Material.".concat(r),a.updatable=!0,a.object=t,a.material=a.editor.getObjectMaterial(t,s),a.oldValue=void 0!==a.material?a.material[r]:void 0,a.newValue=n,a.attributeName=r,a}return t=o,(r=[{key:"execute",value:function(){this.material[this.attributeName]=this.newValue,this.material.needsUpdate=!0,this.editor.signals.objectChanged.dispatch(this.object),this.editor.signals.materialChanged.dispatch(this.material)}},{key:"undo",value:function(){this.material[this.attributeName]=this.oldValue,this.material.needsUpdate=!0,this.editor.signals.objectChanged.dispatch(this.object),this.editor.signals.materialChanged.dispatch(this.material)}},{key:"update",value:function(e){this.newValue=e.newValue}},{key:"toJSON",value:function(){var e=Yr(Kr(o.prototype),"toJSON",this).call(this,this);return e.objectUuid=this.object.uuid,e.attributeName=this.attributeName,e.oldValue=this.oldValue,e.newValue=this.newValue,e}},{key:"fromJSON",value:function(e){Yr(Kr(o.prototype),"fromJSON",this).call(this,e),this.attributeName=e.attributeName,this.oldValue=e.oldValue,this.newValue=e.newValue,this.object=this.editor.objectByUuid(e.objectUuid)}}])&&Xr(t.prototype,r),n&&Xr(t,n),Object.defineProperty(t,"prototype",{writable:!1}),o}(c);function Qr(e){return Qr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Qr(e)}function $r(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(i=n.key,o=void 0,o=function(e,t){if("object"!==Qr(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==Qr(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(i,"string"),"symbol"===Qr(o)?o:String(o)),n)}var i,o}function en(){return en="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=nn(e)););return e}(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(arguments.length<3?e:r):i.value}},en.apply(this,arguments)}function tn(e,t){return tn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},tn(e,t)}function rn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=nn(e);if(t){var i=nn(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return function(e,t){if(t&&("object"===Qr(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,r)}}function nn(e){return nn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},nn(e)}var on=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&tn(e,t)}(o,e);var t,r,n,i=rn(o);function o(e,t,r,n,s){var a;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(a=i.call(this,e)).type="SetMaterialColorCommand",a.name="Set Material.".concat(r),a.updatable=!0,a.object=t,a.material=a.editor.getObjectMaterial(t,s),a.oldValue=void 0!==a.material?a.material[r].toArray():void 0,a.newValue=n,a.attributeName=r,a}return t=o,(r=[{key:"execute",value:function(){this.material[this.attributeName].fromArray(this.newValue),this.editor.signals.materialChanged.dispatch(this.material)}},{key:"undo",value:function(){this.material[this.attributeName].fromArray(this.oldValue),this.editor.signals.materialChanged.dispatch(this.material)}},{key:"update",value:function(e){this.newValue=e.newValue}},{key:"toJSON",value:function(){var e=en(nn(o.prototype),"toJSON",this).call(this,this);return e.objectUuid=this.object.uuid,e.attributeName=this.attributeName,e.oldValue=this.oldValue,e.newValue=this.newValue,e}},{key:"fromJSON",value:function(e){en(nn(o.prototype),"fromJSON",this).call(this,e),this.object=this.editor.objectByUuid(e.objectUuid),this.attributeName=e.attributeName,this.oldValue=e.oldValue,this.newValue=e.newValue}}])&&$r(t.prototype,r),n&&$r(t,n),Object.defineProperty(t,"prototype",{writable:!1}),o}(c);function sn(e){return sn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},sn(e)}function an(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(i=n.key,o=void 0,o=function(e,t){if("object"!==sn(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==sn(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(i,"string"),"symbol"===sn(o)?o:String(o)),n)}var i,o}function cn(){return cn="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=hn(e)););return e}(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(arguments.length<3?e:r):i.value}},cn.apply(this,arguments)}function ln(e,t){return ln=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},ln(e,t)}function un(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=hn(e);if(t){var i=hn(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return function(e,t){if(t&&("object"===sn(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,r)}}function hn(e){return hn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},hn(e)}var pn=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ln(e,t)}(s,e);var r,n,i,o=un(s);function s(e,t,r,n){var i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(i=o.call(this,e)).type="SetPositionCommand",i.name="Set Position",i.updatable=!0,i.object=t,void 0!==t&&void 0!==r&&(i.oldPosition=t.position.clone(),i.newPosition=r.clone()),void 0!==n&&(i.oldPosition=n.clone()),i}return r=s,(n=[{key:"execute",value:function(){this.object.position.copy(this.newPosition),this.object.updateMatrixWorld(!0),this.editor.signals.objectChanged.dispatch(this.object),this.editor.app.updateObjectCallback(this.object,"position")}},{key:"undo",value:function(){this.object.position.copy(this.oldPosition),this.object.updateMatrixWorld(!0),this.editor.signals.objectChanged.dispatch(this.object)}},{key:"update",value:function(e){this.newPosition.copy(e.newPosition)}},{key:"toJSON",value:function(){var e=cn(hn(s.prototype),"toJSON",this).call(this,this);return e.objectUuid=this.object.uuid,e.oldPosition=this.oldPosition.toArray(),e.newPosition=this.newPosition.toArray(),e}},{key:"fromJSON",value:function(e){cn(hn(s.prototype),"fromJSON",this).call(this,e),this.object=this.editor.objectByUuid(e.objectUuid),this.oldPosition=(new t.Vector3).fromArray(e.oldPosition),this.newPosition=(new t.Vector3).fromArray(e.newPosition)}}])&&an(r.prototype,n),i&&an(r,i),Object.defineProperty(r,"prototype",{writable:!1}),s}(c);function dn(e){return dn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},dn(e)}function fn(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(i=n.key,o=void 0,o=function(e,t){if("object"!==dn(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==dn(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(i,"string"),"symbol"===dn(o)?o:String(o)),n)}var i,o}function mn(){return mn="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=vn(e)););return e}(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(arguments.length<3?e:r):i.value}},mn.apply(this,arguments)}function gn(e,t){return gn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},gn(e,t)}function yn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=vn(e);if(t){var i=vn(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return function(e,t){if(t&&("object"===dn(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,r)}}function vn(e){return vn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},vn(e)}var _n=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&gn(e,t)}(s,e);var r,n,i,o=yn(s);function s(e,t,r,n){var i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(i=o.call(this,e)).type="SetRotationCommand",i.name="Set Rotation",i.updatable=!0,i.object=t,void 0!==t&&void 0!==r&&(i.oldRotation=t.rotation.clone(),i.newRotation=r.clone()),void 0!==n&&(i.oldRotation=n.clone()),i}return r=s,(n=[{key:"execute",value:function(){this.object.rotation.copy(this.newRotation),this.object.updateMatrixWorld(!0),this.editor.signals.objectChanged.dispatch(this.object),this.editor.app.updateObjectCallback(this.object,"rotation")}},{key:"undo",value:function(){this.object.rotation.copy(this.oldRotation),this.object.updateMatrixWorld(!0),this.editor.signals.objectChanged.dispatch(this.object)}},{key:"update",value:function(e){this.newRotation.copy(e.newRotation)}},{key:"toJSON",value:function(){var e=mn(vn(s.prototype),"toJSON",this).call(this,this);return e.objectUuid=this.object.uuid,e.oldRotation=this.oldRotation.toArray(),e.newRotation=this.newRotation.toArray(),e}},{key:"fromJSON",value:function(e){mn(vn(s.prototype),"fromJSON",this).call(this,e),this.object=this.editor.objectByUuid(e.objectUuid),this.oldRotation=(new t.Euler).fromArray(e.oldRotation),this.newRotation=(new t.Euler).fromArray(e.newRotation)}}])&&fn(r.prototype,n),i&&fn(r,i),Object.defineProperty(r,"prototype",{writable:!1}),s}(c);function bn(e){return bn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},bn(e)}function xn(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(i=n.key,o=void 0,o=function(e,t){if("object"!==bn(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==bn(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(i,"string"),"symbol"===bn(o)?o:String(o)),n)}var i,o}function wn(){return wn="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Tn(e)););return e}(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(arguments.length<3?e:r):i.value}},wn.apply(this,arguments)}function Sn(e,t){return Sn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Sn(e,t)}function Mn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Tn(e);if(t){var i=Tn(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return function(e,t){if(t&&("object"===bn(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,r)}}function Tn(e){return Tn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Tn(e)}var En=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Sn(e,t)}(s,e);var r,n,i,o=Mn(s);function s(e,t,r,n){var i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(i=o.call(this,e)).type="SetScaleCommand",i.name="Set Scale",i.updatable=!0,i.object=t,void 0!==t&&void 0!==r&&(i.oldScale=t.scale.clone(),i.newScale=r.clone()),void 0!==n&&(i.oldScale=n.clone()),i}return r=s,(n=[{key:"execute",value:function(){this.object.scale.copy(this.newScale),this.object.updateMatrixWorld(!0),this.editor.signals.objectChanged.dispatch(this.object),this.editor.app.updateObjectCallback(this.object,"scale")}},{key:"undo",value:function(){this.object.scale.copy(this.oldScale),this.object.updateMatrixWorld(!0),this.editor.signals.objectChanged.dispatch(this.object)}},{key:"update",value:function(e){this.newScale.copy(e.newScale)}},{key:"toJSON",value:function(){var e=wn(Tn(s.prototype),"toJSON",this).call(this,this);return e.objectUuid=this.object.uuid,e.oldScale=this.oldScale.toArray(),e.newScale=this.newScale.toArray(),e}},{key:"fromJSON",value:function(e){wn(Tn(s.prototype),"fromJSON",this).call(this,e),this.object=this.editor.objectByUuid(e.objectUuid),this.oldScale=(new t.Vector3).fromArray(e.oldScale),this.newScale=(new t.Vector3).fromArray(e.newScale)}}])&&xn(r.prototype,n),i&&xn(r,i),Object.defineProperty(r,"prototype",{writable:!1}),s}(c);function An(e){return An="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},An(e)}function Rn(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(i=n.key,o=void 0,o=function(e,t){if("object"!==An(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==An(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(i,"string"),"symbol"===An(o)?o:String(o)),n)}var i,o}function Cn(){return Cn="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Pn(e)););return e}(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(arguments.length<3?e:r):i.value}},Cn.apply(this,arguments)}function In(e,t){return In=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},In(e,t)}function On(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Pn(e);if(t){var i=Pn(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return function(e,t){if(t&&("object"===An(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,r)}}function Pn(e){return Pn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Pn(e)}var Nn=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&In(e,t)}(o,e);var t,r,n,i=On(o);function o(e,t,r,n,s){var a;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(a=i.call(this,e)).type="SetScriptValueCommand",a.name="Set Script.".concat(n),a.updatable=!0,a.object=t,a.script=r,a.attributeName=n,a.oldValue=void 0!==r?r[a.attributeName]:void 0,a.newValue=s,a}return t=o,(r=[{key:"execute",value:function(){this.script[this.attributeName]=this.newValue,this.editor.signals.scriptChanged.dispatch()}},{key:"undo",value:function(){this.script[this.attributeName]=this.oldValue,this.editor.signals.scriptChanged.dispatch()}},{key:"update",value:function(e){this.newValue=e.newValue}},{key:"toJSON",value:function(){var e=Cn(Pn(o.prototype),"toJSON",this).call(this,this);return e.objectUuid=this.object.uuid,e.index=this.editor.scripts[this.object.uuid].indexOf(this.script),e.attributeName=this.attributeName,e.oldValue=this.oldValue,e.newValue=this.newValue,e}},{key:"fromJSON",value:function(e){Cn(Pn(o.prototype),"fromJSON",this).call(this,e),this.oldValue=e.oldValue,this.newValue=e.newValue,this.attributeName=e.attributeName,this.object=this.editor.objectByUuid(e.objectUuid),this.script=this.editor.scripts[e.objectUuid][e.index]}}])&&Rn(t.prototype,r),n&&Rn(t,n),Object.defineProperty(t,"prototype",{writable:!1}),o}(c);function Ln(e){return Ln="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ln(e)}function Un(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(i=n.key,o=void 0,o=function(e,t){if("object"!==Ln(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==Ln(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(i,"string"),"symbol"===Ln(o)?o:String(o)),n)}var i,o}var Dn=function(){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.editor=e,this.undos=[],this.redos=[],this.lastCmdTime=Date.now(),this.idCounter=0,this.historyDisabled=!1,this.config=e.config;var r=this;this.editor.signals.startPlayer.add((function(){r.historyDisabled=!0})),this.editor.signals.stopPlayer.add((function(){r.historyDisabled=!1}))}var r,n,i;return r=t,(n=[{key:"execute",value:function(e,t){var r=this.undos[this.undos.length-1],n=Date.now()-this.lastCmdTime,i=r&&r.updatable&&e.updatable&&r.object===e.object&&r.type===e.type&&r.script===e.script&&r.attributeName===e.attributeName;i&&"SetScriptValueCommand"===e.type||i&&n<500?(r.update(e),e=r):(this.undos.push(e),e.id=++this.idCounter),e.name=void 0!==t?t:e.name,e.execute(),e.inMemory=!0,this.config.getKey("settings/history")&&(e.json=e.toJSON()),this.lastCmdTime=Date.now(),this.redos=[],this.editor.signals.historyChanged.dispatch(e)}},{key:"undo",value:function(){if(!this.historyDisabled){var e=void 0;return this.undos.length>0&&!1===(e=this.undos.pop()).inMemory&&e.fromJSON(e.json),void 0!==e&&(e.undo(),this.redos.push(e),this.editor.signals.historyChanged.dispatch(e)),e}alert("Undo/Redo disabled while scene is playing.")}},{key:"redo",value:function(){if(!this.historyDisabled){var e=void 0;return this.redos.length>0&&!1===(e=this.redos.pop()).inMemory&&e.fromJSON(e.json),void 0!==e&&(e.execute(),this.undos.push(e),this.editor.signals.historyChanged.dispatch(e)),e}alert("Undo/Redo disabled while scene is playing.")}},{key:"toJSON",value:function(){var e={undos:[],redos:[]};if(!this.config.getKey("settings/history"))return e;for(var t=0;t<this.undos.length;t++)this.undos[t].hasOwnProperty("json")&&e.undos.push(this.undos[t].json);for(var r=0;r<this.redos.length;r++)this.redos[r].hasOwnProperty("json")&&e.redos.push(this.redos[r].json);return e}},{key:"fromJSON",value:function(t){if(void 0!==t){for(var r=0;r<t.undos.length;r++){var n=t.undos[r],i=new e[n.type](this.editor);i.json=n,i.id=n.id,i.name=n.name,this.undos.push(i),this.idCounter=n.id>this.idCounter?n.id:this.idCounter}for(var o=0;o<t.redos.length;o++){var s=t.redos[o],a=new e[s.type](this.editor);a.json=s,a.id=s.id,a.name=s.name,this.redos.push(a),this.idCounter=s.id>this.idCounter?s.id:this.idCounter}this.editor.signals.historyChanged.dispatch(this.undos[this.undos.length-1])}}},{key:"clear",value:function(){this.undos=[],this.redos=[],this.idCounter=0,this.editor.signals.historyChanged.dispatch()}},{key:"goToState",value:function(e){if(this.historyDisabled)alert("Undo/Redo disabled while scene is playing.");else{this.editor.signals.sceneGraphChanged.active=!1,this.editor.signals.historyChanged.active=!1;var t=this.undos.length>0?this.undos[this.undos.length-1]:void 0;if(void 0===t||e>t.id)for(t=this.redo();void 0!==t&&e>t.id;)t=this.redo();else for(;void 0!==(t=this.undos[this.undos.length-1])&&e!==t.id;)this.undo();this.editor.signals.sceneGraphChanged.active=!0,this.editor.signals.historyChanged.active=!0,this.editor.signals.sceneGraphChanged.dispatch(),this.editor.signals.historyChanged.dispatch(t)}}},{key:"enableSerialization",value:function(e){this.goToState(-1),this.editor.signals.sceneGraphChanged.active=!1,this.editor.signals.historyChanged.active=!1;for(var t=this.redo();void 0!==t;)t.hasOwnProperty("json")||(t.json=t.toJSON()),t=this.redo();this.editor.signals.sceneGraphChanged.active=!0,this.editor.signals.historyChanged.active=!0,this.goToState(e)}}])&&Un(r.prototype,n),i&&Un(r,i),Object.defineProperty(r,"prototype",{writable:!1}),t}();function Fn(e){return Fn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Fn(e)}function Bn(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(i=n.key,o=void 0,o=function(e,t){if("object"!==Fn(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==Fn(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(i,"string"),"symbol"===Fn(o)?o:String(o)),n)}var i,o}var kn=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.editor=t,this.editor.signals.intersectionsDetected.add((function(e,r){if(e.length>0){var n,i,o=function e(r){return null==r.parent?void 0:r.parent==t.scene?r:e(r.parent)},s=function e(t,r){r.push(t),t.parent&&e(t.parent,r)},a=t.selected,c=e[0].object;if(r)if(null==a||a==t.scene||a==t.camera)n=o(c);else if(s(c,i=[]),i.indexOf(a)>=0){var l=i.indexOf(a);l-1>=0&&(n=i[l-1])}else n=o(c);else if(a)s(c,i=[]),n=i.indexOf(a)>=0?a:o(c);else n=o(c);if(null!=n)if(t.app.getWidgetIsLocked(n.uuid))return;null!=n&&void 0!==n.userData.object?t.app.updateObjectCallback(n.userData.object,"widgetSelected"):t.app.updateObjectCallback(n,"widgetSelected")}else t.app.updateObjectCallback(t.camera,"widgetSelected")}))}var t,r,n;return t=e,(r=[{key:"select",value:function(e){var t;null==e&&(e=null),this.editor.selected!==e&&(null!=e&&(t=e.uuid),this.editor.selected=e,this.editor.config.setKey("selected",t),this.editor.signals.objectSelected.dispatch(e))}},{key:"deselect",value:function(){this.select(null)}}])&&Bn(t.prototype,r),n&&Bn(t,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function jn(e){return jn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},jn(e)}function Gn(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(i=n.key,o=void 0,o=function(e,t){if("object"!==jn(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==jn(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(i,"string"),"symbol"===jn(o)?o:String(o)),n)}var i,o}function zn(e,t){return zn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},zn(e,t)}function Vn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Hn(e);if(t){var i=Hn(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return function(e,t){if(t&&("object"===jn(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,r)}}function Hn(e){return Hn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Hn(e)}var Wn=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&zn(e,t)}(s,e);var r,n,i,o=Vn(s);function s(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(t=o.call(this,e)).textures={},t}return r=s,i=[{key:"createMaterialFromType",value:function(e){var r=e.type;return e.isGLTFSpecularGlossinessMaterial?new ne:new{ShadowMaterial:t.ShadowMaterial,SpriteMaterial:t.SpriteMaterial,RawShaderMaterial:t.RawShaderMaterial,ShaderMaterial:t.ShaderMaterial,PointsMaterial:t.PointsMaterial,MeshPhysicalMaterial:t.MeshPhysicalMaterial,MeshStandardMaterial:t.MeshStandardMaterial,MeshPhongMaterial:t.MeshPhongMaterial,MeshToonMaterial:t.MeshToonMaterial,MeshNormalMaterial:t.MeshNormalMaterial,MeshLambertMaterial:t.MeshLambertMaterial,MeshDepthMaterial:t.MeshDepthMaterial,MeshDistanceMaterial:t.MeshDistanceMaterial,MeshBasicMaterial:t.MeshBasicMaterial,MeshMatcapMaterial:t.MeshMatcapMaterial,LineDashedMaterial:t.LineDashedMaterial,LineBasicMaterial:t.LineBasicMaterial,Material:t.Material}[r]}}],(n=[{key:"load",value:function(e,r,n,i){var o=this,s=new t.FileLoader(o.manager);s.setPath(o.path),s.setRequestHeader(o.requestHeader),s.setWithCredentials(o.withCredentials),s.load(e,(function(t){try{r(o.parse(JSON.parse(t)))}catch(t){i?i(t):console.error(t),o.manager.itemError(e)}}),n,i)}},{key:"parse",value:function(e){var r=this.textures;function n(e){return void 0===r[e]&&console.warn("THREE.MaterialLoader: Undefined texture",e),r[e]}var i=s.createMaterialFromType(e),o=t.LinearSRGBColorSpace;if(e.version&&(o=t.SRGBColorSpace),void 0!==e.uuid&&(i.uuid=e.uuid),void 0!==e.name&&(i.name=e.name),void 0!==e.color&&void 0!==i.color&&i.color.setHex(e.color,o),void 0!==e.roughness&&(i.roughness=e.roughness),void 0!==e.metalness&&(i.metalness=e.metalness),void 0!==e.sheen&&(i.sheen=e.sheen),void 0!==e.sheenColor&&(i.sheenColor=(new t.Color).setHex(e.sheenColor,o)),void 0!==e.sheenRoughness&&(i.sheenRoughness=e.sheenRoughness),void 0!==e.emissive&&void 0!==i.emissive&&i.emissive.setHex(e.emissive,o),void 0!==e.specular&&void 0!==i.specular&&i.specular.setHex(e.specular,o),void 0!==e.specularIntensity&&(i.specularIntensity=e.specularIntensity),void 0!==e.specularColor&&void 0!==i.specularColor&&i.specularColor.setHex(e.specularColor,o),void 0!==e.shininess&&(i.shininess=e.shininess),void 0!==e.clearcoat&&(i.clearcoat=e.clearcoat),void 0!==e.clearcoatRoughness&&(i.clearcoatRoughness=e.clearcoatRoughness),void 0!==e.dispersion&&(i.dispersion=e.dispersion),void 0!==e.iridescence&&(i.iridescence=e.iridescence),void 0!==e.iridescenceIOR&&(i.iridescenceIOR=e.iridescenceIOR),void 0!==e.iridescenceThicknessRange&&(i.iridescenceThicknessRange=e.iridescenceThicknessRange),void 0!==e.transmission&&(i.transmission=e.transmission),void 0!==e.thickness&&(i.thickness=e.thickness),void 0!==e.attenuationDistance&&(i.attenuationDistance=e.attenuationDistance),void 0!==e.attenuationColor&&void 0!==i.attenuationColor&&i.attenuationColor.setHex(e.attenuationColor,o),void 0!==e.anisotropy&&(i.anisotropy=e.anisotropy),void 0!==e.anisotropyRotation&&(i.anisotropyRotation=e.anisotropyRotation),void 0!==e.fog&&(i.fog=e.fog),void 0!==e.flatShading&&(i.flatShading=e.flatShading),void 0!==e.blending&&(i.blending=e.blending),void 0!==e.combine&&(i.combine=e.combine),void 0!==e.side&&(i.side=e.side),void 0!==e.shadowSide&&(i.shadowSide=e.shadowSide),void 0!==e.opacity&&(i.opacity=e.opacity),void 0!==e.transparent&&(i.transparent=e.transparent),void 0!==e.alphaTest&&(i.alphaTest=e.alphaTest),void 0!==e.alphaHash&&(i.alphaHash=e.alphaHash),void 0!==e.depthFunc&&(i.depthFunc=e.depthFunc),void 0!==e.depthTest&&(i.depthTest=e.depthTest),void 0!==e.depthWrite&&(i.depthWrite=e.depthWrite),void 0!==e.colorWrite&&(i.colorWrite=e.colorWrite),void 0!==e.blendSrc&&(i.blendSrc=e.blendSrc),void 0!==e.blendDst&&(i.blendDst=e.blendDst),void 0!==e.blendEquation&&(i.blendEquation=e.blendEquation),void 0!==e.blendSrcAlpha&&(i.blendSrcAlpha=e.blendSrcAlpha),void 0!==e.blendDstAlpha&&(i.blendDstAlpha=e.blendDstAlpha),void 0!==e.blendEquationAlpha&&(i.blendEquationAlpha=e.blendEquationAlpha),void 0!==e.blendColor&&void 0!==i.blendColor&&i.blendColor.setHex(e.blendColor,o),void 0!==e.blendAlpha&&(i.blendAlpha=e.blendAlpha),void 0!==e.stencilWriteMask&&(i.stencilWriteMask=e.stencilWriteMask),void 0!==e.stencilFunc&&(i.stencilFunc=e.stencilFunc),void 0!==e.stencilRef&&(i.stencilRef=e.stencilRef),void 0!==e.stencilFuncMask&&(i.stencilFuncMask=e.stencilFuncMask),void 0!==e.stencilFail&&(i.stencilFail=e.stencilFail),void 0!==e.stencilZFail&&(i.stencilZFail=e.stencilZFail),void 0!==e.stencilZPass&&(i.stencilZPass=e.stencilZPass),void 0!==e.stencilWrite&&(i.stencilWrite=e.stencilWrite),void 0!==e.wireframe&&(i.wireframe=e.wireframe),void 0!==e.wireframeLinewidth&&(i.wireframeLinewidth=e.wireframeLinewidth),void 0!==e.wireframeLinecap&&(i.wireframeLinecap=e.wireframeLinecap),void 0!==e.wireframeLinejoin&&(i.wireframeLinejoin=e.wireframeLinejoin),void 0!==e.rotation&&(i.rotation=e.rotation),void 0!==e.linewidth&&(i.linewidth=e.linewidth),void 0!==e.dashSize&&(i.dashSize=e.dashSize),void 0!==e.gapSize&&(i.gapSize=e.gapSize),void 0!==e.scale&&(i.scale=e.scale),void 0!==e.polygonOffset&&(i.polygonOffset=e.polygonOffset),void 0!==e.polygonOffsetFactor&&(i.polygonOffsetFactor=e.polygonOffsetFactor),void 0!==e.polygonOffsetUnits&&(i.polygonOffsetUnits=e.polygonOffsetUnits),void 0!==e.dithering&&(i.dithering=e.dithering),void 0!==e.alphaToCoverage&&(i.alphaToCoverage=e.alphaToCoverage),void 0!==e.premultipliedAlpha&&(i.premultipliedAlpha=e.premultipliedAlpha),void 0!==e.forceSinglePass&&(i.forceSinglePass=e.forceSinglePass),void 0!==e.visible&&(i.visible=e.visible),void 0!==e.toneMapped&&(i.toneMapped=e.toneMapped),void 0!==e.userData&&(i.userData=e.userData),void 0!==e.vertexColors&&("number"==typeof e.vertexColors?i.vertexColors=e.vertexColors>0:i.vertexColors=e.vertexColors),void 0!==e.uniforms)for(var a in e.uniforms){var c=e.uniforms[a];switch(i.uniforms[a]={},c.type){case"t":i.uniforms[a].value=n(c.value);break;case"c":i.uniforms[a].value=(new t.Color).setHex(c.value,o);break;case"v2":i.uniforms[a].value=(new t.Vector2).fromArray(c.value);break;case"v3":i.uniforms[a].value=(new t.Vector3).fromArray(c.value);break;case"v4":i.uniforms[a].value=(new t.Vector4).fromArray(c.value);break;case"m3":i.uniforms[a].value=(new t.Matrix3).fromArray(c.value);break;case"m4":i.uniforms[a].value=(new t.Matrix4).fromArray(c.value);break;default:i.uniforms[a].value=c.value}}if(void 0!==e.defines&&(i.defines=e.defines),void 0!==e.vertexShader&&(i.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(i.fragmentShader=e.fragmentShader),void 0!==e.glslVersion&&(i.glslVersion=e.glslVersion),void 0!==e.extensions)for(var l in e.extensions)i.extensions[l]=e.extensions[l];if(void 0!==e.lights&&(i.lights=e.lights),void 0!==e.clipping&&(i.clipping=e.clipping),void 0!==e.size&&(i.size=e.size),void 0!==e.sizeAttenuation&&(i.sizeAttenuation=e.sizeAttenuation),void 0!==e.map&&(i.map=n(e.map)),void 0!==e.matcap&&(i.matcap=n(e.matcap)),void 0!==e.alphaMap&&(i.alphaMap=n(e.alphaMap)),void 0!==e.bumpMap&&(i.bumpMap=n(e.bumpMap)),void 0!==e.bumpScale&&(i.bumpScale=e.bumpScale),void 0!==e.normalMap&&(i.normalMap=n(e.normalMap)),void 0!==e.normalMapType&&(i.normalMapType=e.normalMapType),void 0!==e.normalScale){var u=e.normalScale;!1===Array.isArray(u)&&(u=[u,u]),i.normalScale=(new t.Vector2).fromArray(u)}return void 0!==e.displacementMap&&(i.displacementMap=n(e.displacementMap)),void 0!==e.displacementScale&&(i.displacementScale=e.displacementScale),void 0!==e.displacementBias&&(i.displacementBias=e.displacementBias),void 0!==e.roughnessMap&&(i.roughnessMap=n(e.roughnessMap)),void 0!==e.metalnessMap&&(i.metalnessMap=n(e.metalnessMap)),void 0!==e.emissiveMap&&(i.emissiveMap=n(e.emissiveMap)),void 0!==e.emissiveIntensity&&(i.emissiveIntensity=e.emissiveIntensity),void 0!==e.specularMap&&(i.specularMap=n(e.specularMap)),void 0!==e.specularIntensityMap&&(i.specularIntensityMap=n(e.specularIntensityMap)),void 0!==e.specularColorMap&&(i.specularColorMap=n(e.specularColorMap)),void 0!==e.envMap&&(i.envMap=n(e.envMap)),void 0!==e.envMapRotation&&i.envMapRotation.fromArray(e.envMapRotation),void 0!==e.envMapIntensity&&(i.envMapIntensity=e.envMapIntensity),void 0!==e.reflectivity&&(i.reflectivity=e.reflectivity),void 0!==e.refractionRatio&&(i.refractionRatio=e.refractionRatio),void 0!==e.lightMap&&(i.lightMap=n(e.lightMap)),void 0!==e.lightMapIntensity&&(i.lightMapIntensity=e.lightMapIntensity),void 0!==e.aoMap&&(i.aoMap=n(e.aoMap)),void 0!==e.aoMapIntensity&&(i.aoMapIntensity=e.aoMapIntensity),void 0!==e.gradientMap&&(i.gradientMap=n(e.gradientMap)),void 0!==e.clearcoatMap&&(i.clearcoatMap=n(e.clearcoatMap)),void 0!==e.clearcoatRoughnessMap&&(i.clearcoatRoughnessMap=n(e.clearcoatRoughnessMap)),void 0!==e.clearcoatNormalMap&&(i.clearcoatNormalMap=n(e.clearcoatNormalMap)),void 0!==e.clearcoatNormalScale&&(i.clearcoatNormalScale=(new t.Vector2).fromArray(e.clearcoatNormalScale)),void 0!==e.iridescenceMap&&(i.iridescenceMap=n(e.iridescenceMap)),void 0!==e.iridescenceThicknessMap&&(i.iridescenceThicknessMap=n(e.iridescenceThicknessMap)),void 0!==e.transmissionMap&&(i.transmissionMap=n(e.transmissionMap)),void 0!==e.thicknessMap&&(i.thicknessMap=n(e.thicknessMap)),void 0!==e.anisotropyMap&&(i.anisotropyMap=n(e.anisotropyMap)),void 0!==e.sheenColorMap&&(i.sheenColorMap=n(e.sheenColorMap)),void 0!==e.sheenRoughnessMap&&(i.sheenRoughnessMap=n(e.sheenRoughnessMap)),"ecb7b463-6a4d-46ed-ba86-5eb318125752"==e.uuid&&(i.depthWrite=!0),i}},{key:"setTextures",value:function(e){return this.textures=e,this}}])&&Gn(r.prototype,n),i&&Gn(r,i),Object.defineProperty(r,"prototype",{writable:!1}),s}(t.Loader);function Xn(e){return Xn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Xn(e)}function Yn(){Yn=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,i=Object.defineProperty||function(e,t,r){e[t]=r.value},o="function"==typeof Symbol?Symbol:{},s=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function u(e,t,r,n){var o=t&&t.prototype instanceof y?t:y,s=Object.create(o.prototype),a=new I(n||[]);return i(s,"_invoke",{value:E(e,r,a)}),s}function h(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=u;var p="suspendedStart",d="suspendedYield",f="executing",m="completed",g={};function y(){}function v(){}function _(){}var b={};l(b,s,(function(){return this}));var x=Object.getPrototypeOf,w=x&&x(x(O([])));w&&w!==r&&n.call(w,s)&&(b=w);var S=_.prototype=y.prototype=Object.create(b);function M(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function T(e,t){function r(i,o,s,a){var c=h(e[i],e,o);if("throw"!==c.type){var l=c.arg,u=l.value;return u&&"object"==Xn(u)&&n.call(u,"__await")?t.resolve(u.__await).then((function(e){r("next",e,s,a)}),(function(e){r("throw",e,s,a)})):t.resolve(u).then((function(e){l.value=e,s(l)}),(function(e){return r("throw",e,s,a)}))}a(c.arg)}var o;i(this,"_invoke",{value:function(e,n){function i(){return new t((function(t,i){r(e,n,t,i)}))}return o=o?o.then(i,i):i()}})}function E(t,r,n){var i=p;return function(o,s){if(i===f)throw new Error("Generator is already running");if(i===m){if("throw"===o)throw s;return{value:e,done:!0}}for(n.method=o,n.arg=s;;){var a=n.delegate;if(a){var c=A(a,n);if(c){if(c===g)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===p)throw i=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=f;var l=h(t,r,n);if("normal"===l.type){if(i=n.done?m:d,l.arg===g)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(i=m,n.method="throw",n.arg=l.arg)}}}function A(t,r){var n=r.method,i=t.iterator[n];if(i===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,A(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),g;var o=h(i,t.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,g;var s=o.arg;return s?s.done?(r[t.resultName]=s.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,g):s:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,g)}function R(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function C(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function I(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(R,this),this.reset(!0)}function O(t){if(t||""===t){var r=t[s];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,o=function r(){for(;++i<t.length;)if(n.call(t,i))return r.value=t[i],r.done=!1,r;return r.value=e,r.done=!0,r};return o.next=o}}throw new TypeError(Xn(t)+" is not iterable")}return v.prototype=_,i(S,"constructor",{value:_,configurable:!0}),i(_,"constructor",{value:v,configurable:!0}),v.displayName=l(_,c,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===v||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,_):(e.__proto__=_,l(e,c,"GeneratorFunction")),e.prototype=Object.create(S),e},t.awrap=function(e){return{__await:e}},M(T.prototype),l(T.prototype,a,(function(){return this})),t.AsyncIterator=T,t.async=function(e,r,n,i,o){void 0===o&&(o=Promise);var s=new T(u(e,r,n,i),o);return t.isGeneratorFunction(r)?s:s.next().then((function(e){return e.done?e.value:s.next()}))},M(S),l(S,c,"Generator"),l(S,s,(function(){return this})),l(S,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=O,I.prototype={constructor:I,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(C),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function i(n,i){return a.type="throw",a.arg=t,r.next=n,i&&(r.method="next",r.arg=e),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var s=this.tryEntries[o],a=s.completion;if("root"===s.tryLoc)return i("end");if(s.tryLoc<=this.prev){var c=n.call(s,"catchLoc"),l=n.call(s,"finallyLoc");if(c&&l){if(this.prev<s.catchLoc)return i(s.catchLoc,!0);if(this.prev<s.finallyLoc)return i(s.finallyLoc)}else if(c){if(this.prev<s.catchLoc)return i(s.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return i(s.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var s=o?o.completion:{};return s.type=e,s.arg=t,o?(this.method="next",this.next=o.finallyLoc,g):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),C(r),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;C(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:O(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),g}},t}function qn(e,t,r,n,i,o,s){try{var a=e[o](s),c=a.value}catch(e){return void r(e)}a.done?t(c):Promise.resolve(c).then(n,i)}function Jn(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function s(e){qn(o,n,i,s,a,"next",e)}function a(e){qn(o,n,i,s,a,"throw",e)}s(void 0)}))}}function Kn(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(i=n.key,o=void 0,o=function(e,t){if("object"!==Xn(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==Xn(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(i,"string"),"symbol"===Xn(o)?o:String(o)),n)}var i,o}function Zn(e,t){return Zn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Zn(e,t)}function Qn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=$n(e);if(t){var i=$n(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return function(e,t){if(t&&("object"===Xn(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,r)}}function $n(e){return $n=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},$n(e)}var ei={BoxGeometry:t.BoxGeometry,CapsuleGeometry:t.CapsuleGeometry,CircleGeometry:t.CircleGeometry,CylinderGeometry:t.CylinderGeometry,DodecahedronGeometry:t.DodecahedronGeometry,EdgesGeometry:t.EdgesGeometry,ExtrudeGeometry:t.ExtrudeGeometry,IcosahedronGeometry:t.IcosahedronGeometry,LatheGeometry:t.LatheGeometry,OctahedronGeometry:t.OctahedronGeometry,PlaneGeometry:t.PlaneGeometry,PolyhedronGeometry:t.PolyhedronGeometry,RingGeometry:t.RingGeometry,ShapeGeometry:t.ShapeGeometry,SphereGeometry:t.SphereGeometry,TetrahedronGeometry:t.TetrahedronGeometry,TorusGeometry:t.TorusGeometry,TorusKnotGeometry:t.TorusKnotGeometry,TubeGeometry:t.TubeGeometry,WireframeGeometry:t.WireframeGeometry},ti=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Zn(e,t)}(l,e);var r,n,i,o,s,a,c=Qn(l);function l(e,t){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),(r=c.call(this,e)).editor=t,r}return r=l,n=[{key:"load",value:function(e,r,n,i){var o=this,s=""===this.path?LoaderUtils.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||s;var a=new t.FileLoader(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,(function(t){var n=null;try{n=JSON.parse(t)}catch(t){return void 0!==i&&i(t),void console.error("THREE:DoraObjectLoader: Can't parse "+e+".",t.message)}var s=n.metadata;void 0!==s&&void 0!==s.type&&"geometry"!==s.type.toLowerCase()?o.parse(n,r):console.error("THREE.DoraObjectLoader: Can't load "+e)}),n,i)}},{key:"loadAsync",value:(a=Jn(Yn().mark((function e(r,n){var i,o,s,a,c,l;return Yn().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=this,o=""===this.path?LoaderUtils.extractUrlBase(r):this.path,this.resourcePath=this.resourcePath||o,(s=new t.FileLoader(this.manager)).setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),e.next=9,s.loadAsync(r,n);case 9:if(a=e.sent,c=JSON.parse(a),void 0!==(l=c.metadata)&&void 0!==l.type&&"geometry"!==l.type.toLowerCase()){e.next=14;break}throw new Error("THREE.DoraObjectLoader: Can't load "+r);case 14:return e.next=16,i.parseAsync(c);case 16:return e.abrupt("return",e.sent);case 17:case"end":return e.stop()}}),e,this)}))),function(e,t){return a.apply(this,arguments)})},{key:"parse",value:function(e,t){var r=this.parseAnimations(e.animations),n=this.parseShapes(e.shapes),i=this.parseGeometries(e.geometries,n),o=this.parseImages(e.images,(function(){void 0!==t&&t(c)})),s=this.parseTextures(e.textures,o),a=this.parseMaterials(e.materials,s),c=this.parseObject(e.object,i,a,s,r),l=this.parseSkeletons(e.skeletons,c);if(this.bindSkeletons(c,l),void 0!==t){var u=!1;for(var h in o)if(o[h].data instanceof HTMLImageElement){u=!0;break}!1===u&&t(c)}return c}},{key:"parseAsync",value:(s=Jn(Yn().mark((function e(r){var n,i,o,s,a,c,l,u;return Yn().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.parseAnimations(r.animations),i=this.parseShapes(r.shapes),o=this.parseGeometries(r.geometries,i),e.next=5,this.parseImagesAsync(r.images);case 5:return s=e.sent,a=this.parseTextures(r.textures,s),c=this.parseMaterials(r.materials,a),l=this.parseObject(r.object,o,c,a,n),u=this.parseSkeletons(r.skeletons,l),this.bindSkeletons(l,u),l.traverse((function(e){!0===e.isSkinnedMesh&&void 0!==e.skeleton&&("string"==typeof e.skeleton||e.skeleton instanceof String)&&(e.skeleton=new t.Skeleton)})),e.abrupt("return",l);case 13:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"parseShapes",value:function(e){var r={};if(void 0!==e)for(var n=0,i=e.length;n<i;n++){var o=(new t.Shape).fromJSON(e[n]);r[o.uuid]=o}return r}},{key:"parseSkeletons",value:function(e,r){var n={},i={};if(r.traverse((function(e){e.isBone&&(i[e.uuid]=e)})),void 0!==e)for(var o=0,s=e.length;o<s;o++)if(e[o].boneInverses){var a=(new t.Skeleton).fromJSON(e[o],i);n[a.uuid]=a}return n}},{key:"parseGeometries",value:function(e,r){var n={};if(void 0!==e)for(var i=new t.BufferGeometryLoader,o=0,s=e.length;o<s;o++){var a=void 0,c=e[o],l=c.uuid;if(this.editor.app.geometries[l])n[l]=this.editor.app.geometries[l];else{switch(c.type){case"BufferGeometry":case"InstancedBufferGeometry":a=i.parse(c);break;default:c.type in ei?a=ei["".concat(c.type)].fromJSON(c,r):console.warn('THREE.DoraObjectLoader: Unsupported geometry type "'.concat(c.type,'"'))}a&&(a.uuid=l,void 0!==c.name&&(a.name=c.name),!0===a.isBufferGeometry&&void 0!==c.userData&&(a.userData=c.userData),n[l]=a,this.editor.app.geometries[l]=a)}}return n}},{key:"parseMaterials",value:function(e,t){var r={},n={};if(void 0!==e){var i=new Wn;i.setTextures(t);for(var o=0,s=e.length;o<s;o++){var a=e[o];void 0===r[a.uuid]&&(r[a.uuid]=i.parse(a)),n[a.uuid]=r[a.uuid]}}return n}},{key:"parseAnimations",value:function(e){var r={};this.editor.scene.traverse((function(e){if(null!=e.animations)for(var t=0;t<e.animations.length;t++){var n=e.animations[t];r[n.uuid]=n}}));var n={};if(void 0!==e)for(var i=0;i<e.length;i++){var o=e[i];if(null==r[o.uuid]){var s=t.AnimationClip.parse(o);n[s.uuid]=s}else n[o.uuid]=r[o.uuid]}return n}},{key:"parseImages",value:function(e,r){var n,i=this,o={};function s(e){if("string"==typeof e){var t=e;return function(e){return i.manager.itemStart(e),n.load(e,(function(){i.manager.itemEnd(e)}),void 0,(function(){i.manager.itemError(e),i.manager.itemEnd(e)}))}(/^(\/\/)|([a-z]+:(\/\/)?)/i.test(t)?t:i.resourcePath+t)}return e.data?{data:getTypedArray(e.type,e.data),width:e.width,height:e.height}:null}if(void 0!==e&&e.length>0){var a=new t.LoadingManager(r);(n=new t.ImageLoader(a)).setCrossOrigin(this.crossOrigin);for(var c=0,l=e.length;c<l;c++){var u=e[c],h=u.url;if(this.editor.app.images[u.uuid])o[u.uuid]=this.editor.app.images[u.uuid];else{if(Array.isArray(h)){for(var p=[],d=0,f=h.length;d<f;d++){var m=s(h[d]);null!==m&&(m instanceof HTMLImageElement?p.push(m):p.push(new t.DataTexture(m.data,m.width,m.height)))}o[u.uuid]=new t.Source(p)}else{var g=s(u.url);o[u.uuid]=new t.Source(g)}o[u.uuid].uuid=u.uuid,this.editor.app.images[u.uuid]=o[u.uuid]}}}return o}},{key:"parseImagesAsync",value:(o=Jn(Yn().mark((function e(r){var n,i,o,s,a,c,l,u,h,p,d,f,m,g,y;return Yn().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=function(){return a=Jn(Yn().mark((function e(t){var r,i;return Yn().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t){e.next=8;break}return i=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(r=t)?r:n.resourcePath+r,e.next=5,o.loadAsync(i);case 5:return e.abrupt("return",e.sent);case 8:if(!t||!t.data){e.next=12;break}return e.abrupt("return",{data:getTypedArray(t.type,t.data),width:t.width,height:t.height});case 12:return e.abrupt("return",null);case 13:case"end":return e.stop()}}),e)}))),a.apply(this,arguments)},s=function(e){return a.apply(this,arguments)},n=this,i={},!(void 0!==r&&r.length>0)){e.next=39;break}(o=new t.ImageBitmapLoader(this.manager)).setCrossOrigin(this.crossOrigin),c=0,l=r.length;case 8:if(!(c<l)){e.next=39;break}if(u=r[c],""!=(h=u.url)&&null!=h){e.next=15;break}return i[u.uuid]=u,i[u.uuid].uuid=u.uuid,e.abrupt("continue",36);case 15:if(!Array.isArray(h)){e.next=31;break}p=[],d=0,f=h.length;case 18:if(!(d<f)){e.next=27;break}return m=h[d],e.next=22,s(m);case 22:null!==(g=e.sent)&&(g instanceof HTMLImageElement?p.push(g):p.push(new t.DataTexture(g.data,g.width,g.height)));case 24:d++,e.next=18;break;case 27:i[u.uuid]=new t.Source(p),i[u.uuid].uuid=u.uuid,e.next=36;break;case 31:return e.next=33,s(u.url);case 33:y=e.sent,i[u.uuid]=new t.Source(y),i[u.uuid].uuid=u.uuid;case 36:c++,e.next=8;break;case 39:return e.abrupt("return",i);case 40:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"parseTextures",value:function(e,r){function n(e,t){return"number"==typeof e?e:(console.warn("THREE.DoraObjectLoader.parseTexture: Constant should be in numeric form.",e),t[e])}var i={};if(void 0!==e)for(var o=0,s=e.length;o<s;o++){var a=e[o];if(this.editor&&this.editor.app.textures[a.uuid])i[a.uuid]=this.editor.app.textures[a.uuid];else if(void 0===a.image&&console.warn('THREE.DoraObjectLoader: No "image" specified for',a.uuid),void 0!==r[a.image]){var c=r[a.image],l=c.data,u=void 0;Array.isArray(l)?(u=new t.CubeTexture,6===l.length&&(u.needsUpdate=!0)):(u=l&&l.data?new t.DataTexture:new t.Texture,l&&(u.needsUpdate=!0)),u.source=c,u.uuid=a.uuid,void 0!==a.name&&(u.name=a.name),void 0!==a.mapping&&(u.mapping=n(a.mapping,ri)),void 0!==a.offset&&u.offset.fromArray(a.offset),void 0!==a.repeat&&u.repeat.fromArray(a.repeat),void 0!==a.center&&u.center.fromArray(a.center),void 0!==a.rotation&&(u.rotation=a.rotation),void 0!==a.wrap&&(u.wrapS=n(a.wrap[0],ni),u.wrapT=n(a.wrap[1],ni)),void 0!==a.format&&(u.format=a.format),void 0!==a.type&&(u.type=a.type),void 0!==a.colorSpace&&(u.colorSpace=a.colorSpace),void 0!==a.minFilter&&(u.minFilter=n(a.minFilter,ii)),void 0!==a.magFilter&&(u.magFilter=n(a.magFilter,ii)),void 0!==a.anisotropy&&(u.anisotropy=a.anisotropy),void 0!==a.flipY&&(u.flipY=a.flipY),void 0!==a.premultiplyAlpha&&(u.premultiplyAlpha=a.premultiplyAlpha),void 0!==a.unpackAlignment&&(u.unpackAlignment=a.unpackAlignment),void 0!==a.userData&&(u.userData=a.userData),i[a.uuid]=u}else console.warn("THREE.DoraObjectLoader: Undefined image",a.image)}return i}},{key:"parseObject",value:function(e,r,n,i,o){var s;function a(e){return void 0===r[e]&&console.warn("THREE.DoraObjectLoader: Undefined geometry",e),r[e]}function c(e){if(void 0!==e){if(Array.isArray(e)){for(var t=[],r=0,i=e.length;r<i;r++){var o=e[r];void 0===n[o]&&console.warn("THREE.DoraObjectLoader: Undefined material",o),t.push(n[o])}return t}return void 0===n[e]&&console.warn("THREE.DoraObjectLoader: Undefined material",e),n[e]}}function l(e){return void 0===i[e]&&console.warn("THREE.DoraObjectLoader: Undefined texture",e),i[e]}var u=this.editor.findObjectByUuid(e.uuid);if(null!=u)s=u;else{var h,p;switch(e.type){case"Scene":if(s=new t.Scene,void 0!==e.background&&(Number.isInteger(e.background)?s.background=new t.Color(e.background):s.background=l(e.background)),void 0!==e.environment){var d=l(e.environment);d?s.environment=d:console.warn("THREE.DoraObjectLoader: Undefined environment")}void 0!==e.fog&&("Fog"===e.fog.type?s.fog=new t.Fog(e.fog.color,e.fog.near,e.fog.far):"FogExp2"===e.fog.type&&(s.fog=new t.FogExp2(e.fog.color,e.fog.density)));break;case"PerspectiveCamera":s=new t.PerspectiveCamera(e.fov,e.aspect,e.near,e.far),void 0!==e.focus&&(s.focus=e.focus),void 0!==e.zoom&&(s.zoom=e.zoom),void 0!==e.filmGauge&&(s.filmGauge=e.filmGauge),void 0!==e.filmOffset&&(s.filmOffset=e.filmOffset),void 0!==e.view&&(s.view=Object.assign({},e.view));break;case"OrthographicCamera":s=new t.OrthographicCamera(e.left,e.right,e.top,e.bottom,e.near,e.far),void 0!==e.zoom&&(s.zoom=e.zoom),void 0!==e.view&&(s.view=Object.assign({},e.view));break;case"AmbientLight":s=new t.AmbientLight(e.color,e.intensity);break;case"DirectionalLight":s=new t.DirectionalLight(e.color,e.intensity);break;case"PointLight":s=new t.PointLight(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":s=new t.RectAreaLight(e.color,e.intensity,e.width,e.height);break;case"SpotLight":s=new t.SpotLight(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":s=new t.HemisphereLight(e.color,e.groundColor,e.intensity);break;case"LightProbe":s=(new t.LightProbe).fromJSON(e);break;case"SkinnedMesh":h=a(e.geometry),p=c(e.material),s=new t.SkinnedMesh(h,p),void 0!==e.bindMode&&(s.bindMode=e.bindMode),void 0!==e.bindMatrix&&s.bindMatrix.fromArray(e.bindMatrix),void 0!==e.skeleton&&(s.skeleton=e.skeleton);break;case"Mesh":h=a(e.geometry),p=c(e.material),s=new t.Mesh(h,p);break;case"InstancedMesh":h=a(e.geometry),p=c(e.material);var f=e.count,m=e.instanceMatrix,g=e.instanceColor;(s=new t.InstancedMesh(h,p,f)).instanceMatrix=new t.InstancedBufferAttribute(new Float32Array(m.array),16),void 0!==g&&(s.instanceColor=new t.InstancedBufferAttribute(new Float32Array(g.array),g.itemSize));break;case"LOD":s=new t.LOD;break;case"Line":s=new t.Line(a(e.geometry),c(e.material));break;case"LineLoop":s=new t.LineLoop(a(e.geometry),c(e.material));break;case"LineSegments":s=new t.LineSegments(a(e.geometry),c(e.material));break;case"PointCloud":case"Points":s=new t.Points(a(e.geometry),c(e.material));break;case"Sprite":s=new t.Sprite(c(e.material));break;case"Group":s=new t.Group;break;case"Bone":s=new t.Bone;break;default:s=new t.Object3D}if(s.uuid=e.uuid,void 0!==e.name&&(s.name=e.name),void 0!==e.matrix?(s.matrix.fromArray(e.matrix),void 0!==e.matrixAutoUpdate&&(s.matrixAutoUpdate=e.matrixAutoUpdate),s.matrixAutoUpdate&&s.matrix.decompose(s.position,s.quaternion,s.scale)):(void 0!==e.position&&s.position.fromArray(e.position),void 0!==e.rotation&&s.rotation.fromArray(e.rotation),void 0!==e.quaternion&&s.quaternion.fromArray(e.quaternion),void 0!==e.scale&&s.scale.fromArray(e.scale)),void 0!==e.castShadow&&(s.castShadow=e.castShadow),void 0!==e.receiveShadow&&(s.receiveShadow=e.receiveShadow),e.shadow&&(void 0!==e.shadow.bias&&(s.shadow.bias=e.shadow.bias),void 0!==e.shadow.normalBias&&(s.shadow.normalBias=e.shadow.normalBias),void 0!==e.shadow.radius&&(s.shadow.radius=e.shadow.radius),void 0!==e.shadow.mapSize&&s.shadow.mapSize.fromArray(e.shadow.mapSize),void 0!==e.shadow.camera&&(s.shadow.camera=this.parseObject(e.shadow.camera))),void 0!==e.visible&&(s.visible=e.visible),void 0!==e.frustumCulled&&(s.frustumCulled=e.frustumCulled),void 0!==e.renderOrder&&(s.renderOrder=e.renderOrder),void 0!==e.userData&&(s.userData=e.userData),void 0!==e.layers&&(s.layers.mask=e.layers),void 0!==e.animations)for(var y=e.animations,v=0;v<y.length;v++){var _=y[v];s.animations.push(o[_])}if("LOD"===e.type){void 0!==e.autoUpdate&&(s.autoUpdate=e.autoUpdate);for(var b=e.levels,x=0;x<b.length;x++){var w=b[x],S=s.getObjectByProperty("uuid",w.object);void 0!==S&&s.addLevel(S,w.distance)}}}if(void 0!==e.children)for(var M=e.children,T=0;T<M.length;T++){var E=this.parseObject(M[T],r,n,i,o);E.parent!=s&&s.add(E)}return s}},{key:"bindSkeletons",value:function(e,t){0!==Object.keys(t).length&&e.traverse((function(e){if(!0===e.isSkinnedMesh&&void 0!==e.skeleton){var r=t[e.skeleton];void 0===r?console.warn("THREE.DoraObjectLoader: No skeleton found with UUID:",e.skeleton):e.bind(r,e.bindMatrix)}}))}}],n&&Kn(r.prototype,n),i&&Kn(r,i),Object.defineProperty(r,"prototype",{writable:!1}),l}(t.Loader),ri={UVMapping:t.UVMapping,CubeReflectionMapping:t.CubeReflectionMapping,CubeRefractionMapping:t.CubeRefractionMapping,EquirectangularReflectionMapping:t.EquirectangularReflectionMapping,EquirectangularRefractionMapping:t.EquirectangularRefractionMapping,CubeUVReflectionMapping:t.CubeUVReflectionMapping},ni={RepeatWrapping:t.RepeatWrapping,ClampToEdgeWrapping:t.ClampToEdgeWrapping,MirroredRepeatWrapping:t.MirroredRepeatWrapping},ii={NearestFilter:t.NearestFilter,NearestMipmapNearestFilter:t.NearestMipmapNearestFilter,NearestMipmapLinearFilter:t.NearestMipmapLinearFilter,LinearFilter:t.LinearFilter,LinearMipmapNearestFilter:t.LinearMipmapNearestFilter,LinearMipmapLinearFilter:t.LinearMipmapLinearFilter};function oi(e){return oi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},oi(e)}function si(){si=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,i=Object.defineProperty||function(e,t,r){e[t]=r.value},o="function"==typeof Symbol?Symbol:{},s=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function u(e,t,r,n){var o=t&&t.prototype instanceof y?t:y,s=Object.create(o.prototype),a=new I(n||[]);return i(s,"_invoke",{value:E(e,r,a)}),s}function h(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=u;var p="suspendedStart",d="suspendedYield",f="executing",m="completed",g={};function y(){}function v(){}function _(){}var b={};l(b,s,(function(){return this}));var x=Object.getPrototypeOf,w=x&&x(x(O([])));w&&w!==r&&n.call(w,s)&&(b=w);var S=_.prototype=y.prototype=Object.create(b);function M(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function T(e,t){function r(i,o,s,a){var c=h(e[i],e,o);if("throw"!==c.type){var l=c.arg,u=l.value;return u&&"object"==oi(u)&&n.call(u,"__await")?t.resolve(u.__await).then((function(e){r("next",e,s,a)}),(function(e){r("throw",e,s,a)})):t.resolve(u).then((function(e){l.value=e,s(l)}),(function(e){return r("throw",e,s,a)}))}a(c.arg)}var o;i(this,"_invoke",{value:function(e,n){function i(){return new t((function(t,i){r(e,n,t,i)}))}return o=o?o.then(i,i):i()}})}function E(t,r,n){var i=p;return function(o,s){if(i===f)throw new Error("Generator is already running");if(i===m){if("throw"===o)throw s;return{value:e,done:!0}}for(n.method=o,n.arg=s;;){var a=n.delegate;if(a){var c=A(a,n);if(c){if(c===g)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===p)throw i=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=f;var l=h(t,r,n);if("normal"===l.type){if(i=n.done?m:d,l.arg===g)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(i=m,n.method="throw",n.arg=l.arg)}}}function A(t,r){var n=r.method,i=t.iterator[n];if(i===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,A(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),g;var o=h(i,t.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,g;var s=o.arg;return s?s.done?(r[t.resultName]=s.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,g):s:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,g)}function R(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function C(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function I(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(R,this),this.reset(!0)}function O(t){if(t||""===t){var r=t[s];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,o=function r(){for(;++i<t.length;)if(n.call(t,i))return r.value=t[i],r.done=!1,r;return r.value=e,r.done=!0,r};return o.next=o}}throw new TypeError(oi(t)+" is not iterable")}return v.prototype=_,i(S,"constructor",{value:_,configurable:!0}),i(_,"constructor",{value:v,configurable:!0}),v.displayName=l(_,c,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===v||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,_):(e.__proto__=_,l(e,c,"GeneratorFunction")),e.prototype=Object.create(S),e},t.awrap=function(e){return{__await:e}},M(T.prototype),l(T.prototype,a,(function(){return this})),t.AsyncIterator=T,t.async=function(e,r,n,i,o){void 0===o&&(o=Promise);var s=new T(u(e,r,n,i),o);return t.isGeneratorFunction(r)?s:s.next().then((function(e){return e.done?e.value:s.next()}))},M(S),l(S,c,"Generator"),l(S,s,(function(){return this})),l(S,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=O,I.prototype={constructor:I,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(C),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function i(n,i){return a.type="throw",a.arg=t,r.next=n,i&&(r.method="next",r.arg=e),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var s=this.tryEntries[o],a=s.completion;if("root"===s.tryLoc)return i("end");if(s.tryLoc<=this.prev){var c=n.call(s,"catchLoc"),l=n.call(s,"finallyLoc");if(c&&l){if(this.prev<s.catchLoc)return i(s.catchLoc,!0);if(this.prev<s.finallyLoc)return i(s.finallyLoc)}else if(c){if(this.prev<s.catchLoc)return i(s.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return i(s.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var s=o?o.completion:{};return s.type=e,s.arg=t,o?(this.method="next",this.next=o.finallyLoc,g):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),C(r),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;C(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:O(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),g}},t}function ai(e,t,r,n,i,o,s){try{var a=e[o](s),c=a.value}catch(e){return void r(e)}a.done?t(c):Promise.resolve(c).then(n,i)}var ci=new t.PerspectiveCamera(50,1,.1,1e3);ci.name="Camera",ci.position.set(0,5,10),ci.lookAt(new t.Vector3);var li,ui,hi,pi;new t.Vector2;function di(e,i,o,s){var a=r.Signal;this.canvas=e,this.pixelRatio=s,this.canvasWidth=i,this.canvasHeight=o,this.signals={editScript:new a,startPlayer:new a,stopPlayer:new a,toggleVR:new a,exitedVR:new a,editorCleared:new a,savingStarted:new a,savingFinished:new a,transformModeChanged:new a,snapChanged:new a,spaceChanged:new a,rendererCreated:new a,rendererUpdated:new a,sceneBackgroundChanged:new a,sceneEnvironmentChanged:new a,sceneFogChanged:new a,sceneFogSettingsChanged:new a,sceneGraphChanged:new a,sceneRendered:new a,sceneRender:new a,cameraResetted:new a,geometryChanged:new a,objectSelected:new a,objectFocused:new a,objectAdded:new a,objectChanged:new a,objectRemoved:new a,cameraAdded:new a,cameraRemoved:new a,helperAdded:new a,helperRemoved:new a,materialAdded:new a,materialChanged:new a,materialRemoved:new a,scriptAdded:new a,scriptChanged:new a,scriptRemoved:new a,windowResize:new a,showGridChanged:new a,showHelpersChanged:new a,historyChanged:new a,viewportCameraChanged:new a,intersectionsDetected:new a,updateCameraController:new a,updateCameraControllerProperty:new a,setDefautCamera:new a},this.config=new n,this.history=new Dn(this),this.selector=new kn(this),this.loader=new xt(this),this.camera=ci.clone(),this.sceneHelpers=new t.Scene,this.object={},this.geometries={},this.materials={},this.textures={},this.scripts={},this.materialsRefCounter=new Map,this.mixer=new t.AnimationMixer(this.scene),this.selected=null,this.helpers={},this.cameras={},this.viewportCamera=this.camera,this.addCamera(this.camera)}function fi(e){return fi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},fi(e)}function mi(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function gi(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(i=n.key,o=void 0,o=function(e,t){if("object"!==fi(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==fi(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(i,"string"),"symbol"===fi(o)?o:String(o)),n)}var i,o}function yi(e,t,r){return t&&gi(e.prototype,t),r&&gi(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function vi(){return vi="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Si(e)););return e}(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(arguments.length<3?e:r):i.value}},vi.apply(this,arguments)}function _i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&bi(e,t)}function bi(e,t){return bi=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},bi(e,t)}function xi(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Si(e);if(t){var i=Si(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return function(e,t){if(t&&("object"===fi(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return wi(e)}(this,r)}}function wi(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Si(e){return Si=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Si(e)}di.prototype={setScene:function(e){if(this.scene.uuid!=e.uuid){for(this.scene.uuid=e.uuid,this.scene.name=e.name,this.scene.background=e.background,this.scene.environment=e.environment,this.scene.fog=e.fog,this.scene.userData=JSON.parse(JSON.stringify(e.userData)),this.scene.matrix.copy(e.matrix),this.scene.position.copy(e.position),this.scene.scale.copy(e.scale),this.scene.rotation.copy(e.rotation),this.signals.sceneGraphChanged.active=!1;e.children.length>0;)this.addObject(e.children[0]);this.scene.traverse((function(e){if(e.geometry&&e.geometry.attributes&&"d8a848b8-b52e-45cf-a253-0ca6bf5e4736"===e.geometry.uuid){var t=e.geometry.attributes.color;if(t){for(var r=0;r<t.array.length;r++)t.array[r]=255;t.needsUpdate=!0}}})),this.signals.sceneGraphChanged.active=!0}this.signals.sceneGraphChanged.dispatch()},addObject:function(e,t,r){var n=this;e.traverse((function(e){void 0!==e.geometry&&n.addGeometry(e.geometry),void 0!==e.material&&n.addMaterial(e.material),n.addCamera(e),n.addHelper(e)})),void 0===t?this.scene.add(e):(t.children.splice(r,0,e),e.parent=t),this.signals.objectAdded.dispatch(e),this.signals.sceneGraphChanged.dispatch()},moveObject:function(e,t,r){if(void 0===t&&(t=this.scene),t.add(e),void 0!==r){var n=t.children.indexOf(r);t.children.splice(n,0,e),t.children.pop()}this.signals.sceneGraphChanged.dispatch()},nameObject:function(e,t){e.name=t,this.signals.sceneGraphChanged.dispatch()},removeObject:function(e){if(null!==e.parent){var t=this;e.traverse((function(e){t.removeCamera(e),t.removeHelper(e),void 0!==e.material&&t.removeMaterial(e.material)})),e.parent.remove(e),this.signals.objectRemoved.dispatch(e),this.signals.sceneGraphChanged.dispatch()}},addGeometry:function(e){this.geometries[e.uuid]=e},setGeometryName:function(e,t){e.name=t,this.signals.sceneGraphChanged.dispatch()},addMaterial:function(e){if(Array.isArray(e))for(var t=0,r=e.length;t<r;t++)this.addMaterialToRefCounter(e[t]);else this.addMaterialToRefCounter(e);this.signals.materialAdded.dispatch()},addMaterialToRefCounter:function(e){var t=this.materialsRefCounter,r=t.get(e);void 0===r?(t.set(e,1),this.materials[e.uuid]=e):(r++,t.set(e,r))},removeMaterial:function(e){if(Array.isArray(e))for(var t=0,r=e.length;t<r;t++)this.removeMaterialFromRefCounter(e[t]);else this.removeMaterialFromRefCounter(e);this.signals.materialRemoved.dispatch()},removeMaterialFromRefCounter:function(e){var t=this.materialsRefCounter,r=t.get(e);0===--r?(t.delete(e),delete this.materials[e.uuid]):t.set(e,r)},getMaterialById:function(e){for(var t,r=Object.values(this.materials),n=0;n<r.length;n++)if(r[n].id===e){t=r[n];break}return t},setMaterialName:function(e,t){e.name=t,this.signals.sceneGraphChanged.dispatch()},addTexture:function(e){this.textures[e.uuid]=e},addCamera:function(e){e.isCamera&&(this.cameras[e.uuid]=e,this.signals.cameraAdded.dispatch(e))},removeCamera:function(e){void 0!==this.cameras[e.uuid]&&(delete this.cameras[e.uuid],this.signals.cameraRemoved.dispatch(e))},addHelper:(hi=new t.SphereGeometry(2,4,2),pi=new t.MeshBasicMaterial({color:16711680,visible:!1}),function(e,r){if(void 0===r){var n;if(e.isCamera)r=new t.CameraHelper(e);else if(e.isPointLight)r=new t.PointLightHelper(e,1);else if(e.isDirectionalLight)r=new t.DirectionalLightHelper(e,1);else if(e.isSpotLight)r=new t.SpotLightHelper(e);else if(e.isHemisphereLight)r=new t.HemisphereLightHelper(e,1);else if(e.isSkinnedMesh)e.skeleton&&e.skeleton.bones&&e.skeleton.bones.length>0&&(r=new t.SkeletonHelper(e.skeleton.bones[0]));else{if(!0!==e.isBone||!0===(null===(n=e.parent)||void 0===n?void 0:n.isBone))return;r=new t.SkeletonHelper(e)}if(r){var i=new t.Mesh(hi,pi);i.name="picker",i.userData.object=e,r.add(i)}}r&&(this.sceneHelpers.add(r),this.helpers[e.id]=r,this.signals.helperAdded.dispatch(r))}),removeHelper:function(e){if(void 0!==this.helpers[e.id]){var t=this.helpers[e.id];t.parent.remove(t),delete this.helpers[e.id],this.signals.helperRemoved.dispatch(t)}},addScript:function(e,t){void 0===this.scripts[e.uuid]&&(this.scripts[e.uuid]=[]),this.scripts[e.uuid].push(t),this.signals.scriptAdded.dispatch(t)},removeScript:function(e,t){if(void 0!==this.scripts[e.uuid]){var r=this.scripts[e.uuid].indexOf(t);-1!==r&&this.scripts[e.uuid].splice(r,1),this.signals.scriptRemoved.dispatch(t)}},getObjectMaterial:function(e,t){var r=e.material;return Array.isArray(r)&&void 0!==t&&(r=r[t]),r},setObjectMaterial:function(e,t,r){Array.isArray(e.material)&&void 0!==t?e.material[t]=r:e.material=r},select:function(e){this.selector.select(e)},selectById:function(e){e!==this.camera.id?this.select(this.scene.getObjectById(e)):this.select(this.camera)},selectByUuid:function(e){var t=this;this.scene.traverse((function(r){r.uuid===e&&t.select(r)}))},deselect:function(){this.selector.deselect()},focus:function(e){void 0!==e&&this.signals.objectFocused.dispatch(e)},focusById:function(e){this.focus(this.scene.getObjectByProperty("uuid",e))},clear:function(){this.history.clear(),this.camera.copy(ci),this.signals.cameraResetted.dispatch(),this.scene.name="Scene",this.scene.userData={},this.scene.background=null,this.scene.environment=null,this.scene.fog=null;for(var e=this.scene.children;e.length>0;)this.removeObject(e[0]);this.geometries={},this.materials={},this.textures={},this.scripts={},this.materialsRefCounter.clear(),this.animations={},this.mixer.stopAllAction(),this.deselect(),this.signals.editorCleared.dispatch()},fromJSON:(li=si().mark((function e(t){var r,n,i;return si().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new ti(void 0,this),this.camera.uuid!=t.camera.uuid&&(n=r.parseObject(t.camera.object),this.camera.copy(n),i=this.camera.uuid,this.camera.uuid=n.uuid,delete this.cameras[i],this.addCamera(this.camera),this.signals.cameraResetted.dispatch()),this.history.fromJSON(t.history),this.scripts=t.scripts,e.t0=this,e.next=7,r.parseAsync(t.scene);case 7:e.t1=e.sent,e.t0.setScene.call(e.t0,e.t1);case 9:case"end":return e.stop()}}),e,this)})),ui=function(){var e=this,t=arguments;return new Promise((function(r,n){var i=li.apply(e,t);function o(e){ai(i,r,n,o,s,"next",e)}function s(e){ai(i,r,n,o,s,"throw",e)}o(void 0)}))},function(e){return ui.apply(this,arguments)}),toJSON:function(){var e=this.scene,t=this.scripts;for(var r in t){0!==t[r].length&&void 0!==e.getObjectByProperty("uuid",r)||delete t[r]}return{metadata:{},project:{shadows:this.config.getKey("project/renderer/shadows"),shadowType:this.config.getKey("project/renderer/shadowType"),vr:this.config.getKey("project/vr"),physicallyCorrectLights:this.config.getKey("project/renderer/physicallyCorrectLights"),toneMapping:this.config.getKey("project/renderer/toneMapping"),toneMappingExposure:this.config.getKey("project/renderer/toneMappingExposure")},camera:this.camera.toJSON(),scene:this.scene.toJSON(),scripts:this.scripts,history:this.history.toJSON()}},objectByUuid:function(e){return this.scene.getObjectByProperty("uuid",e,!0)},findObjectByUuid:function(e){var t=this.scene,r=this.camera;return e==t.uuid?t:e==r.uuid?r:this.objectByUuid(e)},findObjectByName:function(e){var t=this.scene,r=this.camera;return e==t.name?t:e==r.name?r:this.objectByName(e)},objectByName:function(e){return this.scene.getObjectByProperty("name",e,!0)},execute:function(e,t){this.history.execute(e,t)},undo:function(){this.history.undo()},redo:function(){this.history.redo()},dispose:function(){this.selector.editor=null,this.selector=null,this.signals=null},doUpdateObjectAnimation:function(e){if(1==e.modelAnimationsNeedsUpdate&&void 0!==e.modelAnimations&&0!==e.animations.length){e.modelAnimationsNeedsUpdate=!1;for(var r=e.animations,n=this.app.mixers,i=this.app.actions,o=JSON.parse(e.modelAnimations),s=function(e){return o.find((function(t){return t.uuid==e}))},a=0;a<r.length;a++){if(null!=(l=r[a])){var c=s(l.uuid);null==(u=n[l.uuid])&&(u=new t.AnimationMixer(this.scene),n[l.uuid]=u),null==(h=i[l.uuid])&&(h=u.clipAction(l,e),i[l.uuid]=h)}}for(a=0;a<r.length;a++){var l;if(null!=(l=r[a])){c=s(l.uuid);var u=n[l.uuid],h=i[l.uuid];if(null!=c&&c.enable)if(u.enable=!0,c.autoPlay)h.timeScale=c.speed,h.play(),u.autoPlay=!0;else{var p=c.currentFrame/(60*c.duration)*c.duration;u.setTime(p),h.play(),u.autoPlay=!1}else u.enable=!1,u.autoPlay=!1,h.stop()}}}}};var Mi=new t.Raycaster,Ti=new t.Vector3,Ei=new t.Vector3,Ai=new t.Quaternion,Ri={X:new t.Vector3(1,0,0),Y:new t.Vector3(0,1,0),Z:new t.Vector3(0,0,1)},Ci={type:"change"},Ii={type:"translate"},Oi={type:"rotation"},Pi={type:"scale"},Ni={type:"mouseDown"},Li={type:"mouseUp",mode:null},Ui={type:"objectChange"},Di=function(e){_i(n,e);var r=xi(n);function n(e,i){var o;mi(this,n),o=r.call(this),void 0===i&&(console.warn('THREE.DoraTransformControls: The second parameter "domElement" is now mandatory.'),i=document),o.isTransformControls=!0,o.visible=!1,o.domElement=i;var s=new $i;o._gizmo=s,o.add(s);var a=new eo;o._plane=a,o.add(a);var c=wi(o);function l(e,t){var r=t;Object.defineProperty(c,e,{get:function(){return void 0!==r?r:t},set:function(t){r!==t&&(r=t,a[e]=t,s[e]=t,c.dispatchEvent({type:e+"-changed",value:t}),c.dispatchEvent({type:Ci.type,ignoreCallback:!0}))}}),c[e]=t,a[e]=t,s[e]=t}l("camera",e),l("object",void 0),l("enabled",!0),l("axis",null),l("mode","translate"),l("translationSnap",null),l("rotationSnap",null),l("scaleSnap",null),l("space","world"),l("size",1),l("dragging",!1),l("showX",!0),l("showY",!0),l("showZ",!0);var u=new t.Vector3,h=new t.Vector3,p=new t.Quaternion,d=new t.Quaternion,f=new t.Vector3,m=new t.Quaternion,g=new t.Vector3,y=new t.Vector3,v=new t.Vector3,_=new t.Vector3;return l("worldPosition",u),l("worldPositionStart",h),l("worldQuaternion",p),l("worldQuaternionStart",d),l("cameraPosition",f),l("cameraQuaternion",m),l("pointStart",g),l("pointEnd",y),l("rotationAxis",v),l("rotationAngle",0),l("eye",_),o._offset=new t.Vector3,o._startNorm=new t.Vector3,o._endNorm=new t.Vector3,o._cameraScale=new t.Vector3,o._parentPosition=new t.Vector3,o._parentQuaternion=new t.Quaternion,o._parentQuaternionInv=new t.Quaternion,o._parentScale=new t.Vector3,o._worldScaleStart=new t.Vector3,o._worldQuaternionInv=new t.Quaternion,o._worldScale=new t.Vector3,o._positionStart=new t.Vector3,o._quaternionStart=new t.Quaternion,o._scaleStart=new t.Vector3,o._getPointer=Fi.bind(wi(o)),o._onPointerDown=o.onPointerDown.bind(wi(o)),o._onPointerHover=o.onPointerHover.bind(wi(o)),o._onPointerMove=o.onPointerMove.bind(wi(o)),o._onPointerUp=o.onPointerUp.bind(wi(o)),o.domElement.addEventListener("pointerdown",o._onPointerDown),o.domElement.addEventListener("pointermove",o._onPointerHover),o.domElement.addEventListener("pointerup",o._onPointerUp),o}return yi(n,[{key:"updateMatrixWorld",value:function(){void 0!==this.object&&(this.object.updateMatrixWorld(),null===this.object.parent?console.error("DoraTransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(this._parentPosition,this._parentQuaternion,this._parentScale),this.object.matrixWorld.decompose(this.worldPosition,this.worldQuaternion,this._worldScale),this._parentQuaternionInv.copy(this._parentQuaternion).invert(),this._worldQuaternionInv.copy(this.worldQuaternion).invert()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(this.cameraPosition,this.cameraQuaternion,this._cameraScale),this.camera.isOrthographicCamera?this.camera.getWorldDirection(this.eye).negate():this.eye.copy(this.cameraPosition).sub(this.worldPosition).normalize(),vi(Si(n.prototype),"updateMatrixWorld",this).call(this,this)}},{key:"pointerHover",value:function(e){if(void 0!==this.object&&!0!==this.dragging){Mi.setFromCamera(e,this.camera);var t=Bi(this._gizmo.picker[this.mode],Mi);this.axis=t?t.object.name:null}}},{key:"pointerDown",value:function(e){if(void 0!==this.object&&!0!==this.dragging&&0===e.button&&null!==this.axis){Mi.setFromCamera(e,this.camera);var t=Bi(this._plane,Mi,!0);t&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(t.point).sub(this.worldPositionStart)),this.dragging=!0,Ni.mode=this.mode,this.dispatchEvent(Ni)}}},{key:"pointerMove",value:function(e){var r=this.axis,n=this.mode,i=this.object,o=this.space;if("scale"===n?o="local":"E"!==r&&"XYZE"!==r&&"XYZ"!==r||(o="world"),void 0!==i&&null!==r&&!1!==this.dragging&&-1===e.button){Mi.setFromCamera(e,this.camera);var s=Bi(this._plane,Mi,!0);if(s){if(this.pointEnd.copy(s.point).sub(this.worldPositionStart),"translate"===n)this._offset.copy(this.pointEnd).sub(this.pointStart),"local"===o&&"XYZ"!==r&&this._offset.applyQuaternion(this._worldQuaternionInv),-1===r.indexOf("X")&&(this._offset.x=0),-1===r.indexOf("Y")&&(this._offset.y=0),-1===r.indexOf("Z")&&(this._offset.z=0),"local"===o&&"XYZ"!==r?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),Ii.position=(new t.Vector3).copy(this._offset).add(this._positionStart),this.dispatchEvent(Ii),this.translationSnap&&("local"===o&&(i.position.applyQuaternion(Ai.copy(this._quaternionStart).invert()),-1!==r.search("X")&&(i.position.x=Math.round(i.position.x/this.translationSnap)*this.translationSnap),-1!==r.search("Y")&&(i.position.y=Math.round(i.position.y/this.translationSnap)*this.translationSnap),-1!==r.search("Z")&&(i.position.z=Math.round(i.position.z/this.translationSnap)*this.translationSnap),i.position.applyQuaternion(this._quaternionStart)),"world"===o&&(i.parent&&i.position.add(Ti.setFromMatrixPosition(i.parent.matrixWorld)),-1!==r.search("X")&&(i.position.x=Math.round(i.position.x/this.translationSnap)*this.translationSnap),-1!==r.search("Y")&&(i.position.y=Math.round(i.position.y/this.translationSnap)*this.translationSnap),-1!==r.search("Z")&&(i.position.z=Math.round(i.position.z/this.translationSnap)*this.translationSnap),i.parent&&i.position.sub(Ti.setFromMatrixPosition(i.parent.matrixWorld))));else if("scale"===n){if(-1!==r.search("XYZ")){var a=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(a*=-1),Ei.set(a,a,a)}else Ti.copy(this.pointStart),Ei.copy(this.pointEnd),Ti.applyQuaternion(this._worldQuaternionInv),Ei.applyQuaternion(this._worldQuaternionInv),Ei.divide(Ti),-1===r.search("X")&&(Ei.x=1),-1===r.search("Y")&&(Ei.y=1),-1===r.search("Z")&&(Ei.z=1);Pi.scale=new t.Vector3(1,1,1).copy(this._scaleStart).multiply(Ei),this.dispatchEvent(Pi),this.scaleSnap&&(-1!==r.search("X")&&(i.scale.x=Math.round(i.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),-1!==r.search("Y")&&(i.scale.y=Math.round(i.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),-1!==r.search("Z")&&(i.scale.z=Math.round(i.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if("rotate"===n){this._offset.copy(this.pointEnd).sub(this.pointStart);var c,l,u,h=20/this.worldPosition.distanceTo(Ti.setFromMatrixPosition(this.camera.matrixWorld));if("E"===r?(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1):"XYZE"===r?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(Ti.copy(this.rotationAxis).cross(this.eye))*h):"X"!==r&&"Y"!==r&&"Z"!==r||(this.rotationAxis.copy(Ri[r]),Ti.copy(Ri[r]),"local"===o&&Ti.applyQuaternion(this.worldQuaternion),this.rotationAngle=this._offset.dot(Ti.cross(this.eye).normalize())*h),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),"local"===o&&"E"!==r&&"XYZE"!==r)(c=(new t.Quaternion).copy(this._quaternionStart)).multiply(Ai.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize(),(l=new t.Euler).setFromQuaternion(c,void 0,!1),(u=l.toArray()).pop(),u=u.map((function(e){return e*t.MathUtils.RAD2DEG})),Oi.rotation=u,this.dispatchEvent(Oi);else this.rotationAxis.applyQuaternion(this._parentQuaternionInv),(c=(new t.Quaternion).copy(Ai.setFromAxisAngle(this.rotationAxis,this.rotationAngle))).multiply(this._quaternionStart).normalize(),(l=new t.Euler).setFromQuaternion(c,void 0,!1),(u=l.toArray()).pop(),u=u.map((function(e){return e*t.MathUtils.RAD2DEG})),Oi.rotation=u,this.dispatchEvent(Oi)}this.dispatchEvent(Ci),this.dispatchEvent(Ui)}}}},{key:"pointerUp",value:function(e){0===e.button&&(this.dragging&&null!==this.axis&&(Li.mode=this.mode,this.dispatchEvent(Li)),this.dragging=!1,this.axis=null)}},{key:"dispose",value:function(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.traverse((function(e){e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose()}))}},{key:"attach",value:function(e){return this.object=e,this.visible=!0,this}},{key:"detach",value:function(){return this.object=void 0,this.visible=!1,this.axis=null,this}},{key:"reset",value:function(){this.enabled&&this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent(Ci),this.dispatchEvent(Ui),this.pointStart.copy(this.pointEnd))}},{key:"getRaycaster",value:function(){return Mi}},{key:"getMode",value:function(){return this.mode}},{key:"setMode",value:function(e){this.mode=e}},{key:"setTranslationSnap",value:function(e){this.translationSnap=e}},{key:"setRotationSnap",value:function(e){this.rotationSnap=e}},{key:"setScaleSnap",value:function(e){this.scaleSnap=e}},{key:"setSize",value:function(e){this.size=e}},{key:"setSpace",value:function(e){this.space=e}},{key:"onPointerHover",value:function(e){if(this.enabled)switch(e.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(e))}}},{key:"onPointerDown",value:function(e){this.enabled&&(document.pointerLockElement||this.domElement.setPointerCapture(e.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(e)),this.pointerDown(this._getPointer(e)))}},{key:"onPointerMove",value:function(e){this.enabled&&this.pointerMove(this._getPointer(e))}},{key:"onPointerUp",value:function(e){this.enabled&&this.pointerUp(this._getPointer(e))}}]),n}(t.Object3D);function Fi(e){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:e.button};var t=this.domElement.getBoundingClientRect();return{x:(e.clientX-t.left)/t.width*2-1,y:-(e.clientY-t.top)/t.height*2+1,button:e.button}}function Bi(e,t,r){for(var n=t.intersectObject(e,!0),i=0;i<n.length;i++)if(n[i].object.visible||r)return n[i];return!1}var ki=new t.Euler,ji=new t.Vector3(0,1,0),Gi=new t.Vector3(0,0,0),zi=new t.Matrix4,Vi=new t.Quaternion,Hi=new t.Quaternion,Wi=new t.Vector3,Xi=new t.Matrix4,Yi=new t.Vector3(1,0,0),qi=new t.Vector3(0,1,0),Ji=new t.Vector3(0,0,1),Ki=new t.Vector3,Zi=new t.Vector3,Qi=new t.Vector3,$i=function(e){_i(n,e);var r=xi(n);function n(){var e;mi(this,n),(e=r.call(this)).isTransformControlsGizmo=!0,e.type="TransformControlsGizmo";var i=new t.MeshBasicMaterial({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),o=new t.LineBasicMaterial({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),s=i.clone();s.opacity=.15;var a=o.clone();a.opacity=.5;var c=i.clone();c.color.setHex(16711680);var l=i.clone();l.color.setHex(65280);var u=i.clone();u.color.setHex(255);var h=i.clone();h.color.setHex(16711680),h.opacity=.5;var p=i.clone();p.color.setHex(65280),p.opacity=.5;var d=i.clone();d.color.setHex(255),d.opacity=.5;var f=i.clone();f.opacity=.25;var m=i.clone();m.color.setHex(16776960),m.opacity=.25,i.clone().color.setHex(16776960);var g=i.clone();g.color.setHex(7895160);var y=new t.CylinderGeometry(0,.04,.1,12);y.translate(0,.05,0);var v=new t.BoxGeometry(.08,.08,.08);v.translate(0,.04,0);var _=new t.BufferGeometry;_.setAttribute("position",new t.Float32BufferAttribute([0,0,0,1,0,0],3));var b=new t.CylinderGeometry(.0075,.0075,.5,3);function x(e,r){var n=new t.TorusGeometry(e,.0075,3,64,r*Math.PI*2);return n.rotateY(Math.PI/2),n.rotateX(Math.PI/2),n}b.translate(0,.25,0);var w={X:[[new t.Mesh(y,c),[.5,0,0],[0,0,-Math.PI/2]],[new t.Mesh(y,c),[-.5,0,0],[0,0,Math.PI/2]],[new t.Mesh(b,c),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new t.Mesh(y,l),[0,.5,0]],[new t.Mesh(y,l),[0,-.5,0],[Math.PI,0,0]],[new t.Mesh(b,l)]],Z:[[new t.Mesh(y,u),[0,0,.5],[Math.PI/2,0,0]],[new t.Mesh(y,u),[0,0,-.5],[-Math.PI/2,0,0]],[new t.Mesh(b,u),null,[Math.PI/2,0,0]]],XYZ:[[new t.Mesh(new t.OctahedronGeometry(.1,0),f.clone()),[0,0,0]]],XY:[[new t.Mesh(new t.BoxGeometry(.15,.15,.01),d.clone()),[.15,.15,0]]],YZ:[[new t.Mesh(new t.BoxGeometry(.15,.15,.01),h.clone()),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new t.Mesh(new t.BoxGeometry(.15,.15,.01),p.clone()),[.15,0,.15],[-Math.PI/2,0,0]]]},S={X:[[new t.Mesh(new t.CylinderGeometry(.2,0,.6,4),s),[.3,0,0],[0,0,-Math.PI/2]],[new t.Mesh(new t.CylinderGeometry(.2,0,.6,4),s),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new t.Mesh(new t.CylinderGeometry(.2,0,.6,4),s),[0,.3,0]],[new t.Mesh(new t.CylinderGeometry(.2,0,.6,4),s),[0,-.3,0],[0,0,Math.PI]]],Z:[[new t.Mesh(new t.CylinderGeometry(.2,0,.6,4),s),[0,0,.3],[Math.PI/2,0,0]],[new t.Mesh(new t.CylinderGeometry(.2,0,.6,4),s),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new t.Mesh(new t.OctahedronGeometry(.2,0),s)]],XY:[[new t.Mesh(new t.BoxGeometry(.2,.2,.01),s),[.15,.15,0]]],YZ:[[new t.Mesh(new t.BoxGeometry(.2,.2,.01),s),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new t.Mesh(new t.BoxGeometry(.2,.2,.01),s),[.15,0,.15],[-Math.PI/2,0,0]]]},M={START:[[new t.Mesh(new t.OctahedronGeometry(.01,2),a),null,null,null,"helper"]],END:[[new t.Mesh(new t.OctahedronGeometry(.01,2),a),null,null,null,"helper"]],DELTA:[[new t.Line(function(){var e=new t.BufferGeometry;return e.setAttribute("position",new t.Float32BufferAttribute([0,0,0,1,1,1],3)),e}(),a),null,null,null,"helper"]],X:[[new t.Line(_,a.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new t.Line(_,a.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new t.Line(_,a.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},T={XYZE:[[new t.Mesh(x(.5,1),g),null,[0,Math.PI/2,0]]],X:[[new t.Mesh(x(.5,.5),c)]],Y:[[new t.Mesh(x(.5,.5),l),null,[0,0,-Math.PI/2]]],Z:[[new t.Mesh(x(.5,.5),u),null,[0,Math.PI/2,0]]],E:[[new t.Mesh(x(.75,1),m),null,[0,Math.PI/2,0]]]},E={AXIS:[[new t.Line(_,a.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},A={XYZE:[[new t.Mesh(new t.SphereGeometry(.25,10,8),s)]],X:[[new t.Mesh(new t.TorusGeometry(.5,.1,4,24),s),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new t.Mesh(new t.TorusGeometry(.5,.1,4,24),s),[0,0,0],[Math.PI/2,0,0]]],Z:[[new t.Mesh(new t.TorusGeometry(.5,.1,4,24),s),[0,0,0],[0,0,-Math.PI/2]]],E:[[new t.Mesh(new t.TorusGeometry(.75,.1,2,24),s)]]},R={X:[[new t.Mesh(v,c),[.5,0,0],[0,0,-Math.PI/2]],[new t.Mesh(b,c),[0,0,0],[0,0,-Math.PI/2]],[new t.Mesh(v,c),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new t.Mesh(v,l),[0,.5,0]],[new t.Mesh(b,l)],[new t.Mesh(v,l),[0,-.5,0],[0,0,Math.PI]]],Z:[[new t.Mesh(v,u),[0,0,.5],[Math.PI/2,0,0]],[new t.Mesh(b,u),[0,0,0],[Math.PI/2,0,0]],[new t.Mesh(v,u),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new t.Mesh(new t.BoxGeometry(.15,.15,.01),d),[.15,.15,0]]],YZ:[[new t.Mesh(new t.BoxGeometry(.15,.15,.01),h),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new t.Mesh(new t.BoxGeometry(.15,.15,.01),p),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new t.Mesh(new t.BoxGeometry(.1,.1,.1),f.clone())]]},C={X:[[new t.Mesh(new t.CylinderGeometry(.2,0,.6,4),s),[.3,0,0],[0,0,-Math.PI/2]],[new t.Mesh(new t.CylinderGeometry(.2,0,.6,4),s),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new t.Mesh(new t.CylinderGeometry(.2,0,.6,4),s),[0,.3,0]],[new t.Mesh(new t.CylinderGeometry(.2,0,.6,4),s),[0,-.3,0],[0,0,Math.PI]]],Z:[[new t.Mesh(new t.CylinderGeometry(.2,0,.6,4),s),[0,0,.3],[Math.PI/2,0,0]],[new t.Mesh(new t.CylinderGeometry(.2,0,.6,4),s),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new t.Mesh(new t.BoxGeometry(.2,.2,.01),s),[.15,.15,0]]],YZ:[[new t.Mesh(new t.BoxGeometry(.2,.2,.01),s),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new t.Mesh(new t.BoxGeometry(.2,.2,.01),s),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new t.Mesh(new t.BoxGeometry(.2,.2,.2),s),[0,0,0]]]},I={X:[[new t.Line(_,a.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new t.Line(_,a.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new t.Line(_,a.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function O(e){var r=new t.Object3D;for(var n in e)for(var i=e[n].length;i--;){var o=e[n][i][0].clone(),s=e[n][i][1],a=e[n][i][2],c=e[n][i][3],l=e[n][i][4];o.name=n,o.tag=l,s&&o.position.set(s[0],s[1],s[2]),a&&o.rotation.set(a[0],a[1],a[2]),c&&o.scale.set(c[0],c[1],c[2]),o.updateMatrix();var u=o.geometry.clone();u.applyMatrix4(o.matrix),o.geometry=u,o.renderOrder=1/0,o.position.set(0,0,0),o.rotation.set(0,0,0),o.scale.set(1,1,1),r.add(o)}return r}return e.gizmo={},e.picker={},e.helper={},e.add(e.gizmo.translate=O(w)),e.add(e.gizmo.rotate=O(T)),e.add(e.gizmo.scale=O(R)),e.add(e.picker.translate=O(S)),e.add(e.picker.rotate=O(A)),e.add(e.picker.scale=O(C)),e.add(e.helper.translate=O(M)),e.add(e.helper.rotate=O(E)),e.add(e.helper.scale=O(I)),e.picker.translate.visible=!1,e.picker.rotate.visible=!1,e.picker.scale.visible=!1,e}return yi(n,[{key:"updateMatrixWorld",value:function(e){var t=this,r="local"===("scale"===this.mode?"local":this.space)?this.worldQuaternion:Hi;this.gizmo.translate.visible="translate"===this.mode,this.gizmo.rotate.visible="rotate"===this.mode,this.gizmo.scale.visible="scale"===this.mode,this.helper.translate.visible="translate"===this.mode,this.helper.rotate.visible="rotate"===this.mode,this.helper.scale.visible="scale"===this.mode;var i=[];i=(i=(i=i.concat(this.picker[this.mode].children)).concat(this.gizmo[this.mode].children)).concat(this.helper[this.mode].children);for(var o=function(){var e,n=i[s];if(n.visible=!0,n.rotation.set(0,0,0),n.position.copy(t.worldPosition),e=t.camera.isOrthographicCamera?(t.camera.top-t.camera.bottom)/t.camera.zoom:t.worldPosition.distanceTo(t.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*t.camera.fov/360)/t.camera.zoom,7),n.scale.set(1,1,1).multiplyScalar(e*t.size/4),"helper"===n.tag)return n.visible=!1,"AXIS"===n.name?(n.position.copy(t.worldPositionStart),n.visible=!!t.axis,"X"===t.axis&&(Ai.setFromEuler(ki.set(0,0,0)),n.quaternion.copy(r).multiply(Ai),Math.abs(ji.copy(Yi).applyQuaternion(r).dot(t.eye))>.9&&(n.visible=!1)),"Y"===t.axis&&(Ai.setFromEuler(ki.set(0,0,Math.PI/2)),n.quaternion.copy(r).multiply(Ai),Math.abs(ji.copy(qi).applyQuaternion(r).dot(t.eye))>.9&&(n.visible=!1)),"Z"===t.axis&&(Ai.setFromEuler(ki.set(0,Math.PI/2,0)),n.quaternion.copy(r).multiply(Ai),Math.abs(ji.copy(Ji).applyQuaternion(r).dot(t.eye))>.9&&(n.visible=!1)),"XYZE"===t.axis&&(Ai.setFromEuler(ki.set(0,Math.PI/2,0)),ji.copy(t.rotationAxis),n.quaternion.setFromRotationMatrix(zi.lookAt(Gi,ji,qi)),n.quaternion.multiply(Ai),n.visible=t.dragging),"E"===t.axis&&(n.visible=!1)):"START"===n.name?(n.position.copy(t.worldPositionStart),n.visible=t.dragging):"END"===n.name?(n.position.copy(t.worldPosition),n.visible=t.dragging):"DELTA"===n.name?(n.position.copy(t.worldPositionStart),n.quaternion.copy(t.worldQuaternionStart),Ti.set(1e-10,1e-10,1e-10).add(t.worldPositionStart).sub(t.worldPosition).multiplyScalar(-1),Ti.applyQuaternion(t.worldQuaternionStart.clone().invert()),n.scale.copy(Ti),n.visible=t.dragging):(n.quaternion.copy(r),t.dragging?n.position.copy(t.worldPositionStart):n.position.copy(t.worldPosition),t.axis&&(n.visible=-1!==t.axis.search(n.name))),1;if(n.quaternion.copy(r),"translate"===t.mode||"scale"===t.mode){var o=.99;"X"===n.name&&Math.abs(ji.copy(Yi).applyQuaternion(r).dot(t.eye))>o&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),"Y"===n.name&&Math.abs(ji.copy(qi).applyQuaternion(r).dot(t.eye))>o&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),"Z"===n.name&&Math.abs(ji.copy(Ji).applyQuaternion(r).dot(t.eye))>o&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),"XY"===n.name&&Math.abs(ji.copy(Ji).applyQuaternion(r).dot(t.eye))<.2&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),"YZ"===n.name&&Math.abs(ji.copy(Yi).applyQuaternion(r).dot(t.eye))<.2&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),"XZ"===n.name&&Math.abs(ji.copy(qi).applyQuaternion(r).dot(t.eye))<.2&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1)}else"rotate"===t.mode&&(Vi.copy(r),ji.copy(t.eye).applyQuaternion(Ai.copy(r).invert()),-1!==n.name.search("E")&&n.quaternion.setFromRotationMatrix(zi.lookAt(t.eye,Gi,qi)),"X"===n.name&&(Ai.setFromAxisAngle(Yi,Math.atan2(-ji.y,ji.z)),Ai.multiplyQuaternions(Vi,Ai),n.quaternion.copy(Ai)),"Y"===n.name&&(Ai.setFromAxisAngle(qi,Math.atan2(ji.x,ji.z)),Ai.multiplyQuaternions(Vi,Ai),n.quaternion.copy(Ai)),"Z"===n.name&&(Ai.setFromAxisAngle(Ji,Math.atan2(ji.y,ji.x)),Ai.multiplyQuaternions(Vi,Ai),n.quaternion.copy(Ai)));n.visible=n.visible&&(-1===n.name.indexOf("X")||t.showX),n.visible=n.visible&&(-1===n.name.indexOf("Y")||t.showY),n.visible=n.visible&&(-1===n.name.indexOf("Z")||t.showZ),n.visible=n.visible&&(-1===n.name.indexOf("E")||t.showX&&t.showY&&t.showZ),n.material._color=n.material._color||n.material.color.clone(),n.material._opacity=n.material._opacity||n.material.opacity,n.material.color.copy(n.material._color),n.material.opacity=n.material._opacity,t.enabled&&t.axis&&(n.name===t.axis||t.axis.split("").some((function(e){return n.name===e})))&&(n.material.color.setHex(16776960),n.material.opacity=1)},s=0;s<i.length;s++)o();vi(Si(n.prototype),"updateMatrixWorld",this).call(this,e)}}]),n}(t.Object3D),eo=function(e){_i(n,e);var r=xi(n);function n(){var e;return mi(this,n),(e=r.call(this,new t.PlaneGeometry(1e5,1e5,2,2),new t.MeshBasicMaterial({visible:!1,wireframe:!0,side:t.DoubleSide,transparent:!0,opacity:.1,toneMapped:!1}))).isTransformControlsPlane=!0,e.type="TransformControlsPlane",e}return yi(n,[{key:"updateMatrixWorld",value:function(e){var t=this.space;switch(this.position.copy(this.worldPosition),"scale"===this.mode&&(t="local"),Ki.copy(Yi).applyQuaternion("local"===t?this.worldQuaternion:Hi),Zi.copy(qi).applyQuaternion("local"===t?this.worldQuaternion:Hi),Qi.copy(Ji).applyQuaternion("local"===t?this.worldQuaternion:Hi),ji.copy(Zi),this.mode){case"translate":case"scale":switch(this.axis){case"X":ji.copy(this.eye).cross(Ki),Wi.copy(Ki).cross(ji);break;case"Y":ji.copy(this.eye).cross(Zi),Wi.copy(Zi).cross(ji);break;case"Z":ji.copy(this.eye).cross(Qi),Wi.copy(Qi).cross(ji);break;case"XY":Wi.copy(Qi);break;case"YZ":Wi.copy(Ki);break;case"XZ":ji.copy(Qi),Wi.copy(Zi);break;case"XYZ":case"E":Wi.set(0,0,0)}break;default:Wi.set(0,0,0)}0===Wi.length()?this.quaternion.copy(this.cameraQuaternion):(Xi.lookAt(Ti.set(0,0,0),Wi,ji),this.quaternion.setFromRotationMatrix(Xi)),vi(Si(n.prototype),"updateMatrixWorld",this).call(this,e)}}]),n}(t.Mesh);function to(e){return to="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},to(e)}function ro(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return no(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return no(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,a=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){a=!0,o=e},f:function(){try{s||null==r.return||r.return()}finally{if(a)throw o}}}}function no(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function io(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(i=n.key,o=void 0,o=function(e,t){if("object"!==to(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==to(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(i,"string"),"symbol"===to(o)?o:String(o)),n)}var i,o}function oo(e,t){return oo=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},oo(e,t)}function so(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=co(e);if(t){var i=co(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return function(e,t){if(t&&("object"===to(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return ao(e)}(this,r)}}function ao(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function co(e){return co=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},co(e)}var lo=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&oo(e,t)}(s,e);var r,n,i,o=so(s);function s(e,r,n){var i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(i=o.call(this)).camera=r,i.enabled=!0,i.center=new t.Vector3,i.panSpeed=.002,i.zoomSpeed=.1,i.rotationSpeed=.005,i.cameraDistance=20,i.cameraTheta=0,i.cameraPhi=0,i.rotateZ=0;var a,c=ao(i),l=new t.Vector3,u=new t.Vector3,h=new t.Box3,p={NONE:-1,ROTATE:0,ZOOM:1,PAN:2},d=p.NONE,f=i.center,m=new t.Matrix3,g=new t.Vector2,y=new t.Vector2,v=new t.Spherical,_=new t.Sphere,b={type:"change"};function x(e){if(!1!==c.enabled){switch(e.pointerType){case"mouse":case"pen":!function(e){0===e.button?d=p.ROTATE:1===e.button?d=p.ZOOM:2===e.button&&(d=p.PAN);y.set(e.clientX,e.clientY)}(e)}n.addEventListener("pointermove",w),n.addEventListener("pointerup",S),window.addEventListener("pointerup",S)}}function w(e){if(!1!==c.enabled)switch(e.pointerType){case"mouse":case"pen":!function(e){g.set(e.clientX,e.clientY);var t=g.x-y.x,r=g.y-y.y;d===p.ROTATE?c.rotate(u.set(-t,-r,0)):d===p.ZOOM?c.zoom(u.set(0,0,r)):d===p.PAN&&c.pan(u.set(-t,r,0));y.set(e.clientX,e.clientY)}(e)}}function S(e){switch(e.pointerType){case"mouse":case"pen":M()}n.removeEventListener("pointermove",w),n.removeEventListener("pointerup",S),window.removeEventListener("pointerup",S)}function M(){d!=p.NONE&&(d=p.NONE,e.app.doUpdateObjectEndCallback(r.uuid,"cameraController"))}function T(t){!1!==c.enabled&&(t.preventDefault(),c.zoom(u.set(0,0,t.deltaY>0?1:-1)),clearTimeout(a),a=setTimeout((function(){e.app.doUpdateObjectEndCallback(r.uuid,"cameraController")}),500))}function E(e){e.preventDefault()}i.update=function(){r.lookAt(f),c.dispatchEvent(b)},i.focus=function(t){var n;h.setFromObject(t),!1===h.isEmpty()?(h.getCenter(f),n=h.getBoundingSphere(_).radius):(f.setFromMatrixPosition(t.matrixWorld),n=.1),n=r.position.distanceTo(t.position),u.set(0,0,1),u.applyQuaternion(r.quaternion),u.multiplyScalar(n),r.position.copy(f).add(u),e.app.updateDefaultCamera(r,this.getConfig()),c.dispatchEvent(b)},i.getConfig=function(){return{cameraDistance:this.cameraDistance,cameraTheta:this.cameraTheta*t.MathUtils.RAD2DEG,cameraPhi:90-this.cameraPhi*t.MathUtils.RAD2DEG,lookAtX:this.center.x,lookAtY:this.center.y,lookAtZ:this.center.z}},i.pan=function(t){var r=this.camera.position.distanceTo(f);t.multiplyScalar(r*c.panSpeed),t.applyMatrix3(m.getNormalMatrix(this.camera.matrix)),this.camera.position.add(t),void 0===t.x||void 0===t.y||isNaN(t.x)||isNaN(t.y)||(f.add(t),e.app.updateDefaultCamera(this.camera,this.getConfig()),c.dispatchEvent(b))},i.updateConfig=function(e){this.cameraDistance=e.cameraDistance,this.cameraTheta=e.cameraTheta/t.MathUtils.RAD2DEG,this.cameraPhi=(90-e.cameraPhi)/t.MathUtils.RAD2DEG;var r=e.lookAtX,n=e.lookAtY,i=e.lookAtZ;f.set(r,n,i),v.radius=this.cameraDistance,v.theta=this.cameraTheta,v.phi=this.cameraPhi,l.setFromSpherical(v),this.camera.position.copy(f).add(l),this.setUp(),this.camera.lookAt(f),this.camera.updateMatrix(),c.dispatchEvent(b)},i.updateConfigProperty=function(e,t){var r=this.getConfig();r[e]=t,this.updateConfig(r)},i.setUp=function(){l.set(0,0,1),v.setFromVector3(l),v.theta=this.cameraTheta-v.theta,v.phi=this.cameraPhi-v.phi,l.setFromSpherical(v),r.up.copy(l),r.rotation.z=t.MathUtils.degToRad(this.rotate)},i.zoom=function(t){var n=r.position.distanceTo(f);if(n<.01)this.cameraDistance=.01;else{t.multiplyScalar(n*c.zoomSpeed),t.applyMatrix3(m.getNormalMatrix(r.matrix));var i=r.position.clone();i.add(t);var o=i.distanceTo(f);if(isNaN(o))return;o>=.01&&(this.cameraDistance=o)}e.app.updateDefaultCamera(r,{cameraDistance:this.cameraDistance}),c.dispatchEvent(b)},i.rotate=function(t){this.cameraTheta+=t.x*c.rotationSpeed,this.cameraPhi+=t.y*c.rotationSpeed,v.radius=this.cameraDistance,v.theta=this.cameraTheta,v.phi=this.cameraPhi,l.setFromSpherical(v),e.app.updateDefaultCamera(r,this.getConfig()),c.dispatchEvent(b)},i.dispose=function(){n.removeEventListener("contextmenu",E),n.removeEventListener("dblclick",M),n.removeEventListener("wheel",T),n.removeEventListener("pointerdown",x),n.removeEventListener("touchstart",I),n.removeEventListener("touchmove",O),window.removeEventListener("pointerup",S)},e.app.isDoraEditor&&(n.addEventListener("contextmenu",E),n.addEventListener("dblclick",M),n.addEventListener("wheel",T),n.addEventListener("pointerdown",x));var A=[new t.Vector3,new t.Vector3,new t.Vector3],R=[new t.Vector3,new t.Vector3,new t.Vector3],C=null;function I(e){if(!1!==c.enabled){switch(e.touches.length){case 1:A[0].set(e.touches[0].pageX,e.touches[0].pageY,0).divideScalar(window.devicePixelRatio),A[1].set(e.touches[0].pageX,e.touches[0].pageY,0).divideScalar(window.devicePixelRatio);break;case 2:A[0].set(e.touches[0].pageX,e.touches[0].pageY,0).divideScalar(window.devicePixelRatio),A[1].set(e.touches[1].pageX,e.touches[1].pageY,0).divideScalar(window.devicePixelRatio),C=A[0].distanceTo(A[1])}R[0].copy(A[0]),R[1].copy(A[1])}}function O(e){if(!1!==c.enabled){switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:A[0].set(e.touches[0].pageX,e.touches[0].pageY,0).divideScalar(window.devicePixelRatio),A[1].set(e.touches[0].pageX,e.touches[0].pageY,0).divideScalar(window.devicePixelRatio),c.rotate(A[0].sub(i(A[0],R)).multiplyScalar(-1));break;case 2:A[0].set(e.touches[0].pageX,e.touches[0].pageY,0).divideScalar(window.devicePixelRatio),A[1].set(e.touches[1].pageX,e.touches[1].pageY,0).divideScalar(window.devicePixelRatio);var t=A[0].distanceTo(A[1]);c.zoom(u.set(0,0,C-t)),C=t;var r=A[0].clone().sub(i(A[0],R)),n=A[1].clone().sub(i(A[1],R));r.x=-r.x,n.x=-n.x}R[0].copy(A[0]),R[1].copy(A[1])}function i(e,t){var r,n=t[0],i=ro(t);try{for(i.s();!(r=i.n()).done;){var o=r.value;n.distanceTo(e)>o.distanceTo(e)&&(n=o)}}catch(e){i.e(e)}finally{i.f()}return n}}return i}return r=s,n&&io(r.prototype,n),i&&io(r,i),Object.defineProperty(r,"prototype",{writable:!1}),r}(t.EventDispatcher);function uo(e){return uo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},uo(e)}function ho(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function po(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(i=n.key,o=void 0,o=function(e,t){if("object"!==uo(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==uo(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(i,"string"),"symbol"===uo(o)?o:String(o)),n)}var i,o}function fo(e,t,r){return t&&po(e.prototype,t),r&&po(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}var mo=function(){function e(t){ho(this,e),this.dom=t}return fo(e,[{key:"add",value:function(){for(var t=0;t<arguments.length;t++){var r=arguments[t];r instanceof e?this.dom.appendChild(r.dom):console.error("UIElement:",r,"is not an instance of UIElement.")}return this}},{key:"remove",value:function(){for(var t=0;t<arguments.length;t++){var r=arguments[t];r instanceof e?this.dom.removeChild(r.dom):console.error("UIElement:",r,"is not an instance of UIElement.")}return this}},{key:"clear",value:function(){for(;this.dom.children.length;)this.dom.removeChild(this.dom.lastChild)}},{key:"setId",value:function(e){return this.dom.id=e,this}},{key:"getId",value:function(){return this.dom.id}},{key:"setClass",value:function(e){return this.dom.className=e,this}},{key:"addClass",value:function(e){return this.dom.classList.add(e),this}},{key:"removeClass",value:function(e){return this.dom.classList.remove(e),this}},{key:"setStyle",value:function(e,t){for(var r=0;r<t.length;r++)this.dom.style[e]=t[r];return this}},{key:"setDisabled",value:function(e){return this.dom.disabled=e,this}},{key:"setTextContent",value:function(e){return this.dom.textContent=e,this}},{key:"setInnerHTML",value:function(e){this.dom.innerHTML=e}},{key:"getIndexOfChild",value:function(e){return Array.prototype.indexOf.call(this.dom.children,e.dom)}}]),e}();["position","left","top","right","bottom","width","height","display","verticalAlign","overflow","color","background","backgroundColor","opacity","border","borderLeft","borderTop","borderRight","borderBottom","borderColor","margin","marginLeft","marginTop","marginRight","marginBottom","padding","paddingLeft","paddingTop","paddingRight","paddingBottom","fontSize","fontWeight","textAlign","textDecoration","textTransform","cursor","zIndex"].forEach((function(e){var t="set"+e.substr(0,1).toUpperCase()+e.substr(1,e.length);mo.prototype[t]=function(){return this.setStyle(e,arguments),this}}));["KeyUp","KeyDown","MouseOver","MouseOut","Click","DblClick","Change","Input"].forEach((function(e){var t="on"+e;mo.prototype[t]=function(t){return this.dom.addEventListener(e.toLowerCase(),t.bind(this)),this}}));function go(e){var t=e.signals;function r(){for(var t=e.scene,r=0,n=0,i=0,o=0,s=t.children.length;o<s;o++){t.children[o].traverseVisible((function(e){if(r++,e.isMesh||e.isPoints){var t=e.geometry;n+=t.attributes.position.count,e.isMesh&&(null!==t.index?i+=t.index.count/3:i+=t.attributes.position.count/3)}}))}console.info(" objects ".concat(r.format()," vertices ").concat(n.format()," triangles ").concat(i.format()," "))}return t.objectAdded.add(r),t.objectRemoved.add(r),t.geometryChanged.add(r),t.sceneRendered.add((function(e){console.info(" frametime ".concat(Number(e).toFixed(2)," ms"))})),this}function yo(e){return yo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},yo(e)}function vo(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(i=n.key,o=void 0,o=function(e,t){if("object"!==yo(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==yo(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(i,"string"),"symbol"===yo(o)?o:String(o)),n)}var i,o}function _o(e,t){return _o=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},_o(e,t)}function bo(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=xo(e);if(t){var i=xo(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return function(e,t){if(t&&("object"===yo(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,r)}}function xo(e){return xo=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},xo(e)}var wo=new t.Vector4,So=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_o(e,t)}(s,e);var r,n,i,o=bo(s);function s(e,r){var n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(n=o.call(this)).isViewHelper=!0,n.editorCamera=e,n.animating=!1,n.controls=null;var i=new t.Color("#FF5E57"),a=new t.Color("#00BE1A"),c=new t.Color("#1CA4FF"),l=[],u=new t.Raycaster,h=new t.Vector2,p=new t.Object3D,d=new t.OrthographicCamera(-2,2,2,-2,0,4);d.position.set(0,0,2);var f=new t.BoxGeometry(.8,.05,.05).translate(.4,0,0),m=new t.Mesh(f,U(i)),g=new t.Mesh(f,U(a)),y=new t.Mesh(f,U(c));g.rotation.z=Math.PI/2,y.rotation.y=-Math.PI/2,n.add(m),n.add(y),n.add(g);var v=new t.Sprite(D(i,"X"));v.userData.type="posX";var _=new t.Sprite(D(a,"Y"));_.userData.type="posY";var b=new t.Sprite(D(c,"Z"));b.userData.type="posZ";var x=new t.Sprite(D(i));x.userData.type="negX";var w=new t.Sprite(D(a));w.userData.type="negY";var S=new t.Sprite(D(c));S.userData.type="negZ",v.position.x=1,_.position.y=1,b.position.z=1,x.position.x=-1,x.scale.setScalar(.8),w.position.y=-1,w.scale.setScalar(.8),S.position.z=-1,S.scale.setScalar(.8),n.add(v),n.add(_),n.add(b),n.add(x),n.add(w),n.add(S),l.push(v),l.push(_),l.push(b),l.push(x),l.push(w),l.push(S);var M=new t.Vector3,T=128,E=2*Math.PI;n.render=function(e){this.quaternion.copy(this.editorCamera.quaternion).invert(),this.updateMatrixWorld(),M.set(0,0,1),M.applyQuaternion(this.editorCamera.quaternion),M.x>=0?(v.material.opacity=1,x.material.opacity=.5):(v.material.opacity=.5,x.material.opacity=1),M.y>=0?(_.material.opacity=1,w.material.opacity=.5):(_.material.opacity=.5,w.material.opacity=1),M.z>=0?(b.material.opacity=1,S.material.opacity=.5):(b.material.opacity=.5,S.material.opacity=1);var t=r.canvasWidth-T;e.clearDepth(),e.getViewport(wo),e.setViewport(t,0,T,T),e.render(this,d),e.setViewport(wo.x,wo.y,wo.z,wo.w)};var A=new t.Vector2,R=new t.Vector3,C=new t.Quaternion,I=new t.Vector2,O=new t.Vector2,P=new t.Quaternion,N=new t.Quaternion,L=0;function U(e){return new t.MeshBasicMaterial({color:e,toneMapped:!1})}function D(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=document.createElement("canvas");n.width=64,n.height=64;var i=n.getContext("2d");i.beginPath(),i.arc(32,32,16,0,2*Math.PI),i.closePath();var o=1;null==r&&(o=.6),i.fillStyle="rgba(".concat(255*e.r|0,", ").concat(255*e.g|0,", ").concat(255*e.b|0,", ").concat(o,")"),i.fill(),null!==r?(i.font="24px Arial",i.textAlign="center",i.fillStyle="#000000",i.fillText(r,32,41)):(i.beginPath(),i.arc(32,32,14,0,2*Math.PI),i.closePath(),i.lineWidth=2,i.strokeStyle=e.getStyle(),i.stroke());var s=new t.CanvasTexture(n);return s.colorSpace=t.LinearSRGBColorSpace,new t.SpriteMaterial({map:s,toneMapped:!1})}return n.handleClick=function(e){if(!0===this.animating)return!1;var t=r.canvas.getBoundingClientRect(),n=r.canvasWidth-T,i=r.canvasHeight-T,o=e.clientX-t.left,s=e.clientY-t.top;h.x=(o-n)/T*2-1,h.y=-(s-i)/T*2+1,u.setFromCamera(h,d);var a=u.intersectObjects(l);if(a.length>0){var c=a[0].object;return this.prepareAnimationData(c,this.controls.center),this.animating=!0,!0}return!1},n.update=function(e){var t=e*E,r=this.controls.center;P.rotateTowards(N,t),this.editorCamera.position.set(0,0,1).applyQuaternion(P).multiplyScalar(L).add(r),this.editorCamera.quaternion.rotateTowards(C,t),0===P.angleTo(N)&&(this.animating=!1)},n.dispose=function(){f.dispose(),m.material.dispose(),g.material.dispose(),y.material.dispose(),v.material.map.dispose(),_.material.map.dispose(),b.material.map.dispose(),x.material.map.dispose(),w.material.map.dispose(),S.material.map.dispose(),v.material.dispose(),_.material.dispose(),b.material.dispose(),x.material.dispose(),w.material.dispose(),S.material.dispose()},n.prepareAnimationData=function(e,r){switch(e.userData.type){case"posX":A.set(0,90),R.set(1,0,0),C.setFromEuler(new t.Euler(0,.5*Math.PI,0));break;case"posY":A.set(90,90),R.set(0,1,0),C.setFromEuler(new t.Euler(.5*-Math.PI,0,0));break;case"posZ":A.set(0,0),R.set(0,0,1),C.setFromEuler(new t.Euler);break;case"negX":A.set(0,-90),R.set(-1,0,0),C.setFromEuler(new t.Euler(0,.5*-Math.PI,0));break;case"negY":A.set(-90,-90),R.set(0,-1,0),C.setFromEuler(new t.Euler(.5*Math.PI,0,0));break;case"negZ":A.set(0,180),R.set(0,0,-1),C.setFromEuler(new t.Euler(0,Math.PI,0));break;default:console.error("ViewHelper: Invalid axis.")}L=this.editorCamera.position.distanceTo(r),R.multiplyScalar(L).add(r),p.position.copy(r),p.lookAt(this.editorCamera.position),P.copy(p.quaternion),p.lookAt(R),N.copy(p.quaternion),I.set(this.editor.app.viewport.controls.cameraPhi,this.editor.app.viewport.controls.cameraTheta),O.copy(A)},n}return r=s,n&&vo(r.prototype,n),i&&vo(r,i),Object.defineProperty(r,"prototype",{writable:!1}),r}(t.Object3D);function Mo(e){return Mo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Mo(e)}function To(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(i=n.key,o=void 0,o=function(e,t){if("object"!==Mo(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==Mo(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(i,"string"),"symbol"===Mo(o)?o:String(o)),n)}var i,o}function Eo(e,t){return Eo=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Eo(e,t)}function Ao(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Ro(e);if(t){var i=Ro(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return function(e,t){if(t&&("object"===Mo(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,r)}}function Ro(e){return Ro=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Ro(e)}var Co=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Eo(e,t)}(o,e);var t,r,n,i=Ao(o);function o(e,t){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),i.call(this,e,t)}return t=o,r&&To(t.prototype,r),n&&To(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}(So);function Io(e){return Io="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Io(e)}function Oo(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(i=n.key,o=void 0,o=function(e,t){if("object"!==Io(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==Io(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(i,"string"),"symbol"===Io(o)?o:String(o)),n)}var i,o}function Po(e,t){return Po=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Po(e,t)}function No(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Lo(e);if(t){var i=Lo(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return function(e,t){if(t&&("object"===Io(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,r)}}function Lo(e){return Lo=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Lo(e)}var Uo=new t.Vector4,Do=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Po(e,t)}(s,e);var r,n,i,o=No(s);function s(e){var r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),r=o.call(this);var n=e.pixelRatio;r.isViewHelper=!0;var i=new t.Color("#FF813C"),a=new t.OrthographicCamera(-1,1,1,-1,0,4);a.position.set(0,0,2);var c=new t.Sprite(function(e){var r=document.createElement("canvas");r.width=16*n,r.height=16*n;var i=r.getContext("2d");i.scale(n,n),i.beginPath(),i.arc(8,8,4,0,2*Math.PI),i.closePath(),i.strokeStyle=e.getStyle(),i.lineWidth=1,i.stroke(),i.beginPath(),i.moveTo(8,0),i.lineTo(8,16),i.stroke(),i.beginPath(),i.moveTo(0,8),i.lineTo(16,8),i.stroke();var o=new t.CanvasTexture(r);return o.colorSpace=t.SRGBColorSpace,new t.SpriteMaterial({map:o,toneMapped:!1,color:16777215,transparent:!0})}(i));return r.add(c),r.render=function(e){e.clearDepth(),e.getViewport(Uo),a.left=-Uo.z/2/n,a.right=Uo.z/2/n,a.top=Uo.w/2/n,a.bottom=-Uo.w/2/n,a.updateProjectionMatrix(),c.scale.set(16,16,1),e.render(this,a)},r.dispose=function(){c.material.map.dispose(),c.material.dispose()},r}return r=s,n&&Oo(r.prototype,n),i&&Oo(r,i),Object.defineProperty(r,"prototype",{writable:!1}),r}(t.Object3D);class Fo extends t.Scene{constructor(e=null){super();const r=new t.BoxGeometry;r.deleteAttribute("uv");const n=new t.MeshStandardMaterial({side:t.BackSide}),i=new t.MeshStandardMaterial,o=new t.PointLight(16777215,900,28,2);o.position.set(.418,16.199,.3),this.add(o);const s=new t.Mesh(r,n);s.position.set(-.757,13.219,.717),s.scale.set(31.713,28.305,28.591),this.add(s);const a=new t.Mesh(r,i);a.position.set(-10.906,2.009,1.846),a.rotation.set(0,-.195,0),a.scale.set(2.328,7.905,4.651),this.add(a);const c=new t.Mesh(r,i);c.position.set(-5.607,-.754,-.758),c.rotation.set(0,.994,0),c.scale.set(1.97,1.534,3.955),this.add(c);const l=new t.Mesh(r,i);l.position.set(6.167,.857,7.803),l.rotation.set(0,.561,0),l.scale.set(3.927,6.285,3.687),this.add(l);const u=new t.Mesh(r,i);u.position.set(-2.017,.018,6.124),u.rotation.set(0,.333,0),u.scale.set(2.002,4.566,2.064),this.add(u);const h=new t.Mesh(r,i);h.position.set(2.291,-.756,-2.621),h.rotation.set(0,-.286,0),h.scale.set(1.546,1.552,1.496),this.add(h);const p=new t.Mesh(r,i);p.position.set(-2.193,-.369,-5.547),p.rotation.set(0,.516,0),p.scale.set(3.875,3.487,2.986),this.add(p);const d=new t.Mesh(r,Bo(50));d.position.set(-16.116,14.37,8.208),d.scale.set(.1,2.428,2.739),this.add(d);const f=new t.Mesh(r,Bo(50));f.position.set(-16.109,18.021,-8.207),f.scale.set(.1,2.425,2.751),this.add(f);const m=new t.Mesh(r,Bo(17));m.position.set(14.904,12.198,-1.832),m.scale.set(.15,4.265,6.331),this.add(m);const g=new t.Mesh(r,Bo(43));g.position.set(-.462,8.89,14.52),g.scale.set(4.38,5.441,.088),this.add(g);const y=new t.Mesh(r,Bo(20));y.position.set(3.235,11.486,-12.541),y.scale.set(2.5,2,.1),this.add(y);const v=new t.Mesh(r,Bo(100));v.position.set(0,20,0),v.scale.set(1,.1,1),this.add(v)}dispose(){const e=new Set;this.traverse((t=>{t.isMesh&&(e.add(t.geometry),e.add(t.material))}));for(const t of e)t.dispose()}}function Bo(e){const r=new t.MeshBasicMaterial;return r.color.setScalar(e),r}function ko(e){return ko="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ko(e)}function jo(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(i=n.key,o=void 0,o=function(e,t){if("object"!==ko(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==ko(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(i,"string"),"symbol"===ko(o)?o:String(o)),n)}var i,o}function Go(e,t){return Go=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Go(e,t)}function zo(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Vo(e);if(t){var i=Vo(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return function(e,t){if(t&&("object"===ko(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,r)}}function Vo(e){return Vo=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Vo(e)}var Ho=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Go(e,t)}(s,e);var r,n,i,o=zo(s);function s(){var e=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:8947848;return function(a,c){var l;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(e,s);a=new t.Color(a),c=new t.Color(c);i=new t.Color(i);for(var u=n/2,h=r/n,p=r/2,d=[],f=[],m=0,g=0,y=-p;m<=n;m++,y+=h){d.push(-p,0,y,p,0,y),d.push(y,0,-p,y,0,p);var v=m===u?c:i;m===u?(a.toArray(f,g),g+=3,a.toArray(f,g),g+=3):(v.toArray(f,g),g+=3,v.toArray(f,g),g+=3),v.toArray(f,g),g+=3,v.toArray(f,g),g+=3}var _=new t.BufferGeometry;_.setAttribute("position",new t.Float32BufferAttribute(d,3)),_.setAttribute("color",new t.Float32BufferAttribute(f,3));var b=new t.LineBasicMaterial({vertexColors:!0,toneMapped:!1});return(l=o.call(e,_,b)).type="GridHelper",l}(arguments.length>2&&void 0!==arguments[2]?arguments[2]:4473924,arguments.length>3&&void 0!==arguments[3]?arguments[3]:4473924)}return r=s,(n=[{key:"dispose",value:function(){this.geometry.dispose(),this.material.dispose()}}])&&jo(r.prototype,n),i&&jo(r,i),Object.defineProperty(r,"prototype",{writable:!1}),s}(t.LineSegments),Wo=.001,Xo=class{constructor(){this.startTime=performance.now(),this.previousTime=0,this.currentTime=0,this._delta=0,this._elapsed=0,this._fixedDelta=1e3/60,this.timescale=1,this.useFixedDelta=!1,this._autoReset=!1}get autoReset(){return this._autoReset}set autoReset(e){"undefined"!=typeof document&&void 0!==document.hidden&&(e?document.addEventListener("visibilitychange",this):document.removeEventListener("visibilitychange",this),this._autoReset=e)}get delta(){return this._delta*Wo}get fixedDelta(){return this._fixedDelta*Wo}set fixedDelta(e){this._fixedDelta=1e3*e}get elapsed(){return this._elapsed*Wo}update(e){this.useFixedDelta?this._delta=this.fixedDelta:(this.previousTime=this.currentTime,this.currentTime=(void 0!==e?e:performance.now())-this.startTime,this._delta=this.currentTime-this.previousTime),this._delta*=this.timescale,this._elapsed+=this._delta}reset(){this._delta=0,this._elapsed=0,this.currentTime=performance.now()-this.startTime}getDelta(){return this.delta}getElapsed(){return this.elapsed}handleEvent(e){document.hidden||(this.currentTime=performance.now()-this.startTime)}dispose(){this.autoReset=!1}},Yo=(()=>{const e=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),r=new Float32Array([0,0,2,0,0,2]),n=new t.BufferGeometry;return n.setAttribute("position",new t.BufferAttribute(e,3)),n.setAttribute("uv",new t.BufferAttribute(r,2)),n})(),qo=class e{static get fullscreenGeometry(){return Yo}constructor(e="Pass",r=new t.Scene,n=new t.Camera){this.name=e,this.renderer=null,this.scene=r,this.camera=n,this.screen=null,this.rtt=!0,this.needsSwap=!0,this.needsDepthTexture=!1,this.enabled=!0}get renderToScreen(){return!this.rtt}set renderToScreen(e){if(this.rtt===e){const t=this.fullscreenMaterial;null!==t&&(t.needsUpdate=!0),this.rtt=!e}}set mainScene(e){}set mainCamera(e){}setRenderer(e){this.renderer=e}isEnabled(){return this.enabled}setEnabled(e){this.enabled=e}get fullscreenMaterial(){return null!==this.screen?this.screen.material:null}set fullscreenMaterial(r){let n=this.screen;null!==n?n.material=r:(n=new t.Mesh(e.fullscreenGeometry,r),n.frustumCulled=!1,null===this.scene&&(this.scene=new t.Scene),this.scene.add(n),this.screen=n)}getFullscreenMaterial(){return this.fullscreenMaterial}setFullscreenMaterial(e){this.fullscreenMaterial=e}getDepthTexture(){return null}setDepthTexture(e,r=t.BasicDepthPacking){}render(e,t,r,n,i){throw new Error("Render method not implemented!")}setSize(e,t){}initialize(e,t,r){}dispose(){for(const r of Object.keys(this)){const n=this[r];(n instanceof t.WebGLRenderTarget||n instanceof t.Material||n instanceof t.Texture||n instanceof e)&&this[r].dispose()}null!==this.fullscreenMaterial&&this.fullscreenMaterial.dispose()}},Jo=class extends qo{constructor(){super("ClearMaskPass",null,null),this.needsSwap=!1}render(e,t,r,n,i){const o=e.state.buffers.stencil;o.setLocked(!1),o.setTest(!1)}},Ko="varying vec2 vUv;void main(){vUv=position.xy*0.5+0.5;gl_Position=vec4(position.xy,1.0,1.0);}",Zo=class extends t.ShaderMaterial{constructor(){super({name:"CopyMaterial",uniforms:{inputBuffer:new t.Uniform(null),opacity:new t.Uniform(1)},blending:t.NoBlending,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:"#include <common>\n#include <dithering_pars_fragment>\n#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D inputBuffer;\n#else\nuniform lowp sampler2D inputBuffer;\n#endif\nuniform float opacity;varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);gl_FragColor=opacity*texel;\n#include <colorspace_fragment>\n#include <dithering_fragment>\n}",vertexShader:Ko})}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}getOpacity(e){return this.uniforms.opacity.value}setOpacity(e){this.uniforms.opacity.value=e}},Qo=class extends qo{constructor(e,r=!0){super("CopyPass"),this.fullscreenMaterial=new Zo,this.needsSwap=!1,this.renderTarget=e,void 0===e&&(this.renderTarget=new t.WebGLRenderTarget(1,1,{minFilter:t.LinearFilter,magFilter:t.LinearFilter,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="CopyPass.Target"),this.autoResize=r}get resize(){return this.autoResize}set resize(e){this.autoResize=e}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}setAutoResizeEnabled(e){this.autoResize=e}render(e,t,r,n,i){this.fullscreenMaterial.inputBuffer=t.texture,e.setRenderTarget(this.renderToScreen?null:this.renderTarget),e.render(this.scene,this.camera)}setSize(e,t){this.autoResize&&this.renderTarget.setSize(e,t)}initialize(e,r,n){void 0!==n&&(this.renderTarget.texture.type=n,n!==t.UnsignedByteType?this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1":null!==e&&e.outputColorSpace===t.SRGBColorSpace&&(this.renderTarget.texture.colorSpace=t.SRGBColorSpace))}},$o=new t.Color,es=class extends qo{constructor(e=!0,t=!0,r=!1){super("ClearPass",null,null),this.needsSwap=!1,this.color=e,this.depth=t,this.stencil=r,this.overrideClearColor=null,this.overrideClearAlpha=-1}setClearFlags(e,t,r){this.color=e,this.depth=t,this.stencil=r}getOverrideClearColor(){return this.overrideClearColor}setOverrideClearColor(e){this.overrideClearColor=e}getOverrideClearAlpha(){return this.overrideClearAlpha}setOverrideClearAlpha(e){this.overrideClearAlpha=e}render(e,t,r,n,i){const o=this.overrideClearColor,s=this.overrideClearAlpha,a=e.getClearAlpha(),c=null!==o,l=s>=0;c?(e.getClearColor($o),e.setClearColor(o,l?s:a)):l&&e.setClearAlpha(s),e.setRenderTarget(this.renderToScreen?null:t),e.clear(this.color,this.depth,this.stencil),c?e.setClearColor($o,a):l&&e.setClearAlpha(a)}},ts=class extends qo{constructor(e,t){super("MaskPass",e,t),this.needsSwap=!1,this.clearPass=new es(!1,!1,!0),this.inverse=!1}set mainScene(e){this.scene=e}set mainCamera(e){this.camera=e}get inverted(){return this.inverse}set inverted(e){this.inverse=e}get clear(){return this.clearPass.enabled}set clear(e){this.clearPass.enabled=e}getClearPass(){return this.clearPass}isInverted(){return this.inverted}setInverted(e){this.inverted=e}render(e,t,r,n,i){const o=e.getContext(),s=e.state.buffers,a=this.scene,c=this.camera,l=this.clearPass,u=this.inverted?0:1,h=1-u;s.color.setMask(!1),s.depth.setMask(!1),s.color.setLocked(!0),s.depth.setLocked(!0),s.stencil.setTest(!0),s.stencil.setOp(o.REPLACE,o.REPLACE,o.REPLACE),s.stencil.setFunc(o.ALWAYS,u,4294967295),s.stencil.setClear(h),s.stencil.setLocked(!0),this.clearPass.enabled&&(this.renderToScreen?l.render(e,null):(l.render(e,t),l.render(e,r))),this.renderToScreen?(e.setRenderTarget(null),e.render(a,c)):(e.setRenderTarget(t),e.render(a,c),e.setRenderTarget(r),e.render(a,c)),s.color.setLocked(!1),s.depth.setLocked(!1),s.stencil.setLocked(!1),s.stencil.setFunc(o.EQUAL,1,4294967295),s.stencil.setOp(o.KEEP,o.KEEP,o.KEEP),s.stencil.setLocked(!0)}},rs=class{constructor(e=null,{depthBuffer:t=!0,stencilBuffer:r=!1,multisampling:n=0,frameBufferType:i}={}){this.renderer=null,this.inputBuffer=this.createBuffer(t,r,i,n),this.outputBuffer=this.inputBuffer.clone(),this.copyPass=new Qo,this.depthTexture=null,this.passes=[],this.timer=new Xo,this.autoRenderToScreen=!0,this.setRenderer(e)}get multisampling(){return this.inputBuffer.samples||0}set multisampling(e){const t=this.inputBuffer,r=this.multisampling;r>0&&e>0?(this.inputBuffer.samples=e,this.outputBuffer.samples=e,this.inputBuffer.dispose(),this.outputBuffer.dispose()):r!==e&&(this.inputBuffer.dispose(),this.outputBuffer.dispose(),this.inputBuffer=this.createBuffer(t.depthBuffer,t.stencilBuffer,t.texture.type,e),this.inputBuffer.depthTexture=this.depthTexture,this.outputBuffer=this.inputBuffer.clone())}getTimer(){return this.timer}getRenderer(){return this.renderer}setRenderer(e){if(this.renderer=e,null!==e){const r=e.getSize(new t.Vector2),n=e.getContext().getContextAttributes().alpha,i=this.inputBuffer.texture.type;i===t.UnsignedByteType&&e.outputColorSpace===t.SRGBColorSpace&&(this.inputBuffer.texture.colorSpace=t.SRGBColorSpace,this.outputBuffer.texture.colorSpace=t.SRGBColorSpace,this.inputBuffer.dispose(),this.outputBuffer.dispose()),e.autoClear=!1,this.setSize(r.width,r.height);for(const t of this.passes)t.initialize(e,n,i)}}replaceRenderer(e,t=!0){const r=this.renderer,n=r.domElement.parentNode;return this.setRenderer(e),t&&null!==n&&(n.removeChild(r.domElement),n.appendChild(e.domElement)),r}createDepthTexture(){const e=this.depthTexture=new t.DepthTexture;return this.inputBuffer.depthTexture=e,this.inputBuffer.dispose(),this.inputBuffer.stencilBuffer?(e.format=t.DepthStencilFormat,e.type=t.UnsignedInt248Type):e.type=t.UnsignedIntType,e}deleteDepthTexture(){if(null!==this.depthTexture){this.depthTexture.dispose(),this.depthTexture=null,this.inputBuffer.depthTexture=null,this.inputBuffer.dispose();for(const e of this.passes)e.setDepthTexture(null)}}createBuffer(e,r,n,i){const o=this.renderer,s=null===o?new t.Vector2:o.getDrawingBufferSize(new t.Vector2),a={minFilter:t.LinearFilter,magFilter:t.LinearFilter,stencilBuffer:r,depthBuffer:e,type:n},c=new t.WebGLRenderTarget(s.width,s.height,a);return i>0&&(c.ignoreDepthForMultisampleCopy=!1,c.samples=i),n===t.UnsignedByteType&&null!==o&&o.outputColorSpace===t.SRGBColorSpace&&(c.texture.colorSpace=t.SRGBColorSpace),c.texture.name="EffectComposer.Buffer",c.texture.generateMipmaps=!1,c}setMainScene(e){for(const t of this.passes)t.mainScene=e}setMainCamera(e){for(const t of this.passes)t.mainCamera=e}addPass(e,r){const n=this.passes,i=this.renderer,o=i.getDrawingBufferSize(new t.Vector2),s=i.getContext().getContextAttributes().alpha,a=this.inputBuffer.texture.type;if(e.setRenderer(i),e.setSize(o.width,o.height),e.initialize(i,s,a),this.autoRenderToScreen&&(n.length>0&&(n[n.length-1].renderToScreen=!1),e.renderToScreen&&(this.autoRenderToScreen=!1)),void 0!==r?n.splice(r,0,e):n.push(e),this.autoRenderToScreen&&(n[n.length-1].renderToScreen=!0),e.needsDepthTexture||null!==this.depthTexture)if(null===this.depthTexture){const t=this.createDepthTexture();for(e of n)e.setDepthTexture(t)}else e.setDepthTexture(this.depthTexture)}removePass(e){const t=this.passes,r=t.indexOf(e);if(-1!==r&&t.splice(r,1).length>0){if(null!==this.depthTexture){const r=(e,t)=>e||t.needsDepthTexture;t.reduce(r,!1)||(e.getDepthTexture()===this.depthTexture&&e.setDepthTexture(null),this.deleteDepthTexture())}this.autoRenderToScreen&&r===t.length&&(e.renderToScreen=!1,t.length>0&&(t[t.length-1].renderToScreen=!0))}}removeAllPasses(){const e=this.passes;this.deleteDepthTexture(),e.length>0&&(this.autoRenderToScreen&&(e[e.length-1].renderToScreen=!1),this.passes=[])}render(e){const t=this.renderer,r=this.copyPass;let n,i,o,s=this.inputBuffer,a=this.outputBuffer,c=!1;void 0===e&&(this.timer.update(),e=this.timer.getDelta());for(const l of this.passes)l.enabled&&(l.render(t,s,a,e,c),l.needsSwap&&(c&&(r.renderToScreen=l.renderToScreen,n=t.getContext(),i=t.state.buffers.stencil,i.setFunc(n.NOTEQUAL,1,4294967295),r.render(t,s,a,e,c),i.setFunc(n.EQUAL,1,4294967295)),o=s,s=a,a=o),l instanceof ts?c=!0:l instanceof Jo&&(c=!1))}setSize(e,r,n){const i=this.renderer,o=i.getSize(new t.Vector2);void 0!==e&&void 0!==r||(e=o.width,r=o.height),o.width===e&&o.height===r||i.setSize(e,r,n);const s=i.getDrawingBufferSize(new t.Vector2);this.inputBuffer.setSize(s.width,s.height),this.outputBuffer.setSize(s.width,s.height);for(const e of this.passes)e.setSize(s.width,s.height)}reset(){this.dispose(),this.autoRenderToScreen=!0}dispose(){for(const e of this.passes)e.dispose();this.passes=[],null!==this.inputBuffer&&this.inputBuffer.dispose(),null!==this.outputBuffer&&this.outputBuffer.dispose(),this.deleteDepthTexture(),this.copyPass.dispose(),this.timer.dispose(),qo.fullscreenGeometry.dispose()}},ns=0,is=1,os=2,ss={FRAGMENT_HEAD:"FRAGMENT_HEAD",FRAGMENT_MAIN_UV:"FRAGMENT_MAIN_UV",FRAGMENT_MAIN_IMAGE:"FRAGMENT_MAIN_IMAGE",VERTEX_HEAD:"VERTEX_HEAD",VERTEX_MAIN_SUPPORT:"VERTEX_MAIN_SUPPORT"},as=class{constructor(){this.shaderParts=new Map([[ss.FRAGMENT_HEAD,null],[ss.FRAGMENT_MAIN_UV,null],[ss.FRAGMENT_MAIN_IMAGE,null],[ss.VERTEX_HEAD,null],[ss.VERTEX_MAIN_SUPPORT,null]]),this.defines=new Map,this.uniforms=new Map,this.blendModes=new Map,this.extensions=new Set,this.attributes=ns,this.varyings=new Set,this.uvTransformation=!1,this.readDepth=!1,this.colorSpace=t.LinearSRGBColorSpace}};var cs=!1,ls=class{constructor(e=null){this.originalMaterials=new Map,this.material=null,this.materials=null,this.materialsBackSide=null,this.materialsDoubleSide=null,this.materialsFlatShaded=null,this.materialsFlatShadedBackSide=null,this.materialsFlatShadedDoubleSide=null,this.setMaterial(e),this.meshCount=0,this.replaceMaterial=e=>{if(e.isMesh){let r;if(e.material.flatShading)switch(e.material.side){case t.DoubleSide:r=this.materialsFlatShadedDoubleSide;break;case t.BackSide:r=this.materialsFlatShadedBackSide;break;default:r=this.materialsFlatShaded}else switch(e.material.side){case t.DoubleSide:r=this.materialsDoubleSide;break;case t.BackSide:r=this.materialsBackSide;break;default:r=this.materials}this.originalMaterials.set(e,e.material),e.isSkinnedMesh?e.material=r[2]:e.isInstancedMesh?e.material=r[1]:e.material=r[0],++this.meshCount}}}cloneMaterial(e){if(!(e instanceof t.ShaderMaterial))return e.clone();const r=e.uniforms,n=new Map;for(const e in r){const t=r[e].value;t.isRenderTargetTexture&&(r[e].value=null,n.set(e,t))}const i=e.clone();for(const e of n)r[e[0]].value=e[1],i.uniforms[e[0]].value=e[1];return i}setMaterial(e){if(this.disposeMaterials(),this.material=e,null!==e){const r=this.materials=[this.cloneMaterial(e),this.cloneMaterial(e),this.cloneMaterial(e)];for(const n of r)n.uniforms=Object.assign({},e.uniforms),n.side=t.FrontSide;r[2].skinning=!0,this.materialsBackSide=r.map((r=>{const n=this.cloneMaterial(r);return n.uniforms=Object.assign({},e.uniforms),n.side=t.BackSide,n})),this.materialsDoubleSide=r.map((r=>{const n=this.cloneMaterial(r);return n.uniforms=Object.assign({},e.uniforms),n.side=t.DoubleSide,n})),this.materialsFlatShaded=r.map((t=>{const r=this.cloneMaterial(t);return r.uniforms=Object.assign({},e.uniforms),r.flatShading=!0,r})),this.materialsFlatShadedBackSide=r.map((r=>{const n=this.cloneMaterial(r);return n.uniforms=Object.assign({},e.uniforms),n.flatShading=!0,n.side=t.BackSide,n})),this.materialsFlatShadedDoubleSide=r.map((r=>{const n=this.cloneMaterial(r);return n.uniforms=Object.assign({},e.uniforms),n.flatShading=!0,n.side=t.DoubleSide,n}))}}render(e,t,r){const n=e.shadowMap.enabled;if(e.shadowMap.enabled=!1,cs){const n=this.originalMaterials;this.meshCount=0,t.traverse(this.replaceMaterial),e.render(t,r);for(const e of n)e[0].material=e[1];this.meshCount!==n.size&&n.clear()}else{const n=t.overrideMaterial;t.overrideMaterial=this.material,e.render(t,r),t.overrideMaterial=n}e.shadowMap.enabled=n}disposeMaterials(){if(null!==this.material){const e=this.materials.concat(this.materialsBackSide).concat(this.materialsDoubleSide).concat(this.materialsFlatShaded).concat(this.materialsFlatShadedBackSide).concat(this.materialsFlatShadedDoubleSide);for(const t of e)t.dispose()}}dispose(){this.originalMaterials.clear(),this.disposeMaterials()}static get workaroundEnabled(){return cs}static set workaroundEnabled(e){cs=e}},us=-1,hs=class extends t.EventDispatcher{constructor(e,r=-1,n=-1,i=1){super(),this.resizable=e,this.baseSize=new t.Vector2(1,1),this.preferredSize=new t.Vector2(r,n),this.target=this.preferredSize,this.s=i,this.effectiveSize=new t.Vector2,this.addEventListener("change",(()=>this.updateEffectiveSize())),this.updateEffectiveSize()}updateEffectiveSize(){const e=this.baseSize,t=this.preferredSize,r=this.effectiveSize,n=this.scale;t.width!==us?r.width=t.width:t.height!==us?r.width=Math.round(t.height*(e.width/Math.max(e.height,1))):r.width=Math.round(e.width*n),t.height!==us?r.height=t.height:t.width!==us?r.height=Math.round(t.width/Math.max(e.width/Math.max(e.height,1),1)):r.height=Math.round(e.height*n)}get width(){return this.effectiveSize.width}set width(e){this.preferredWidth=e}get height(){return this.effectiveSize.height}set height(e){this.preferredHeight=e}getWidth(){return this.width}getHeight(){return this.height}get scale(){return this.s}set scale(e){this.s!==e&&(this.s=e,this.preferredSize.setScalar(us),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getScale(){return this.scale}setScale(e){this.scale=e}get baseWidth(){return this.baseSize.width}set baseWidth(e){this.baseSize.width!==e&&(this.baseSize.width=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getBaseWidth(){return this.baseWidth}setBaseWidth(e){this.baseWidth=e}get baseHeight(){return this.baseSize.height}set baseHeight(e){this.baseSize.height!==e&&(this.baseSize.height=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getBaseHeight(){return this.baseHeight}setBaseHeight(e){this.baseHeight=e}setBaseSize(e,t){this.baseSize.width===e&&this.baseSize.height===t||(this.baseSize.set(e,t),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}get preferredWidth(){return this.preferredSize.width}set preferredWidth(e){this.preferredSize.width!==e&&(this.preferredSize.width=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getPreferredWidth(){return this.preferredWidth}setPreferredWidth(e){this.preferredWidth=e}get preferredHeight(){return this.preferredSize.height}set preferredHeight(e){this.preferredSize.height!==e&&(this.preferredSize.height=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getPreferredHeight(){return this.preferredHeight}setPreferredHeight(e){this.preferredHeight=e}setPreferredSize(e,t){this.preferredSize.width===e&&this.preferredSize.height===t||(this.preferredSize.set(e,t),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}copy(e){this.s=e.scale,this.baseSize.set(e.baseWidth,e.baseHeight),this.preferredSize.set(e.preferredWidth,e.preferredHeight),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height)}static get AUTO_SIZE(){return us}},ps={SKIP:9,SET:30,ADD:0,ALPHA:1,AVERAGE:2,COLOR:3,COLOR_BURN:4,COLOR_DODGE:5,DARKEN:6,DIFFERENCE:7,DIVIDE:8,DST:9,EXCLUSION:10,HARD_LIGHT:11,HARD_MIX:12,HUE:13,INVERT:14,INVERT_RGB:15,LIGHTEN:16,LINEAR_BURN:17,LINEAR_DODGE:18,LINEAR_LIGHT:19,LUMINOSITY:20,MULTIPLY:21,NEGATION:22,NORMAL:23,OVERLAY:24,PIN_LIGHT:25,REFLECT:26,SATURATION:27,SCREEN:28,SOFT_LIGHT:29,SRC:30,SUBTRACT:31,VIVID_LIGHT:32},ds=new Map([[ps.ADD,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x+y,opacity);}"],[ps.ALPHA,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y,min(y.a,opacity));}"],[ps.AVERAGE,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,(x+y)*0.5,opacity);}"],[ps.COLOR,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(yHSL.rg,xHSL.b));return vec4(mix(x.rgb,z,opacity),y.a);}"],[ps.COLOR_BURN,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(step(0.0,y)*(1.0-min(vec4(1.0),(1.0-x)/y)),vec4(1.0),step(1.0,x));return mix(x,z,opacity);}"],[ps.COLOR_DODGE,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=step(0.0,x)*mix(min(vec4(1.0),x/max(1.0-y,1e-9)),vec4(1.0),step(1.0,y));return mix(x,z,opacity);}"],[ps.DARKEN,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,min(x,y),opacity);}"],[ps.DIFFERENCE,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,abs(x-y),opacity);}"],[ps.DIVIDE,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x/max(y,1e-12),opacity);}"],[ps.DST,null],[ps.EXCLUSION,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,(x+y-2.0*x*y),opacity);}"],[ps.HARD_LIGHT,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 a=min(x,1.0),b=min(y,1.0);vec4 z=mix(2.0*a*b,1.0-2.0*(1.0-a)*(1.0-b),step(0.5,y));return mix(x,z,opacity);}"],[ps.HARD_MIX,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,step(1.0,x+y),opacity);}"],[ps.HUE,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(yHSL.r,xHSL.gb));return vec4(mix(x.rgb,z,opacity),y.a);}"],[ps.INVERT,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,1.0-y,opacity);}"],[ps.INVERT_RGB,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y*(1.0-x),opacity);}"],[ps.LIGHTEN,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,max(x,y),opacity);}"],[ps.LINEAR_BURN,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,clamp(y+x-1.0,0.0,1.0),opacity);}"],[ps.LINEAR_DODGE,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,min(x+y,1.0),opacity);}"],[ps.LINEAR_LIGHT,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,clamp(2.0*y+x-1.0,0.0,1.0),opacity);}"],[ps.LUMINOSITY,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(xHSL.rg,yHSL.b));return vec4(mix(x.rgb,z,opacity),y.a);}"],[ps.MULTIPLY,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x*y,opacity);}"],[ps.NEGATION,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,1.0-abs(1.0-x-y),opacity);}"],[ps.NORMAL,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y,opacity);}"],[ps.OVERLAY,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(2.0*y*x,1.0-2.0*(1.0-y)*(1.0-x),step(0.5,x));return mix(x,z,opacity);}"],[ps.PIN_LIGHT,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 y2=2.0*y;vec4 z=mix(mix(y2,x,step(0.5*x,y)),max(vec4(0.0),y2-1.0),step(x,(y2-1.0)));return mix(x,z,opacity);}"],[ps.REFLECT,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(min(x*x/max(1.0-y,1e-12),1.0),y,step(1.0,y));return mix(x,z,opacity);}"],[ps.SATURATION,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(xHSL.r,yHSL.g,xHSL.b));return vec4(mix(x.rgb,z,opacity),y.a);}"],[ps.SCREEN,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x+y-min(x*y,1.0),opacity);}"],[ps.SOFT_LIGHT,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 y2=2.0*y;vec4 w=step(0.5,y);vec4 z=mix(x-(1.0-y2)*x*(1.0-x),mix(x+(y2-1.0)*(sqrt(x)-x),x+(y2-1.0)*x*((16.0*x-12.0)*x+3.0),w*(1.0-step(0.25,x))),w);return mix(x,z,opacity);}"],[ps.SRC,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return y;}"],[ps.SUBTRACT,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,max(x+y-1.0,0.0),opacity);}"],[ps.VIVID_LIGHT,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(max(1.0-min((1.0-x)/(2.0*y),1.0),0.0),min(x/(2.0*(1.0-y)),1.0),step(0.5,y));return mix(x,z,opacity);}"]]),fs=class extends t.EventDispatcher{constructor(e,r=1){super(),this._blendFunction=e,this.opacity=new t.Uniform(r)}getOpacity(){return this.opacity.value}setOpacity(e){this.opacity.value=e}get blendFunction(){return this._blendFunction}set blendFunction(e){this._blendFunction=e,this.dispatchEvent({type:"change"})}getBlendFunction(){return this.blendFunction}setBlendFunction(e){this.blendFunction=e}getShaderCode(){return ds.get(this.blendFunction)}},ms=2,gs=3,ys=[new Float32Array([0,0]),new Float32Array([0,1,1]),new Float32Array([0,1,1,2]),new Float32Array([0,1,2,2,3]),new Float32Array([0,1,2,3,4,4,5]),new Float32Array([0,1,2,3,4,5,7,8,9,10])],vs=class extends t.ShaderMaterial{constructor(e=new t.Vector4){super({name:"KawaseBlurMaterial",uniforms:{inputBuffer:new t.Uniform(null),texelSize:new t.Uniform(new t.Vector4),scale:new t.Uniform(1),kernel:new t.Uniform(0)},blending:t.NoBlending,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:"#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D inputBuffer;\n#else\nuniform lowp sampler2D inputBuffer;\n#endif\nvarying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec4 sum=texture2D(inputBuffer,vUv0);sum+=texture2D(inputBuffer,vUv1);sum+=texture2D(inputBuffer,vUv2);sum+=texture2D(inputBuffer,vUv3);gl_FragColor=sum*0.25;\n#include <colorspace_fragment>\n}",vertexShader:"uniform vec4 texelSize;uniform float kernel;uniform float scale;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vec2 dUv=(texelSize.xy*vec2(kernel)+texelSize.zw)*scale;vUv0=vec2(uv.x-dUv.x,uv.y+dUv.y);vUv1=vec2(uv.x+dUv.x,uv.y+dUv.y);vUv2=vec2(uv.x+dUv.x,uv.y-dUv.y);vUv3=vec2(uv.x-dUv.x,uv.y-dUv.y);gl_Position=vec4(position.xy,1.0,1.0);}"}),this.setTexelSize(e.x,e.y),this.kernelSize=ms}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.inputBuffer=e}get kernelSequence(){return ys[this.kernelSize]}get scale(){return this.uniforms.scale.value}set scale(e){this.uniforms.scale.value=e}getScale(){return this.uniforms.scale.value}setScale(e){this.uniforms.scale.value=e}getKernel(){return null}get kernel(){return this.uniforms.kernel.value}set kernel(e){this.uniforms.kernel.value=e}setKernel(e){this.kernel=e}setTexelSize(e,t){this.uniforms.texelSize.value.set(e,t,.5*e,.5*t)}setSize(e,t){const r=1/e,n=1/t;this.uniforms.texelSize.value.set(r,n,.5*r,.5*n)}},_s=class extends qo{constructor({kernelSize:e=ms,resolutionScale:r=.5,width:n=hs.AUTO_SIZE,height:i=hs.AUTO_SIZE,resolutionX:o=n,resolutionY:s=i}={}){super("KawaseBlurPass"),this.renderTargetA=new t.WebGLRenderTarget(1,1,{depthBuffer:!1}),this.renderTargetA.texture.name="Blur.Target.A",this.renderTargetB=this.renderTargetA.clone(),this.renderTargetB.texture.name="Blur.Target.B";const a=this.resolution=new hs(this,o,s,r);a.addEventListener("change",(e=>this.setSize(a.baseWidth,a.baseHeight))),this._blurMaterial=new vs,this._blurMaterial.kernelSize=e,this.copyMaterial=new Zo}getResolution(){return this.resolution}get blurMaterial(){return this._blurMaterial}set blurMaterial(e){this._blurMaterial=e}get dithering(){return this.copyMaterial.dithering}set dithering(e){this.copyMaterial.dithering=e}get kernelSize(){return this.blurMaterial.kernelSize}set kernelSize(e){this.blurMaterial.kernelSize=e}get width(){return this.resolution.width}set width(e){this.resolution.preferredWidth=e}get height(){return this.resolution.height}set height(e){this.resolution.preferredHeight=e}get scale(){return this.blurMaterial.scale}set scale(e){this.blurMaterial.scale=e}getScale(){return this.blurMaterial.scale}setScale(e){this.blurMaterial.scale=e}getKernelSize(){return this.kernelSize}setKernelSize(e){this.kernelSize=e}getResolutionScale(){return this.resolution.scale}setResolutionScale(e){this.resolution.scale=e}render(e,t,r,n,i){const o=this.scene,s=this.camera,a=this.renderTargetA,c=this.renderTargetB,l=this.blurMaterial,u=l.kernelSequence;let h=t;this.fullscreenMaterial=l;for(let t=0,r=u.length;t<r;++t){const r=0==(1&t)?a:c;l.kernel=u[t],l.inputBuffer=h.texture,e.setRenderTarget(r),e.render(o,s),h=r}this.fullscreenMaterial=this.copyMaterial,this.copyMaterial.inputBuffer=h.texture,e.setRenderTarget(this.renderToScreen?null:r),e.render(o,s)}setSize(e,t){const r=this.resolution;r.setBaseSize(e,t);const n=r.width,i=r.height;this.renderTargetA.setSize(n,i),this.renderTargetB.setSize(n,i),this.blurMaterial.setSize(e,t)}initialize(e,r,n){void 0!==n&&(this.renderTargetA.texture.type=n,this.renderTargetB.texture.type=n,n!==t.UnsignedByteType?(this.blurMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.copyMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1"):null!==e&&e.outputColorSpace===t.SRGBColorSpace&&(this.renderTargetA.texture.colorSpace=t.SRGBColorSpace,this.renderTargetB.texture.colorSpace=t.SRGBColorSpace))}static get AUTO_SIZE(){return hs.AUTO_SIZE}},bs=class extends t.ShaderMaterial{constructor(e=!1,r=null){super({name:"LuminanceMaterial",defines:{THREE_REVISION:t.REVISION.replace(/\D+/g,"")},uniforms:{inputBuffer:new t.Uniform(null),threshold:new t.Uniform(0),smoothing:new t.Uniform(1),range:new t.Uniform(null)},blending:t.NoBlending,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:"#include <common>\n#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D inputBuffer;\n#else\nuniform lowp sampler2D inputBuffer;\n#endif\n#ifdef RANGE\nuniform vec2 range;\n#elif defined(THRESHOLD)\nuniform float threshold;uniform float smoothing;\n#endif\nvarying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);float l=luminance(texel.rgb);\n#ifdef RANGE\nfloat low=step(range.x,l);float high=step(l,range.y);l*=low*high;\n#elif defined(THRESHOLD)\nl=smoothstep(threshold,threshold+smoothing,l)*l;\n#endif\n#ifdef COLOR\ngl_FragColor=vec4(texel.rgb*clamp(l,0.0,1.0),l);\n#else\ngl_FragColor=vec4(l);\n#endif\n}",vertexShader:Ko}),this.colorOutput=e,this.luminanceRange=r}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}get threshold(){return this.uniforms.threshold.value}set threshold(e){this.smoothing>0||e>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.threshold.value=e}getThreshold(){return this.threshold}setThreshold(e){this.threshold=e}get smoothing(){return this.uniforms.smoothing.value}set smoothing(e){this.threshold>0||e>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.smoothing.value=e}getSmoothingFactor(){return this.smoothing}setSmoothingFactor(e){this.smoothing=e}get useThreshold(){return this.threshold>0||this.smoothing>0}set useThreshold(e){}get colorOutput(){return void 0!==this.defines.COLOR}set colorOutput(e){e?this.defines.COLOR="1":delete this.defines.COLOR,this.needsUpdate=!0}isColorOutputEnabled(e){return this.colorOutput}setColorOutputEnabled(e){this.colorOutput=e}get useRange(){return null!==this.luminanceRange}set useRange(e){this.luminanceRange=null}get luminanceRange(){return this.uniforms.range.value}set luminanceRange(e){null!==e?this.defines.RANGE="1":delete this.defines.RANGE,this.uniforms.range.value=e,this.needsUpdate=!0}getLuminanceRange(){return this.luminanceRange}setLuminanceRange(e){this.luminanceRange=e}},xs=class extends qo{constructor({renderTarget:e,luminanceRange:r,colorOutput:n,resolutionScale:i=1,width:o=hs.AUTO_SIZE,height:s=hs.AUTO_SIZE,resolutionX:a=o,resolutionY:c=s}={}){super("LuminancePass"),this.fullscreenMaterial=new bs(n,r),this.needsSwap=!1,this.renderTarget=e,void 0===this.renderTarget&&(this.renderTarget=new t.WebGLRenderTarget(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="LuminancePass.Target");const l=this.resolution=new hs(this,a,c,i);l.addEventListener("change",(e=>this.setSize(l.baseWidth,l.baseHeight)))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}render(e,t,r,n,i){this.fullscreenMaterial.inputBuffer=t.texture,e.setRenderTarget(this.renderToScreen?null:this.renderTarget),e.render(this.scene,this.camera)}setSize(e,t){const r=this.resolution;r.setBaseSize(e,t),this.renderTarget.setSize(r.width,r.height)}initialize(e,r,n){void 0!==n&&n!==t.UnsignedByteType&&(this.renderTarget.texture.type=n,this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},ws=class extends t.ShaderMaterial{constructor(){super({name:"DownsamplingMaterial",uniforms:{inputBuffer:new t.Uniform(null),texelSize:new t.Uniform(new t.Vector2)},blending:t.NoBlending,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:"#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D inputBuffer;\n#else\nuniform lowp sampler2D inputBuffer;\n#endif\n#define WEIGHT_INNER 0.125\n#define WEIGHT_OUTER 0.0555555\nvarying vec2 vUv;varying vec2 vUv00;varying vec2 vUv01;varying vec2 vUv02;varying vec2 vUv03;varying vec2 vUv04;varying vec2 vUv05;varying vec2 vUv06;varying vec2 vUv07;varying vec2 vUv08;varying vec2 vUv09;varying vec2 vUv10;varying vec2 vUv11;float clampToBorder(const in vec2 uv){return float(uv.s>=0.0&&uv.s<=1.0&&uv.t>=0.0&&uv.t<=1.0);}void main(){vec4 c=vec4(0.0);vec4 w=WEIGHT_INNER*vec4(clampToBorder(vUv00),clampToBorder(vUv01),clampToBorder(vUv02),clampToBorder(vUv03));c+=w.x*texture2D(inputBuffer,vUv00);c+=w.y*texture2D(inputBuffer,vUv01);c+=w.z*texture2D(inputBuffer,vUv02);c+=w.w*texture2D(inputBuffer,vUv03);w=WEIGHT_OUTER*vec4(clampToBorder(vUv04),clampToBorder(vUv05),clampToBorder(vUv06),clampToBorder(vUv07));c+=w.x*texture2D(inputBuffer,vUv04);c+=w.y*texture2D(inputBuffer,vUv05);c+=w.z*texture2D(inputBuffer,vUv06);c+=w.w*texture2D(inputBuffer,vUv07);w=WEIGHT_OUTER*vec4(clampToBorder(vUv08),clampToBorder(vUv09),clampToBorder(vUv10),clampToBorder(vUv11));c+=w.x*texture2D(inputBuffer,vUv08);c+=w.y*texture2D(inputBuffer,vUv09);c+=w.z*texture2D(inputBuffer,vUv10);c+=w.w*texture2D(inputBuffer,vUv11);c+=WEIGHT_OUTER*texture2D(inputBuffer,vUv);gl_FragColor=c;\n#include <colorspace_fragment>\n}",vertexShader:"uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv00;varying vec2 vUv01;varying vec2 vUv02;varying vec2 vUv03;varying vec2 vUv04;varying vec2 vUv05;varying vec2 vUv06;varying vec2 vUv07;varying vec2 vUv08;varying vec2 vUv09;varying vec2 vUv10;varying vec2 vUv11;void main(){vUv=position.xy*0.5+0.5;vUv00=vUv+texelSize*vec2(-1.0,1.0);vUv01=vUv+texelSize*vec2(1.0,1.0);vUv02=vUv+texelSize*vec2(-1.0,-1.0);vUv03=vUv+texelSize*vec2(1.0,-1.0);vUv04=vUv+texelSize*vec2(-2.0,2.0);vUv05=vUv+texelSize*vec2(0.0,2.0);vUv06=vUv+texelSize*vec2(2.0,2.0);vUv07=vUv+texelSize*vec2(-2.0,0.0);vUv08=vUv+texelSize*vec2(2.0,0.0);vUv09=vUv+texelSize*vec2(-2.0,-2.0);vUv10=vUv+texelSize*vec2(0.0,-2.0);vUv11=vUv+texelSize*vec2(2.0,-2.0);gl_Position=vec4(position.xy,1.0,1.0);}"})}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setSize(e,t){this.uniforms.texelSize.value.set(1/e,1/t)}},Ss=class extends t.ShaderMaterial{constructor(){super({name:"UpsamplingMaterial",uniforms:{inputBuffer:new t.Uniform(null),supportBuffer:new t.Uniform(null),texelSize:new t.Uniform(new t.Vector2),radius:new t.Uniform(.85)},blending:t.NoBlending,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:"#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D inputBuffer;uniform mediump sampler2D supportBuffer;\n#else\nuniform lowp sampler2D inputBuffer;uniform lowp sampler2D supportBuffer;\n#endif\nuniform float radius;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;varying vec2 vUv6;varying vec2 vUv7;void main(){vec4 c=vec4(0.0);c+=texture2D(inputBuffer,vUv0)*0.0625;c+=texture2D(inputBuffer,vUv1)*0.125;c+=texture2D(inputBuffer,vUv2)*0.0625;c+=texture2D(inputBuffer,vUv3)*0.125;c+=texture2D(inputBuffer,vUv)*0.25;c+=texture2D(inputBuffer,vUv4)*0.125;c+=texture2D(inputBuffer,vUv5)*0.0625;c+=texture2D(inputBuffer,vUv6)*0.125;c+=texture2D(inputBuffer,vUv7)*0.0625;vec4 baseColor=texture2D(supportBuffer,vUv);gl_FragColor=mix(baseColor,c,radius);\n#include <colorspace_fragment>\n}",vertexShader:"uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;varying vec2 vUv6;varying vec2 vUv7;void main(){vUv=position.xy*0.5+0.5;vUv0=vUv+texelSize*vec2(-1.0,1.0);vUv1=vUv+texelSize*vec2(0.0,1.0);vUv2=vUv+texelSize*vec2(1.0,1.0);vUv3=vUv+texelSize*vec2(-1.0,0.0);vUv4=vUv+texelSize*vec2(1.0,0.0);vUv5=vUv+texelSize*vec2(-1.0,-1.0);vUv6=vUv+texelSize*vec2(0.0,-1.0);vUv7=vUv+texelSize*vec2(1.0,-1.0);gl_Position=vec4(position.xy,1.0,1.0);}"})}set inputBuffer(e){this.uniforms.inputBuffer.value=e}set supportBuffer(e){this.uniforms.supportBuffer.value=e}get radius(){return this.uniforms.radius.value}set radius(e){this.uniforms.radius.value=e}setSize(e,t){this.uniforms.texelSize.value.set(1/e,1/t)}},Ms=class extends qo{constructor(){super("MipmapBlurPass"),this.needsSwap=!1,this.renderTarget=new t.WebGLRenderTarget(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="Upsampling.Mipmap0",this.downsamplingMipmaps=[],this.upsamplingMipmaps=[],this.downsamplingMaterial=new ws,this.upsamplingMaterial=new Ss,this.resolution=new t.Vector2}get texture(){return this.renderTarget.texture}get levels(){return this.downsamplingMipmaps.length}set levels(e){if(this.levels!==e){const t=this.renderTarget;this.dispose(),this.downsamplingMipmaps=[],this.upsamplingMipmaps=[];for(let r=0;r<e;++r){const e=t.clone();e.texture.name="Downsampling.Mipmap"+r,this.downsamplingMipmaps.push(e)}this.upsamplingMipmaps.push(t);for(let r=1,n=e-1;r<n;++r){const e=t.clone();e.texture.name="Upsampling.Mipmap"+r,this.upsamplingMipmaps.push(e)}this.setSize(this.resolution.x,this.resolution.y)}}get radius(){return this.upsamplingMaterial.radius}set radius(e){this.upsamplingMaterial.radius=e}render(e,t,r,n,i){const{scene:o,camera:s}=this,{downsamplingMaterial:a,upsamplingMaterial:c}=this,{downsamplingMipmaps:l,upsamplingMipmaps:u}=this;let h=t;this.fullscreenMaterial=a;for(let t=0,r=l.length;t<r;++t){const r=l[t];a.setSize(h.width,h.height),a.inputBuffer=h.texture,e.setRenderTarget(r),e.render(o,s),h=r}this.fullscreenMaterial=c;for(let t=u.length-1;t>=0;--t){const r=u[t];c.setSize(h.width,h.height),c.inputBuffer=h.texture,c.supportBuffer=l[t].texture,e.setRenderTarget(r),e.render(o,s),h=r}}setSize(e,t){const r=this.resolution;r.set(e,t);let n=r.width,i=r.height;for(let e=0,t=this.downsamplingMipmaps.length;e<t;++e)n=Math.round(.5*n),i=Math.round(.5*i),this.downsamplingMipmaps[e].setSize(n,i),e<this.upsamplingMipmaps.length&&this.upsamplingMipmaps[e].setSize(n,i)}initialize(e,r,n){if(void 0!==n){const r=this.downsamplingMipmaps.concat(this.upsamplingMipmaps);for(const e of r)e.texture.type=n;if(n!==t.UnsignedByteType)this.downsamplingMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.upsamplingMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1";else if(null!==e&&e.outputColorSpace===t.SRGBColorSpace)for(const e of r)e.texture.colorSpace=t.SRGBColorSpace}}dispose(){super.dispose();for(const e of this.downsamplingMipmaps.concat(this.upsamplingMipmaps))e.dispose()}},Ts=class extends t.EventDispatcher{constructor(e,r,{attributes:n=ns,blendFunction:i=ps.NORMAL,defines:o=new Map,uniforms:s=new Map,extensions:a=null,vertexShader:c=null}={}){super(),this.name=e,this.renderer=null,this.attributes=n,this.fragmentShader=r,this.vertexShader=c,this.defines=o,this.uniforms=s,this.extensions=a,this.blendMode=new fs(i),this.blendMode.addEventListener("change",(e=>this.setChanged())),this._inputColorSpace=t.LinearSRGBColorSpace,this._outputColorSpace=t.NoColorSpace}get inputColorSpace(){return this._inputColorSpace}set inputColorSpace(e){this._inputColorSpace=e,this.setChanged()}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e,this.setChanged()}set mainScene(e){}set mainCamera(e){}getName(){return this.name}setRenderer(e){this.renderer=e}getDefines(){return this.defines}getUniforms(){return this.uniforms}getExtensions(){return this.extensions}getBlendMode(){return this.blendMode}getAttributes(){return this.attributes}setAttributes(e){this.attributes=e,this.setChanged()}getFragmentShader(){return this.fragmentShader}setFragmentShader(e){this.fragmentShader=e,this.setChanged()}getVertexShader(){return this.vertexShader}setVertexShader(e){this.vertexShader=e,this.setChanged()}setChanged(){this.dispatchEvent({type:"change"})}setDepthTexture(e,r=t.BasicDepthPacking){}update(e,t,r){}setSize(e,t){}initialize(e,t,r){}dispose(){for(const e of Object.keys(this)){const r=this[e];(r instanceof t.WebGLRenderTarget||r instanceof t.Material||r instanceof t.Texture||r instanceof qo)&&this[e].dispose()}}};var Es=0,As=1,Rs=2,Cs=3;var Is=class extends t.DataTexture{constructor(e,r,n=t.LuminanceFormat,i=t.UnsignedByteType){super(function(e,r,n){const i=new Map([[t.LuminanceFormat,1],[t.RedFormat,1],[t.RGFormat,2],[t.RGBAFormat,4]]);let o;if(i.has(r)||console.error("Invalid noise texture format"),n===t.UnsignedByteType){o=new Uint8Array(e*i.get(r));for(let e=0,t=o.length;e<t;++e)o[e]=255*Math.random()+.5}else{o=new Float32Array(e*i.get(r));for(let e=0,t=o.length;e<t;++e)o[e]=Math.random()}return o}(e*r,n,i),e,r,n,i),this.needsUpdate=!0}},Os="Glitch.Generated";function Ps(e,t){return e+Math.random()*(t-e)}var Ns=class extends Ts{constructor({chromaticAberrationOffset:e=null,delay:r=new t.Vector2(1.5,3.5),duration:n=new t.Vector2(.6,1),strength:i=new t.Vector2(.3,1),columns:o=.05,ratio:s=.85,perturbationMap:a=null,dtSize:c=64}={}){if(super("GlitchEffect","uniform lowp sampler2D perturbationMap;uniform bool active;uniform float columns;uniform float random;uniform vec2 seeds;uniform vec2 distortion;void mainUv(inout vec2 uv){if(active){if(uv.y<distortion.x+columns&&uv.y>distortion.x-columns*random){float sx=clamp(ceil(seeds.x),0.0,1.0);uv.y=sx*(1.0-(uv.y+distortion.y))+(1.0-sx)*distortion.y;}if(uv.x<distortion.y+columns&&uv.x>distortion.y-columns*random){float sy=clamp(ceil(seeds.y),0.0,1.0);uv.x=sy*distortion.x+(1.0-sy)*(1.0-(uv.x+distortion.x));}vec2 normal=texture2D(perturbationMap,uv*random*random).rg;uv+=normal*seeds*(random*0.2);}}",{uniforms:new Map([["perturbationMap",new t.Uniform(null)],["columns",new t.Uniform(o)],["active",new t.Uniform(!1)],["random",new t.Uniform(1)],["seeds",new t.Uniform(new t.Vector2)],["distortion",new t.Uniform(new t.Vector2)]])}),null===a){const e=new Is(c,c,t.RGBAFormat);e.name=Os,this.perturbationMap=e}else this.perturbationMap=a;this.time=0,this.distortion=this.uniforms.get("distortion").value,this.delay=r,this.duration=n,this.breakPoint=new t.Vector2(Ps(this.delay.x,this.delay.y),Ps(this.duration.x,this.duration.y)),this.strength=i,this.mode=As,this.ratio=s,this.chromaticAberrationOffset=e}get seeds(){return this.uniforms.get("seeds").value}get active(){return this.uniforms.get("active").value}isActive(){return this.active}get minDelay(){return this.delay.x}set minDelay(e){this.delay.x=e}getMinDelay(){return this.delay.x}setMinDelay(e){this.delay.x=e}get maxDelay(){return this.delay.y}set maxDelay(e){this.delay.y=e}getMaxDelay(){return this.delay.y}setMaxDelay(e){this.delay.y=e}get minDuration(){return this.duration.x}set minDuration(e){this.duration.x=e}getMinDuration(){return this.duration.x}setMinDuration(e){this.duration.x=e}get maxDuration(){return this.duration.y}set maxDuration(e){this.duration.y=e}getMaxDuration(){return this.duration.y}setMaxDuration(e){this.duration.y=e}get minStrength(){return this.strength.x}set minStrength(e){this.strength.x=e}getMinStrength(){return this.strength.x}setMinStrength(e){this.strength.x=e}get maxStrength(){return this.strength.y}set maxStrength(e){this.strength.y=e}getMaxStrength(){return this.strength.y}setMaxStrength(e){this.strength.y=e}getMode(){return this.mode}setMode(e){this.mode=e}getGlitchRatio(){return 1-this.ratio}setGlitchRatio(e){this.ratio=Math.min(Math.max(1-e,0),1)}get columns(){return this.uniforms.get("columns").value}set columns(e){this.uniforms.get("columns").value=e}getGlitchColumns(){return this.columns}setGlitchColumns(e){this.columns=e}getChromaticAberrationOffset(){return this.chromaticAberrationOffset}setChromaticAberrationOffset(e){this.chromaticAberrationOffset=e}get perturbationMap(){return this.uniforms.get("perturbationMap").value}set perturbationMap(e){const r=this.perturbationMap;null!==r&&r.name===Os&&r.dispose(),e.minFilter=e.magFilter=t.NearestFilter,e.wrapS=e.wrapT=t.RepeatWrapping,e.generateMipmaps=!1,this.uniforms.get("perturbationMap").value=e}getPerturbationMap(){return this.perturbationMap}setPerturbationMap(e){this.perturbationMap=e}generatePerturbationMap(e=64){const r=new Is(e,e,t.RGBAFormat);return r.name=Os,r}update(e,t,r){const n=this.mode,i=this.breakPoint,o=this.chromaticAberrationOffset,s=this.strength;let a,c=this.time,l=!1,u=0,h=0;n!==Es&&(n===As&&(c+=r,a=c>i.x,c>=i.x+i.y&&(i.set(Ps(this.delay.x,this.delay.y),Ps(this.duration.x,this.duration.y)),c=0)),u=Math.random(),this.uniforms.get("random").value=u,a&&u>this.ratio||n===Cs?(l=!0,u*=.03*s.y,h=Ps(-Math.PI,Math.PI),this.seeds.set(Ps(-s.y,s.y),Ps(-s.y,s.y)),this.distortion.set(Ps(0,1),Ps(0,1))):(a||n===Rs)&&(l=!0,u*=.03*s.x,h=Ps(-Math.PI,Math.PI),this.seeds.set(Ps(-s.x,s.x),Ps(-s.x,s.x)),this.distortion.set(Ps(0,1),Ps(0,1))),this.time=c),null!==o&&(l?o.set(Math.cos(h),Math.sin(h)).multiplyScalar(u):o.set(0,0)),this.uniforms.get("active").value=l}dispose(){const e=this.perturbationMap;null!==e&&e.name===Os&&e.dispose()}},Ls=class extends qo{constructor(e,t,r=null){super("RenderPass",e,t),this.needsSwap=!1,this.clearPass=new es,this.overrideMaterialManager=null===r?null:new ls(r),this.ignoreBackground=!1,this.skipShadowMapUpdate=!1,this.selection=null}set mainScene(e){this.scene=e}set mainCamera(e){this.camera=e}get renderToScreen(){return super.renderToScreen}set renderToScreen(e){super.renderToScreen=e,this.clearPass.renderToScreen=e}get overrideMaterial(){const e=this.overrideMaterialManager;return null!==e?e.material:null}set overrideMaterial(e){const t=this.overrideMaterialManager;null!==e?null!==t?t.setMaterial(e):this.overrideMaterialManager=new ls(e):null!==t&&(t.dispose(),this.overrideMaterialManager=null)}getOverrideMaterial(){return this.overrideMaterial}setOverrideMaterial(e){this.overrideMaterial=e}get clear(){return this.clearPass.enabled}set clear(e){this.clearPass.enabled=e}getSelection(){return this.selection}setSelection(e){this.selection=e}isBackgroundDisabled(){return this.ignoreBackground}setBackgroundDisabled(e){this.ignoreBackground=e}isShadowMapDisabled(){return this.skipShadowMapUpdate}setShadowMapDisabled(e){this.skipShadowMapUpdate=e}getClearPass(){return this.clearPass}render(e,t,r,n,i){const o=this.scene,s=this.camera,a=this.selection,c=s.layers.mask,l=o.background,u=e.shadowMap.autoUpdate,h=this.renderToScreen?null:t;null!==a&&s.layers.set(a.getLayer()),this.skipShadowMapUpdate&&(e.shadowMap.autoUpdate=!1),(this.ignoreBackground||null!==this.clearPass.overrideClearColor)&&(o.background=null),this.clearPass.enabled&&this.clearPass.render(e,t),e.setRenderTarget(h),null!==this.overrideMaterialManager?this.overrideMaterialManager.render(e,o,s):e.render(o,s),s.layers.mask=c,o.background=l,e.shadowMap.autoUpdate=u}};var Us=class extends Ts{constructor(e=30){super("PixelationEffect","uniform bool active;uniform vec4 d;void mainUv(inout vec2 uv){if(active){uv=d.xy*(floor(uv*d.zw)+0.5);}}",{uniforms:new Map([["active",new t.Uniform(!1)],["d",new t.Uniform(new t.Vector4)]])}),this.resolution=new t.Vector2,this._granularity=0,this.granularity=e}get granularity(){return this._granularity}set granularity(e){let t=Math.floor(e);t%2>0&&(t+=1),this._granularity=t,this.uniforms.get("active").value=t>0,this.setSize(this.resolution.width,this.resolution.height)}getGranularity(){return this.granularity}setGranularity(e){this.granularity=e}setSize(e,t){const r=this.resolution;r.set(e,t);const n=this.granularity,i=n/r.x,o=n/r.y;this.uniforms.get("d").value.set(i,o,1/i,1/o)}},Ds=(Math.PI,class extends t.ShaderMaterial{constructor(e,r,n,i,o=!1){super({name:"EffectMaterial",defines:{THREE_REVISION:t.REVISION.replace(/\D+/g,""),DEPTH_PACKING:"0",ENCODE_OUTPUT:"1"},uniforms:{inputBuffer:new t.Uniform(null),depthBuffer:new t.Uniform(null),resolution:new t.Uniform(new t.Vector2),texelSize:new t.Uniform(new t.Vector2),cameraNear:new t.Uniform(.3),cameraFar:new t.Uniform(1e3),aspect:new t.Uniform(1),time:new t.Uniform(0)},blending:t.NoBlending,toneMapped:!1,depthWrite:!1,depthTest:!1,dithering:o}),e&&this.setShaderParts(e),r&&this.setDefines(r),n&&this.setUniforms(n),this.copyCameraSettings(i)}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}get depthBuffer(){return this.uniforms.depthBuffer.value}set depthBuffer(e){this.uniforms.depthBuffer.value=e}get depthPacking(){return Number(this.defines.DEPTH_PACKING)}set depthPacking(e){this.defines.DEPTH_PACKING=e.toFixed(0),this.needsUpdate=!0}setDepthBuffer(e,r=t.BasicDepthPacking){this.depthBuffer=e,this.depthPacking=r}setShaderData(e){this.setShaderParts(e.shaderParts),this.setDefines(e.defines),this.setUniforms(e.uniforms),this.setExtensions(e.extensions)}setShaderParts(e){return this.fragmentShader="#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#define packFloatToRGBA(v) packDepthToRGBA(v)\n#define unpackRGBAToFloat(v) unpackRGBAToDepth(v)\n#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D inputBuffer;\n#else\nuniform lowp sampler2D inputBuffer;\n#endif\n#if DEPTH_PACKING == 3201\nuniform lowp sampler2D depthBuffer;\n#elif defined(GL_FRAGMENT_PRECISION_HIGH)\nuniform highp sampler2D depthBuffer;\n#else\nuniform mediump sampler2D depthBuffer;\n#endif\nuniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;vec4 sRGBToLinear(const in vec4 value){return vec4(mix(pow(value.rgb*0.9478672986+vec3(0.0521327014),vec3(2.4)),value.rgb*0.0773993808,vec3(lessThanEqual(value.rgb,vec3(0.04045)))),value.a);}float readDepth(const in vec2 uv){\n#if DEPTH_PACKING == 3201\nreturn unpackRGBAToDepth(texture2D(depthBuffer,uv));\n#else\nreturn texture2D(depthBuffer,uv).r;\n#endif\n}float getViewZ(const in float depth){\n#ifdef PERSPECTIVE_CAMERA\nreturn perspectiveDepthToViewZ(depth,cameraNear,cameraFar);\n#else\nreturn orthographicDepthToViewZ(depth,cameraNear,cameraFar);\n#endif\n}vec3 RGBToHCV(const in vec3 RGB){vec4 P=mix(vec4(RGB.bg,-1.0,2.0/3.0),vec4(RGB.gb,0.0,-1.0/3.0),step(RGB.b,RGB.g));vec4 Q=mix(vec4(P.xyw,RGB.r),vec4(RGB.r,P.yzx),step(P.x,RGB.r));float C=Q.x-min(Q.w,Q.y);float H=abs((Q.w-Q.y)/(6.0*C+EPSILON)+Q.z);return vec3(H,C,Q.x);}vec3 RGBToHSL(const in vec3 RGB){vec3 HCV=RGBToHCV(RGB);float L=HCV.z-HCV.y*0.5;float S=HCV.y/(1.0-abs(L*2.0-1.0)+EPSILON);return vec3(HCV.x,S,L);}vec3 HueToRGB(const in float H){float R=abs(H*6.0-3.0)-1.0;float G=2.0-abs(H*6.0-2.0);float B=2.0-abs(H*6.0-4.0);return clamp(vec3(R,G,B),0.0,1.0);}vec3 HSLToRGB(const in vec3 HSL){vec3 RGB=HueToRGB(HSL.x);float C=(1.0-abs(2.0*HSL.z-1.0))*HSL.y;return(RGB-0.5)*C+HSL.z;}FRAGMENT_HEAD void main(){FRAGMENT_MAIN_UV vec4 color0=texture2D(inputBuffer,UV);vec4 color1=vec4(0.0);FRAGMENT_MAIN_IMAGE color0.a=clamp(color0.a,0.0,1.0);gl_FragColor=color0;\n#ifdef ENCODE_OUTPUT\n#include <colorspace_fragment>\n#endif\n#include <dithering_fragment>\n}".replace(ss.FRAGMENT_HEAD,e.get(ss.FRAGMENT_HEAD)||"").replace(ss.FRAGMENT_MAIN_UV,e.get(ss.FRAGMENT_MAIN_UV)||"").replace(ss.FRAGMENT_MAIN_IMAGE,e.get(ss.FRAGMENT_MAIN_IMAGE)||""),this.vertexShader="uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;VERTEX_HEAD void main(){vUv=position.xy*0.5+0.5;VERTEX_MAIN_SUPPORT gl_Position=vec4(position.xy,1.0,1.0);}".replace(ss.VERTEX_HEAD,e.get(ss.VERTEX_HEAD)||"").replace(ss.VERTEX_MAIN_SUPPORT,e.get(ss.VERTEX_MAIN_SUPPORT)||""),this.needsUpdate=!0,this}setDefines(e){for(const t of e.entries())this.defines[t[0]]=t[1];return this.needsUpdate=!0,this}setUniforms(e){for(const t of e.entries())this.uniforms[t[0]]=t[1];return this}setExtensions(e){this.extensions={};for(const t of e)this.extensions[t]=!0;return this}get encodeOutput(){return void 0!==this.defines.ENCODE_OUTPUT}set encodeOutput(e){this.encodeOutput!==e&&(e?this.defines.ENCODE_OUTPUT="1":delete this.defines.ENCODE_OUTPUT,this.needsUpdate=!0)}isOutputEncodingEnabled(e){return this.encodeOutput}setOutputEncodingEnabled(e){this.encodeOutput=e}get time(){return this.uniforms.time.value}set time(e){this.uniforms.time.value=e}setDeltaTime(e){this.uniforms.time.value+=e}adoptCameraSettings(e){this.copyCameraSettings(e)}copyCameraSettings(e){e&&(this.uniforms.cameraNear.value=e.near,this.uniforms.cameraFar.value=e.far,e instanceof t.PerspectiveCamera?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}setSize(e,t){const r=this.uniforms;r.resolution.value.set(e,t),r.texelSize.value.set(1/e,1/t),r.aspect.value=e/t}static get Section(){return ss}}),Fs=(Number(t.REVISION.replace(/\D+/g,"")),255/256);new Float32Array([5.9371814131736755e-8,Fs/65536,.0038909912109375,Fs]),new Float32Array([Fs,.0038909912109375,Fs/65536,1/256**3]);function Bs(e,t,r){for(const n of t){const t="$1"+e+n.charAt(0).toUpperCase()+n.slice(1),i=new RegExp("([^\\.])(\\b"+n+"\\b)","g");for(const e of r.entries())null!==e[1]&&r.set(e[0],e[1].replace(i,t))}}function ks(e,r,n){let i=r.getFragmentShader(),o=r.getVertexShader();const s=void 0!==i&&/mainImage/.test(i),a=void 0!==i&&/mainUv/.test(i);if(n.attributes|=r.getAttributes(),void 0===i)throw new Error(`Missing fragment shader (${r.name})`);if(a&&0!=(n.attributes&os))throw new Error(`Effects that transform UVs are incompatible with convolution effects (${r.name})`);if(!s&&!a)throw new Error(`Could not find mainImage or mainUv function (${r.name})`);{const c=/\w+\s+(\w+)\([\w\s,]*\)\s*{/g,l=n.shaderParts;let u=l.get(ss.FRAGMENT_HEAD)||"",h=l.get(ss.FRAGMENT_MAIN_UV)||"",p=l.get(ss.FRAGMENT_MAIN_IMAGE)||"",d=l.get(ss.VERTEX_HEAD)||"",f=l.get(ss.VERTEX_MAIN_SUPPORT)||"";const m=new Set,g=new Set;if(a&&(h+=`\t${e}MainUv(UV);\n`,n.uvTransformation=!0),null!==o&&/mainSupport/.test(o)){const t=/mainSupport *\([\w\s]*?uv\s*?\)/.test(o);f+=`\t${e}MainSupport(`,f+=t?"vUv);\n":");\n";for(const e of o.matchAll(/(?:varying\s+\w+\s+([\S\s]*?);)/g))for(const t of e[1].split(/\s*,\s*/))n.varyings.add(t),m.add(t),g.add(t);for(const e of o.matchAll(c))g.add(e[1])}for(const e of i.matchAll(c))g.add(e[1]);for(const e of r.defines.keys())g.add(e.replace(/\([\w\s,]*\)/g,""));for(const e of r.uniforms.keys())g.add(e);g.delete("while"),g.delete("for"),g.delete("if"),r.uniforms.forEach(((t,r)=>n.uniforms.set(e+r.charAt(0).toUpperCase()+r.slice(1),t))),r.defines.forEach(((t,r)=>n.defines.set(e+r.charAt(0).toUpperCase()+r.slice(1),t)));const y=new Map([["fragment",i],["vertex",o]]);Bs(e,g,n.defines),Bs(e,g,y),i=y.get("fragment"),o=y.get("vertex");const v=r.blendMode;if(n.blendModes.set(v.blendFunction,v),s){null!==r.inputColorSpace&&r.inputColorSpace!==n.colorSpace&&(p+=r.inputColorSpace===t.SRGBColorSpace?"color0 = sRGBTransferOETF(color0);\n\t":"color0 = sRGBToLinear(color0);\n\t"),r.outputColorSpace!==t.NoColorSpace?n.colorSpace=r.outputColorSpace:null!==r.inputColorSpace&&(n.colorSpace=r.inputColorSpace);const o=/MainImage *\([\w\s,]*?depth[\w\s,]*?\)/;p+=`${e}MainImage(color0, UV, `,0!=(n.attributes&is)&&o.test(i)&&(p+="depth, ",n.readDepth=!0),p+="color1);\n\t";const s=e+"BlendOpacity";n.uniforms.set(s,v.opacity),p+=`color0 = blend${v.blendFunction}(color0, color1, ${s});\n\n\t`,u+=`uniform float ${s};\n\n`}if(u+=i+"\n",null!==o&&(d+=o+"\n"),l.set(ss.FRAGMENT_HEAD,u),l.set(ss.FRAGMENT_MAIN_UV,h),l.set(ss.FRAGMENT_MAIN_IMAGE,p),l.set(ss.VERTEX_HEAD,d),l.set(ss.VERTEX_MAIN_SUPPORT,f),null!==r.extensions)for(const e of r.extensions)n.extensions.add(e)}}var js=class extends qo{constructor(e,...t){super("EffectPass"),this.fullscreenMaterial=new Ds(null,null,null,e),this.listener=e=>this.handleEvent(e),this.effects=[],this.setEffects(t),this.skipRendering=!1,this.minTime=1,this.maxTime=Number.POSITIVE_INFINITY,this.timeScale=1}set mainScene(e){for(const t of this.effects)t.mainScene=e}set mainCamera(e){this.fullscreenMaterial.copyCameraSettings(e);for(const t of this.effects)t.mainCamera=e}get encodeOutput(){return this.fullscreenMaterial.encodeOutput}set encodeOutput(e){this.fullscreenMaterial.encodeOutput=e}get dithering(){return this.fullscreenMaterial.dithering}set dithering(e){const t=this.fullscreenMaterial;t.dithering=e,t.needsUpdate=!0}setEffects(e){for(const e of this.effects)e.removeEventListener("change",this.listener);this.effects=e.sort(((e,t)=>t.attributes-e.attributes));for(const e of this.effects)e.addEventListener("change",this.listener)}updateMaterial(){const e=new as;let r=0;for(const t of this.effects)if(t.blendMode.blendFunction===ps.DST)e.attributes|=t.getAttributes()&is;else{if(0!=(e.attributes&t.getAttributes()&os))throw new Error(`Convolution effects cannot be merged (${t.name})`);ks("e"+r++,t,e)}let n=e.shaderParts.get(ss.FRAGMENT_HEAD),i=e.shaderParts.get(ss.FRAGMENT_MAIN_IMAGE),o=e.shaderParts.get(ss.FRAGMENT_MAIN_UV);const s=/\bblend\b/g;for(const t of e.blendModes.values())n+=t.getShaderCode().replace(s,`blend${t.blendFunction}`)+"\n";0!=(e.attributes&is)?(e.readDepth&&(i="float depth = readDepth(UV);\n\n\t"+i),this.needsDepthTexture=null===this.getDepthTexture()):this.needsDepthTexture=!1,e.colorSpace===t.SRGBColorSpace&&(i+="color0 = sRGBToLinear(color0);\n\t"),e.uvTransformation?(o="vec2 transformedUv = vUv;\n"+o,e.defines.set("UV","transformedUv")):e.defines.set("UV","vUv"),e.shaderParts.set(ss.FRAGMENT_HEAD,n),e.shaderParts.set(ss.FRAGMENT_MAIN_IMAGE,i),e.shaderParts.set(ss.FRAGMENT_MAIN_UV,o);for(const[t,r]of e.shaderParts)null!==r&&e.shaderParts.set(t,r.trim().replace(/^#/,"\n#"));this.skipRendering=0===r,this.needsSwap=!this.skipRendering,this.fullscreenMaterial.setShaderData(e)}recompile(){this.updateMaterial()}getDepthTexture(){return this.fullscreenMaterial.depthBuffer}setDepthTexture(e,r=t.BasicDepthPacking){this.fullscreenMaterial.depthBuffer=e,this.fullscreenMaterial.depthPacking=r;for(const t of this.effects)t.setDepthTexture(e,r)}render(e,t,r,n,i){for(const r of this.effects)r.update(e,t,n);if(!this.skipRendering||this.renderToScreen){const i=this.fullscreenMaterial;i.inputBuffer=t.texture,i.time+=n*this.timeScale,e.setRenderTarget(this.renderToScreen?null:r),e.render(this.scene,this.camera)}}setSize(e,t){this.fullscreenMaterial.setSize(e,t);for(const r of this.effects)r.setSize(e,t)}initialize(e,r,n){this.renderer=e;for(const t of this.effects)t.initialize(e,r,n);this.updateMaterial(),void 0!==n&&n!==t.UnsignedByteType&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}dispose(){super.dispose();for(const e of this.effects)e.removeEventListener("change",this.listener),e.dispose()}handleEvent(e){if("change"===e.type)this.recompile()}};new Float32Array(3),new Float32Array(3),new Float32Array(3),new Float32Array(3),new Float32Array(3),new Float32Array(3),new Float32Array([0,0,0]),new Float32Array([1,0,0]),new Float32Array([1,1,0]),new Float32Array([1,1,1]),new Float32Array([0,0,0]),new Float32Array([1,0,0]),new Float32Array([1,0,1]),new Float32Array([1,1,1]),new Float32Array([0,0,0]),new Float32Array([0,0,1]),new Float32Array([1,0,1]),new Float32Array([1,1,1]),new Float32Array([0,0,0]),new Float32Array([0,1,0]),new Float32Array([1,1,0]),new Float32Array([1,1,1]),new Float32Array([0,0,0]),new Float32Array([0,1,0]),new Float32Array([0,1,1]),new Float32Array([1,1,1]),new Float32Array([0,0,0]),new Float32Array([0,0,1]),new Float32Array([0,1,1]),new Float32Array([1,1,1]);new Float32Array(2),new Float32Array(2),new Float32Array([0,-.25,.25,-.125,.125,-.375,.375]),new Float32Array([0,0]),new Float32Array([.25,-.25]),new Float32Array([-.25,.25]),new Float32Array([.125,-.125]),new Float32Array([-.125,.125]),new Uint8Array([0,0]),new Uint8Array([3,0]),new Uint8Array([0,3]),new Uint8Array([3,3]),new Uint8Array([1,0]),new Uint8Array([4,0]),new Uint8Array([1,3]),new Uint8Array([4,3]),new Uint8Array([0,1]),new Uint8Array([3,1]),new Uint8Array([0,4]),new Uint8Array([3,4]),new Uint8Array([1,1]),new Uint8Array([4,1]),new Uint8Array([1,4]),new Uint8Array([4,4]),new Uint8Array([0,0]),new Uint8Array([1,0]),new Uint8Array([0,2]),new Uint8Array([1,2]),new Uint8Array([2,0]),new Uint8Array([3,0]),new Uint8Array([2,2]),new Uint8Array([3,2]),new Uint8Array([0,1]),new Uint8Array([1,1]),new Uint8Array([0,3]),new Uint8Array([1,3]),new Uint8Array([2,1]),new Uint8Array([3,1]),new Uint8Array([2,3]),new Uint8Array([3,3]);zs(0,0,0,0),new Float32Array([0,0,0,0]),zs(0,0,0,1),new Float32Array([0,0,0,1]),zs(0,0,1,0),new Float32Array([0,0,1,0]),zs(0,0,1,1),new Float32Array([0,0,1,1]),zs(0,1,0,0),new Float32Array([0,1,0,0]),zs(0,1,0,1),new Float32Array([0,1,0,1]),zs(0,1,1,0),new Float32Array([0,1,1,0]),zs(0,1,1,1),new Float32Array([0,1,1,1]),zs(1,0,0,0),new Float32Array([1,0,0,0]),zs(1,0,0,1),new Float32Array([1,0,0,1]),zs(1,0,1,0),new Float32Array([1,0,1,0]),zs(1,0,1,1),new Float32Array([1,0,1,1]),zs(1,1,0,0),new Float32Array([1,1,0,0]),zs(1,1,0,1),new Float32Array([1,1,0,1]),zs(1,1,1,0),new Float32Array([1,1,1,0]),zs(1,1,1,1),new Float32Array([1,1,1,1]);function Gs(e,t,r){return e+(t-e)*r}function zs(e,t,r,n){const i=Gs(e,t,.75),o=Gs(r,n,.75);return Gs(i,o,.875)}function Vs(e){return Vs="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Vs(e)}function Hs(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(i=n.key,o=void 0,o=function(e,t){if("object"!==Vs(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==Vs(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(i,"string"),"symbol"===Vs(o)?o:String(o)),n)}var i,o}function Ws(e,t){return Ws=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Ws(e,t)}function Xs(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Ys(e);if(t){var i=Ys(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return function(e,t){if(t&&("object"===Vs(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,r)}}function Ys(e){return Ys=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Ys(e)}var qs=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Ws(e,t)}(s,e);var r,n,i,o=Xs(s);function s(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),o.call(this,"AberrationEffect","\nuniform float offsetX;\nuniform float offsetY;\n\nvec4 offsetRGB(vec2 uv, float v) {\n  return vec4(texture2D(inputBuffer, vec2(uv.x - offsetX * v,uv.y- offsetY * v)));\n}\n\nvoid mainImage(const in vec4 inputColor, const in vec2 uv, out vec4 outputColor) {\n\n  vec2 e0VUvR = uv + vec2(offsetX, offsetY);\n  vec2 e0VUvB = uv - vec2(offsetX, offsetY);\n\n  vec2 ra = texture2D(inputBuffer,e0VUvR).ra;\n  vec2 ba = texture2D(inputBuffer,e0VUvB).ba;\n  outputColor=vec4(ra.x,inputColor.g,ba.x,max(max(ra.y,ba.y),inputColor.a));\n}\n",{blendFunction:ps.Normal,uniforms:new Map([["offsetX",new t.Uniform(0)],["offsetY",new t.Uniform(0)]])})}return r=s,n&&Hs(r.prototype,n),i&&Hs(r,i),Object.defineProperty(r,"prototype",{writable:!1}),r}(Ts);function Js(e){return Js="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Js(e)}function Ks(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(i=n.key,o=void 0,o=function(e,t){if("object"!==Js(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==Js(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(i,"string"),"symbol"===Js(o)?o:String(o)),n)}var i,o}function Zs(e,t){return Zs=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Zs(e,t)}function Qs(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=$s(e);if(t){var i=$s(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return function(e,t){if(t&&("object"===Js(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,r)}}function $s(e){return $s=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},$s(e)}var ea=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Zs(e,t)}(s,e);var r,n,i,o=Qs(s);function s(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),o.call(this,"DistortionEffect","\nuniform float bandOffset;\nuniform float jitterOffset;\nuniform float jitterIntensity;\nuniform int samples;\n\n#define BAND_MODE 2\n\nvoid mainImage(const in vec4 inputColor, const in vec2 uv, out vec4 outputColor) {\n\n  vec3 normal = vec3( ( 2.0 * vUv - vec2( 1.0 ) ), 1.0 );\n  normal.z = 1.0;\n  normal = normalize( normal );\n\n  vec4 color;\n\n  float baseIor = 1.0;\n\n  // if NO BANDS\n  #if BAND_MODE == 0\n\n  color = texture2D( inputBuffer, vUv);\n\n  // if RGB or RYGCBV BANDS\n  #else\n\n  float index, randValue, offsetValue;\n  float r, g, b, r_ior, g_ior, b_ior;\n  vec3 r_refracted, g_refracted, b_refracted;\n  vec4 r_sample, g_sample, b_sample;\n\n  #if BAND_MODE == 2\n  float y, c, v, y_ior, c_ior, v_ior;\n  vec3 y_refracted, c_refracted, v_refracted;\n  vec4 y_sample, c_sample, v_sample;\n  #endif\n\n  for ( int i = 0; i < samples; i ++ ) {\n\n    index = float( i );\n    randValue = rand( sin( index + 1. ) * gl_FragCoord.xy + vec2( jitterOffset, - jitterOffset ) ) - 0.5;\n    offsetValue = index / float( samples ) + randValue * jitterIntensity;\n    #if BAND_MODE == 1\n    randValue *= 2.0;\n    #endif\n\n    // Paper describing functions for creating yellow, cyan, and violet bands and reforming\n    // them into RGB:\n    // https://web.archive.org/web/20061108181225/http://home.iitk.ac.in/~shankars/reports/dispersionraytrace.pdf\n    r_ior = 1.0 + bandOffset * ( 0.0 + offsetValue );\n    g_ior = 1.0 + bandOffset * ( 2.0 + offsetValue );\n    b_ior = 1.0 + bandOffset * ( 4.0 + offsetValue );\n\n    r_refracted = refract( vec3( 0.0, 0.0, - 1.0 ), normal, baseIor / r_ior );\n    g_refracted = refract( vec3( 0.0, 0.0, - 1.0 ), normal, baseIor / g_ior );\n    b_refracted = refract( vec3( 0.0, 0.0, - 1.0 ), normal, baseIor / b_ior );\n\n    r_sample = texture2D( inputBuffer, vUv + r_refracted.xy );\n    g_sample = texture2D( inputBuffer, vUv + g_refracted.xy );\n    b_sample = texture2D( inputBuffer, vUv + b_refracted.xy );\n\n    #if BAND_MODE == 2\n    y_ior = 1.0 + bandOffset * ( 1.0 + offsetValue );\n    c_ior = 1.0 + bandOffset * ( 3.0 + offsetValue );\n    v_ior = 1.0 + bandOffset * ( 5.0 + offsetValue );\n\n    y_refracted = refract( vec3( 0.0, 0.0, - 1.0 ), normal, baseIor / y_ior );\n    c_refracted = refract( vec3( 0.0, 0.0, - 1.0 ), normal, baseIor / c_ior );\n    v_refracted = refract( vec3( 0.0, 0.0, - 1.0 ), normal, baseIor / v_ior );\n\n    y_sample = texture2D( inputBuffer, vUv + y_refracted.xy );\n    c_sample = texture2D( inputBuffer, vUv + c_refracted.xy );\n    v_sample = texture2D( inputBuffer, vUv + v_refracted.xy );\n\n    r = r_sample.r / 2.0;\n    y = ( 2.0 * y_sample.r + 2.0 * y_sample.g - y_sample.b ) / 6.0;\n    g = g_sample.g / 2.0;\n    c = ( 2.0 * c_sample.g + 2.0 * c_sample.b - c_sample.r ) / 6.0;\n    b = b_sample.b / 2.0;\n    v = ( 2.0 * v_sample.b + 2.0 * v_sample.r - v_sample.g ) / 6.0;\n\n    color.r += r + ( 2.0 * v + 2.0 * y - c ) / 3.0;\n    color.g += g + ( 2.0 * y + 2.0 * c - v ) / 3.0;\n    color.b += b + ( 2.0 * c + 2.0 * v - y ) / 3.0;\n    color.a = max(max(r_sample.a, g_sample.a), b_sample.a);\n    // color.a = (r_sample.a + g_sample.a + b_sample.a) / 3.0;\n    #else\n    color.r += r_sample.r;\n    color.g += g_sample.g;\n    color.b += b_sample.b;\n    color.a = max(max(r_sample.a, g_sample.a), b_sample.a);\n    // color.a = (r_sample.a + g_sample.a + b_sample.a) / 3.0;\n    #endif\n\n  }\n\n  color.rgb /= float( samples );\n\n  #endif\n\n  outputColor = color;\n}\n",{blendFunction:ps.Normal,uniforms:new Map([["bandOffset",new t.Uniform(.1)],["jitterOffset",new t.Uniform(0)],["jitterIntensity",new t.Uniform(1)],["samples",new t.Uniform(7)]])})}return r=s,n&&Ks(r.prototype,n),i&&Ks(r,i),Object.defineProperty(r,"prototype",{writable:!1}),r}(Ts);function ta(e){return ta="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ta(e)}function ra(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(i=n.key,o=void 0,o=function(e,t){if("object"!==ta(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==ta(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(i,"string"),"symbol"===ta(o)?o:String(o)),n)}var i,o}function na(e,t){return na=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},na(e,t)}function ia(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=oa(e);if(t){var i=oa(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return function(e,t){if(t&&("object"===ta(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,r)}}function oa(e){return oa=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},oa(e)}var sa=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&na(e,t)}(s,e);var r,n,i,o=ia(s);function s(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),o.call(this,"FilmEffect","\nuniform float nIntensity;\nuniform float sIntensity;\nuniform float sCount;\nuniform float grayscale;\n\nvoid mainImage(const in vec4 inputColor, const in vec2 uv, out vec4 outputColor) {\n\n  float time = 0.0;\n\n  // sample the source\n  vec4 cTextureScreen = texture2D( inputBuffer, vUv );\n\n  // make some noise\n  float dx = rand( vUv + time );\n\n  // add noise\n  vec3 cResult = cTextureScreen.rgb + cTextureScreen.rgb * clamp( 0.1 + dx, 0.0, 1.0 );\n\n  // get us a sine and cosine\n  vec2 sc = vec2( sin( vUv.y * sCount ), cos( vUv.y * sCount ) );\n\n  // add scanlines\n  cResult += cTextureScreen.rgb * vec3( sc.x, sc.y, sc.x ) * sIntensity;\n\n  // interpolate between source and result by intensity\n  cResult = cTextureScreen.rgb + clamp( nIntensity, 0.0,1.0 ) * ( cResult - cTextureScreen.rgb );\n\n  // convert to grayscale if desired\n  if( grayscale >= 1.0 ) {\n\n    cResult = vec3( cResult.r * 0.3 + cResult.g * 0.59 + cResult.b * 0.11 );\n\n  }\n\n  outputColor =  vec4( cResult, cTextureScreen.a );\n\n}\n",{blendFunction:ps.Normal,uniforms:new Map([["nIntensity",new t.Uniform(0)],["sIntensity",new t.Uniform(0)],["sCount",new t.Uniform(0)],["grayscale",new t.Uniform(1)]])})}return r=s,n&&ra(r.prototype,n),i&&ra(r,i),Object.defineProperty(r,"prototype",{writable:!1}),r}(Ts);function aa(e){return aa="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},aa(e)}function ca(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(i=n.key,o=void 0,o=function(e,t){if("object"!==aa(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==aa(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(i,"string"),"symbol"===aa(o)?o:String(o)),n)}var i,o}function la(e,t){return la=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},la(e,t)}function ua(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=ha(e);if(t){var i=ha(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return function(e,t){if(t&&("object"===aa(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,r)}}function ha(e){return ha=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},ha(e)}var pa=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&la(e,t)}(s,e);var r,n,i,o=ua(s);function s(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),o.call(this,"HalftoneEffect","\n#define SQRT2_MINUS_ONE 0.41421356\n#define SQRT2_HALF_MINUS_ONE 0.20710678\n\n#define SHAPE_DOT 1\n#define SHAPE_ELLIPSE 2\n#define SHAPE_LINE 3\n#define SHAPE_SQUARE 4\nuniform float width;\nuniform float height;\nconst int samples = 8;\n\nuniform int shape;\nuniform float radius;\nuniform float rotateR;\nuniform float rotateG;\nuniform float rotateB;\nuniform float scatter;\nuniform bool greyscale;\n\nfloat hypot( float x, float y ) {\n\n  // vector magnitude\n  return sqrt( x * x + y * y );\n\n}\n\nfloat distanceToDotRadius( float channel, vec2 coord, vec2 normal, vec2 p, float angle, float rad_max ) {\n\n  // apply shape-specific transforms\n  float dist = hypot( coord.x - p.x, coord.y - p.y );\n  float rad = channel;\n\n  if ( shape == SHAPE_DOT ) {\n\n    rad = pow( abs( rad ), 1.125 ) * rad_max;\n\n  } else if ( shape == SHAPE_ELLIPSE ) {\n\n    rad = pow( abs( rad ), 1.125 ) * rad_max;\n\n    if ( dist != 0.0 ) {\n      float dot_p = abs( ( p.x - coord.x ) / dist * normal.x + ( p.y - coord.y ) / dist * normal.y );\n      dist = ( dist * ( 1.0 - SQRT2_HALF_MINUS_ONE ) ) + dot_p * dist * SQRT2_MINUS_ONE;\n    }\n\n  } else if ( shape == SHAPE_LINE ) {\n\n    rad = pow( abs( rad ), 1.5) * rad_max;\n    float dot_p = ( p.x - coord.x ) * normal.x + ( p.y - coord.y ) * normal.y;\n    dist = hypot( normal.x * dot_p, normal.y * dot_p );\n\n  } else if ( shape == SHAPE_SQUARE ) {\n\n    float theta = atan( p.y - coord.y, p.x - coord.x ) - angle;\n    float sin_t = abs( sin( theta ) );\n    float cos_t = abs( cos( theta ) );\n    rad = pow( abs( rad ), 1.4 );\n    rad = rad_max * ( rad + ( ( sin_t > cos_t ) ? rad - sin_t * rad : rad - cos_t * rad ) );\n\n  }\n\n  return rad - dist;\n\n}\n\nstruct Cell {\n\n  // grid sample positions\n  vec2 normal;\n  vec2 p1;\n  vec2 p2;\n  vec2 p3;\n  vec2 p4;\n  float samp2;\n  float samp1;\n  float samp3;\n  float samp4;\n\n};\n\n\nfloat rand( vec2 seed ){\n\n  // get pseudo-random number\n  return fract( sin( dot( seed.xy, vec2( 12.9898, 78.233 ) ) ) * 43758.5453 );\n\n}\n\nvec4 getSample( vec2 point ) {\n\n  // multi-sampled point\n  vec4 tex = texture2D( inputBuffer, vec2( point.x / width, point.y / height ) );\n  float base = rand( vec2( floor( point.x ), floor( point.y ) ) ) * PI2;\n  float step = PI2 / float( samples );\n  float dist = radius * 0.66;\n\n  for ( int i = 0; i < samples; ++i ) {\n\n    float r = base + step * float( i );\n    vec2 coord = point + vec2( cos( r ) * dist, sin( r ) * dist );\n    tex += texture2D( inputBuffer, vec2( coord.x / width, coord.y / height ) );\n\n  }\n\n  tex /= float( samples ) + 1.0;\n  return tex;\n\n}\n\nfloat getDotColour( Cell c, vec2 p, int channel, float angle, float aa ) {\n\n  // get colour for given point\n  float dist_c_1, dist_c_2, dist_c_3, dist_c_4, res;\n\n  if ( channel == 0 ) {\n\n    c.samp1 = getSample( c.p1 ).r;\n    c.samp2 = getSample( c.p2 ).r;\n    c.samp3 = getSample( c.p3 ).r;\n    c.samp4 = getSample( c.p4 ).r;\n\n  } else if (channel == 1) {\n\n    c.samp1 = getSample( c.p1 ).g;\n    c.samp2 = getSample( c.p2 ).g;\n    c.samp3 = getSample( c.p3 ).g;\n    c.samp4 = getSample( c.p4 ).g;\n\n  } else {\n\n    c.samp1 = getSample( c.p1 ).b;\n    c.samp3 = getSample( c.p3 ).b;\n    c.samp2 = getSample( c.p2 ).b;\n    c.samp4 = getSample( c.p4 ).b;\n\n  }\n\n  dist_c_1 = distanceToDotRadius( c.samp1, c.p1, c.normal, p, angle, radius );\n  dist_c_2 = distanceToDotRadius( c.samp2, c.p2, c.normal, p, angle, radius );\n  dist_c_3 = distanceToDotRadius( c.samp3, c.p3, c.normal, p, angle, radius );\n  dist_c_4 = distanceToDotRadius( c.samp4, c.p4, c.normal, p, angle, radius );\n  res = ( dist_c_1 > 0.0 ) ? clamp( dist_c_1 / aa, 0.0, 1.0 ) : 0.0;\n  res += ( dist_c_2 > 0.0 ) ? clamp( dist_c_2 / aa, 0.0, 1.0 ) : 0.0;\n  res += ( dist_c_3 > 0.0 ) ? clamp( dist_c_3 / aa, 0.0, 1.0 ) : 0.0;\n  res += ( dist_c_4 > 0.0 ) ? clamp( dist_c_4 / aa, 0.0, 1.0 ) : 0.0;\n  res = clamp( res, 0.0, 1.0 );\n\n  return res;\n\n}\n\nCell getReferenceCell( vec2 p, vec2 origin, float grid_angle, float step ) {\n\n  // get containing cell\n  Cell c;\n\n  // calc grid\n  vec2 n = vec2( cos( grid_angle ), sin( grid_angle ) );\n  float threshold = step * 0.5;\n  float dot_normal = n.x * ( p.x - origin.x ) + n.y * ( p.y - origin.y );\n  float dot_line = -n.y * ( p.x - origin.x ) + n.x * ( p.y - origin.y );\n  vec2 offset = vec2( n.x * dot_normal, n.y * dot_normal );\n  float offset_normal = mod( hypot( offset.x, offset.y ), step );\n  float normal_dir = ( dot_normal < 0.0 ) ? 1.0 : -1.0;\n  float normal_scale = ( ( offset_normal < threshold ) ? -offset_normal : step - offset_normal ) * normal_dir;\n  float offset_line = mod( hypot( ( p.x - offset.x ) - origin.x, ( p.y - offset.y ) - origin.y ), step );\n  float line_dir = ( dot_line < 0.0 ) ? 1.0 : -1.0;\n  float line_scale = ( ( offset_line < threshold ) ? -offset_line : step - offset_line ) * line_dir;\n\n  // get closest corner\n  c.normal = n;\n  c.p1.x = p.x - n.x * normal_scale + n.y * line_scale;\n  c.p1.y = p.y - n.y * normal_scale - n.x * line_scale;\n\n  // scatter\n  if ( scatter != 0.0 ) {\n\n    float off_mag = scatter * threshold * 0.5;\n    float off_angle = rand( vec2( floor( c.p1.x ), floor( c.p1.y ) ) ) * PI2;\n    c.p1.x += cos( off_angle ) * off_mag;\n    c.p1.y += sin( off_angle ) * off_mag;\n\n  }\n\n  // find corners\n  float normal_step = normal_dir * ( ( offset_normal < threshold ) ? step : -step );\n  float line_step = line_dir * ( ( offset_line < threshold ) ? step : -step );\n  c.p2.x = c.p1.x - n.x * normal_step;\n  c.p2.y = c.p1.y - n.y * normal_step;\n  c.p3.x = c.p1.x + n.y * line_step;\n  c.p3.y = c.p1.y - n.x * line_step;\n  c.p4.x = c.p1.x - n.x * normal_step + n.y * line_step;\n  c.p4.y = c.p1.y - n.y * normal_step - n.x * line_step;\n\n  return c;\n\n}\n\nvoid mainImage(const in vec4 inputColor, const in vec2 uv, out vec4 outputColor) {\n\n  vec2 vUV = uv;\n\n  // setup\n  vec2 p = vec2( vUV.x * width, vUV.y * height );\n  vec2 origin = vec2( 0, 0 );\n  float aa = ( radius < 2.5 ) ? radius * 0.5 : 1.25;\n\n  // get channel samples\n  Cell cell_r = getReferenceCell( p, origin, rotateR, radius );\n  Cell cell_g = getReferenceCell( p, origin, rotateG, radius );\n  Cell cell_b = getReferenceCell( p, origin, rotateB, radius );\n  float r = getDotColour( cell_r, p, 0, rotateR, aa );\n  float g = getDotColour( cell_g, p, 1, rotateG, aa );\n  float b = getDotColour( cell_b, p, 2, rotateB, aa );\n\n  if ( greyscale ) {\n    r = g = b = (r + b + g) / 3.0;\n  }\n\n  outputColor = vec4( r, g, b, inputColor.a );\n\n}\n",{blendFunction:ps.Normal,uniforms:new Map([["shape",new t.Uniform(1)],["radius",new t.Uniform(4)],["rotateR",new t.Uniform(30)],["rotateG",new t.Uniform(30)],["rotateB",new t.Uniform(30)],["scatter",new t.Uniform(0)],["greyscale",new t.Uniform(0)],["width",new t.Uniform(1280)],["height",new t.Uniform(720)]])})}return r=s,n&&ca(r.prototype,n),i&&ca(r,i),Object.defineProperty(r,"prototype",{writable:!1}),r}(Ts);function da(e){return da="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},da(e)}function fa(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(i=n.key,o=void 0,o=function(e,t){if("object"!==da(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==da(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(i,"string"),"symbol"===da(o)?o:String(o)),n)}var i,o}function ma(e,t){return ma=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},ma(e,t)}function ga(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=ya(e);if(t){var i=ya(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return function(e,t){if(t&&("object"===da(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,r)}}function ya(e){return ya=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},ya(e)}var va=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ma(e,t)}(s,e);var r,n,i,o=ga(s);function s(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.blendFunction,i=void 0===n?ps.SRC:n,a=r.hue,c=void 0===a?0:a,l=r.saturation,u=void 0===l?0:l;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(e=o.call(this,"HueSaturationEffect","\nuniform vec3 hue;\nuniform float saturation;\n\nvoid mainImage(const in vec4 inputColor, const in vec2 uv, out vec4 outputColor) {\n\n\t// Hue.\n\tvec3 color = vec3(\n\t\tdot(inputColor.rgb, hue.xyz),\n\t\tdot(inputColor.rgb, hue.zxy),\n\t\tdot(inputColor.rgb, hue.yzx)\n\t);\n\n\t// Saturation.\n\tfloat average = (color.r + color.g + color.b) / 3.0;\n\tvec3 diff = average - color;\n\n\tif(saturation > 0.0) {\n\n\t\tcolor += diff * (1.0 - 1.0 / (1.001 - saturation));\n\n\t} else {\n\n\t\tcolor += diff * -saturation;\n\n\t}\n\n\toutputColor = vec4(min(color, 1.0), inputColor.a);\n\n}\n",{blendFunction:i,uniforms:new Map([["hue",new t.Uniform(new t.Vector3)],["saturation",new t.Uniform(u)]])})).hue=c,e}return r=s,n=[{key:"saturation",get:function(){return this.uniforms.get("saturation").value},set:function(e){this.uniforms.get("saturation").value=e}},{key:"getSaturation",value:function(){return this.saturation}},{key:"setSaturation",value:function(e){this.saturation=e}},{key:"hue",get:function(){var e=this.uniforms.get("hue").value;return Math.acos((3*e.x-1)/2)},set:function(e){var t=Math.sin(e),r=Math.cos(e);this.uniforms.get("hue").value.set((2*r+1)/3,(-Math.sqrt(3)*t-r+1)/3,(Math.sqrt(3)*t-r+1)/3)}},{key:"getHue",value:function(){return this.hue}},{key:"setHue",value:function(e){this.hue=e}}],n&&fa(r.prototype,n),i&&fa(r,i),Object.defineProperty(r,"prototype",{writable:!1}),s}(Ts);function _a(e){return _a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_a(e)}function ba(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(i=n.key,o=void 0,o=function(e,t){if("object"!==_a(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==_a(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(i,"string"),"symbol"===_a(o)?o:String(o)),n)}var i,o}function xa(e,t){return xa=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},xa(e,t)}function wa(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Sa(e);if(t){var i=Sa(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return function(e,t){if(t&&("object"===_a(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,r)}}function Sa(e){return Sa=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Sa(e)}var Ma=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&xa(e,t)}(s,e);var r,n,i,o=wa(s);function s(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),o.call(this,"NoiseEffect","\nuniform int timeEnable;\n\nvoid mainImage(const in vec4 inputColor, const in vec2 uv, out vec4 outputColor) {\n\n  vec3 noise;\n\n  if(timeEnable > 0) {\n    noise = vec3(rand(uv * time));\n  } else {\n    noise = vec3(rand(uv));\n  }\n\n\t#ifdef PREMULTIPLY\n\n\t\toutputColor = vec4(min(inputColor.rgb * noise, vec3(1.0)), inputColor.a);\n\n\t#else\n\n\t\toutputColor = vec4(noise, inputColor.a);\n\n\t#endif\n\n}\n",{blendFunction:ps.Normal,uniforms:new Map([["timeEnable",new t.Uniform(0)]])})}return r=s,n&&ba(r.prototype,n),i&&ba(r,i),Object.defineProperty(r,"prototype",{writable:!1}),r}(Ts);function Ta(e){return Ta="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ta(e)}function Ea(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(i=n.key,o=void 0,o=function(e,t){if("object"!==Ta(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==Ta(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(i,"string"),"symbol"===Ta(o)?o:String(o)),n)}var i,o}function Aa(e,t){return Aa=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Aa(e,t)}function Ra(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Ca(e);if(t){var i=Ca(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return function(e,t){if(t&&("object"===Ta(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,r)}}function Ca(e){return Ca=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Ca(e)}var Ia=[new Float32Array([0,0]),new Float32Array([0,1,1]),new Float32Array([0,1,1,2]),new Float32Array([0,1,2,2,3]),new Float32Array([0,1,2,3,4,4,5]),new Float32Array([0,1,2,3,4,5,7,8,9,10])],Oa=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Aa(e,t)}(s,e);var r,n,i,o=Ra(s);function s(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new t.Vector4;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(e=o.call(this,{name:"KawaseBlurMaterial",uniforms:{inputBuffer:new t.Uniform(null),texelSize:new t.Uniform(new t.Vector4),scale:new t.Uniform(1),kernel:new t.Uniform(0)},blending:t.NoBlending,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:"\n#ifdef FRAMEBUFFER_PRECISION_HIGH\n\n\tuniform mediump sampler2D inputBuffer;\n\n#else\n\n\tuniform lowp sampler2D inputBuffer;\n\n#endif\n\nvarying vec2 vUv0;\nvarying vec2 vUv1;\nvarying vec2 vUv2;\nvarying vec2 vUv3;\n\nvoid main() {\n\n\tvec4 sum = texture2D(inputBuffer, vUv0); // Top left\n\tsum += texture2D(inputBuffer, vUv1); // Top right\n\tsum += texture2D(inputBuffer, vUv2); // Bottom right\n\tsum += texture2D(inputBuffer, vUv3); // Bottom left\n\tgl_FragColor = sum * 0.25; // Compute the average\n\n}\n\n",vertexShader:"\nuniform vec4 texelSize; // XY = texel size, ZW = half texel size\nuniform float kernel;\nuniform float scale;\n\nvarying vec2 vUv0;\nvarying vec2 vUv1;\nvarying vec2 vUv2;\nvarying vec2 vUv3;\n\nvoid main() {\n\n\tvec2 uv = position.xy * 0.5 + 0.5;\n\tvec2 dUv = (texelSize.xy * vec2(kernel) + texelSize.zw) * scale;\n\n\tvUv0 = vec2(uv.x - dUv.x, uv.y + dUv.y);\n\tvUv1 = vec2(uv.x + dUv.x, uv.y + dUv.y);\n\tvUv2 = vec2(uv.x + dUv.x, uv.y - dUv.y);\n\tvUv3 = vec2(uv.x - dUv.x, uv.y - dUv.y);\n\n\tgl_Position = vec4(position.xy, 1.0, 1.0);\n\n}\n"})).setTexelSize(r.x,r.y),e.kernelSize=ms,e}return r=s,(n=[{key:"inputBuffer",set:function(e){this.uniforms.inputBuffer.value=e}},{key:"setInputBuffer",value:function(e){this.inputBuffer=e}},{key:"kernelSequence",get:function(){return Ia[this.kernelSize]}},{key:"scale",get:function(){return this.uniforms.scale.value},set:function(e){this.uniforms.scale.value=e}},{key:"getScale",value:function(){return this.uniforms.scale.value}},{key:"setScale",value:function(e){this.uniforms.scale.value=e}},{key:"getKernel",value:function(){return null}},{key:"kernel",get:function(){return this.uniforms.kernel.value},set:function(e){this.uniforms.kernel.value=e}},{key:"setKernel",value:function(e){this.kernel=e}},{key:"setTexelSize",value:function(e,t){this.uniforms.texelSize.value.set(e,t,.5*e,.5*t)}},{key:"setSize",value:function(e,t){var r=1/e,n=1/t;this.uniforms.texelSize.value.set(r,n,.5*r,.5*n)}}])&&Ea(r.prototype,n),i&&Ea(r,i),Object.defineProperty(r,"prototype",{writable:!1}),s}(t.ShaderMaterial),Pa="srgb";function Na(e){return null===e?null:e.outputColorSpace}function La(e,t){null!==e&&(e.colorSpace=t)}function Ua(e){return Ua="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ua(e)}function Da(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(i=n.key,o=void 0,o=function(e,t){if("object"!==Ua(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==Ua(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(i,"string"),"symbol"===Ua(o)?o:String(o)),n)}var i,o}function Fa(e,t){return Fa=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Fa(e,t)}function Ba(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=ja(e);if(t){var i=ja(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return function(e,t){if(t&&("object"===Ua(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return ka(e)}(this,r)}}function ka(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ja(e){return ja=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},ja(e)}var Ga=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Fa(e,t)}(s,e);var r,n,i,o=Ba(s);function s(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.kernelSize,i=void 0===n?ms:n,a=r.resolutionScale,c=void 0===a?.5:a,l=r.width,u=void 0===l?hs.AUTO_SIZE:l,h=r.height,p=void 0===h?hs.AUTO_SIZE:h,d=r.resolutionX,f=void 0===d?u:d,m=r.resolutionY,g=void 0===m?p:m;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(e=o.call(this,"KawaseBlurPass")).renderTargetA=new t.WebGLRenderTarget(1,1,{depthBuffer:!0}),e.renderTargetA.texture.name="Blur.Target.A",e.renderTargetB=e.renderTargetA.clone(),e.renderTargetB.texture.name="Blur.Target.B",e.resolution=new hs(ka(e),f,g,c),e._blurMaterial=new Oa,e._blurMaterial.kernelSize=i,e.copyMaterial=new Zo,e}return r=s,n=[{key:"getResolution",value:function(){return this.resolution}},{key:"blurMaterial",get:function(){return this._blurMaterial},set:function(e){this._blurMaterial=e}},{key:"dithering",get:function(){return this.copyMaterial.dithering},set:function(e){this.copyMaterial.dithering=e}},{key:"kernelSize",get:function(){return this.blurMaterial.kernelSize},set:function(e){this.blurMaterial.kernelSize=e}},{key:"width",get:function(){return this.resolution.width},set:function(e){this.resolution.preferredWidth=e}},{key:"height",get:function(){return this.resolution.height},set:function(e){this.resolution.preferredHeight=e}},{key:"scale",get:function(){return this.blurMaterial.scale},set:function(e){this.blurMaterial.scale=e}},{key:"getScale",value:function(){return this.blurMaterial.scale}},{key:"setScale",value:function(e){this.blurMaterial.scale=e}},{key:"getKernelSize",value:function(){return this.kernelSize}},{key:"setKernelSize",value:function(e){this.kernelSize=e}},{key:"getResolutionScale",value:function(){return this.resolution.scale}},{key:"setResolutionScale",value:function(e){this.resolution.scale=e}},{key:"render",value:function(e,t,r,n,i){var o=this.scene,s=this.camera,a=this.renderTargetA,c=this.renderTargetB,l=this.blurMaterial,u=l.kernelSequence,h=t;this.fullscreenMaterial=l;for(var p=0,d=u.length;p<d;++p){var f=0==(1&p)?a:c;l.kernel=u[p],l.inputBuffer=h.texture,e.setRenderTarget(f),e.render(o,s),h=f}this.fullscreenMaterial=this.copyMaterial,this.copyMaterial.inputBuffer=h.texture,e.setRenderTarget(this.renderToScreen?null:r),e.render(o,s)}},{key:"setSize",value:function(e,t){var r=this.resolution;r.setBaseSize(e,t);var n=r.width,i=r.height;this.renderTargetA.setSize(n,i),this.renderTargetB.setSize(n,i),this.blurMaterial.setSize(e,t)}},{key:"initialize",value:function(e,r,n){void 0!==n&&(this.renderTargetA.texture.type=n,this.renderTargetB.texture.type=n,n!==t.UnsignedByteType?(this.blurMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.copyMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1"):Na(e)===Pa&&(La(this.renderTargetA.texture,Pa),La(this.renderTargetB.texture,Pa)))}}],i=[{key:"AUTO_SIZE",get:function(){return hs.AUTO_SIZE}}],n&&Da(r.prototype,n),i&&Da(r,i),Object.defineProperty(r,"prototype",{writable:!1}),s}(qo);function za(e){return za="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},za(e)}function Va(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(i=n.key,o=void 0,o=function(e,t){if("object"!==za(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==za(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(i,"string"),"symbol"===za(o)?o:String(o)),n)}var i,o}function Ha(e,t){return Ha=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Ha(e,t)}function Wa(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Ya(e);if(t){var i=Ya(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return function(e,t){if(t&&("object"===za(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Xa(e)}(this,r)}}function Xa(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ya(e){return Ya=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Ya(e)}var qa=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Ha(e,t)}(s,e);var r,n,i,o=Wa(s);function s(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.blendFunction,i=void 0===n?ps.SCREEN:n,a=r.intensity,c=void 0===a?1:a,l=r.kernelSize,u=void 0===l?gs:l,h=r.resolutionScale,p=void 0===h?.5:h,d=r.width,f=void 0===d?hs.AUTO_SIZE:d,m=r.height,g=void 0===m?hs.AUTO_SIZE:m,y=r.resolutionX,v=void 0===y?f:y,_=r.resolutionY,b=void 0===_?g:_;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(e=o.call(this,"KawaseBlurEffect","\nuniform sampler2D map;\nvoid mainImage(const in vec4 inputColor, const in vec2 uv, out vec4 outputColor) {\n\n\toutputColor = texture2D(map, uv);\n\n}\n",{blendFunction:i,uniforms:new Map([["map",new t.Uniform(null)],["intensity",new t.Uniform(c)]])})).renderTarget=new t.WebGLRenderTarget(1,1,{depthBuffer:!1}),e.renderTarget.texture.name="Bloom.Target",e.blurPass=new Ga({kernelSize:u}),e.uniforms.get("map").value=e.renderTarget.texture;var x=e.resolution=new hs(Xa(e),v,b,p);return x.addEventListener("change",(function(t){e.setSize(x.baseWidth,x.baseHeight)})),e}return r=s,(n=[{key:"texture",get:function(){return this.renderTarget.texture}},{key:"getTexture",value:function(){return this.texture}},{key:"getBlurPass",value:function(){return this.blurPass}},{key:"width",get:function(){return this.resolution.width},set:function(e){this.resolution.preferredWidth=e}},{key:"height",get:function(){return this.resolution.height},set:function(e){this.resolution.preferredHeight=e}},{key:"dithering",get:function(){return this.blurPass.dithering},set:function(e){this.blurPass.dithering=e}},{key:"kernelSize",get:function(){return this.blurPass.kernelSize},set:function(e){this.blurPass.kernelSize=e}},{key:"distinction",get:function(){return console.warn(this.name,"distinction was removed"),1},set:function(e){console.warn(this.name,"distinction was removed")}},{key:"intensity",get:function(){return this.uniforms.get("intensity").value},set:function(e){this.uniforms.get("intensity").value=e}},{key:"getIntensity",value:function(){return this.intensity}},{key:"setIntensity",value:function(e){this.intensity=e}},{key:"update",value:function(e,t,r){var n=this.renderTarget;this.blurPass.render(e,t,n)}},{key:"setSize",value:function(e,t){var r=this.resolution;r.setBaseSize(e,t),this.renderTarget.setSize(r.width,r.height),this.blurPass.resolution.copy(r)}},{key:"initialize",value:function(e,t,r){this.blurPass.initialize(e,t,r),void 0!==r&&(this.renderTarget.texture.type=r,Na(e)===Pa&&(this.renderTarget.texture.colorSpace=Pa))}}])&&Va(r.prototype,n),i&&Va(r,i),Object.defineProperty(r,"prototype",{writable:!1}),s}(Ts);function Ja(e){return Ja="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ja(e)}function Ka(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(i=n.key,o=void 0,o=function(e,t){if("object"!==Ja(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==Ja(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(i,"string"),"symbol"===Ja(o)?o:String(o)),n)}var i,o}function Za(e,t){return Za=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Za(e,t)}function Qa(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=ec(e);if(t){var i=ec(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return function(e,t){if(t&&("object"===Ja(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return $a(e)}(this,r)}}function $a(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ec(e){return ec=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},ec(e)}var tc=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Za(e,t)}(s,e);var r,n,i,o=Qa(s);function s(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.blendFunction,i=void 0===n?ps.SCREEN:n,a=r.luminanceThreshold,c=void 0===a?.9:a,l=r.luminanceSmoothing,u=void 0===l?.025:l,h=r.mipmapBlur,p=void 0!==h&&h,d=r.intensity,f=void 0===d?1:d,m=r.radius,g=void 0===m?.85:m,y=r.levels,v=void 0===y?8:y,_=r.kernelSize,b=void 0===_?gs:_,x=r.resolutionScale,w=void 0===x?.5:x,S=r.width,M=void 0===S?hs.AUTO_SIZE:S,T=r.height,E=void 0===T?hs.AUTO_SIZE:T,A=r.resolutionX,R=void 0===A?M:A,C=r.resolutionY,I=void 0===C?E:C;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(e=o.call(this,"BloomEffect","\n#ifdef FRAMEBUFFER_PRECISION_HIGH\n\n\tuniform mediump sampler2D map;\n\n#else\n\n\tuniform lowp sampler2D map;\n\n#endif\n\nuniform float intensity;\n\nvoid mainImage(const in vec4 inputColor, const in vec2 uv, out vec4 outputColor) {\n\n\toutputColor = texture2D(map, uv) * intensity;\n\n}\n",{blendFunction:i,uniforms:new Map([["map",new t.Uniform(null)],["intensity",new t.Uniform(f)]])})).renderTarget=new t.WebGLRenderTarget(1,1,{depthBuffer:!1}),e.renderTarget.texture.name="Bloom.Target",e.blurPass=new _s({kernelSize:b}),e.luminancePass=new xs({colorOutput:!0}),e.luminanceMaterial.threshold=c,e.luminanceMaterial.smoothing=u,e.mipmapBlurPass=new Ms,e.mipmapBlurPass.enabled=p,e.mipmapBlurPass.radius=g,e.mipmapBlurPass.levels=v,e.uniforms.get("map").value=p?e.mipmapBlurPass.texture:e.renderTarget.texture;var O=e.resolution=new hs($a(e),R,I,w);return O.addEventListener("change",(function(t){return e.setSize(O.baseWidth,O.baseHeight)})),e}return r=s,(n=[{key:"texture",get:function(){return this.mipmapBlurPass.enabled?this.mipmapBlurPass.texture:this.renderTarget.texture}},{key:"getTexture",value:function(){return this.texture}},{key:"getResolution",value:function(){return this.resolution}},{key:"getBlurPass",value:function(){return this.blurPass}},{key:"getLuminancePass",value:function(){return this.luminancePass}},{key:"luminanceMaterial",get:function(){return this.luminancePass.fullscreenMaterial}},{key:"getLuminanceMaterial",value:function(){return this.luminancePass.fullscreenMaterial}},{key:"width",get:function(){return this.resolution.width},set:function(e){this.resolution.preferredWidth=e}},{key:"height",get:function(){return this.resolution.height},set:function(e){this.resolution.preferredHeight=e}},{key:"dithering",get:function(){return this.blurPass.dithering},set:function(e){this.blurPass.dithering=e}},{key:"kernelSize",get:function(){return this.blurPass.kernelSize},set:function(e){this.blurPass.kernelSize=e}},{key:"distinction",get:function(){return console.warn(this.name,"distinction was removed"),1},set:function(e){console.warn(this.name,"distinction was removed")}},{key:"intensity",get:function(){return this.uniforms.get("intensity").value},set:function(e){this.uniforms.get("intensity").value=e}},{key:"getIntensity",value:function(){return this.intensity}},{key:"setIntensity",value:function(e){this.intensity=e}},{key:"getResolutionScale",value:function(){return this.resolution.scale}},{key:"setResolutionScale",value:function(e){this.resolution.scale=e}},{key:"update",value:function(e,t,r){var n=this.renderTarget,i=this.luminancePass;i.enabled?(i.render(e,t),this.mipmapBlurPass.enabled?this.mipmapBlurPass.render(e,i.renderTarget):this.blurPass.render(e,i.renderTarget,n)):this.mipmapBlurPass.enabled?this.mipmapBlurPass.render(e,t):this.blurPass.render(e,t,n)}},{key:"setSize",value:function(e,t){var r=this.resolution;r.setBaseSize(e,t),this.renderTarget.setSize(r.width,r.height),this.blurPass.resolution.copy(r),this.luminancePass.setSize(e,t),this.mipmapBlurPass.setSize(e,t)}},{key:"initialize",value:function(e,r,n){this.blurPass.initialize(e,r,n),this.luminancePass.initialize(e,r,n),this.mipmapBlurPass.initialize(e,r,n),void 0!==n&&(this.renderTarget.texture.type=n,e.outputColorSpace===t.SRGBColorSpace&&(this.renderTarget.texture.colorSpace=t.SRGBColorSpace))}}])&&Ka(r.prototype,n),i&&Ka(r,i),Object.defineProperty(r,"prototype",{writable:!1}),s}(Ts);function rc(e){return rc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},rc(e)}function nc(e,t,r){return nc=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}()?Reflect.construct.bind():function(e,t,r){var n=[null];n.push.apply(n,t);var i=new(Function.bind.apply(e,n));return r&&ic(i,r.prototype),i},nc.apply(null,arguments)}function ic(e,t){return ic=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},ic(e,t)}function oc(e){return function(e){if(Array.isArray(e))return cc(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||ac(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function sc(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=ac(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,a=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){a=!0,o=e},f:function(){try{s||null==r.return||r.return()}finally{if(a)throw o}}}}function ac(e,t){if(e){if("string"==typeof e)return cc(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?cc(e,t):void 0}}function cc(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function lc(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(i=n.key,o=void 0,o=function(e,t){if("object"!==rc(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==rc(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(i,"string"),"symbol"===rc(o)?o:String(o)),n)}var i,o}var uc=new t.Raycaster,hc=new t.Vector2,pc=new t.Vector2,dc=new t.Vector2,fc=new t.Vector2,mc=new t.Vector2,gc={},yc=0,vc=null,_c=0,bc=0,xc=t.SRGBColorSpace,wc=new t.Vector2,Sc=new t.Box3,Mc=[],Tc=function(){function e(r){function n(){r.app.updateCameras()}!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.clock=new t.Clock,this.editor=r,this.renderer=null,this.pmremGenerator=null,this.modelViewerTexture=null,this.sceneHelpers=r.sceneHelpers,this.showSceneHelpers=!0,this.composer=null,this.effectPass=null,this.renderPass=null,this.currentEffects=[],this.signals=r.signals,this.container=r.canvas,r.app.isTestEnv&&(this.viewportInfo=new go(r)),this.signals.cameraAdded.add(n),this.signals.cameraRemoved.add(n),n(),this.grid=new t.Group,this.generateGrid(this.grid),this.viewHelper=null,this.lookAtHelper=null,r.app.isDoraEditor&&(this.viewHelper=new Co(this.editor.camera,this.editor),this.lookAtHelper=new Do(this.editor)),this.selectionBox=new t.Box3Helper(Sc),this.selectionBox.material.depthTest=!1,this.selectionBox.material.transparent=!0,this.selectionBox.visible=!1,this.sceneHelpers.add(this.selectionBox),this.objectPositionOnDown=null,this.objectRotationOnDown=null,this.objectScaleOnDown=null,this.transformControls=null,this.init()}var r,n,i;return r=e,n=[{key:"createTransformControls",value:function(){var e=this;this.editor.app.isDoraEditor&&(this.transformControls=new Di(this.editor.camera,this.container),this.transformControls.addEventListener("translate",(function(t){var r=e.transformControls.object;void 0!==r&&e.editor.app.doUpdateObjectCallback(r.uuid,"position",t.position.toArray())})),this.transformControls.addEventListener("scale",(function(t){var r=e.transformControls.object;void 0!==r&&e.editor.app.doUpdateObjectCallback(r.uuid,"scale",t.scale.toArray())})),this.transformControls.addEventListener("rotation",(function(t){var r=e.transformControls.object;void 0!==r&&e.editor.app.doUpdateObjectCallback(r.uuid,"rotation",t.rotation)})),this.transformControls.addEventListener("mouseDown",(function(){var t=e.transformControls.object;e.objectPositionOnDown=t.position.clone(),e.objectRotationOnDown=t.rotation.clone(),e.objectScaleOnDown=t.scale.clone(),e.controls.enabled=!1})),this.transformControls.addEventListener("mouseUp",(function(){var t=e.transformControls.object;if(void 0!==t)switch(e.transformControls.getMode()){case"translate":e.objectPositionOnDown.equals(t.position)||(e.editor.execute(new pn(e.editor,t,t.position,e.objectPositionOnDown)),e.editor.app.doUpdateObjectEndCallback(t.uuid,"position"));break;case"rotate":e.objectRotationOnDown.equals(t.rotation)||(e.editor.execute(new _n(e.editor,t,t.rotation,e.objectRotationOnDown)),e.editor.app.doUpdateObjectEndCallback(t.uuid,"rotation"));break;case"scale":e.objectScaleOnDown.equals(t.scale)||(e.editor.execute(new En(e.editor,t,t.scale,e.objectScaleOnDown)),e.editor.app.doUpdateObjectEndCallback(t.uuid,"scale"))}e.controls.enabled=!0})),this.sceneHelpers.add(this.transformControls))}},{key:"generateGrid",value:function(e){var r=new t.GridHelper(500,500,13750737,13750737);r.material.color.setHex(13750737),r.material.vertexColors=!1,r.name="level0",r.slug="opacity",e.add(r);var n=new Ho(500,50,16753566,6148863,11250603);n.material.depthFunc=t.AlwaysDepth,n.material.vertexColors=!0,n.name="level0",e.add(n)}},{key:"updateAspectRatio",value:function(){this.editor.camera&&(this.editor.aspect=this.editor.canvasWidth/this.editor.canvasHeight,this.editor.camera.aspect=this.editor.aspect,this.editor.camera.updateProjectionMatrix(),this.editor.viewportCamera.aspect=this.editor.camera.aspect,this.editor.viewportCamera.updateProjectionMatrix())}},{key:"getIntersects",value:function(e){hc.set(2*e.x-1,-2*e.y+1),uc.setFromCamera(hc,this.editor.camera);var t=[];return scene.traverseVisible((function(e){t.push(e)})),this.sceneHelpers.traverseVisible((function(e){"picker"===e.name&&t.push(e)})),uc.intersectObjects(t,!1)}},{key:"getMousePosition",value:function(e,t){var r=this.container.getBoundingClientRect();return[(e-r.left)/r.width,(t-r.top)/r.height]}},{key:"handleClick",value:function(){if(0===pc.distanceTo(dc)){var e=this.getIntersectsFor(dc,this.editor.scene);this.signals.intersectionsDetected.dispatch(e,!1)}}},{key:"onTouchEnd",value:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){var t=e.changedTouches[0],r=this.getMousePosition(t.clientX,t.clientY);dc.fromArray(r),handleClick(),document.removeEventListener("touchend",onTouchEnd)}))},{key:"getIntersectsFor",value:function(e,t){if(null==t)return[];hc.set(2*e.x-1,-2*e.y+1),uc.setFromCamera(hc,this.editor.camera);var r=[];return t.traverseVisible((function(e){r.push(e)})),this.sceneHelpers.traverseVisible((function(e){"picker"===e.name&&r.push(e)})),uc.intersectObjects(r,!1)}},{key:"hitTest",value:function(e,t){var r=this.getMousePosition(e,t);mc.fromArray(r);var n=this.getIntersectsFor(mc,this.editor.scene);if(n.length>0){var i=n[0].object,o=this,s=function e(t){return null==t.parent?void 0:t.parent==o.editor.scene?t:e(t.parent)}(i);return null!=s&&void 0!==s.userData.object?s.userData.object:s}return null}},{key:"createControls",value:function(){this.controls=new lo(this.editor,this.editor.camera,this.container),this.controls.updateConfig(this.editor.app.cameraController),this.viewHelper&&(this.viewHelper.controls=this.controls)}},{key:"init",value:function(){var e=this,r=this;function n(e){var t=r.getMousePosition(e.clientX,e.clientY);dc.fromArray(t),r.handleClick(),document.removeEventListener("mouseup",n)}function i(e){e.preventDefault();var t=r.getMousePosition(e.clientX,e.clientY);pc.fromArray(t),document.addEventListener("mouseup",n)}function o(e){var t=e.changedTouches[0],n=r.getMousePosition(t.clientX,t.clientY);pc.fromArray(n),document.addEventListener("touchend",onTouchEnd)}function s(e){var t=r.getMousePosition(e.clientX,e.clientY);if(fc.fromArray(t),0===pc.distanceTo(dc)){var n=r.getIntersectsFor(fc,r.editor.selected);n.isEmpty&&(n=r.getIntersectsFor(fc,scene)),r.signals.intersectionsDetected.dispatch(n,!0)}}this.editor.app.isDoraEditor&&(this.container.addEventListener("mousedown",i),this.container.addEventListener("touchstart",o),this.container.addEventListener("dblclick",s)),this.signals.updateCameraController.add((function(t){e.controls.updateConfig(t)})),this.signals.setDefautCamera.add((function(){e.controls.camera=e.editor.camera,e.controls.updateConfig(e.controls.getConfig())})),this.signals.updateCameraControllerProperty.add((function(t,r){e.controls&&e.controls.updateConfigProperty(t,r)})),this.signals.editorCleared.add((function(){e.controls.center.set(0,0,0)})),this.signals.transformModeChanged.add((function(t){e.transformControls.setMode(t)})),this.signals.snapChanged.add((function(t){e.transformControls.setTranslationSnap(t)})),this.signals.spaceChanged.add((function(t){e.transformControls.setSpace(t)})),this.signals.rendererUpdated.add((function(){e.editor&&e.editor.scene&&e.editor.scene.traverse((function(e){void 0!==e.material&&(e.material.needsUpdate=!0)}))})),this.signals.rendererCreated.add((function(n){null!==r.renderer&&(r.renderer.setAnimationLoop(null),r.renderer.dispose(),r.pmremGenerator.dispose(),r.container.dom.removeChild(r.renderer.domElement)),r.renderer=n,r.renderer.setAnimationLoop((function(){return e.animate()})),r.renderer.setClearColor(0,0),r.renderer.setPixelRatio(e.editor.pixelRatio),r.renderer.setSize(e.editor.canvasWidth,e.editor.canvasHeight,!1),r.pmremGenerator=new t.PMREMGenerator(r.renderer),r.pmremGenerator.compileEquirectangularShader()})),this.signals.sceneGraphChanged.add((function(){})),this.signals.sceneRender.add((function(){})),this.signals.objectSelected.add((function(t){e.selectionBox.visible=!1,e.transformControls.detach();try{null!==t&&t!==e.editor.scene&&t!==e.editor.camera&&(Sc.setFromObject(t,!0),!1===Sc.isEmpty()&&(e.selectionBox.visible=!0),e.transformControls.attach(t))}catch(e){console.warn(e)}})),this.signals.objectFocused.add((function(t){e.controls.focus(t)})),this.signals.geometryChanged.add((function(e){void 0!==e&&Sc.setFromObject(e,!0)})),this.signals.objectChanged.add((function(t){e.editor.selected===t&&Sc.setFromObject(t,!0),t.isPerspectiveCamera&&t.updateProjectionMatrix();var r=e.editor.helpers[t.id];void 0!==r&&!0!==r.isSkeletonHelper&&r.update()})),this.signals.objectRemoved.add((function(t){e.controls.enabled=!0,t===e.transformControls.object&&e.transformControls.detach()})),this.signals.materialChanged.add((function(){})),this.signals.sceneBackgroundChanged.add((function(e,r,n,i){switch(e){case"None":scene.background=null;break;case"Color":scene.background=new t.Color(r);break;case"Texture":n&&(scene.background=n);break;case"Equirectangular":i&&(i.mapping=t.EquirectangularReflectionMapping,scene.background=i)}})),this.signals.sceneEnvironmentChanged.add((function(r,n){switch(r){case"none":e.editor.scene.environment=null;break;case"equirectangular":e.editor.scene.environment=null,n&&(n.mapping=t.EquirectangularReflectionMapping,e.editor.scene.environment=n);break;case"modelViewer":null==e.modelViewerTexture&&(e.modelViewerTexture=e.pmremGenerator.fromScene(new Fo,.04).texture),e.editor.scene.environment=e.modelViewerTexture}})),this.signals.sceneFogChanged.add((function(e,r,n,i,o){switch(e){case"None":scene.fog=null;break;case"Fog":scene.fog=new t.Fog(r,n,i);break;case"FogExp2":scene.fog=new t.FogExp2(r,o)}})),this.signals.sceneFogSettingsChanged.add((function(e,t,r,n,i){switch(e){case"Fog":scene.fog.color.setHex(t),scene.fog.near=r,scene.fog.far=n;break;case"FogExp2":scene.fog.color.setHex(t),scene.fog.density=i}})),this.signals.viewportCameraChanged.add((function(){if(e.editor.app.isDoraEditor){var t=e.editor.viewportCamera;t&&(t.isPerspectiveCamera?(t.aspect=e.editor.camera.aspect,t.projectionMatrix.copy(e.editor.camera.projectionMatrix)):t.isOrthographicCamera),e.controls&&(e.controls.enabled=t===e.editor.camera)}})),this.signals.windowResize.add((function(t,r){if(!(t<=0||r<=0)){e.updateAspectRatio(),e.renderer.setSize(t,r,!1);try{e.render()}catch(e){console.warn(e)}}})),this.signals.showGridChanged.add((function(e){grid.visible=e})),this.signals.showHelpersChanged.add((function(t){e.showSceneHelpers=t,e.transformControls.enabled=t})),this.signals.cameraResetted.add((function(){return e.updateAspectRatio()})),this.dispose=function(){this.signals=null,this.container.removeEventListener("mousedown",i),this.container.removeEventListener("touchstart",o),this.container.removeEventListener("dblclick",s),this.container=null,this.transformControls.dispose(),this.transformControls=null,this.viewHelper&&(this.viewHelper.controls=null,this.viewHelper.dispose(),this.viewHelper=null),this.controls.dispose(),this.controls=null}}},{key:"animate",value:function(){var e=this.editor.app;if(e&&e.isVisible){var t=this.editor.mixer,r=this.clock.getDelta(),n=t.stats.actions;(n.inUse>0||yc>0)&&(yc=n.inUse,t.update(r)),Object.keys(e.mixers).forEach((function(t){var n=e.mixers[t];1==n.autoPlay&&n.update(r)})),this.viewHelper&&this.viewHelper.controls&&!0===this.viewHelper.animating&&this.viewHelper.update(r);try{this.render()}catch(e){}}}},{key:"setGridScale",value:function(e){var r=new t.Vector3(8,5,5).distanceTo(new t.Vector3(0,0,0)),n=this.editor.camera.position.distanceTo(new t.Vector3(0,0,0));if(vc!=n){vc=n;var i=1;if(0!=n&&(i=r/n),0!=n)if(i<1){var o,s=function(e){for(var t=1;!(Math.pow(.1,t)<e);)t+=1;return t}(i),a=(i-Math.pow(.1,s))/Math.pow(.1,s-1),c=sc(e.children);try{for(c.s();!(o=c.n()).done;){var l=o.value;"opacity"==l.slug&&(l.material.opacity=a,l.material.transparent=!0,l.material.needsUpdate=!0)}}catch(e){c.e(e)}finally{c.f()}0==(h=Math.pow(10,s-1))&&(h=1),e.scale.set(h,h,h)}else{s=function(e){for(var t=1;!(Math.pow(10,t)>e);)t+=1;return t}(i),a=(i-Math.pow(10,s-1))/Math.pow(10,s);var u,h,p=sc(e.children);try{for(p.s();!(u=p.n()).done;){var d=u.value;"opacity"==d.slug&&(d.material.opacity=a,d.material.transparent=!0,d.material.needsUpdate=!0)}}catch(e){p.e(e)}finally{p.f()}0==(h=Math.pow(.1,s))&&(h=1),e.scale.set(h,h,h)}}}},{key:"preRender",value:function(){var e=this;this.editor.scene.currentEnvironmentType!=this.editor.scene.environmentType&&(this.editor.signals.sceneEnvironmentChanged.dispatch(this.editor.scene.environmentType,void 0),this.editor.scene.currentEnvironmentType=this.editor.scene.environmentType),this.editor.scene.traverse((function(t){t.modelAnimationsNeedsUpdate&&(t.modelAnimationsNeedsUpdate=!1,e.editor.app.updateObjectAnimations(t)),t.isSkinnedMesh&&void 0===t.skeleton&&(t.isSkinnedMesh=!1),null!=t.skeleton&&!1===t.isSkinnedMesh&&(t.isSkinnedMesh=!0)}))}},{key:"render",value:function(){if(window.renderLogEnable&&(console.log(" render isActivate ".concat(this.editor.app.isActivate," ")),console.log(this.editor)),this.editor.viewportCamera&&this.editor.scene&&!(this.editor.canvasWidth<=0||this.editor.canvasHeight<=0)&&(this.renderer.getSize(wc),!(wc.x<=0||wc.y<=0)&&(_c=performance.now(),this.editor.app.isActivate))){if(this.preRender(),this.handlePostprocessing(),this.controls.update(),!this.editor.app.isDoraEditor)return this.renderer.setViewport(0,0,this.editor.canvasWidth,this.editor.canvasHeight),void this.renderWith(this.editor.app.postprocessingEnable);var e=this.editor.app.isActive;this.renderer.setViewport(0,0,this.editor.canvasWidth,this.editor.canvasHeight),this.renderWith(this.editor.app.postprocessingEnable),e&&this.editor.camera===this.editor.viewportCamera&&(this.renderer.autoClear=!1,xc=this.renderer.outputColorSpace,this.renderer.outputColorSpace=t.LinearSRGBColorSpace,!0===this.showSceneHelpers&&this.renderer.render(this.sceneHelpers,this.editor.viewportCamera),this.viewHelper&&this.viewHelper.render(this.renderer),this.editor.app.isActive&&this.editor.scene.children.length>0&&this.lookAtHelper&&this.lookAtHelper.render(this.renderer),this.renderer.autoClear=!0,this.renderer.outputColorSpace=xc),bc=performance.now(),this.signals.sceneRendered.dispatch(bc-_c)}}},{key:"renderWith",value:function(e){var t,r=this.editor.scene,n=this.grid,i=this.editor;e?(this.composer.render(),(t=this.editor.app.isActive)&&(this.setGridScale(n),this.renderer.autoClear=!1,this.renderer.render(n,i.viewportCamera),this.renderer.autoClear=!0)):((t=this.editor.app.isActive)&&(this.setGridScale(n),r.add(n)),this.renderer.render(r,i.viewportCamera),t&&r.remove(n))}},{key:"handlePostprocessing",value:function(){var e=this;if(this.editor.app.postprocessingEnable){this.preparePostprocessing();var t=!1;if(Mc=[],this.editor.app.passItems){var r,n=sc(this.editor.app.passItems);try{for(n.s();!(r=n.n()).done;){var i=r.value;if(i.enable){var o=this.getPassByName(i.type);o&&(this.updatePass(o,i),Mc.push(i.type))}}}catch(e){n.e(e)}finally{n.f()}}this.currentEffects!=Mc&&(t=!0),t&&(this.currentEffects=oc(Mc),this.composer.removePass(this.effectPass),this.effectPass=nc(js,[this.editor.viewportCamera].concat(oc(this.currentEffects.map((function(t){return e.getPassByName(t)}))))),this.composer.addPass(this.effectPass))}}},{key:"updatePass",value:function(e,t){e.blendMode.opacity.value=t.alpha;var r=t.blend||0;0==r&&(r=23),e.blendMode.getBlendFunction()!=r&&e.blendMode.setBlendFunction(r),t.type==Rc?(e.luminancePass.enable=!0,e.mipmapBlurPass.enable=!1,e.uniforms.get("intensity").value=t.intensity,e.blurPass.setKernelSize(Math.floor(t.levels)),e.blurPass.scale=t.radius,e.luminanceMaterial.threshold=t.threshold,e.luminanceMaterial.smoothing=t.smoothing):t.type==Cc?Math.round(e.granularity)!=Math.round(t.granularity)&&(e.granularity=Math.round(t.granularity)):t.type==Ic?(e.uniforms.get("offsetX").value=t.offsetX/this.editor.canvasWidth,e.uniforms.get("offsetY").value=t.offsetY/this.editor.canvasHeight):t.type==Oc?(e.uniforms.get("bandOffset").value=t.bandOffset/10,e.uniforms.get("jitterOffset").value=t.jitterOffset,e.uniforms.get("jitterIntensity").value=t.jitterIntensity,e.uniforms.get("samples").value=t.samples):t.type==Pc?(e.uniforms.get("nIntensity").value=t.nIntensity,e.uniforms.get("sIntensity").value=t.sIntensity,e.uniforms.get("sCount").value=t.sCount,e.uniforms.get("grayscale").value=t.grayscale):t.type==Nc?(e.uniforms.get("shape").value=Math.round(t.shape),e.uniforms.get("radius").value=t.radius,e.uniforms.get("rotateR").value=t.rotateR,e.uniforms.get("rotateG").value=t.rotateG,e.uniforms.get("rotateB").value=t.rotateB,e.uniforms.get("scatter").value=t.scatter,e.uniforms.get("greyscale").value=t.greyscale,e.uniforms.get("width").value=this.editor.canvasWidth,e.uniforms.get("height").value=this.editor.canvasHeight):t.type==Lc?e.uniforms.get("timeEnable").value=Math.floor(t.timeEnable):t.type==Uc?(e.blurPass.kernelSize=t.size,e.blurPass.scale=t.scale):t.type==Dc?(e.minDelay=t.delay,e.maxDelay=t.delay,e.minDuration=t.duration,e.maxDuration=t.duration,e.minStrength=t.strength,e.maxStrength=t.strength):t.type==Fc?(e.hue=t.hue,e.saturation=t.saturation):console.log(" updatePass unsupport type ".concat(t.type," "))}},{key:"preparePostprocessing",value:function(){this.effectPass||(this.effectPass=this.getPassByName(Ec)),this.composer||(this.composer=new rs(this.renderer,{stencilBuffer:!0,multisampling:4,frameBufferType:t.HalfFloatType}),this.renderPass=new Ls(this.editor.scene,this.editor.viewportCamera),this.composer.addPass(this.renderPass))}},{key:"getPassByName",value:function(e){return gc[e]||(gc[e]=this.createPassByName(e)),gc[e]}},{key:"createPassByName",value:function(e){return e==Ac?new Ls(scene,this.editor.viewportCamera):e==Ec?new js(this.editor.viewportCamera):e==Rc?new tc({blendFunction:ps.ADD,mipmapBlur:!1,intensity:1,radius:1,levels:4,resolutionScale:.5,luminanceThreshold:0,kernelSize:ms}):e==Cc?new Us:e==Ic?new qs:e==Oc?new ea:e==Pc?new sa:e==Nc?new pa:e==Lc?new Ma:e==Uc?new qa:e==Dc?new Ns:e==Fc?new va:void console.error(" unsupport createPassByName ".concat(e," Effect  "))}},{key:"dispose",value:function(){this.renderer.setAnimationLoop(null),this.renderer.dispose(),this.pmremGenerator.dispose()}}],n&&lc(r.prototype,n),i&&lc(r,i),Object.defineProperty(r,"prototype",{writable:!1}),e}();var Ec="effectPass",Ac="renderPass",Rc="bloomPass",Cc="pixelationPass",Ic="aberrationPass",Oc="distortionPass",Pc="filmPass",Nc="halftonePass",Lc="noisePass",Uc="blurPass",Dc="glitchPass",Fc="hueSaturationPass";function Bc(e){var r=e.signals,n=null;(n=new t.WebGLRenderer({canvas:e.canvas,antialias:!0,alpha:!0,preserveDrawingBuffer:!0})).shadowMap.enabled=!0,n.shadowMap.type=parseFloat(1),n.toneMapping=parseFloat(0),n.toneMappingExposure=1,e.app.isTestEnv||e.app.isLocalhost?n.debug.checkShaderErrors=!0:n.debug.checkShaderErrors=!1,r.rendererCreated.dispatch(n),r.rendererUpdated.dispatch()}function kc(e){return kc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},kc(e)}function jc(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(i=n.key,o=void 0,o=function(e,t){if("object"!==kc(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==kc(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(i,"string"),"symbol"===kc(o)?o:String(o)),n)}var i,o}const Gc=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.app=t}var t,r,n;return t=e,r=[{key:"callMethod",value:function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];this.app.message_from_js&&this.app.message_from_js(e,r)}}],r&&jc(t.prototype,r),n&&jc(t,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();let zc,Vc,Hc,Wc;function Xc(e,r=1/0,n=null){Vc||(Vc=new t.PlaneGeometry(2,2,1,1)),Hc||(Hc=new t.ShaderMaterial({uniforms:{blitTexture:new t.Uniform(e)},vertexShader:"\n\t\t\tvarying vec2 vUv;\n\t\t\tvoid main(){\n\t\t\t\tvUv = uv;\n\t\t\t\tgl_Position = vec4(position.xy * 1.0,0.,.999999);\n\t\t\t}",fragmentShader:"\n\t\t\tuniform sampler2D blitTexture; \n\t\t\tvarying vec2 vUv;\n\n\t\t\tvoid main(){ \n\t\t\t\tgl_FragColor = vec4(vUv.xy, 0, 1);\n\t\t\t\t\n\t\t\t\t#ifdef IS_SRGB\n\t\t\t\tgl_FragColor = LinearTosRGB( texture2D( blitTexture, vUv) );\n\t\t\t\t#else\n\t\t\t\tgl_FragColor = texture2D( blitTexture, vUv);\n\t\t\t\t#endif\n\t\t\t}"})),Hc.uniforms.blitTexture.value=e,Hc.defines.IS_SRGB=e.colorSpace==t.SRGBColorSpace,Hc.needsUpdate=!0,Wc||(Wc=new t.Mesh(Vc,Hc),Wc.frustumCulled=!1);const i=new t.PerspectiveCamera,o=new t.Scene;o.add(Wc),null===n&&(n=zc=new t.WebGLRenderer({antialias:!1}));const s=Math.min(e.image.width,r),a=Math.min(e.image.height,r);n.setSize(s,a),n.clear(),n.render(o,i);const c=document.createElement("canvas"),l=c.getContext("2d");c.width=s,c.height=a,l.drawImage(n.domElement,0,0,s,a);const u=new t.CanvasTexture(c);return u.minFilter=e.minFilter,u.magFilter=e.magFilter,u.wrapS=e.wrapS,u.wrapT=e.wrapT,u.name=e.name,zc&&(zc.forceContextLoss(),zc.dispose(),zc=null),u}function Yc(e){return Yc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Yc(e)}function qc(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(i=n.key,o=void 0,o=function(e,t){if("object"!==Yc(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==Yc(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(i,"string"),"symbol"===Yc(o)?o:String(o)),n)}var i,o}var Jc=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.writer=t,this.name="KHR_materials_pbrSpecularGlossiness"}var t,r,n;return t=e,r=[{key:"writeMaterial",value:function(e,t){if(e.isGLTFSpecularGlossinessMaterial){var r=this.writer,n=r.extensionsUsed,i={};t.pbrMetallicRoughness.baseColorFactor&&(i.diffuseFactor=t.pbrMetallicRoughness.baseColorFactor);var o=[1,1,1];if(e.specular.toArray(o,0),i.specularFactor=o,i.glossinessFactor=e.glossiness,t.pbrMetallicRoughness.baseColorTexture&&(i.diffuseTexture=t.pbrMetallicRoughness.baseColorTexture),e.specularMap){var s={index:r.processTexture(e.specularMap)};r.applyTextureTransform(s,e.specularMap),i.specularGlossinessTexture=s}t.extensions=t.extensions||{},t.extensions[this.name]=i,n[this.name]=!0}}}],r&&qc(t.prototype,r),n&&qc(t,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function Kc(){Kc=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,i=Object.defineProperty||function(e,t,r){e[t]=r.value},o="function"==typeof Symbol?Symbol:{},s=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function u(e,t,r,n){var o=t&&t.prototype instanceof y?t:y,s=Object.create(o.prototype),a=new I(n||[]);return i(s,"_invoke",{value:E(e,r,a)}),s}function h(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=u;var p="suspendedStart",d="suspendedYield",f="executing",m="completed",g={};function y(){}function v(){}function _(){}var b={};l(b,s,(function(){return this}));var x=Object.getPrototypeOf,w=x&&x(x(O([])));w&&w!==r&&n.call(w,s)&&(b=w);var S=_.prototype=y.prototype=Object.create(b);function M(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function T(e,t){function r(i,o,s,a){var c=h(e[i],e,o);if("throw"!==c.type){var l=c.arg,u=l.value;return u&&"object"==Qc(u)&&n.call(u,"__await")?t.resolve(u.__await).then((function(e){r("next",e,s,a)}),(function(e){r("throw",e,s,a)})):t.resolve(u).then((function(e){l.value=e,s(l)}),(function(e){return r("throw",e,s,a)}))}a(c.arg)}var o;i(this,"_invoke",{value:function(e,n){function i(){return new t((function(t,i){r(e,n,t,i)}))}return o=o?o.then(i,i):i()}})}function E(t,r,n){var i=p;return function(o,s){if(i===f)throw new Error("Generator is already running");if(i===m){if("throw"===o)throw s;return{value:e,done:!0}}for(n.method=o,n.arg=s;;){var a=n.delegate;if(a){var c=A(a,n);if(c){if(c===g)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===p)throw i=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=f;var l=h(t,r,n);if("normal"===l.type){if(i=n.done?m:d,l.arg===g)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(i=m,n.method="throw",n.arg=l.arg)}}}function A(t,r){var n=r.method,i=t.iterator[n];if(i===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,A(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),g;var o=h(i,t.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,g;var s=o.arg;return s?s.done?(r[t.resultName]=s.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,g):s:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,g)}function R(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function C(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function I(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(R,this),this.reset(!0)}function O(t){if(t||""===t){var r=t[s];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,o=function r(){for(;++i<t.length;)if(n.call(t,i))return r.value=t[i],r.done=!1,r;return r.value=e,r.done=!0,r};return o.next=o}}throw new TypeError(Qc(t)+" is not iterable")}return v.prototype=_,i(S,"constructor",{value:_,configurable:!0}),i(_,"constructor",{value:v,configurable:!0}),v.displayName=l(_,c,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===v||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,_):(e.__proto__=_,l(e,c,"GeneratorFunction")),e.prototype=Object.create(S),e},t.awrap=function(e){return{__await:e}},M(T.prototype),l(T.prototype,a,(function(){return this})),t.AsyncIterator=T,t.async=function(e,r,n,i,o){void 0===o&&(o=Promise);var s=new T(u(e,r,n,i),o);return t.isGeneratorFunction(r)?s:s.next().then((function(e){return e.done?e.value:s.next()}))},M(S),l(S,c,"Generator"),l(S,s,(function(){return this})),l(S,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=O,I.prototype={constructor:I,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(C),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function i(n,i){return a.type="throw",a.arg=t,r.next=n,i&&(r.method="next",r.arg=e),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var s=this.tryEntries[o],a=s.completion;if("root"===s.tryLoc)return i("end");if(s.tryLoc<=this.prev){var c=n.call(s,"catchLoc"),l=n.call(s,"finallyLoc");if(c&&l){if(this.prev<s.catchLoc)return i(s.catchLoc,!0);if(this.prev<s.finallyLoc)return i(s.finallyLoc)}else if(c){if(this.prev<s.catchLoc)return i(s.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return i(s.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var s=o?o.completion:{};return s.type=e,s.arg=t,o?(this.method="next",this.next=o.finallyLoc,g):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),C(r),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;C(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:O(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),g}},t}function Zc(e,t,r,n,i,o,s){try{var a=e[o](s),c=a.value}catch(e){return void r(e)}a.done?t(c):Promise.resolve(c).then(n,i)}function Qc(e){return Qc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Qc(e)}function $c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function el(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(i=n.key,o=void 0,o=function(e,t){if("object"!==Qc(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==Qc(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(i,"string"),"symbol"===Qc(o)?o:String(o)),n)}var i,o}function tl(e,t,r){return t&&el(e.prototype,t),r&&el(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}var rl={POSITION:["byte","byte normalized","unsigned byte","unsigned byte normalized","short","short normalized","unsigned short","unsigned short normalized"],NORMAL:["byte normalized","short normalized"],TANGENT:["byte normalized","short normalized"],TEXCOORD:["byte","byte normalized","unsigned byte","short","short normalized","unsigned short"]},nl=function(){function e(){$c(this,e),this.pluginCallbacks=[],this.register((function(e){return new Fl(e)})),this.register((function(e){return new Bl(e)})),this.register((function(e){return new Jc(e)})),this.register((function(e){return new zl(e)})),this.register((function(e){return new Vl(e)})),this.register((function(e){return new Hl(e)})),this.register((function(e){return new Wl(e)})),this.register((function(e){return new kl(e)})),this.register((function(e){return new jl(e)})),this.register((function(e){return new Gl(e)})),this.register((function(e){return new Xl(e)})),this.register((function(e){return new Yl(e)})),this.register((function(e){return new ql(e)})),this.register((function(e){return new Jl(e)})),this.register((function(e){return new Kl(e)}))}return tl(e,[{key:"register",value:function(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}},{key:"unregister",value:function(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}},{key:"parse",value:function(e,t,r,n){for(var i=new Dl,o=[],s=0,a=this.pluginCallbacks.length;s<a;s++)o.push(this.pluginCallbacks[s](i));i.setPlugins(o),i.write(e,t,n).catch(r)}},{key:"parseAsync",value:function(e,t){var r=this;return new Promise((function(n,i){r.parse(e,n,i,t)}))}}]),e}(),il=0,ol=1,sl=2,al=3,cl=4,ll=5120,ul=5121,hl=5122,pl=5123,dl=5124,fl=5125,ml=5126,gl=34962,yl=34963,vl=9728,_l=9729,bl=9984,xl=9985,wl=9986,Sl=9987,Ml=33071,Tl=33648,El=10497,Al="KHR_mesh_quantization",Rl={};Rl[t.NearestFilter]=vl,Rl[t.NearestMipmapNearestFilter]=bl,Rl[t.NearestMipmapLinearFilter]=wl,Rl[t.LinearFilter]=_l,Rl[t.LinearMipmapNearestFilter]=xl,Rl[t.LinearMipmapLinearFilter]=Sl,Rl[t.ClampToEdgeWrapping]=Ml,Rl[t.RepeatWrapping]=El,Rl[t.MirroredRepeatWrapping]=Tl;var Cl={scale:"scale",position:"translation",quaternion:"rotation",morphTargetInfluences:"weights"},Il=new t.Color;function Ol(e,t){return e.length===t.length&&e.every((function(e,r){return e===t[r]}))}function Pl(e){return 4*Math.ceil(e/4)}function Nl(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=Pl(e.byteLength);if(r!==e.byteLength){var n=new Uint8Array(r);if(n.set(new Uint8Array(e)),0!==t)for(var i=e.byteLength;i<r;i++)n[i]=t;return n.buffer}return e}function Ll(){return"undefined"==typeof document&&"undefined"!=typeof OffscreenCanvas?new OffscreenCanvas(1,1):document.createElement("canvas")}function Ul(e,t){return void 0!==e.toBlob?new Promise((function(r){return e.toBlob(r,t)})):("image/jpeg"===t?r=.92:"image/webp"===t&&(r=.8),e.convertToBlob({type:t,quality:r}));var r}var Dl=function(){function e(){$c(this,e),this.plugins=[],this.options={},this.pending=[],this.buffers=[],this.byteOffset=0,this.buffers=[],this.nodeMap=new Map,this.skins=[],this.extensionsUsed={},this.extensionsRequired={},this.uids=new Map,this.uid=0,this.json={asset:{version:"2.0",generator:"THREE.GLTFExporter r"+t.REVISION}},this.cache={meshes:new Map,attributes:new Map,attributesNormalized:new Map,materials:new Map,textures:new Map,images:new Map}}var r;return tl(e,[{key:"setPlugins",value:function(e){this.plugins=e}},{key:"write",value:(r=function(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function s(e){Zc(o,n,i,s,a,"next",e)}function a(e){Zc(o,n,i,s,a,"throw",e)}s(void 0)}))}}(Kc().mark((function e(t,r){var n,i,o,s,a,c,l,u,h,p,d,f=arguments;return Kc().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=f.length>2&&void 0!==f[2]?f[2]:{},this.options=Object.assign({binary:!1,trs:!1,onlyVisible:!0,maxTextureSize:1/0,animations:[],includeCustomExtensions:!1},n),this.options.animations.length>0&&(this.options.trs=!0),this.processInput(t),e.next=6,Promise.all(this.pending);case 6:o=(i=this).buffers,s=i.json,n=i.options,a=i.extensionsUsed,c=i.extensionsRequired,l=new Blob(o,{type:"application/octet-stream"}),u=Object.keys(a),h=Object.keys(c),u.length>0&&(s.extensionsUsed=u),h.length>0&&(s.extensionsRequired=h),s.buffers&&s.buffers.length>0&&(s.buffers[0].byteLength=l.size),!0===n.binary?((p=new FileReader).readAsArrayBuffer(l),p.onloadend=function(){var e=Nl(p.result),t=new DataView(new ArrayBuffer(8));t.setUint32(0,e.byteLength,!0),t.setUint32(4,5130562,!0);var n,i=Nl((n=JSON.stringify(s),(new TextEncoder).encode(n).buffer),32),o=new DataView(new ArrayBuffer(8));o.setUint32(0,i.byteLength,!0),o.setUint32(4,1313821514,!0);var a=new ArrayBuffer(12),c=new DataView(a);c.setUint32(0,1179937895,!0),c.setUint32(4,2,!0);var l=12+o.byteLength+i.byteLength+t.byteLength+e.byteLength;c.setUint32(8,l,!0);var u=new Blob([a,o,i,t,e],{type:"application/octet-stream"}),h=new FileReader;h.readAsArrayBuffer(u),h.onloadend=function(){r(h.result)}}):s.buffers&&s.buffers.length>0?((d=new FileReader).readAsDataURL(l),d.onloadend=function(){var e=d.result;s.buffers[0].uri=e,r(s)}):r(s);case 19:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})},{key:"serializeUserData",value:function(e,t){if(0!==Object.keys(e.userData).length){var r=this.options,n=this.extensionsUsed;try{var i=JSON.parse(JSON.stringify(e.userData));if(r.includeCustomExtensions&&i.gltfExtensions){for(var o in void 0===t.extensions&&(t.extensions={}),i.gltfExtensions)t.extensions[o]=i.gltfExtensions[o],n[o]=!0;delete i.gltfExtensions}Object.keys(i).length>0&&(t.extras=i)}catch(t){console.warn("THREE.GLTFExporter: userData of '"+e.name+"' won't be serialized because of JSON.stringify error - "+t.message)}}}},{key:"getUID",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!1===this.uids.has(e)){var r=new Map;r.set(!0,this.uid++),r.set(!1,this.uid++),this.uids.set(e,r)}return this.uids.get(e).get(t)}},{key:"isNormalizedNormalAttribute",value:function(e){if(this.cache.attributesNormalized.has(e))return!1;for(var r=new t.Vector3,n=0,i=e.count;n<i;n++)if(Math.abs(r.fromBufferAttribute(e,n).length()-1)>5e-4)return!1;return!0}},{key:"createNormalizedNormalAttribute",value:function(e){var r=this.cache;if(r.attributesNormalized.has(e))return r.attributesNormalized.get(e);for(var n=e.clone(),i=new t.Vector3,o=0,s=n.count;o<s;o++)i.fromBufferAttribute(n,o),0===i.x&&0===i.y&&0===i.z?i.setX(1):i.normalize(),n.setXYZ(o,i.x,i.y,i.z);return r.attributesNormalized.set(e,n),n}},{key:"applyTextureTransform",value:function(e,t){var r=!1,n={};0===t.offset.x&&0===t.offset.y||(n.offset=t.offset.toArray(),r=!0),0!==t.rotation&&(n.rotation=t.rotation,r=!0),1===t.repeat.x&&1===t.repeat.y||(n.scale=t.repeat.toArray(),r=!0),r&&(e.extensions=e.extensions||{},e.extensions.KHR_texture_transform=n,this.extensionsUsed.KHR_texture_transform=!0)}},{key:"buildMetalRoughTexture",value:function(e,r){if(e===r)return e;function n(e){return e.colorSpace===t.SRGBColorSpace?function(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}:function(e){return e}}console.warn("THREE.GLTFExporter: Merged metalnessMap and roughnessMap textures."),e instanceof t.CompressedTexture&&(e=Xc(e)),r instanceof t.CompressedTexture&&(r=Xc(r));var i=e?e.image:null,o=r?r.image:null,s=Math.max(i?i.width:0,o?o.width:0),a=Math.max(i?i.height:0,o?o.height:0),c=Ll();c.width=s,c.height=a;var l=c.getContext("2d");l.fillStyle="#00ffff",l.fillRect(0,0,s,a);var u=l.getImageData(0,0,s,a);if(i){l.drawImage(i,0,0,s,a);for(var h=n(e),p=l.getImageData(0,0,s,a).data,d=2;d<p.length;d+=4)u.data[d]=256*h(p[d]/256)}if(o){l.drawImage(o,0,0,s,a);for(var f=n(r),m=l.getImageData(0,0,s,a).data,g=1;g<m.length;g+=4)u.data[g]=256*f(m[g]/256)}l.putImageData(u,0,0);var y=(e||r).clone();return y.source=new t.Source(c),y.colorSpace=t.NoColorSpace,y.channel=(e||r).channel,e&&r&&e.channel!==r.channel&&console.warn("THREE.GLTFExporter: UV channels for metalnessMap and roughnessMap textures must match."),y}},{key:"processBuffer",value:function(e){var t=this.json,r=this.buffers;return t.buffers||(t.buffers=[{byteLength:0}]),r.push(e),0}},{key:"processBufferView",value:function(e,r,n,i,o){var s,a=this.json;switch(a.bufferViews||(a.bufferViews=[]),r){case ll:case ul:s=1;break;case hl:case pl:s=2;break;default:s=4}var c=e.itemSize*s;o===gl&&(c=4*Math.ceil(c/4));for(var l=Pl(i*c),u=new DataView(new ArrayBuffer(l)),h=0,p=n;p<n+i;p++){for(var d=0;d<e.itemSize;d++){var f=void 0;e.itemSize>4?f=e.array[p*e.itemSize+d]:(0===d?f=e.getX(p):1===d?f=e.getY(p):2===d?f=e.getZ(p):3===d&&(f=e.getW(p)),!0===e.normalized&&(f=t.MathUtils.normalize(f,e.array))),r===ml?u.setFloat32(h,f,!0):r===dl?u.setInt32(h,f,!0):r===fl?u.setUint32(h,f,!0):r===hl?u.setInt16(h,f,!0):r===pl?u.setUint16(h,f,!0):r===ll?u.setInt8(h,f):r===ul&&u.setUint8(h,f),h+=s}h%c!=0&&(h+=c-h%c)}var m={buffer:this.processBuffer(u.buffer),byteOffset:this.byteOffset,byteLength:l};return void 0!==o&&(m.target=o),o===gl&&(m.byteStride=c),this.byteOffset+=l,a.bufferViews.push(m),{id:a.bufferViews.length-1,byteLength:0}}},{key:"processBufferViewImage",value:function(e){var t=this,r=t.json;return r.bufferViews||(r.bufferViews=[]),new Promise((function(n){var i=new FileReader;i.readAsArrayBuffer(e),i.onloadend=function(){var e=Nl(i.result),o={buffer:t.processBuffer(e),byteOffset:t.byteOffset,byteLength:e.byteLength};t.byteOffset+=e.byteLength,n(r.bufferViews.push(o)-1)}}))}},{key:"processAccessor",value:function(e,r,n,i){var o,s=this.json;if(e.array.constructor===Float32Array)o=ml;else if(e.array.constructor===Int32Array)o=dl;else if(e.array.constructor===Uint32Array)o=fl;else if(e.array.constructor===Int16Array)o=hl;else if(e.array.constructor===Uint16Array)o=pl;else if(e.array.constructor===Int8Array)o=ll;else{if(e.array.constructor!==Uint8Array)throw new Error("THREE.GLTFExporter: Unsupported bufferAttribute component type: "+e.array.constructor.name);o=ul}if(void 0===n&&(n=0),void 0!==i&&i!==1/0||(i=e.count),0===i)return null;var a,c=function(e,r,n){for(var i={min:new Array(e.itemSize).fill(Number.POSITIVE_INFINITY),max:new Array(e.itemSize).fill(Number.NEGATIVE_INFINITY)},o=r;o<r+n;o++)for(var s=0;s<e.itemSize;s++){var a=void 0;e.itemSize>4?a=e.array[o*e.itemSize+s]:(0===s?a=e.getX(o):1===s?a=e.getY(o):2===s?a=e.getZ(o):3===s&&(a=e.getW(o)),!0===e.normalized&&(a=t.MathUtils.normalize(a,e.array))),i.min[s]=Math.min(i.min[s],a),i.max[s]=Math.max(i.max[s],a)}return i}(e,n,i);void 0!==r&&(a=e===r.index?yl:gl);var l=this.processBufferView(e,o,n,i,a),u={bufferView:l.id,byteOffset:l.byteOffset,componentType:o,count:i,max:c.max,min:c.min,type:{1:"SCALAR",2:"VEC2",3:"VEC3",4:"VEC4",9:"MAT3",16:"MAT4"}[e.itemSize]};return!0===e.normalized&&(u.normalized=!0),s.accessors||(s.accessors=[]),s.accessors.push(u)-1}},{key:"processImage",value:function(e,r,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png";if(null!==e){var o=this,s=o.cache,a=o.json,c=o.options,l=o.pending;s.images.has(e)||s.images.set(e,{});var u=s.images.get(e),h=i+":flipY/"+n.toString();if(void 0!==u[h])return u[h];a.images||(a.images=[]);var p={mimeType:i},d=Ll();d.width=Math.min(e.width,c.maxTextureSize),d.height=Math.min(e.height,c.maxTextureSize);var f=d.getContext("2d");if(!0===n&&(f.translate(0,d.height),f.scale(1,-1)),void 0!==e.data){r!==t.RGBAFormat&&console.error("GLTFExporter: Only RGBAFormat is supported.",r),(e.width>c.maxTextureSize||e.height>c.maxTextureSize)&&console.warn("GLTFExporter: Image size is bigger than maxTextureSize",e);for(var m=new Uint8ClampedArray(e.height*e.width*4),g=0;g<m.length;g+=4)m[g+0]=e.data[g+0],m[g+1]=e.data[g+1],m[g+2]=e.data[g+2],m[g+3]=e.data[g+3];f.putImageData(new ImageData(m,e.width,e.height),0,0)}else{if(!("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas))throw new Error("THREE.GLTFExporter: Invalid image type. Use HTMLImageElement, HTMLCanvasElement, ImageBitmap or OffscreenCanvas.");f.drawImage(e,0,0,d.width,d.height)}!0===c.binary?l.push(Ul(d,i).then((function(e){return o.processBufferViewImage(e)})).then((function(e){p.bufferView=e}))):void 0!==d.toDataURL?p.uri=d.toDataURL(i):l.push(Ul(d,i).then((function(e){return(new FileReader).readAsDataURL(e)})).then((function(e){p.uri=e}))),p.uuid=e.uuid;var y=a.images.push(p)-1;return u[h]=y,y}throw new Error("THREE.GLTFExporter: No valid image data found. Unable to process texture.")}},{key:"processSampler",value:function(e){var t=this.json;t.samplers||(t.samplers=[]);var r={magFilter:Rl[e.magFilter],minFilter:Rl[e.minFilter],wrapS:Rl[e.wrapS],wrapT:Rl[e.wrapT]};return t.samplers.push(r)-1}},{key:"processTexture",value:function(e){var r=this.options,n=this.cache,i=this.json;if(n.textures.has(e))return n.textures.get(e);i.textures||(i.textures=[]),e instanceof t.CompressedTexture&&(e=Xc(e,r.maxTextureSize));var o=e.userData.mimeType;"image/webp"===o&&(o="image/png"),e.image.uuid=e.source.uuid;var s={uuid:e.uuid,sampler:this.processSampler(e),source:this.processImage(e.image,e.format,e.flipY,o)};e.name&&(s.name=e.name),this._invokeAll((function(t){t.writeTexture&&t.writeTexture(e,s)}));var a=i.textures.push(s)-1;return n.textures.set(e,a),a}},{key:"processMaterial",value:function(e){var r=this.cache,n=this.json;if(r.materials.has(e))return r.materials.get(e);if(e.isShaderMaterial)return console.warn("GLTFExporter: THREE.ShaderMaterial not supported."),null;n.materials||(n.materials=[]);var i={pbrMetallicRoughness:{}};!0!==e.isMeshStandardMaterial&&!0!==e.isMeshBasicMaterial&&console.warn("GLTFExporter: Use MeshStandardMaterial or MeshBasicMaterial for best results.");var o=e.color.toArray().concat([e.opacity]);if(Ol(o,[1,1,1,1])||(i.pbrMetallicRoughness.baseColorFactor=o),e.isMeshStandardMaterial?(i.pbrMetallicRoughness.metallicFactor=e.metalness,i.pbrMetallicRoughness.roughnessFactor=e.roughness):(i.pbrMetallicRoughness.metallicFactor=.5,i.pbrMetallicRoughness.roughnessFactor=.5),e.metalnessMap||e.roughnessMap){var s=this.buildMetalRoughTexture(e.metalnessMap,e.roughnessMap),a={index:this.processTexture(s),channel:s.channel};this.applyTextureTransform(a,s),i.pbrMetallicRoughness.metallicRoughnessTexture=a}if(e.map){var c={index:this.processTexture(e.map),texCoord:e.map.channel};this.applyTextureTransform(c,e.map),i.pbrMetallicRoughness.baseColorTexture=c}if(e.emissive){var l=e.emissive;if(Math.max(l.r,l.g,l.b)>0&&(i.emissiveFactor=e.emissive.toArray()),e.emissiveMap){var u={index:this.processTexture(e.emissiveMap),texCoord:e.emissiveMap.channel};this.applyTextureTransform(u,e.emissiveMap),i.emissiveTexture=u}}if(e.normalMap){var h={index:this.processTexture(e.normalMap),texCoord:e.normalMap.channel};e.normalScale&&1!==e.normalScale.x&&(h.scale=e.normalScale.x),this.applyTextureTransform(h,e.normalMap),i.normalTexture=h}if(e.aoMap){var p={index:this.processTexture(e.aoMap),texCoord:e.aoMap.channel};1!==e.aoMapIntensity&&(p.strength=e.aoMapIntensity),this.applyTextureTransform(p,e.aoMap),i.occlusionTexture=p}e.transparent?i.alphaMode="BLEND":e.alphaTest>0&&(i.alphaMode="MASK",i.alphaCutoff=e.alphaTest),e.side===t.DoubleSide&&(i.doubleSided=!0),""!==e.name&&(i.name=e.name),this.serializeUserData(e,i),this._invokeAll((function(t){t.writeMaterial&&t.writeMaterial(e,i)})),i.uuid=e.uuid;var d=n.materials.push(i)-1;return r.materials.set(e,d),d}},{key:"processMesh",value:function(e){var r=this.cache,n=this.json,i=[e.geometry.uuid];if(Array.isArray(e.material))for(var o=0,s=e.material.length;o<s;o++)i.push(e.material[o].uuid);else i.push(e.material.uuid);var a=i.join(":");if(r.meshes.has(a))return r.meshes.get(a);var c,l=e.geometry;c=e.isLineSegments?ol:e.isLineLoop?sl:e.isLine?al:e.isPoints?il:e.material.wireframe?ol:cl;var u={},h={},p=[],d=[],f={uv:"TEXCOORD_0",uv1:"TEXCOORD_1",uv2:"TEXCOORD_2",uv3:"TEXCOORD_3",color:"COLOR_0",skinWeight:"WEIGHTS_0",skinIndex:"JOINTS_0"},m=l.getAttribute("normal");void 0===m||this.isNormalizedNormalAttribute(m)||(console.warn("THREE.GLTFExporter: Creating normalized normal attribute from the non-normalized one."),l.setAttribute("normal",this.createNormalizedNormalAttribute(m)));var g=null;for(var y in l.attributes)if("morph"!==y.slice(0,5)){var v=l.attributes[y];y=f[y]||y.toUpperCase();if(/^(POSITION|NORMAL|TANGENT|TEXCOORD_\d+|COLOR_\d+|JOINTS_\d+|WEIGHTS_\d+)$/.test(y)||(y="_"+y),r.attributes.has(this.getUID(v)))h[y]=r.attributes.get(this.getUID(v));else{g=null;var _=v.array;"JOINTS_0"!==y||_ instanceof Uint16Array||_ instanceof Uint8Array||(console.warn('GLTFExporter: Attribute "skinIndex" converted to type UNSIGNED_SHORT.'),g=new t.BufferAttribute(new Uint16Array(_),v.itemSize,v.normalized));var b=this.processAccessor(g||v,l);null!==b&&(y.startsWith("_")||this.detectMeshQuantization(y,v),h[y]=b,r.attributes.set(this.getUID(v),b))}}if(void 0!==m&&l.setAttribute("normal",m),0===Object.keys(h).length)return null;if(void 0!==e.morphTargetInfluences&&e.morphTargetInfluences.length>0){var x=[],w=[],S={};if(void 0!==e.morphTargetDictionary)for(var M in e.morphTargetDictionary)S[e.morphTargetDictionary[M]]=M;for(var T=0;T<e.morphTargetInfluences.length;++T){var E={},A=!1;for(var R in l.morphAttributes)if("position"===R||"normal"===R){var C=l.morphAttributes[R][T],I=R.toUpperCase(),O=l.attributes[R];if(r.attributes.has(this.getUID(C,!0)))E[I]=r.attributes.get(this.getUID(C,!0));else{var P=C.clone();if(!l.morphTargetsRelative)for(var N=0,L=C.count;N<L;N++)for(var U=0;U<C.itemSize;U++)0===U&&P.setX(N,C.getX(N)-O.getX(N)),1===U&&P.setY(N,C.getY(N)-O.getY(N)),2===U&&P.setZ(N,C.getZ(N)-O.getZ(N)),3===U&&P.setW(N,C.getW(N)-O.getW(N));E[I]=this.processAccessor(P,l),r.attributes.set(this.getUID(O,!0),E[I])}}else A||(console.warn("GLTFExporter: Only POSITION and NORMAL morph are supported."),A=!0);d.push(E),x.push(e.morphTargetInfluences[T]),void 0!==e.morphTargetDictionary&&w.push(S[T])}u.weights=x,w.length>0&&(u.extras={},u.extras.targetNames=w)}var D=Array.isArray(e.material);if(D&&0===l.groups.length)return null;var F=!1;if(D&&null===l.index){for(var B=[],k=0,j=l.attributes.position.count;k<j;k++)B[k]=k;l.setIndex(B),F=!0}for(var G=D?e.material:[e.material],z=D?l.groups:[{materialIndex:0,start:void 0,count:void 0}],V=0,H=z.length;V<H;V++){var W={mode:c,attributes:h};if(this.serializeUserData(l,W),d.length>0&&(W.targets=d),null!==l.index){var X=this.getUID(l.index);void 0===z[V].start&&void 0===z[V].count||(X+=":"+z[V].start+":"+z[V].count),r.attributes.has(X)?W.indices=r.attributes.get(X):(W.indices=this.processAccessor(l.index,l,z[V].start,z[V].count),r.attributes.set(X,W.indices)),null===W.indices&&delete W.indices}W.uuid=l.uuid;var Y=this.processMaterial(G[z[V].materialIndex]);null!==Y&&(W.material=Y),p.push(W)}!0===F&&l.setIndex(null),u.primitives=p,n.meshes||(n.meshes=[]),this._invokeAll((function(t){t.writeMesh&&t.writeMesh(e,u)}));var q=n.meshes.push(u)-1;return r.meshes.set(a,q),q}},{key:"detectMeshQuantization",value:function(e,t){if(!this.extensionsUsed[Al]){var r=void 0;switch(t.array.constructor){case Int8Array:r="byte";break;case Uint8Array:r="unsigned byte";break;case Int16Array:r="short";break;case Uint16Array:r="unsigned short";break;default:return}t.normalized&&(r+=" normalized");var n=e.split("_",1)[0];rl[n]&&rl[n].includes(r)&&(this.extensionsUsed[Al]=!0,this.extensionsRequired[Al]=!0)}}},{key:"processCamera",value:function(e){var r=this.json;r.cameras||(r.cameras=[]);var n=e.isOrthographicCamera,i={type:n?"orthographic":"perspective"};return n?i.orthographic={xmag:2*e.right,ymag:2*e.top,zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near}:i.perspective={aspectRatio:e.aspect,yfov:t.MathUtils.degToRad(e.fov),zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near},""!==e.name&&(i.name=e.type),r.cameras.push(i)-1}},{key:"processAnimation",value:function(e,r){var n=this.json,i=this.nodeMap;n.animations||(n.animations=[]);var o=e.uuid;(e=nl.Utils.mergeMorphTargetTracks(e.clone(),r)).uuid=o;for(var s=e.tracks,a=[],c=[],l=0;l<s.length;++l){var u=s[l],h=t.PropertyBinding.parseTrackName(u.name),p=t.PropertyBinding.findNode(r,h.nodeName),d=Cl[h.propertyName];if("bones"===h.objectName&&(p=!0===p.isSkinnedMesh?p.skeleton.getBoneByName(h.objectIndex):void 0),!p||!d)return console.warn('THREE.GLTFExporter: Could not export animation track "%s".',u.name),null;var f=u.values.length/u.times.length;d===Cl.morphTargetInfluences&&(f/=p.morphTargetInfluences.length);var m=void 0;!0===u.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline?(m="CUBICSPLINE",f/=3):m=u.getInterpolation()===t.InterpolateDiscrete?"STEP":"LINEAR",c.push({input:this.processAccessor(new t.BufferAttribute(u.times,1)),output:this.processAccessor(new t.BufferAttribute(u.values,f)),interpolation:m}),a.push({sampler:c.length-1,target:{node:i.get(p),path:d}})}return n.animations.push({uuid:e.uuid,name:e.name||"clip_"+n.animations.length,samplers:c,channels:a}),n.animations.length-1}},{key:"processSkin",value:function(e){var r=this.json,n=this.nodeMap,i=r.nodes[n.get(e)],o=e.skeleton;if(void 0===o)return null;var s=e.skeleton.bones[0];if(void 0===s)return null;for(var a=[],c=new Float32Array(16*o.bones.length),l=new t.Matrix4,u=0;u<o.bones.length;++u)a.push(n.get(o.bones[u])),l.copy(o.boneInverses[u]),l.multiply(e.bindMatrix).toArray(c,16*u);return void 0===r.skins&&(r.skins=[]),r.skins.push({inverseBindMatrices:this.processAccessor(new t.BufferAttribute(c,16)),joints:a,skeleton:n.get(s),uuid:e.skeleton.uuid}),i.skin=r.skins.length-1}},{key:"processNode",value:function(e){var t=this.json,r=this.options,n=this.nodeMap;t.nodes||(t.nodes=[]);var i={};if(r.trs){var o=e.quaternion.toArray(),s=e.position.toArray(),a=e.scale.toArray();Ol(o,[0,0,0,1])||(i.rotation=o),Ol(s,[0,0,0])||(i.translation=s),Ol(a,[1,1,1])||(i.scale=a)}else e.matrixAutoUpdate&&e.updateMatrix(),!1===Ol(e.matrix.elements,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])&&(i.matrix=e.matrix.elements);if(""!==e.name&&(i.name=String(e.name)),this.serializeUserData(e,i),e.isMesh||e.isLine||e.isPoints){var c=this.processMesh(e);null!==c&&(i.mesh=c)}else e.isCamera&&(i.camera=this.processCamera(e));if(e.isSkinnedMesh&&this.skins.push(e),e.children.length>0){for(var l=[],u=0,h=e.children.length;u<h;u++){var p=e.children[u];if(p.visible||!1===r.onlyVisible){var d=this.processNode(p);null!==d&&l.push(d)}}l.length>0&&(i.children=l)}this._invokeAll((function(t){t.writeNode&&t.writeNode(e,i)})),i.uuid=e.uuid;var f=t.nodes.push(i)-1;return n.set(e,f),f}},{key:"processScene",value:function(e){var t=this.json,r=this.options;t.scenes||(t.scenes=[],t.scene=0);var n={};""!==e.name&&(n.name=e.name),t.scenes.push(n);for(var i=[],o=0,s=e.children.length;o<s;o++){var a=e.children[o];if(a.visible||!1===r.onlyVisible){var c=this.processNode(a);null!==c&&i.push(c)}}i.length>0&&(n.nodes=i),this.serializeUserData(e,n)}},{key:"processObjects",value:function(e){var r=new t.Scene;r.name="AuxScene";for(var n=0;n<e.length;n++)r.children.push(e[n]);this.processScene(r)}},{key:"processInput",value:function(e){var r=this.options;e=e instanceof Array?e:[e],this._invokeAll((function(t){t.beforeParse&&t.beforeParse(e)}));for(var n=[],i=0;i<e.length;i++)e[i]instanceof t.Scene?this.processScene(e[i]):n.push(e[i]);n.length>0&&this.processObjects(n);for(var o=0;o<this.skins.length;++o)this.processSkin(this.skins[o]);for(var s=0;s<r.animations.length;++s)this.processAnimation(r.animations[s],e[0]);this._invokeAll((function(t){t.afterParse&&t.afterParse(e)}))}},{key:"_invokeAll",value:function(e){for(var t=0,r=this.plugins.length;t<r;t++)e(this.plugins[t])}}]),e}(),Fl=function(){function e(t){$c(this,e),this.writer=t,this.name="KHR_lights_punctual"}return tl(e,[{key:"writeNode",value:function(e,t){if(e.isLight)if(e.isDirectionalLight||e.isPointLight||e.isSpotLight){var r=this.writer,n=r.json,i=r.extensionsUsed,o={};e.name&&(o.name=e.name),o.color=e.color.toArray(),o.intensity=e.intensity,e.isDirectionalLight?o.type="directional":e.isPointLight?(o.type="point",e.distance>0&&(o.range=e.distance)):e.isSpotLight&&(o.type="spot",e.distance>0&&(o.range=e.distance),o.spot={},o.spot.innerConeAngle=(1-e.penumbra)*e.angle,o.spot.outerConeAngle=e.angle),void 0!==e.decay&&2!==e.decay&&console.warn("THREE.GLTFExporter: Light decay may be lost. glTF is physically-based, and expects light.decay=2."),!e.target||e.target.parent===e&&0===e.target.position.x&&0===e.target.position.y&&-1===e.target.position.z||console.warn("THREE.GLTFExporter: Light direction may be lost. For best results, make light.target a child of the light with position 0,0,-1."),i[this.name]||(n.extensions=n.extensions||{},n.extensions[this.name]={lights:[]},i[this.name]=!0);var s=n.extensions[this.name].lights;s.push(o),t.extensions=t.extensions||{},t.extensions[this.name]={light:s.length-1}}else console.warn("THREE.GLTFExporter: Only directional, point, and spot lights are supported.",e)}}]),e}(),Bl=function(){function e(t){$c(this,e),this.writer=t,this.name="KHR_materials_unlit"}return tl(e,[{key:"writeMaterial",value:function(e,t){if(e.isMeshBasicMaterial){var r=this.writer.extensionsUsed;t.extensions=t.extensions||{},t.extensions[this.name]={},r[this.name]=!0,t.pbrMetallicRoughness.metallicFactor=0,t.pbrMetallicRoughness.roughnessFactor=.9}}}]),e}(),kl=function(){function e(t){$c(this,e),this.writer=t,this.name="KHR_materials_clearcoat"}return tl(e,[{key:"writeMaterial",value:function(e,t){if(e.isMeshPhysicalMaterial&&0!==e.clearcoat){var r=this.writer,n=r.extensionsUsed,i={};if(i.clearcoatFactor=e.clearcoat,e.clearcoatMap){var o={index:r.processTexture(e.clearcoatMap),texCoord:e.clearcoatMap.channel};r.applyTextureTransform(o,e.clearcoatMap),i.clearcoatTexture=o}if(i.clearcoatRoughnessFactor=e.clearcoatRoughness,e.clearcoatRoughnessMap){var s={index:r.processTexture(e.clearcoatRoughnessMap),texCoord:e.clearcoatRoughnessMap.channel};r.applyTextureTransform(s,e.clearcoatRoughnessMap),i.clearcoatRoughnessTexture=s}if(e.clearcoatNormalMap){var a={index:r.processTexture(e.clearcoatNormalMap),texCoord:e.clearcoatNormalMap.channel};1!==e.clearcoatNormalScale.x&&(a.scale=e.clearcoatNormalScale.x),r.applyTextureTransform(a,e.clearcoatNormalMap),i.clearcoatNormalTexture=a}t.extensions=t.extensions||{},t.extensions[this.name]=i,n[this.name]=!0}}}]),e}(),jl=function(){function e(t){$c(this,e),this.writer=t,this.name="KHR_materials_dispersion"}return tl(e,[{key:"writeMaterial",value:function(e,t){if(e.isMeshPhysicalMaterial&&0!==e.dispersion){var r=this.writer.extensionsUsed,n={};n.dispersion=e.dispersion,t.extensions=t.extensions||{},t.extensions[this.name]=n,r[this.name]=!0}}}]),e}(),Gl=function(){function e(t){$c(this,e),this.writer=t,this.name="KHR_materials_iridescence"}return tl(e,[{key:"writeMaterial",value:function(e,t){if(e.isMeshPhysicalMaterial&&0!==e.iridescence){var r=this.writer,n=r.extensionsUsed,i={};if(i.iridescenceFactor=e.iridescence,e.iridescenceMap){var o={index:r.processTexture(e.iridescenceMap),texCoord:e.iridescenceMap.channel};r.applyTextureTransform(o,e.iridescenceMap),i.iridescenceTexture=o}if(i.iridescenceIor=e.iridescenceIOR,i.iridescenceThicknessMinimum=e.iridescenceThicknessRange[0],i.iridescenceThicknessMaximum=e.iridescenceThicknessRange[1],e.iridescenceThicknessMap){var s={index:r.processTexture(e.iridescenceThicknessMap),texCoord:e.iridescenceThicknessMap.channel};r.applyTextureTransform(s,e.iridescenceThicknessMap),i.iridescenceThicknessTexture=s}t.extensions=t.extensions||{},t.extensions[this.name]=i,n[this.name]=!0}}}]),e}(),zl=function(){function e(t){$c(this,e),this.writer=t,this.name="KHR_materials_transmission"}return tl(e,[{key:"writeMaterial",value:function(e,t){if(e.isMeshPhysicalMaterial&&0!==e.transmission){var r=this.writer,n=r.extensionsUsed,i={};if(i.transmissionFactor=e.transmission,e.transmissionMap){var o={index:r.processTexture(e.transmissionMap),texCoord:e.transmissionMap.channel};r.applyTextureTransform(o,e.transmissionMap),i.transmissionTexture=o}t.extensions=t.extensions||{},t.extensions[this.name]=i,n[this.name]=!0}}}]),e}(),Vl=function(){function e(t){$c(this,e),this.writer=t,this.name="KHR_materials_volume"}return tl(e,[{key:"writeMaterial",value:function(e,t){if(e.isMeshPhysicalMaterial&&0!==e.transmission){var r=this.writer,n=r.extensionsUsed,i={};if(i.thicknessFactor=e.thickness,e.thicknessMap){var o={index:r.processTexture(e.thicknessMap),texCoord:e.thicknessMap.channel};r.applyTextureTransform(o,e.thicknessMap),i.thicknessTexture=o}i.attenuationDistance=e.attenuationDistance,i.attenuationColor=e.attenuationColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=i,n[this.name]=!0}}}]),e}(),Hl=function(){function e(t){$c(this,e),this.writer=t,this.name="KHR_materials_ior"}return tl(e,[{key:"writeMaterial",value:function(e,t){if(e.isMeshPhysicalMaterial&&1.5!==e.ior){var r=this.writer.extensionsUsed,n={};n.ior=e.ior,t.extensions=t.extensions||{},t.extensions[this.name]=n,r[this.name]=!0}}}]),e}(),Wl=function(){function e(t){$c(this,e),this.writer=t,this.name="KHR_materials_specular"}return tl(e,[{key:"writeMaterial",value:function(e,t){if(e.isMeshPhysicalMaterial&&(1!==e.specularIntensity||!e.specularColor.equals(Il)||e.specularIntensityMap||e.specularColorMap)){var r=this.writer,n=r.extensionsUsed,i={};if(e.specularIntensityMap){var o={index:r.processTexture(e.specularIntensityMap),texCoord:e.specularIntensityMap.channel};r.applyTextureTransform(o,e.specularIntensityMap),i.specularTexture=o}if(e.specularColorMap){var s={index:r.processTexture(e.specularColorMap),texCoord:e.specularColorMap.channel};r.applyTextureTransform(s,e.specularColorMap),i.specularColorTexture=s}i.specularFactor=e.specularIntensity,i.specularColorFactor=e.specularColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=i,n[this.name]=!0}}}]),e}(),Xl=function(){function e(t){$c(this,e),this.writer=t,this.name="KHR_materials_sheen"}return tl(e,[{key:"writeMaterial",value:function(e,t){if(e.isMeshPhysicalMaterial&&0!=e.sheen){var r=this.writer,n=r.extensionsUsed,i={};if(e.sheenRoughnessMap){var o={index:r.processTexture(e.sheenRoughnessMap),texCoord:e.sheenRoughnessMap.channel};r.applyTextureTransform(o,e.sheenRoughnessMap),i.sheenRoughnessTexture=o}if(e.sheenColorMap){var s={index:r.processTexture(e.sheenColorMap),texCoord:e.sheenColorMap.channel};r.applyTextureTransform(s,e.sheenColorMap),i.sheenColorTexture=s}i.sheenRoughnessFactor=e.sheenRoughness,i.sheenColorFactor=e.sheenColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=i,n[this.name]=!0}}}]),e}(),Yl=function(){function e(t){$c(this,e),this.writer=t,this.name="KHR_materials_anisotropy"}return tl(e,[{key:"writeMaterial",value:function(e,t){if(e.isMeshPhysicalMaterial&&0!=e.anisotropy){var r=this.writer,n=r.extensionsUsed,i={};if(e.anisotropyMap){var o={index:r.processTexture(e.anisotropyMap)};r.applyTextureTransform(o,e.anisotropyMap),i.anisotropyTexture=o}i.anisotropyStrength=e.anisotropy,i.anisotropyRotation=e.anisotropyRotation,t.extensions=t.extensions||{},t.extensions[this.name]=i,n[this.name]=!0}}}]),e}(),ql=function(){function e(t){$c(this,e),this.writer=t,this.name="KHR_materials_emissive_strength"}return tl(e,[{key:"writeMaterial",value:function(e,t){if(e.isMeshStandardMaterial&&1!==e.emissiveIntensity){var r=this.writer.extensionsUsed,n={};n.emissiveStrength=e.emissiveIntensity,t.extensions=t.extensions||{},t.extensions[this.name]=n,r[this.name]=!0}}}]),e}(),Jl=function(){function e(t){$c(this,e),this.writer=t,this.name="EXT_materials_bump"}return tl(e,[{key:"writeMaterial",value:function(e,t){if(e.isMeshStandardMaterial&&(1!==e.bumpScale||e.bumpMap)){var r=this.writer,n=r.extensionsUsed,i={};if(e.bumpMap){var o={index:r.processTexture(e.bumpMap),texCoord:e.bumpMap.channel};r.applyTextureTransform(o,e.bumpMap),i.bumpTexture=o}i.bumpFactor=e.bumpScale,t.extensions=t.extensions||{},t.extensions[this.name]=i,n[this.name]=!0}}}]),e}(),Kl=function(){function e(t){$c(this,e),this.writer=t,this.name="EXT_mesh_gpu_instancing"}return tl(e,[{key:"writeNode",value:function(e,r){if(e.isInstancedMesh){for(var n=this.writer,i=e,o=new Float32Array(3*i.count),s=new Float32Array(4*i.count),a=new Float32Array(3*i.count),c=new t.Matrix4,l=new t.Vector3,u=new t.Quaternion,h=new t.Vector3,p=0;p<i.count;p++)i.getMatrixAt(p,c),c.decompose(l,u,h),l.toArray(o,3*p),u.toArray(s,4*p),h.toArray(a,3*p);var d={TRANSLATION:n.processAccessor(new t.BufferAttribute(o,3)),ROTATION:n.processAccessor(new t.BufferAttribute(s,4)),SCALE:n.processAccessor(new t.BufferAttribute(a,3))};i.instanceColor&&(d._COLOR_0=n.processAccessor(i.instanceColor)),r.extensions=r.extensions||{},r.extensions[this.name]={attributes:d},n.extensionsUsed[this.name]=!0,n.extensionsRequired[this.name]=!0}}}]),e}();nl.Utils={insertKeyframe:function(e,t){var r,n=.001,i=e.getValueSize(),o=new e.TimeBufferType(e.times.length+1),s=new e.ValueBufferType(e.values.length+i),a=e.createInterpolant(new e.ValueBufferType(i));if(0===e.times.length){o[0]=t;for(var c=0;c<i;c++)s[c]=0;r=0}else if(t<e.times[0]){if(Math.abs(e.times[0]-t)<n)return 0;o[0]=t,o.set(e.times,1),s.set(a.evaluate(t),0),s.set(e.values,i),r=0}else if(t>e.times[e.times.length-1]){if(Math.abs(e.times[e.times.length-1]-t)<n)return e.times.length-1;o[o.length-1]=t,o.set(e.times,0),s.set(e.values,0),s.set(a.evaluate(t),e.values.length),r=o.length-1}else for(var l=0;l<e.times.length;l++){if(Math.abs(e.times[l]-t)<n)return l;if(e.times[l]<t&&e.times[l+1]>t){o.set(e.times.slice(0,l+1),0),o[l+1]=t,o.set(e.times.slice(l+1),l+2),s.set(e.values.slice(0,(l+1)*i),0),s.set(a.evaluate(t),(l+1)*i),s.set(e.values.slice((l+1)*i),(l+2)*i),r=l+1;break}}return e.times=o,e.values=s,r},mergeMorphTargetTracks:function(e,r){for(var n=[],i={},o=e.tracks,s=0;s<o.length;++s){var a=o[s],c=t.PropertyBinding.parseTrackName(a.name),l=t.PropertyBinding.findNode(r,c.nodeName);if("morphTargetInfluences"===c.propertyName&&void 0!==c.propertyIndex){if(a.createInterpolant!==a.InterpolantFactoryMethodDiscrete&&a.createInterpolant!==a.InterpolantFactoryMethodLinear){if(a.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline)throw new Error("THREE.GLTFExporter: Cannot merge tracks with glTF CUBICSPLINE interpolation.");console.warn("THREE.GLTFExporter: Morph target interpolation mode not yet supported. Using LINEAR instead."),(a=a.clone()).setInterpolation(t.InterpolateLinear)}var u=l.morphTargetInfluences.length,h=l.morphTargetDictionary[c.propertyIndex];if(void 0===h)throw new Error("THREE.GLTFExporter: Morph target name not found: "+c.propertyIndex);var p=void 0;if(void 0!==i[l.uuid]){var d=a.createInterpolant(new a.ValueBufferType(1));p=i[l.uuid];for(var f=0;f<p.times.length;f++)p.values[f*u+h]=d.evaluate(p.times[f]);for(var m=0;m<a.times.length;m++){var g=this.insertKeyframe(p,a.times[m]);p.values[g*u+h]=a.values[m]}}else{for(var y=new((p=a.clone()).ValueBufferType)(u*p.times.length),v=0;v<p.times.length;v++)y[v*u+h]=p.values[v];p.name=(c.nodeName||"")+".morphTargetInfluences",p.values=y,i[l.uuid]=p,n.push(p)}}else n.push(a)}return e.tracks=n,e}};var Zl=s(162);function Ql(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return $l(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return $l(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,a=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){a=!0,o=e},f:function(){try{s||null==r.return||r.return()}finally{if(a)throw o}}}}function $l(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function eu(e){return eu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},eu(e)}function tu(e){return function(e){if(Array.isArray(e))return ou(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||iu(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ru(){ru=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,i=Object.defineProperty||function(e,t,r){e[t]=r.value},o="function"==typeof Symbol?Symbol:{},s=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function u(e,t,r,n){var o=t&&t.prototype instanceof y?t:y,s=Object.create(o.prototype),a=new I(n||[]);return i(s,"_invoke",{value:E(e,r,a)}),s}function h(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=u;var p="suspendedStart",d="suspendedYield",f="executing",m="completed",g={};function y(){}function v(){}function _(){}var b={};l(b,s,(function(){return this}));var x=Object.getPrototypeOf,w=x&&x(x(O([])));w&&w!==r&&n.call(w,s)&&(b=w);var S=_.prototype=y.prototype=Object.create(b);function M(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function T(e,t){function r(i,o,s,a){var c=h(e[i],e,o);if("throw"!==c.type){var l=c.arg,u=l.value;return u&&"object"==eu(u)&&n.call(u,"__await")?t.resolve(u.__await).then((function(e){r("next",e,s,a)}),(function(e){r("throw",e,s,a)})):t.resolve(u).then((function(e){l.value=e,s(l)}),(function(e){return r("throw",e,s,a)}))}a(c.arg)}var o;i(this,"_invoke",{value:function(e,n){function i(){return new t((function(t,i){r(e,n,t,i)}))}return o=o?o.then(i,i):i()}})}function E(t,r,n){var i=p;return function(o,s){if(i===f)throw new Error("Generator is already running");if(i===m){if("throw"===o)throw s;return{value:e,done:!0}}for(n.method=o,n.arg=s;;){var a=n.delegate;if(a){var c=A(a,n);if(c){if(c===g)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===p)throw i=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=f;var l=h(t,r,n);if("normal"===l.type){if(i=n.done?m:d,l.arg===g)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(i=m,n.method="throw",n.arg=l.arg)}}}function A(t,r){var n=r.method,i=t.iterator[n];if(i===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,A(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),g;var o=h(i,t.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,g;var s=o.arg;return s?s.done?(r[t.resultName]=s.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,g):s:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,g)}function R(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function C(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function I(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(R,this),this.reset(!0)}function O(t){if(t||""===t){var r=t[s];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,o=function r(){for(;++i<t.length;)if(n.call(t,i))return r.value=t[i],r.done=!1,r;return r.value=e,r.done=!0,r};return o.next=o}}throw new TypeError(eu(t)+" is not iterable")}return v.prototype=_,i(S,"constructor",{value:_,configurable:!0}),i(_,"constructor",{value:v,configurable:!0}),v.displayName=l(_,c,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===v||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,_):(e.__proto__=_,l(e,c,"GeneratorFunction")),e.prototype=Object.create(S),e},t.awrap=function(e){return{__await:e}},M(T.prototype),l(T.prototype,a,(function(){return this})),t.AsyncIterator=T,t.async=function(e,r,n,i,o){void 0===o&&(o=Promise);var s=new T(u(e,r,n,i),o);return t.isGeneratorFunction(r)?s:s.next().then((function(e){return e.done?e.value:s.next()}))},M(S),l(S,c,"Generator"),l(S,s,(function(){return this})),l(S,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=O,I.prototype={constructor:I,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(C),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function i(n,i){return a.type="throw",a.arg=t,r.next=n,i&&(r.method="next",r.arg=e),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var s=this.tryEntries[o],a=s.completion;if("root"===s.tryLoc)return i("end");if(s.tryLoc<=this.prev){var c=n.call(s,"catchLoc"),l=n.call(s,"finallyLoc");if(c&&l){if(this.prev<s.catchLoc)return i(s.catchLoc,!0);if(this.prev<s.finallyLoc)return i(s.finallyLoc)}else if(c){if(this.prev<s.catchLoc)return i(s.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return i(s.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var s=o?o.completion:{};return s.type=e,s.arg=t,o?(this.method="next",this.next=o.finallyLoc,g):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),C(r),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;C(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:O(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),g}},t}function nu(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=iu(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,a=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){a=!0,o=e},f:function(){try{s||null==r.return||r.return()}finally{if(a)throw o}}}}function iu(e,t){if(e){if("string"==typeof e)return ou(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?ou(e,t):void 0}}function ou(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function su(e,t,r,n,i,o,s){try{var a=e[o](s),c=a.value}catch(e){return void r(e)}a.done?t(c):Promise.resolve(c).then(n,i)}function au(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function s(e){su(o,n,i,s,a,"next",e)}function a(e){su(o,n,i,s,a,"throw",e)}s(void 0)}))}}function cu(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(i=n.key,o=void 0,o=function(e,t){if("object"!==eu(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==eu(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(i,"string"),"symbol"===eu(o)?o:String(o)),n)}var i,o}window.THREE=t,window.loadBufferGeometry=function(e,r,n){var i=new t.BufferGeometryLoader;if(r){var o=i.parse(JSON.parse(r));n(o)}else{var s=new t.FileLoader;s.crossOrigin="",s.load(e,(function(e){var t=i.parse(JSON.parse(e));n(t)}))}},window.loadMaterial=function(e,t){var r=new Wn,n={};return t.forEach((function(e,t){n[e.uuid]=e})),r.setTextures(n),r.parse(JSON.parse(e))},window.loadAnimationClip=function(e,r,n,i,o){var s,a;function c(e,t,r){if(r||t){var n,i=0,o=Ql(e.tracks);try{for(o.s();!(n=o.n()).done;){var s=n.value,a=s.name.split("."),c=a.pop(),l=a.join("."),u=l;r?u=r[i]:t&&t[l]&&(u=t[l]);var h="".concat(u,".").concat(c);s.name=h,i+=1}}catch(e){o.e(e)}finally{o.f()}}}if(n&&(s=JSON.parse(n)),i&&(a=JSON.parse(i)),r){var l=JSON.parse(r);c(l,s,a);var u=t.AnimationClip.parse(l);o(u)}else{var h=new t.FileLoader;h.crossOrigin="",h.load(e,(function(e){var r=JSON.parse(e);c(r,s,a);var n=t.AnimationClip.parse(r);o(n)}))}},window.loadSource3D=function(e,r,n){if(r){(new t.ObjectLoader).parseImagesAsync([JSON.parse(r)]).then((function(e){var t=Object.values(e)[0],r=Object.keys(e)[0];t.uuid=r,n(t)}))}else{var i=new t.FileLoader;i.crossOrigin="",i.load(e,(function(e){(new t.ObjectLoader).parseImagesAsync([JSON.parse(e)]).then((function(e){var t=Object.values(e)[0],r=Object.keys(e)[0];t.uuid=r,n(t)}))}))}},window.loadTexture3D=function(e,r,n){var i=new ti,o={};r.forEach((function(e,t){o[e.uuid]=e}));var s=JSON.parse(e);null==s.colorSpace&&(3001===s.encoding?s.colorSpace=t.SRGBColorSpace:3e3===s.encoding?s.colorSpace=t.LinearSRGBColorSpace:s.colorSpace=t.NoColorSpace),delete s.encoding;var a=i.parseTextures([s],o),c=Object.values(a)[0],l=Object.keys(a)[0];c?(c.uuid=l,n(c)):n(void 0)},window.loadSkeleton3D=function(e,r,n){var i={};n.traverse((function(e){e.isBone&&(i[e.uuid]=e)})),r((new t.Skeleton).fromJSON(JSON.parse(e),i))},window.loadShape3D=function(e,r,n){if(r){var i=(new t.Shape).fromJSON(JSON.parse(r));n(i)}else{var o=new t.FileLoader;o.crossOrigin="",o.load(e,(function(e){var r=(new t.Shape).fromJSON(JSON.parse(e));n(r)}))}};var lu="cdn-zip-us-aws-e.dora.run",uu=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.messageChannel=new Gc(this),this.cameraController={},this.isProjectLoaded=!1,this.isActive=null!=t.isGridActive,this.isDoraEditor=t.isDoraEditor,this.isTestEnv="test"==t.appEnv,this.postprocessingEnable=!1,this.passItems=[],this.assetHost=t.assetHost,this.isSelfHosted=t.isSelfHosted,this.projectId=t.projectId,this.isLocalhost=t.isLocalhost,this.isActivate=!1,this.mixers={},this.actions={},this.glbModels={},this.geometries={},this.images={},this.textures={},this.skeletons={},this.skeletonInstances={}}var r,n,i,o;return r=e,n=[{key:"createRenderer",value:function(e,t,r,n){var i=this;this.canvas=e,this.editor=new di(this.canvas,t,r,n),this.editor.camera=this.camera,this.editor.viewportCamera=this.viewportCamera,this.editor.app=this,this.viewport=new Tc(this.editor),this.isVisible=!0,this.updateViewportCamera(),new IntersectionObserver((function(e){e.forEach((function(e){e.isIntersecting?i.isVisible=!0:i.isVisible=!1}))})).observe(this.canvas),new Bc(this.editor),this.fileInput=this.createFileInput()}},{key:"pickFiles",value:function(){this.fileInput.click()}},{key:"fileSizeLimit",value:function(e,t){return new Promise((function(r,n){dartFileSizeLimit(e,t,(function(e){r(e)}))}))}},{key:"createFileInput",value:function(){var e=this,t=document.createElement("form");t.style.display="none",document.body.appendChild(t);var r=document.createElement("input");return r.multiple=!0,r.type="file",r.accept=".usdz,.glb,.gltf,.png,.jpg,.jpeg,.3ds,.dae,.fbx,.obj,.ply,.zip,.webp",r.addEventListener("change",au(ru().mark((function n(){var i,o,s,a;return ru().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:i=[],o=nu(r.files),n.prev=2,o.s();case 4:if((s=o.n()).done){n.next=12;break}return a=s.value,n.next=8,e.fileSizeLimit(a.name,a.size);case 8:n.sent&&i.push(a);case 10:n.next=4;break;case 12:n.next=17;break;case 14:n.prev=14,n.t0=n.catch(2),o.e(n.t0);case 17:return n.prev=17,o.f(),n.finish(17);case 20:e.editor.loader.loadFiles(i),t.reset();case 22:case"end":return n.stop()}}),n,null,[[2,14,17,20]])})))),t.appendChild(r),r}},{key:"rendererResize",value:function(e,t){this.editor&&(this.editor.canvasWidth=e,this.editor.canvasHeight=t,this.editor.signals.windowResize.dispatch(e,t))}},{key:"connect",value:function(){this.messageChannel.callMethod("connected")}},{key:"projectReady",value:function(){this.messageChannel.callMethod("project_ready")}},{key:"projectLoaded",value:function(){this.messageChannel.callMethod("project_loaded"),this.isProjectLoaded=!0}},{key:"importModelSuccess",value:function(e){e.updateWorldMatrix(!1,!0);var r=e.toJSON();r.materials.forEach((function(e){e.version=t.REVISION})),console.log(" importModelSuccess  "),console.log(e),console.log(r),this.importModelCallback(JSON.stringify(r),e.modelFileSize)}},{key:"updateObjectCallback",value:function(e,r){if(null!=e){var n=e.uuid;if("rotation"==r)(i=e.rotation.toArray()).pop(),i=i.map((function(e){return e*t.MathUtils.RAD2DEG})),this.doUpdateObjectCallback(n,"rotation",i);else if("position"==r)this.doUpdateObjectCallback(n,"position",e.position.toArray());else if("scale"==r)this.doUpdateObjectCallback(n,"scale",e.scale.toArray());else if("transform"==r){var i;(i=e.rotation.toArray()).pop(),i=i.map((function(e){return e*t.MathUtils.RAD2DEG})),this.doUpdateObjectCallback(n,"rotation",i),this.doUpdateObjectCallback(n,"position",e.position.toArray()),this.doUpdateObjectCallback(n,"scale",e.scale.toArray())}else"widgetSelected"==r?this.doUpdateObjectCallback(n,"widgetSelected",!0):console.log(" updateObjectCallback property ".concat(r," is not support "))}}},{key:"setScene",value:function(e){this.scene=e,this.editor.scene=this.scene,this.updateViewportCamera(),console.log(" setScene  editor "),console.log(this.editor)}},{key:"setCamera",value:function(e){this.camera=e,this.viewportCamera=e,console.log(" setCamera "),console.log(e),this.editor&&(this.editor.aspect&&(this.camera.aspect=this.editor.aspect),this.editor.camera=this.camera,this.editor.viewportCamera=this.viewportCamera,this.viewport.camera=this.editor.viewportCamera,this.updateViewportCamera(),this.viewport.viewHelper&&(this.viewport.viewHelper.editorCamera=this.editor.viewportCamera),this.viewport.createControls(),this.viewport.createTransformControls(),this.viewport.controls.updateConfig(this.cameraController),this.editor.signals.setDefautCamera.dispatch())}},{key:"setViewportCamera",value:function(e){this.viewportCameraUuid=e,this.editor&&(this.updateViewportCamera(),this.editor.signals.viewportCameraChanged.dispatch())}},{key:"updateViewportCamera",value:function(){var e=this;this.scene&&this.camera&&this.viewportCameraUuid&&this.editor&&(this.editor.camera.uuid==this.viewportCameraUuid?this.editor.viewportCamera=this.camera:this.scene.traverse((function(t){t.uuid===e.viewportCameraUuid&&(e.editor.viewportCamera=t)})))}},{key:"setSkeletons",value:function(e){var r,n=this,i=nu(JSON.parse(e));try{for(i.s();!(r=i.n()).done;){var o=r.value,s=new t.FileLoader;s.crossOrigin="",s.load(o,(function(e){var t=JSON.parse(e);n.skeletons[t.uuid]=t}))}}catch(e){i.e(e)}finally{i.f()}}},{key:"setSkeletonInstances",value:function(e){var t,r=nu(e);try{for(r.s();!(t=r.n()).done;){var n=t.value;this.skeletonInstances[n.uuid]=n}}catch(e){r.e(e)}finally{r.f()}}},{key:"setPassItems",value:function(e){this.passItems=JSON.parse(e)}},{key:"setPostprocessingEnable",value:function(e){this.postprocessingEnable=e}},{key:"activate",value:function(){this.isActivate=!0}},{key:"deactivate",value:function(){this.isActivate=!1}},{key:"updateViewportCameraProperty",value:function(e,t){"cameraNear"==e?this.editor.viewportCamera.near=t:"cameraFar"==e?this.editor.viewportCamera.far=t:this.updateCameraControllerProperty(e,t)}},{key:"updateCameraControllerProperty",value:function(e,t){this.cameraController[e]=t,this.editor&&this.editor.signals.updateCameraControllerProperty.dispatch(e,t)}},{key:"updateDefaultCamera",value:function(e,t){if(null!=e){var r=e.uuid,n=t;this.doUpdateObjectCallback(r,"cameraController",n)}}},{key:"doUpdateObjectCallback",value:function(e,t,r){this.updateObjectToAppCallback(e,t,JSON.stringify(r))}},{key:"doUpdateObjectEndCallback",value:function(e,t){this.updateObjectToAppEndCallback(e,t)}},{key:"updateEventCallback",value:function(e,t){this.messageChannel.callMethod("update_event",{eventType:e})}},{key:"updateCamerasCallback",value:function(e){this.messageChannel.callMethod("update_cameras",{cameras:e})}},{key:"updateCameras",value:function(){var e=this.editor.cameras,t=[];for(var r in e){var n=e[r];t.push(n.uuid)}this.updateCamerasCallback(t.join(","))}},{key:"getFileMetaUrl",value:function(e){var t=e.objectName,r="//".concat(this.assetHost,"/");return this.isSelfHosted?"".concat(r).concat(t):"".concat(r).concat(t.substring(0,2),"/").concat(t.substring(2,4),"/").concat(t.substring(4,6),"/").concat(t)}},{key:"getWidgetName",value:function(e,t){return function e(t,r){if(t.uuid===r)return t.name;var n;if(t.children){var i,o=nu(t.children);try{for(o.s();!(i=o.n()).done&&!(n=e(i.value,r)););}catch(e){o.e(e)}finally{o.f()}}return n}(e.scene.object,t)}},{key:"getWidgetIsLocked",value:function(e){return this.messageChannel.callMethod("get_widget_is_locked",e)}},{key:"uploadSceneGlb",value:function(e,t){this.uploadSceneGlbCallback(e,t)}},{key:"loadGlbProgress",value:function(e,t){this.messageChannel.callMethod("load_glb_progress",e,t)}},{key:"widgetSelected",value:function(e,t){var r=pu(this.editor,e);du(this.editor,r,"widgetSelected",t)}},{key:"updateObject",value:function(e){var t=JSON.parse(e),r=pu(this.editor,t.uuid);!function(e,t,r){if(null!=t){var n={};Object.keys(r).forEach((function(i){du(e,t,i,r[i],n)})),t.isCamera&&n.cameraView&&t.updateProjectionMatrix()}}(this.editor,r,t)}},{key:"update3DActive",value:function(e){this.isActive=e}},{key:"getProjectAssetsUuids",value:function(){for(var e=this.editor.scene.toJSON(),t=[],r=0,n=["geometries","materials","textures","skeletons","animations"];r<n.length;r++){var i=e[n[r]];if(null!=i){var o,s=nu(i);try{for(s.s();!(o=s.n()).done;){var a=o.value;t.push(a.uuid)}}catch(e){s.e(e)}finally{s.f()}}}return t.sort(),t.join()}},{key:"setupObjectAnimations",value:function(e){if(void 0!==e.modelAnimations&&0!==e.animations.length){e.modelAnimationsNeedsUpdate=!1;for(var r=e.animations,n=this.mixers,i=this.actions,o=0;o<r.length;o++){var s=r[o];if(null!=s){var a=n[s.uuid];null==a&&(a=new t.AnimationMixer(this.scene),n[s.uuid]=a);var c=i[s.uuid];null==c&&(c=a.clipAction(s,e),i[s.uuid]=c)}}}}},{key:"updateObjectAnimations",value:function(e){if(void 0!==e.modelAnimations&&0!==e.animations.length)for(var t=e.animations,r=this.mixers,n=this.actions,i=JSON.parse(e.modelAnimations),o=function(e){return i.find((function(t){return t.uuid==e}))},s=0;s<t.length;s++){var a=t[s];if(null!=a){var c=o(a.uuid),l=r[a.uuid],u=n[a.uuid];if(l&&u)if(null!=c&&c.enable)if(l.enable=!0,c.autoPlay)u.timeScale=c.speed,u.play(),l.autoPlay=!0;else{var h=c.currentFrame/(60*c.duration)*c.duration;l.setTime(h),u.play(),l.autoPlay=!1}else l.enable=!1,l.autoPlay=!1,u.stop()}}}},{key:"setupAnimations",value:function(){var e=this;this.editor&&this.editor.scene.traverse((function(t){e.setupObjectAnimations(t)}))}},{key:"updateAnimations",value:function(){var e=this;this.editor&&this.editor.scene.traverse((function(t){e.updateObjectAnimations(t)}))}},{key:"exportGlb",value:(o=au(ru().mark((function e(t){var r,n,i;return ru().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=this.editor,n=r.scene,i=hu(n),(new nl).parse(n,function(){var e=au(ru().mark((function e(n){var i;return ru().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=new Uint8Array(n),e.next=5,(0,Zl.R)(i,JSON.parse(t));case 5:n=e.sent,r.app.uploadSceneGlb(JSON.stringify(n.textures),n.buffer),e.next=10;break;case 9:r.app.uploadSceneGlb(JSON.stringify({}),Array.from(i));case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),void 0,{binary:!0,onlyVisible:!1,animations:i});case 5:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"hitTest",value:function(e,t){return null!=this.viewport.hitTest(e,t)}},{key:"screenshot",value:function(){return this.viewport.renderer.domElement.toDataURL("image/png")}},{key:"focusObject",value:function(e){this.editor.focusById(e)}},{key:"syncTransformMode",value:function(e){this.editor.signals.transformModeChanged.dispatch(e)}},{key:"updateEnvironment",value:function(e){this.editor.signals.sceneEnvironmentChanged.dispatch(e,void 0)}},{key:"updateEnvironmentIntensity",value:function(e){this.editor.scene.environmentIntensity=e}},{key:"dispose",value:function(){this.fileInput.remove(),this.editor&&(this.editor.app=null,this.editor.dispose()),this.editor=null,this.viewport&&(this.viewport.dispose(),this.viewport=null)}},{key:"loadScene",value:function(e,r,n){var i=JSON.parse(r),o=new t.LoadingManager;o.setURLModifier((function(e){if(!e.endsWith(".glb")){var t=e.split("/").pop();if(i[t])return i[t]}return e}));var s=new W;s.setDecoderPath("https://"+lu+"/draco3d@1.5.5/");var a=new ve(o);a.setDRACOLoader(s),a.load(e,(function(t){var r,i=t.scene;(r=i.animations).push.apply(r,tu(t.animations)),console.log("=== load scene ".concat(e," ")),console.log(i),console.log(i.toJSON()),n(i)}),(function(e){}),(function(e){}))}}],n&&cu(r.prototype,n),i&&cu(r,i),Object.defineProperty(r,"prototype",{writable:!1}),e}();function hu(e){var t=[];return e.traverse((function(e){null!=e.animations&&t.push.apply(t,tu(e.animations))})),t.filter((function(e){return null!=e}))}function pu(e,t){var r=e.scene,n=e.camera;return t==r.uuid?r:t==n.uuid?n:e.scene.getObjectByProperty("uuid",t)}function du(e,r,n,i,o){switch(n){case"uuid":case"cameraTheta":case"cameraPhi":case"cameraDistance":case"lookAtX":case"lookAtY":case"lookAtZ":case"viewportCamera":break;case"name":r.name=i;break;case"rotateX":r.rotation.x=i/t.MathUtils.RAD2DEG;break;case"rotateY":r.rotation.y=i/t.MathUtils.RAD2DEG;break;case"rotateZ":r.rotation.z=i/t.MathUtils.RAD2DEG;break;case"scaleX":r.scale.x!=i&&(r.scale.x=i);break;case"scaleY":r.scale.y!=i&&(r.scale.y=i);break;case"scaleZ":r.scale.z!=i&&(r.scale.z=i);break;case"locationX":r.position.x!=i&&(r.position.x=i);break;case"locationY":r.position.y!=i&&(r.position.y=i);break;case"locationZ":r.position.z!=i&&(r.position.z=i);break;case"widgetSelected":i?e.select(r):e.selected===r&&e.deselect();break;case"visible":r.visible!=i&&(r.visible=i,r.traverse((function(t){var r=e.helpers[t.id];null!=r&&(r.visible=fu(t))})));break;case"animations":e.doUpdateObjectAnimation(r,i);break;case"children":!function(e,t,r){if(null==r)return;for(var n=r.reverse(),i=0;i<n.length;i++){if(i>=t.children.length||n[i]!=t.children[i].uuid)mu(e.scene.getObjectByProperty("uuid",n[i]),t,i)}if(r.length<t.children.length)for(var o=r.length;o<t.children.length;o++)e.removeObject(t.children[o]),e.deselect()}(e,r,i);break;case"environment":!function(e,t){e.signals.sceneEnvironmentChanged.dispatch(t,void 0)}(e,i);break;case"envIntensity":e.app.updateEnvironmentIntensity(i);break;case"cameraController":!function(e,t){e.app.cameraController=t,e.signals.updateCameraController.dispatch(t)}(e,i);break;case"postprocessingEnable":e.app.postprocessingEnable=i;break;case"passItems":e.app.passItems=i;break;case"near":r.near!=i&&(r.near=i,r.updateProjectionMatrix());break;case"far":r.far!=i&&(r.far=i,r.updateProjectionMatrix());break;default:console.error("_updateObjectProperty ".concat(n," not support yet! "))}}function fu(e){return!!e.visible&&(null==e.parent?e.visible:fu(e.parent))}function mu(e,t,r){return e===t?(console.log("THREE.Object3D.add: object can't be added as a child of itself.",e),t):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=t,t.children.splice(r,0,e),e.dispatchEvent({type:"added"})):console.log("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),t)}window.createThreeApp=function(e,t,r,n){var i=new URLSearchParams(window.location.search),o=i.get("active"),s=i.get("env"),a="localhost:3002"==window.location.host;return new uu({methodName:"newApp",pixelRatio:r,path:"../../",isDoraEditor:!1,isGridActive:o,appEnv:s,isLocalhost:a,projectId:e,assetHost:t,isSelfHosted:n})}})()})();
//# sourceMappingURL=runner.js.map